/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/comp/library','sap/ui/comp/personalization/Controller','sap/ui/comp/personalization/Util','./Util','sap/ui/comp/navpopover/flexibility/changes/AddLink','sap/ui/comp/navpopover/flexibility/changes/RemoveLink','sap/ui/fl/changeHandler/JsControlTreeModifier','./Factory','./LinkData'],function(q,C,a,P,U,A,R,J,F,L){"use strict";var b={};b.isSettingsAvailable=function(){return!!F.getService("CrossApplicationNavigation")&&F.getService("FlexConnector").isVendorLayer();};b.getStableElements=function(n){if(!n||!(n instanceof sap.ui.comp.navpopover.NavigationPopoverHandler)){return null;}var s=n.getNavigationPopoverStableId();if(!s){return null;}var o=n._getAppComponent();if(!o){return null;}return[{id:s,appComponent:o}];};b.execute=function(n,g){return new Promise(function(r,c){if(!n||!(n instanceof sap.ui.comp.navpopover.NavigationPopoverHandler)){return c(new Error("oNavigationPopoverHandler is not of supported type sap.ui.comp.navpopover.NavigationPopoverHandler"));}var s=n.getNavigationPopoverStableId();if(!s){return c(new Error("StableId is not defined. SemanticObject="+n.getSemanticObject()));}var o=n._getAppComponent();if(!o){return c(new Error("AppComponent is not defined. oControl="+n.getControl()));}n._getPopover().then(function(N){b._applyUnsavedChanges(s,g,N,o);var S=P.createSelectionWrapper(U.getStorableAvailableActions(L.convert2Json(N.getAvailableActions())),true);n._destroyPopover();var d=[];var e=new a({table:S,afterP13nModelDataChange:function(E){d=E.getParameters().changeData.selection?E.getParameters().changeData.selection.selectionItems:[];},dialogAfterClose:function(){var f=b._convertSelectionItemsToChangeFormat(d);var h=f.filter(function(m){return m.visible===true;});var i=f.filter(function(m){return m.visible===false;});var j=b._prepareResult(h,sap.ui.comp.navpopover.ChangeHandlerType.addLink,s,o);var k=b._prepareResult(i,sap.ui.comp.navpopover.ChangeHandlerType.removeLink,s,o);r(j.concat(k));}});e.openDialog({contentWidth:"25rem",contentHeight:"35rem",showReset:false,selection:{visible:true}});});});};b._convertSelectionItemsToChangeFormat=function(m){return m.map(function(M){return{key:M.columnKey,visible:M.visible};});};b._prepareResult=function(m,c,s,o){return m.map(function(M){return{selectorControl:{id:s,controlType:"sap.ui.comp.navpopover.NavigationPopover",appComponent:o},changeSpecificData:{changeType:c,content:M}};});};b._applyUnsavedChanges=function(s,g,n,o){var c=g(s,[sap.ui.comp.navpopover.ChangeHandlerType.addLink,sap.ui.comp.navpopover.ChangeHandlerType.removeLink]);c.forEach(function(d){switch(d.getChangeType()){case sap.ui.comp.navpopover.ChangeHandlerType.addLink:A.applyChange(d,n,{modifier:J,appComponent:o});break;case sap.ui.comp.navpopover.ChangeHandlerType.removeLink:R.applyChange(d,n,{modifier:J,appComponent:o});break;}});};return b;},true);
