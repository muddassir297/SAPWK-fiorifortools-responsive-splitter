sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/support/supportRules/WindowCommunicationBus","sap/ui/support/supportRules/ui/models/SharedModel","sap/ui/support/supportRules/ElementTree"],function($,C,J,a,S,E){"use strict";var i={severitytexts:{Error:"Error",Warning:"Warning",Hint:"Information",All:"All Severities"},severitystates:{Error:"Error",Warning:"Warning",Hint:"None",All:"None"},severityicons:{Error:"sap-icon://message-error",Warning:"sap-icon://message-warning",Hint:"sap-icon://message-information",All:"sap-icon://multiselect-all"}};return C.extend("sap.ui.support.supportRules.ui.controllers.Issues",{onInit:function(){a.subscribe("analyzeFinish",function(d){var p={};d.issues.forEach(function(b){if(!b.context||!b.context.id){return;}if(!p[b.context.id]){p[b.context.id]=[b.name];}else{p[b.context.id].push(b.name);}});this.model.setSizeLimit(1000);this.model.setProperty("/issues",d.issues);this.model.setProperty("/selectedIssue",d.issues[0]);this.model.setProperty('/analyzePressed',true);this.model.setProperty("/visibleIssuesCount",d.issues.length);this.elementTree.setData({controls:d.elementTree,issuesIds:p});this.clearFilters();},this);this.model=S;this.getView().setModel(this.model);this.clearFilters();},onAfterRendering:function(){var t=this;this.elementTree=new E(this.getView().byId("elementTreeContainer").getId(),{onIssueCountClicked:function(s){t.clearFilters();t.model.setProperty("/elementFilter",s);t.updateIssuesVisibility();},onHoverChanged:function(h){a.publish("treeElementHover",h);}});},clearFilters:function(){this.model.setProperty("/severityFilter","All");this.model.setProperty("/categoryFilter","All");this.model.setProperty("/elementFilter","All");this.model.setProperty("/audienceFilter","All");this.updateIssuesVisibility();},clearFiltersAndElementSelection:function(){this.clearFilters();this.elementTree.clearSelection();},onIssuePressed:function(e){var p=e.mParameters.listItem,s=p.getBindingContext().getObject();this.model.setProperty("/selectedIssue",s);this.elementTree.setSelectedElement(s.context.id,false);},openDocumentation:function(e){var l=sap.ui.getCore().byId(e.mParameters.id),u=l.getBindingContext().getProperty("href");a.publish("openUrl",u);},updateIssuesVisibility:function(){var v=0;var b=this.getView().byId("issuesList");b.getItems().forEach(function(c){c.updateProperty("visible");});b.getItems().forEach(function(c){if(c.getVisible()){v++;}});this.model.setProperty("/visibleIssuesCount",v);},filterIssueListItems:function(b){var s=this.model.getProperty("/severityFilter"),c=b.severity===s||s==='All',d=this.model.getProperty("/categoryFilter"),e=$.inArray(d,b.categories)>-1||d==='All',f=this.model.getProperty("/elementFilter"),g=f===b.context.id||f==='All',h=this.model.getProperty("/audienceFilter"),j=$.inArray(h,b.audiences)>-1||h==='All';return c&&e&&g&&j;},filterSevirityIcon:function(v){return i.severityicons[v];},filterSevirityState:function(v){return i.severitystates[v];},filterSevirityText:function(v){return i.severitytexts[v];}});});
