/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/EventProvider","./InputDeviceMouse"],function(q,E,I){"use strict";var P=E.extend("sap.ui.vk.InputDevicePointer",{metadata:{publicMethods:["isSupported","enable","disable"]},constructor:function(L){this._loco=L;this._pointerIds=[];this._pointers=[];this._count=0;this._points=0;this._buttons=0;this._mouse=new I(this._loco);}});P.prototype._clearPointers=function(){this._pointerIds=[];this._pointers=[];this._count=0;this._points=0;this._buttons=0;};P.prototype._addPointer=function(i,_,a){if(this._pointerIds[i]==null){this._pointerIds[i]=this._count;}var b=this._pointerIds[i];if(this._pointers.length<=b||this._pointers[b]==null){this._count++;}this._pointers[b]={x:_,y:a};return this._count;};P.prototype._removePointer=function(i){if(this._pointerIds[i]==null){return this._count;}var a=this._pointerIds[i];this._pointerIds[i]=null;if(this._pointers.length>a&&this._pointers[a]!=null){this._count--;}this._pointers[a]=null;return this._count;};P.prototype._eventToInput=function(e){var a={x:0,y:0,z:0,d:0,n:this._count,buttons:0,scroll:0,points:[],handled:false};var t=this._pointers;var l=t.length;for(var i=0;i<l;i++){var b=t[i];if(b!=null){a.points.push({x:b.x,y:b.y,z:0});}}return a;};P.prototype._onpointerdown=function(e){var a=e.originalEvent?e.originalEvent:e;if(a.pointerType!="touch"&&a.pointerType!="pen"){this._buttons=a.buttons;this._mouse._onmousedown(a);return;}if(a.isPrimary){this._clearPointers();}this._addPointer(a.pointerId,a.pageX,a.pageY);a.target.setPointerCapture(a.pointerId);var i=this._eventToInput(a);if(this._points!=0&&this._points!=i.n){this._loco.endGesture(i,this._control);}this._points=i.n;i.handled=false;this._loco.beginGesture(i,this._control);if(i.handled){a["_sapui_handledByControl"]=true;a.preventDefault();}else{this._removePointer(a.pointerId);}};P.prototype._onpointerup=function(e){this._capturedByControl=true;var a=e.originalEvent?e.originalEvent:e;if(a.pointerType!="touch"&&a.pointerType!="pen"){this._buttons=0;this._mouse._onmouseup(a);return;}this._removePointer(a.pointerId);a.target.releasePointerCapture(a.pointerId);var i=this._eventToInput(a);this._loco.endGesture(i,this._control);if(i.n!=0&&this._points!=i.n){i.handled=false;this._loco.beginGesture(i,this._control);}this._points=i.n;if(i.handled){a["_sapui_handledByControl"]=true;a.preventDefault();}};P.prototype._onpointerupWindowListener=function(e){if(!this._capturedByControl){this._onpointerup(e);}this._capturedByControl=false;};P.prototype._onpointermove=function(e){if(e.buttons!==0||sap.ui.Device.system.desktop){var a=e.originalEvent?e.originalEvent:e;if(a.pointerType!="touch"&&a.pointerType!="pen"){if(this._buttons!=a.buttons){this._mouse._onmousedown(a);this._buttons=a.buttons;}else{this._mouse._onmousemove(a);}return;}this._addPointer(a.pointerId,a.pageX,a.pageY);var i=this._eventToInput(a);if(this._points!=i.n){this._loco.endGesture(i,this._control);i.handled=false;this._loco.beginGesture(i,this._control);this._points=i.n;}else{this._loco.move(i,this._control);}if(i.handled){a["_sapui_handledByControl"]=true;a.preventDefault();}}};P.prototype.isSupported=function(){return false;};P.prototype.enable=function(c){this._pointerIds=[];this._pointers=[];this._points=0;this._count=0;this._buttons=0;this._mouse._buttons=0;this._pointerdownProxy=this._onpointerdown.bind(this);this._pointerupProxy=this._onpointerup.bind(this);this._pointermoveProxy=this._onpointermove.bind(this);this._mousewheelProxy=this._mouse._onmousewheel.bind(this._mouse);this._contextmenuProxy=this._mouse._oncontextmenu.bind(this._mouse);this._control=c;this._mouse._control=c;var f=(this._control)?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f("pointerdown",this._pointerdownProxy,false);f("pointerup",this._pointerupProxy,false);f("pointermove",this._pointermoveProxy,false);f("mousewheel",this._mousewheelProxy,false);f("DOMMouseScroll",this._mousewheelProxy,false);f("contextmenu",this._contextmenuProxy,false);window.document.addEventListener("pointerup",this._onpointerupWindowListener.bind(this));};P.prototype.disable=function(){var f=(this._control)?this._control.detachBrowserEvent.bind(this._control):window.document.removeEventListener;f("pointerdown",this._pointerdownProxy);f("pointerup",this._pointerupProxy);f("pointermove",this._pointermoveProxy);f("mousewheel",this._mousewheelProxy);f("DOMMouseScroll",this._mousewheelProxy);f("contextmenu",this._contextmenuProxy);window.document.removeEventListener("pointerup",this._onpointerupWindowListener.bind(this));};return P;},true);
