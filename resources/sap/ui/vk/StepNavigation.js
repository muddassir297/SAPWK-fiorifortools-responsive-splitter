/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","./Loco","./ViewportHandler","sap/ui/core/Popup","sap/ui/core/IconPool","./Messages","./DvlException"],function(q,l,C,R,L,V,P,I,M,D){"use strict";var S=C.extend("sap.ui.vk.StepNavigation",{metadata:{library:"sap.ui.vk",properties:{settings:"object",width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},showThumbnails:{type:"boolean",group:"Appearance",defaultValue:true},showToolbar:{type:"boolean",group:"Appearance",defaultValue:true},showStepInfo:{type:"boolean",group:"Appearance",defaultValue:false}},publicMethods:["setGraphicsCore","setScene","playStep","pauseStep","playAllSteps","getStep","getNextStep","getPreviousStep","getProceduresAndSteps","refresh","clear"],associations:{},aggregations:{procedureItemTemplate:{type:"sap.ui.core.Item",multiple:false},stepInfoPopup:{type:"sap.ui.core.Control",multiple:false},layout:{type:"sap.m.Toolbar",multiple:false},thumbnailsContainer:{type:"sap.m.Panel",multiple:false}},events:{"resize":{parameters:{oldSize:"object",size:"object"}},"stepChanged":{parameters:{clientId:"object",type:"object",stepId:"object"}}}}});S.prototype.setGraphicsCore=function(g){if(g!=this._graphicsCore){if(this._graphicsCore){var o=this._graphicsCore.getApi(sap.ui.vk.GraphicsCoreApi.LegacyDvl);o.Client.detachStepEvent(this._onStepEvent,this);}this._graphicsCore=g;}this.instanceSettings={};this.oDvl=this._graphicsCore.getApi(sap.ui.vk.GraphicsCoreApi.LegacyDvl);this.oDvl.Client.attachStepEvent(this._onStepEvent,this);return this;};S.prototype._onStepEvent=function(p){var s=this.getSettings();this.instanceSettings.currentStepId=p.stepId;switch(p.type){case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_FINISHED:s.currentStepFinished=true;s.currentStepPaused=false;s.playAllActive=false;s.isPlaying=false;this._togglePlayPause(true);break;case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_SWITCHED:case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED:s.currentStepId=p.stepId;s.currentStepFinished=false;this._highlightStep(p.stepId);if(s.currentStepPaused){this.pauseStep();}break;default:q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT12.summary),M.VIT12.code,"sap.ui.vk.StepNavigation");}this.fireStepChanged({clientId:p.clientId,type:p.type,stepId:p.stepId});};S.prototype.hasGraphicsCore=function(){if(this._graphicsCore){return true;}return false;};S.prototype.setScene=function(s){this._scene=s;if(this["_getStepThumbnails"]){if(!this._graphicsCore){this.setGraphicsCore(this._scene.getGraphicsCore());}delete this._procedures;var p=this.getProcedureList();var o=this.getSettings();o.reset();p.unbindItems();p.setSelectedItem(p.getFirstItem());if(o.stepInfo.stepMessagePopup){if(!o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(sap.ui.vk.getResourceBundle().getText("STEP_NAV_STEPDESCRIPTIONHEADING"));}var a=this._getStepThumbnails();this.oModel.setData(a);this._togglePlayPause(true);this._refreshControl();}this.refresh();};S.prototype.init=function(){if(C.prototype.init){C.prototype.init(this);}if(this.getSettings()==undefined){this.setSettings(new this._settings());}this._graphicsCore=null;this.oModel=new sap.ui.model.json.JSONModel();this._layout=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid});this.setAggregation("layout",this._layout);if(this.getShowThumbnails()){this._thumbnailsScroller=new sap.m.ScrollContainer(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false,focusable:true});this._thumbnailsContainer=new sap.m.Panel({expandable:false,content:[this._thumbnailsScroller]});this.setAggregation("thumbnailsContainer",this._thumbnailsContainer);}this.playPreviousButton=new sap.m.Button(this.getId()+"-playPreviousButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-left",tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),visible:true,press:function(e){var s=this.getSettings();var p=this.getPreviousStep(s.currentProcedureIndex);if(p){s.currentStepPaused=false;this.playStep(p.id,true,s.playAllActive);this._togglePlayPause(false);}}.bind(this)});this.playNextButton=new sap.m.Button(this.getId()+"-playNextButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-right",tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_NEXTSTEPBUTTON"),visible:true,press:function(e){var s=this.getSettings();var n=this.getNextStep(s.currentProcedureIndex);if(n){s.currentStepPaused=false;this.playStep(n.id,true,s.playAllActive);this._togglePlayPause(false);}}.bind(this)});this.playOptionButton=new sap.m.Button(this.getId()+"-playOptionButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-play",tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYBUTTON_PLAY"),visible:true,press:function(e){var k=this.getPlayMenuButton().getSelectedKey();var s=this.getSettings();var f=null;switch(k){case"0":if(!s.currentStepId){f=this.getNextStep(s.currentProcedureIndex);if(f){s.currentStepId=f.id;}else{return;}}s.playAllActive=false;this.playStep(s.currentStepId,!s.currentStepPaused,s.playAllActive);s.isPlaying=true;s.currentStepPaused=false;this._togglePlayPause(false);break;case"1":s.playAllActive=true;s.currentStepPaused=false;this.playAllSteps(s.currentProcedureId);s.isPlaying=true;this._togglePlayPause(false);break;case"2":if(!s.currentStepId){f=this.getNextStep(s.currentProcedureIndex);if(f){s.currentStepId=f.id;}else{return;}}s.playAllActive=true;var p=!s.currentStepPaused;s.currentStepPaused=false;this.playStep(s.currentStepId,p,s.playAllActive);s.isPlaying=true;this._togglePlayPause(false);break;default:break;}}.bind(this)});this.procedureList=new sap.m.Select(this.getId()+"-procedureList",{tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PROCEDURESLISTHEADING"),selectedKey:"0",type:sap.m.SelectType.Default,enabled:true,width:"30%",autoAdjustWidth:true,change:function(c){var p=this.getProcedureList();var s=this.getSettings();s.currentProcedureIndex=0;s.currentProcedureId=this.instanceSettings.currentProcedureId=p.getSelectedKey();s.currentStepId=this.instanceSettings.currentStepId=null;for(var i=0;i<this.oModel.oData.procedures.length;i++){if(this.oModel.oData.procedures[i].id==s.currentProcedureId){s.currentProcedureIndex=i;s.currentProcedure=this.oModel.oData.procedures[i];break;}}if(s.stepInfo.stepMessagePopup){if(!s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close();}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;}this._refreshItems();}.bind(this)});this.procedureList.addStyleClass("sapVizKitStepNavigationProcedureList");this.setAggregation("procedureItemTemplate",(new sap.ui.core.ListItem().bindProperty("text","name").bindProperty("key","id").bindProperty("tooltip","name")));this.playMenuButton=(new sap.m.Select(this.getId()+"-playMenuButtonIcon",{selectedKey:"0",type:sap.m.SelectType.Default,tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYOPTIONS"),enabled:true,autoAdjustWidth:false,items:[new sap.ui.core.ListItem({key:"0",icon:"sap-icon://media-play",text:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAY"),tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAY")}),new sap.ui.core.ListItem({key:"1",icon:"sap-icon://media-play",text:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYALL"),tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYALL")}),new sap.ui.core.ListItem({key:"2",icon:"sap-icon://media-play",text:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING"),tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING")})]}));this.playMenuButton.addStyleClass("sapVizKitStepNavigationPlayOptionsSelect");this.pauseButton=new sap.m.Button(this.getId()+"-pauseButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-pause",visible:false,tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PAUSE"),press:function(e){var s=this.getSettings();this.pauseStep();s.currentStepPaused=true;s.isPlaying=false;this._togglePlayPause(true);}.bind(this)});this.showStepInfoButton=new sap.m.ToggleButton(this.getId()+"-showStepInfoButton",{icon:"sap-icon://hide",type:sap.m.ButtonType.Transparent,pressed:false,text:sap.ui.vk.getResourceBundle().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),press:function(e){var t=e.getSource();if(t.getPressed()){this.setShowStepInfo(true);t.setIcon("sap-icon://show");t.setTooltip(sap.ui.vk.getResourceBundle().getText("STEP_NAV_HIDESTEPDESCRIPTIONBUTTON"));}else{this.setShowStepInfo(false);t.setIcon("sap-icon://hide");t.setTooltip(sap.ui.vk.getResourceBundle().getText("STEP_NAV_SHOWSTEPDESCRIPTIONBUTTON"));}}.bind(this)});this._layout.addContent(this.playPreviousButton);this._layout.addContent(this.playOptionButton);this._layout.addContent(this.pauseButton);this._layout.addContent(this.playMenuButton);this._layout.addContent(this.procedureList);this._layout.addContent(this.showStepInfoButton);this._layout.addContent(new sap.m.ToolbarSpacer());this._layout.addContent(this.playNextButton);};S.prototype.destroy=function(){this.setGraphicsCore(null);return C.prototype.destroy.call(this);};S.prototype.getScroller=function(){return this._thumbnailsScroller;};S.prototype.getProcedureList=function(){var i=this.getId()+"-procedureList";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};S.prototype.getPlayMenuButton=function(){var i=this.getId()+"-playMenuButtonIcon";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};S.prototype.getPlayOptionButton=function(){var i=this.getId()+"-playOptionButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};S.prototype.getPauseButton=function(){var i=this.getId()+"-pauseButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};S.prototype.getPlayNextButton=function(){var i=this.getId()+"-playNextButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};S.prototype.getPlayPreviousButton=function(){var i=this.getId()+"-playPreviousButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};S.prototype.getShowStepInfoButton=function(){var i=this.getId()+"-showStepInfoButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};S.prototype.exit=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(C.prototype.exit){C.prototype.exit.apply(this);}};S.prototype._settings=function(){return{enabled:false,toggle:{addCss:function(k,p,o,a){if(!this.targets[k]){this.targets[k]={"type":"css","property":p,"onValue":o,"offValue":a};}},addMethod:function(t,m,o,a,u){var k=t.getId();if(!this.targets[k]){this.targets[k]={"type":"method","target":t,"method":m,"onValue":o,"offValue":a,"useJQuery":u};}},targets:{}},currentProcedureIndex:0,currentProcedureId:"",currentProcedure:null,currentStepId:null,currentStep:null,currentStepPaused:false,isPlaying:false,currentStepFinished:true,playAllActive:false,showToolbar:true,showThumbnails:true,portfolioMode:false,reset:function(){this.currentStep=null;this.currentProcedure=null;this.currentProcedureIndex=0;this.currentProcedureId="";this.currentStepId=null;this.currentStepPaused=false;this.currentStepFinished=true;this.playAllActive=false;this.portfolioMode=false;},stepInfo:{lastTop:null,lastLeft:null,stepMessagePopup:null,openPopup:function(p,t,a,b){this._customHeaderText=this._customHeaderText||new sap.m.Text({width:"100%",textAlign:sap.ui.core.TextAlign.Center}).addStyleClass("sapVizKitStepNavigationPopoverTitle");this._customHeaderText.setText(p);this._customHeaderText.setTooltip(p);this._customHeader=this._customHeader||new sap.m.Bar({contentLeft:[this._customHeaderText]});this._textContent=this._textContent||new sap.m.Text({});this._textContent.addStyleClass("sapVizKitStepNavigationPopoverContent");this._textContent.setText(t);this.stepMessagePopup=this.stepMessagePopup||new sap.m.ResponsivePopover({placement:b,showCloseButton:true,verticalScrolling:true,contentHeight:"10%",contentWidth:"30%",content:[this._textContent],customHeader:this._customHeader});this.stepMessagePopup.addStyleClass("sapVizKitStepNavigationPopoverStepInfo");this.stepMessagePopup.openBy(a);}}};};S.prototype.refresh=function(s){q.sap.log.info("StepNavigation refresh() called.");if(this.getVisible()&&(this["_getStepThumbnails"]&&this._scene!=null)){var p=this.getProcedureList();var o=this.getSettings();o.reset();p.setSelectedItem(p.getFirstItem());var a=this._getStepThumbnails();if(o.stepInfo.stepMessagePopup){if(!o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;}this.oModel.setData(a);this._togglePlayPause(true);this._refreshControl();}else if(this.getVisible()){this._refreshControl();}return true;};S.prototype.clear=function(){q.sap.log.info("StepNavigation clear() called.");return true;};S.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(this.getShowToolbar()){var p=this.getProcedureList();p.setModel(this.oModel);var o=this.getProcedureItemTemplate();p.bindItems("/procedures",o);}};S.prototype.onAfterRendering=function(){if(this._canvas){var a=this.getDomRef();a.appendChild(this._canvas);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._bestFit();this.fireResize({size:{width:a.clientWidth,height:a.clientHeight}});}var s=this.getSettings();this._togglePlayPause(!s.isPlaying);if(s.currentStepId){this._highlightStep(s.currentStepId);}};S.prototype._handleResize=function(e){this.fireResize({oldSize:e.oldSize,size:e.size});this._update();};S.prototype._reset=function(){this._x=0;this._y=0;this._s=1.0;this._r=0;};S.prototype._update=function(){var x=this._x-(this._imageW-this._canvas.clientWidth)/2;var y=this._y-(this._imageH-this._canvas.clientHeight)/2;var t="matrix("+this._s+",0,0,"+this._s+","+x+","+y+")";this._img.style.transform=t;this._img.style.webkitTransform=t;this._img.style.msTransform=t;this._img.style.MozTransform=t;this._img.style.OTransform=t;};S.prototype._bestFit=function(){this._reset();var s=this._canvas.clientWidth/this._img.width;var a=this._canvas.clientHeight/this._img.height;this._s=s<a?s:a;if(this._s==0){this._s=1.0;}this._x=0;this._y=0;this._update();};var d={onAfterRendering:function(e){e.srcControl.focus();e.srcControl.removeEventDelegate(this);}};S.prototype._togglePlayPause=function(p){this.togglePlayPauseActive=true;if(this.getSettings().showToolbar){var a=this.getPlayOptionButton(),b=this.getPauseButton();if(p){if(sap.ui.getCore().getCurrentFocusedControlId()===b.getId()){a.addEventDelegate(d);}b.setVisible(false);a.setVisible(true);}else{if(sap.ui.getCore().getCurrentFocusedControlId()===a.getId()){b.addEventDelegate(d);}a.setVisible(false);b.setVisible(true);}}};S.prototype._refreshControl=function(){var p=this.getProcedureList();var o=this.getProcedureItemTemplate();var s=this.getSettings();if(s.stepInfo.stepMessagePopup){if(!s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close();}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(sap.ui.vk.getResourceBundle().getText("STEP_NAV_STEPDESCRIPTIONHEADING"));}p.unbindItems();if(this.oModel.oData.procedures.length>0){var f=this.oModel.oData.procedures[0];if(this.getShowToolbar()){p.bindItems("/procedures",o);p.selectedKey=f.id;p.enabled=true;}this._refreshItems();}else{if(this.getShowToolbar()){p.bindItems("/procedures",o);p.enabled=false;}if(this.getShowThumbnails()){var a=this.getScroller();a.destroyContent();}}};S.prototype._refreshItems=function(){var t=this;var s=[];var p=this.getProcedureList();var o=t.getSettings();var a=new sap.m.HBox();if(!o.currentProcedure){o.currentProcedure=t.oModel.oData.procedures[o.currentProcedureIndex];p.setSelectedItem(p.getFirstItem());}if(o.currentProcedureId!=""||t.oModel.oData.procedures.length>0){if(t.getShowThumbnails()){var b=t.getScroller();b.removeAllContent();s=t.oModel.oData.procedures[o.currentProcedureIndex].steps;var c=function(f){o.currentStepPaused=false;var g=sap.ui.getCore().byId(f.getSource().getId());t.playStep(g.getCustomData()[0].getValue("stepId"));o.playAllActive=false;t._togglePlayPause(false);};for(var i=0;i<s.length;i++){var e=new sap.m.Image({alt:s[i].name,src:"data:image/"+s[i].thumbnailType+";base64,"+s[i].thumbnailData,densityAware:false,tooltip:s[i].name,press:c.bind(t),layoutData:new sap.m.FlexItemData({shrinkFactor:0})});e.data("stepId",s[i].id);e.addCustomData(new sap.ui.core.CustomData({key:"stepId",value:s[i].id}));e.addStyleClass("sapVizKitStepNavigationStepItem");a.addItem(e);}b.addContent(a);}}};S.prototype._getPopupPlacement=function(e){var p=null;var y=0;while(e){y+=e.offsetTop;e=e.offsetParent;}if(y>200){p=sap.m.PlacementType.Top;}else{p=sap.m.PlacementType.Bottom;}return p;};S.prototype._isScrollingNecessary=function(i,s){var a;if(i&&s){var b=q(i).offset().left+q(i).width();var t=q(s).width();if(b-q(i).width()<0){a=true;}else if((t-b)<q(i).width()){a=true;}else{a=false;}}else{a=false;}return a;};S.prototype._scrollToItem=function(i,s){var p={},o=q(i).offset(),c=q(s).scrollLeft();p.scrollLeft=o.left+(c-q(s).offset().left);p.scrollLeft-=parseInt(q(i).css("marginLeft"),10)||0;p.scrollLeft-=parseInt(q(i).css("borderLeftWidth"),10)||0;q(s).animate(p,50);};S.prototype._highlightStep=function(s){var t=this;if(t.getVisible()){var o=t.getSettings();var a=t.getStep(0,o.currentProcedureIndex,s);if(!o.currentProcedure){o.currentProcedure=t.oModel.oData.procedures[t.oSettings.currentProcedureIndex];}var b=t.getShowStepInfoButton();var p;var c=document.getElementById(b.getId());p=t._getPopupPlacement(c);if(t.getShowStepInfo()){o.stepInfo.openPopup(a.name,a.description,b,p);}else if(o.stepInfo.stepMessagePopup&&o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}if(t.getShowThumbnails()){var e=t.getScroller();var T=e.getContent()[0].getItems();for(var i=0;i<T.length;i++){if(T[i].getCustomData()[0].getValue("stepId")==s){T[i].addStyleClass("selected");if(t._isScrollingNecessary(T[i].$()[0],q("#"+e.sId)[0])){t._scrollToItem(T[i].$()[0],q("#"+e.sId)[0]);}}else{T[i].removeStyleClass("selected");}}}}};S.prototype.getProceduresAndSteps=function(){return this._getStepThumbnails();};S.prototype._getStepThumbnails=function(){var t=this;var p=t._retrieveProcedures();if(p.sceneId!=null){var a;var e;var i;var s;var b;for(var c in p.procedures){var o=p.procedures[c];for(var f in o.steps){s=o.steps[f];a=t.oDvl.Scene.RetrieveThumbnail(p.sceneId,s.id);e=a.substring(a.length-2);b=a.substring(0,3);if(b=="iVB"){i="png";}else if(b!="eff"&&b!="err"){i="jpg";}else if(b=="eff"||b=="err"){i=null;a=null;}if(/,$/.test(e)||/,,$/.test(e)){a=a.substring(0,a.length-4);e=a.substring(a.length-2);}p.procedures[c].steps[f].thumbnailData=a;p.procedures[c].steps[f].thumbnailType=i;}}for(var g in p.portfolios){var h=p.portfolios[g];for(var j in h.steps){s=h.steps[j];a=t.oDvl.Scene.RetrieveThumbnail(p.sceneId,s.id);e=a.substring(a.length-2);b=a.substring(0,3);if(b=="iVB"){i="png";}else if(b!="eff"){i="jpg";}else if(b=="eff"){i=null;}p.portfolios[g].steps[j].thumbnailData=a;p.portfolios[g].steps[j].thumbnailType=i;}}p.hasThumbnails=true;}t._procedures=p;return p;};S.prototype._retrieveProcedures=function(a){var t=this;var p={};if(!t._procedures){p={sceneId:null,hasThumbnails:false,"procedures":[],"portfolios":[]};}else{p=t._procedures;}if(t._scene&&(p.sceneId!=(a||t._scene._dvlSceneId))){var s=a||t._scene._dvlSceneId;if(s!=null){p={sceneId:null,hasThumbnails:false,"procedures":[],"portfolios":[]};try{var b=sap.ui.vk.dvl.getJSONObject(t.oDvl.Scene.RetrieveProcedures(s));if(b!=null){p.hasThumbnails=false;p.sceneId=t._scene._dvlSceneId;p.procedures=b.procedures;p.portfolios=b.portfolios;}}catch(e){if(!(e instanceof D&&e.code===sap.ve.dvl.DVLRESULT.NOTIMPLEMENTED)){throw e;}}}}return p;};S.prototype.getStep=function(r,a,s){var t=this;var b=t.oDvl.Settings.LastLoadedSceneId;var c=null;if(b!=null){a=a!=null?a:0;var e=s?s:t.instanceSettings.currentStepId;var p=t._retrieveProcedures(b);var f=p.procedures[a];if(f&&f.steps.length>0){c=f.steps[0];}else{return null;}if(e!=""){for(var g=0;g<f.steps.length;g++){var _=f.steps[g];if(_.id==e){var x=g+r;if(x<f.steps.length&&x>=0){c=f.steps[x];}else{c=null;}break;}}}}return c;};S.prototype.pauseStep=function(){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){t.oDvl.Scene.PauseCurrentStep(s);}};S.prototype._stepCount=function(a){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;var b=0;if(s!=null){var p=t._retrieveProcedures(s);for(var c=0;c<p.procedures.length;c++){if(p.procedures[c].id==a){b=p.procedures[c].steps.length;break;}else if(a==null){b+=p.procedures[c].steps.length;}}}return b;};S.prototype.getPreviousStep=function(p){var t=this;return t.getStep(-1,p);};S.prototype.getNextStep=function(p){var t=this;return t.getStep(1,p);};S.prototype.playStep=function(a,f,c){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){t.instanceSettings.currentStepId=a;t.oDvl.Scene.ActivateStep(s,a,f!=null?f:true,c!=null?c:false);}};S.prototype.playAllSteps=function(p){var t=this;var a=t.oDvl.Settings.LastLoadedSceneId;if(a!=null){var b=t._retrieveProcedures(a);var c=0;if(p!=null&&b.procedures.length>1){for(var i=0;i<b.procedures.length;i++){if(b.procedures[i].id==p){c=i;break;}}}if(b.procedures.length>0){var s=b.procedures[c].steps[0];if(s){t.instanceSettings.currentStepId=s.id;t.oDvl.Scene.ActivateStep(a,s.id,true,true);}}}};return S;});
