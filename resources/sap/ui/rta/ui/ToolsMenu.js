/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/rta/library','sap/ui/core/Control','sap/m/Toolbar','sap/m/ToolbarLayoutData','sap/m/ToolbarSpacer','sap/m/Label','sap/ui/core/Popup','sap/ui/fl/registry/Settings','sap/ui/fl/Utils','sap/ui/rta/Utils'],function(l,C,T,a,b,L,P,F,c,U){"use strict";var d=C.extend("sap.ui.rta.ui.ToolsMenu",{metadata:{library:"sap.ui.rta",aggregations:{"toolbars":{type:"sap.m.Toolbar",multiple:true,singularName:"toolbar"}},events:{"undo":{},"redo":{},"close":{},"toolbarClose":{},"restore":{},"transport":{}}}});d.prototype.init=function(){this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");};d.prototype.createToolbar=function(t){var s=null;var z=P.getNextZIndex();if(!this._oToolBar){var r=U.getFiori2Renderer();if(r&&!t){this._oToolBar=r.addSubHeader("sap.m.Bar",{},false,true);this._oToolBar.addStyleClass("sapUiRTAFioriToolBar");}else{this._oToolBar=new T({active:true});jQuery("body").prepend('<div id="RTA-Toolbar" style="z-index: '+z+'"></div>');var o=jQuery("#RTA-Toolbar").addClass("sapUiRTAToolsMenuWrapper");o=o[0];this.placeAt(o);this.addToolbar(this._oToolBar);}this._oToolBar.addStyleClass("sapUiRTAToolBar");var A=null;var B=null;var S=null;A=new L({text:this._oRb.getText("TOOLBAR_TITLE"),layoutData:new a({shrinkable:false})});A.bAllowTextSelection=false;s=this._oRb.getText("BTN_UNDO");this._oButtonUndo=new sap.m.Button({type:"Transparent",icon:"sap-icon://undo",enabled:false,tooltip:s,layoutData:new a({shrinkable:false})});this._oButtonUndo.data("Action","UNDO",true);this._oButtonUndo.attachEvent('press',this._onUndo,this);s=this._oRb.getText("BTN_REDO");this._oButtonRedo=new sap.m.Button({type:"Transparent",icon:"sap-icon://redo",iconFirst:false,enabled:false,tooltip:s,layoutData:new a({shrinkable:false})});this._oButtonRedo.data("Action","REDO",true);this._oButtonRedo.attachEvent('press',this._onRedo,this);s=this._oRb.getText("BTN_RESTORE");this._oButtonRestore=new sap.m.Button({type:"Transparent",text:s,visible:true,tooltip:s,layoutData:new a({shrinkable:false})});this._oButtonRestore.data("Action","RESTORE",true);this._oButtonRestore.attachEvent('press',this._onRestore,this);s=this._oRb.getText("BTN_EXIT");B=new sap.m.Button({type:"Transparent",text:s,tooltip:s,layoutData:new a({shrinkable:false})});B.data("Action","EXIT",true);B.attachEvent('press',this.close,this);s=this._oRb.getText("BTN_PUBLISH");this._oButtonPublish=new sap.m.Button({type:"Transparent",text:s,visible:false,tooltip:s,layoutData:new a({shrinkable:false})});this._oButtonPublish.data("Action","TRANSPORT",true);this._oButtonPublish.attachEvent('press',this._onTransport,this);S=new b();return F.getInstance(c.getComponentClassName(this._oRootControl)).then(function(e){var f=!e.isProductiveSystem()&&!e.hasMergeErrorOccured();this._oButtonPublish.setVisible(f);}.bind(this)).catch(function(e){this._oButtonPublish.setVisible(false);}.bind(this)).then(function(){if(U.getFiori2Renderer()){this._oToolBar.addContentLeft(A);this._oToolBar.addContentRight(this._oButtonUndo);this._oToolBar.addContentRight(this._oButtonRedo);this._oToolBar.addContentRight(this._oButtonRestore);this._oToolBar.addContentRight(this._oButtonPublish);this._oToolBar.addContentRight(B);}else{this._oToolBar.addContent(A);this._oToolBar.addContent(S);this._oToolBar.addContent(this._oButtonUndo);this._oToolBar.addContent(this._oButtonRedo);this._oToolBar.addContent(this._oButtonRestore);this._oToolBar.addContent(this._oButtonPublish);this._oToolBar.addContent(B);}sap.ui.getCore().applyChanges();this._oToolBar.addStyleClass("sapUiRTAToolBarContentVisible");}.bind(this));}else{this._oToolBar.addStyleClass("sapUiRTAToolBarContentVisible");}};d.prototype.exit=function(){jQuery("#RTA-Toolbar").remove();};d.prototype._onTransport=function(){this.fireTransport();};d.prototype.show=function(){var r=U.getFiori2Renderer();if(r){r.showSubHeader(this._oToolBar.getId(),false,["home","app"]);r.setHeaderVisibility(false,false,["home","app"]);sap.ui.getCore().applyChanges();}this._oToolBar.addStyleClass("sapUiRTAToolBarVisible");this._oToolBar.removeStyleClass("sapUiRTAToolBarInvisible");};d.prototype.hide=function(){return new Promise(function(r){var t=document.getElementsByClassName("sapUiRTAToolBar")[0];var A=function(){var R=U.getFiori2Renderer();if(R){R.setHeaderVisibility(true,false,["home","app"]);R.hideSubHeader(this._oToolBar.getId(),false,["home","app"]);sap.ui.getCore().applyChanges();this._oToolBar.addStyleClass("sapUiRTAToolBarDisplayNone");}r();this.fireClose();}.bind(this);if(t){t.addEventListener("webkitAnimationEnd",A);t.addEventListener("animationend",A);t.addEventListener("oanimationend",A);this._oToolBar.removeStyleClass("sapUiRTAToolBarContentVisible");this._oToolBar.removeStyleClass("sapUiRTAToolBarVisible");this._oToolBar.addStyleClass("sapUiRTAToolBarInvisible");}else{A();}}.bind(this));};d.prototype._onUndo=function(){this.fireUndo();};d.prototype._onRedo=function(){this.fireRedo();};d.prototype._onRestore=function(){this.fireRestore();};d.prototype.close=function(){this.fireToolbarClose();};d.prototype.setTitle=function(t){var o=this._oToolBar.getContent()[0];o.setText(t);};d.prototype.setRootControl=function(o){this._oRootControl=o;};d.prototype.adaptUndoRedoEnablement=function(e,f){this._oButtonUndo.setEnabled(e);this._oButtonRedo.setEnabled(f);};d.prototype.adaptTransportEnablement=function(e){this._oButtonPublish.setEnabled(e);};d.prototype.adaptRestoreEnablement=function(e){this._oButtonRestore.setEnabled(e);};return d;},true);
