/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/rta/plugin/Plugin','sap/ui/rta/Utils','sap/ui/fl/Utils'],function(P,U,F){"use strict";var S=P.extend("sap.ui.rta.plugin.Selection",{metadata:{library:"sap.ui.rta",properties:{},associations:{},events:{}}});S.prototype._checkVendorLayer=function(o){if(o.getDesignTimeMetadata()){if(this.hasStableId(o)&&F.isVendorLayer()){o.setEditable(true);o.setSelectable(true);return true;}}return false;};S.prototype.registerElementOverlay=function(o){if(!this._checkVendorLayer(o)){o.attachEditableChange(this._onEditableChange,this);this._adaptSelectable(o);}o.attachBrowserEvent("click",this._onClick,this);o.attachBrowserEvent("keydown",this._onKeyDown,this);o.attachBrowserEvent("mousedown",this._onMouseDown,this);};S.prototype._onEditableChange=function(e){var o=e.getSource();this._adaptSelectable(o);};S.prototype._adaptSelectable=function(o){var s=o.getEditable();if(o.getSelectable()!==s){o.setSelectable(s);}};S.prototype.deregisterElementOverlay=function(e){var o=e.getSource();o.detachBrowserEvent("click",this._onClick,this);o.detachBrowserEvent("keydown",this._onKeyDown,this);o.detachBrowserEvent("mousedown",this._onMouseDown,this);o.detachEditableChange(this._onEditableChange,this);};S.prototype._onKeyDown=function(e){var o=U.getFocusedOverlay();if(e.keyCode===jQuery.sap.KeyCodes.ENTER){if((o)&&(!o.isSelected())){o.setSelected(true);e.stopPropagation();}}else if((e.keyCode===jQuery.sap.KeyCodes.ARROW_UP)&&(e.shiftKey===false)&&(e.altKey===false)&&(e.ctrlKey===false)){if(o){var p=o.getParentElementOverlay();if(p&&p.getSelectable()){p.focus();e.stopPropagation();}}}else if((e.keyCode===jQuery.sap.KeyCodes.ARROW_DOWN)&&(e.shiftKey===false)&&(e.altKey===false)&&(e.ctrlKey===false)){if(o){var f=U.getFirstFocusableChildOverlay(o);if(f){f.focus();e.stopPropagation();}}}else if((e.keyCode===jQuery.sap.KeyCodes.ARROW_LEFT)&&(e.shiftKey===false)&&(e.altKey===false)&&(e.ctrlKey===false)){if(o){var a=U.getPreviousFocusableSiblingOverlay(o);if(a){a.focus();e.stopPropagation();}}}else if((e.keyCode===jQuery.sap.KeyCodes.ARROW_RIGHT)&&(e.shiftKey===false)&&(e.altKey===false)&&(e.ctrlKey===false)){if(o){var n=U.getNextFocusableSiblingOverlay(o);if(n){n.focus();e.stopPropagation();}}}};S.prototype._onMouseDown=function(e){if(sap.ui.Device.browser.name=="ie"){var o=sap.ui.getCore().byId(e.currentTarget.id);if(o.getSelectable()){o.focus();e.stopPropagation();}else{o.getDomRef().blur();}e.preventDefault();}};S.prototype._onClick=function(e){var o=sap.ui.getCore().byId(e.currentTarget.id);if(o.getSelectable()){o.setSelected(!o.getSelected());e.preventDefault();e.stopPropagation();}};return S;},true);
