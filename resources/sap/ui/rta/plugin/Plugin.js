/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/dt/Plugin','sap/ui/fl/Utils','sap/ui/fl/registry/ChangeRegistry'],function(P,F,C){"use strict";var B=P.extend("sap.ui.rta.plugin.Plugin",{metadata:{"abstract":true,library:"sap.ui.rta",properties:{userDependentMode:{type:"boolean",defaultValue:false},commandFactory:{type:"object",multiple:false}},events:{elementModified:{command:{type:"sap.ui.rta.command.BaseCommand"}}}}});B.prototype._isEditable=function(){};B.prototype._isEditableByPlugin=function(o){var p=this.getMetadata().getName();var a=o.getEditableByPlugins();return a.indexOf(p)>-1;};B.prototype.registerElementOverlay=function(o){if(this._isEditable(o)){this.addToPluginsList(o);}};B.prototype.deregisterElementOverlay=function(o){this.removeFromPluginsList(o);};B.prototype.hasStableId=function(o){var s=false;var d=o.getDesignTimeMetadata();var e=o.getElementInstance();var p=o.getPublicParentAggregationOverlay()?o.getPublicParentAggregationOverlay().getDesignTimeMetadata():null;if(!p&&o.isInHiddenTree()){return false;}var g;if(o.isInHiddenTree()){g=p.getData().getStableElements;}else{g=d.getData().getStableElements;}if(g){var S=g(e);var u=S?S.some(function(v){var c=v.id||v;if(!F.checkControlId(c,v.appComponent)){return true;}}):true;s=!u;}else{s=F.checkControlId(e);}return s;};B.prototype.checkAggregations=function(o,r,a){var i=false;var c=function(t,p){if(t===r){var A,s;if(p.isInHiddenTree()){A=p.getDesignTimeMetadata().getAction(a,o.getElementInstance());}else{A=p.getDesignTimeMetadata().getAction(a,t.getElementInstance());}s=A?A.changeType:null;var e=r.getElementInstance();if(s&&this.hasChangeHandler(s,e)){i=true;}}else{return c.bind(this,t.getParent(),t)();}};c.bind(this,o)();return i;};B.prototype.checkAggregationsOnSelf=function(o,a){var d=o.getDesignTimeMetadata();var e=o.getElementInstance();var i=false;var A=d.getAggregationAction(a,o.getElementInstance())[0];var c=A?A.changeType:null;if(c&&this.hasChangeHandler(c,e)){i=true;}return i;};B.prototype.removeFromPluginsList=function(o){o.removeEditableByPlugin(this.getMetadata().getName());if(!o.getEditableByPlugins().length){o.setEditable(false);}};B.prototype.addToPluginsList=function(o){o.addEditableByPlugin(this.getMetadata().getName());o.setEditable(true);};B.prototype.hasChangeHandler=function(c,e){var h=false;var s=e.getMetadata().getName();var r=C.getInstance().getRegistryItems({controlType:s,changeTypeName:c});if(r&&r[s]&&r[s][c]){var R=r[s][c];h=!!R.getChangeTypeMetadata().getChangeHandler();}return h;};return B;},true);
