/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/rta/plugin/Plugin','sap/ui/dt/Selection','sap/ui/dt/OverlayRegistry','sap/ui/rta/Utils','sap/ui/fl/Utils'],function(P,S,O,U,F){"use strict";var a=P.extend("sap.ui.rta.plugin.Split",{metadata:{library:"sap.ui.rta",properties:{},associations:{},events:{}}});a.prototype._isEditable=function(o){var d=o.getDesignTimeMetadata();var e=o.getElementInstance();if(!U.getPublicParentDesigntimeMetadata(o)){return false;}var s=this._getSplitAction(o);if(s&&s.changeType){return this.hasStableId(o)&&this.hasChangeHandler(s.changeType,d.getRelevantContainer(e));}else{return false;}};a.prototype._getEffectiveDesignTimeMetadata=function(o){var d;if(o.isInHiddenTree()){var p=o.getPublicParentAggregationOverlay();d=p.getDesignTimeMetadata();}else{d=o.getDesignTimeMetadata();}return d;};a.prototype._getSplitAction=function(o){return this._getEffectiveDesignTimeMetadata(o).getAction("split",o.getElementInstance());};a.prototype.isSplitAvailable=function(o){if(!this._isEditableByPlugin(o)){return false;}var s=this.getDesignTime().getSelection();if(s.length!==1){return false;}var v=this._getSplitAction(o);var e=s[0].getElementInstance();if(v&&v.getControlsCount(e)<=1){return false;}return true;};a.prototype.isSplitEnabled=function(o){var A=this._getSplitAction(o);if(!A||!this.isSplitAvailable(o)){return false;}var b=true;if(typeof A.isEnabled!=="undefined"){if(typeof A.isEnabled==="function"){b=A.isEnabled(o.getElementInstance());}else{b=A.isEnabled;}}return b;};a.prototype.handleSplit=function(s){var p=s.getParent();var e=O.getOverlay(s);var d=this._getEffectiveDesignTimeMetadata(e);var E;if(e.isInHiddenTree()){E=e.getPublicParentElementOverlay().getElementInstance();}else{E=s;}var f=this._getSplitAction(e).getControlsCount(E);var v=F.getViewForControl(E);var n=[];for(var i=0;i<f-1;i++){n.push(v.createId(jQuery.sap.uid()));}var o=this.getCommandFactory().getCommandFor(E,"split",{newElementIds:n,source:s,parentElement:p},d);this.fireElementModified({"command":o});};return a;},true);
