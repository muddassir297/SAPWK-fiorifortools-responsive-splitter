(function(){"use strict";jQuery.sap.declare("sap.ovp.cards.generic.Component");jQuery.sap.require("sap.ui.core.UIComponent");jQuery.sap.require("sap.ovp.cards.AnnotationHelper");jQuery.sap.require("sap.ovp.cards.LoadingUtils");sap.ui.core.UIComponent.extend("sap.ovp.cards.generic.Component",{metadata:{properties:{"contentFragment":{"type":"string"},"headerExtensionFragment":{"type":"string"},"contentPosition":{"type":"string","defaultValue":"Middle"},"footerFragment":{"type":"string"},"identificationAnnotationPath":{"type":"string","defaultValue":"com.sap.vocabularies.UI.v1.Identification"},"selectionAnnotationPath":{"type":"string"},"filters":{"type":"object"},"addODataSelect":{"type":"boolean","defaultValue":false}},version:"1.46.0",library:"sap.ovp",includes:[],dependencies:{libs:["sap.m"],components:[]},config:{}},getCustomPreprocessor:function(){},getPreprocessors:function(p){var c=this.getComponentData(),s=c.settings,m=c.model,M,e,E,o;if(s.description&&!s.subTitle){s.subTitle=s.description;}if(m){M=m.getMetaModel();if(s.entitySet){var a=M.getODataEntitySet(s.entitySet);var b=M.getODataEntitySet(s.entitySet,true);e=M.getODataEntityType(a.entityType);o=M.createBindingContext(b);E=M.createBindingContext(e.$path);}}var C=this._getCardPropertyDefaults();var d=this._completeLayoutDefaults(C,s);var f;var g;if(c.appComponent&&c.appComponent.getModel("ui")&&c.appComponent.getModel("ui").oData){f=c.appComponent.getModel("ui").oData.showDateInRelativeFormat;g=c.appComponent.getModel("ui").oData.disableTableCardFlexibility;}var A={metaModel:M,entityType:e,webkitSupport:sap.ui.Device.browser.webkit,layoutDetail:d&&d.cardLayout?d.cardLayout.containerLayout:'fixed',showDateInRelativeFormat:f,disableTableCardFlexibility:g};if(c&&c.cardId){var h=c.mainComponent;var t=h._getCardFromManifest(c.cardId).template;A.template=t;}C.densityStyle=this._setCardpropertyDensityAttribute();if(d){A.cardLayout=d.cardLayout;}if(C.state!=="Loading"){if(s&&s.selectionPresentationAnnotationPath){var S=e[s.selectionPresentationAnnotationPath];if(S){var i=S.SelectionVariant&&S.SelectionVariant.AnnotationPath;if(i){if(/^@/.test(i)){i=i.slice(1);}s.selectionAnnotationPath=i;}var P=S.PresentationVariant&&S.PresentationVariant.AnnotationPath;if(P){if(/^@/.test(S.PresentationVariant.AnnotationPath)){P=P.slice(1);}s.presentationAnnotationPath=P;var v=e[P].Visualizations[0].AnnotationPath;if(v){if(/^@/.test(v)){v=v.slice(1);}if(/.LineItem/.test(v)){s.annotationPath=v;}if(/.Chart/.test(v)){s.chartAnnotationPath=v;}}}}}}if(C.state&&(C.state==="Loading"||C.state==="Error")&&sap.ovp.cards.LoadingUtils.bPageAndCardLoading){C.footerFragment="sap.ovp.cards.loading.LoadingContent";}C=jQuery.extend(true,A,C,s);var O=new sap.ui.model.json.JSONModel(C);var D=new sap.ui.model.json.JSONModel(sap.ui.Device);D.setDefaultBindingMode("OneWay");var j={xml:{bindingContexts:{entityType:E,entitySet:o},models:{device:D,entityType:M,entitySet:M,ovpMeta:M,ovpCardProperties:O,ovplibResourceBundle:p},ovpCardProperties:O,dataModel:m,_ovpCache:{}}};return jQuery.extend(true,{},this.getCustomPreprocessor(),j);},_completeLayoutDefaults:function(c,s){var C=null,o=this.getComponentData(),u=null,a=null,r=null;if(o.appComponent){u=o.appComponent.getModel("ui");a=o.appComponent.getOvpConfig();}if(!a){return null;}if(a.containerLayout==="resizable"){r=o.appComponent.getDashboardLayoutUtil().getRowHeightPx();if(s.defaultSpan){C={cardLayout:{colSpan:s.defaultSpan.cols,rowSpan:s.defaultSpan.rows}};}else{C={cardLayout:{colSpan:1,rowSpan:12}};}var d=u.getProperty("/initialDashboardLayout");var b=o.cardId;for(var i=0;i<d.length;i++){var D=d[i];if(D[b]){C.cardLayout=D[b];break;}}if(r){C.cardLayout.iRowHeigthPx=r;C.cardLayout.iCardHeightPx=r*C.cardLayout.rowSpan;}}else{if(a.cards[o.cardId]&&a.cards[o.cardId].template==="sap.ovp.cards.linklist"){C={cardLayout:{items:5}};}}if(C){C.cardLayout.containerLayout=a.containerLayout;}return C;},_getCardPropertyDefaults:function(){var c={};var p=this.getMetadata().getAllProperties();var P;for(var a in p){P=p[a];if(P.defaultValue!==undefined){c[P.name]=P.defaultValue;}}return c;},getOvplibResourceBundle:function(){if(!this.ovplibResourceBundle){var r=sap.ui.getCore().getLibraryResourceBundle("sap.ovp");this.ovplibResourceBundle=r?new sap.ui.model.resource.ResourceModel({bundleUrl:r.oUrlInfo.url}):null;}return this.ovplibResourceBundle;},createContent:function(){var c=this.getComponentData&&this.getComponentData();var m=c.model;var p;var P;if(c&&c.mainComponent){p=c.mainComponent._getOvplibResourceBundle();}else{p=this.getOvplibResourceBundle();}P=this.getPreprocessors(p);var v;v=sap.ui.view({preprocessors:P,type:sap.ui.core.mvc.ViewType.XML,viewName:"sap.ovp.cards.generic.Card"});v.setModel(m);if(c.i18n){v.setModel(c.i18n,"@i18n");}v.setModel(P.xml.ovpCardProperties,"ovpCardProperties");v.setModel(p,"ovplibResourceBundle");return v;},getContentDensityClass:function(){if(this._sContentDensityClass===undefined){if(jQuery(document.body).hasClass("sapUiSizeCozy")||jQuery(document.body).hasClass("sapUiSizeCompact")){if(jQuery(document.body).hasClass("sapUiSizeCozy")===true){this._sContentDensityClass="sapUiSizeCozy";}else if(jQuery(document.body).hasClass("sapUiSizeCompact")===true){this._sContentDensityClass="sapUiSizeCompact";}else{this._sContentDensityClass="";}}else if(!sap.ui.Device.support.touch){this._sContentDensityClass="sapUiSizeCompact";}else{this._sContentDensityClass="sapUiSizeCozy";}}return this._sContentDensityClass;},_setCardpropertyDensityAttribute:function(){var c=this.getContentDensityClass();if(c==="sapUiSizeCompact"){return"compact";}else if(c==="sapUiSizeCozy"){return"cozy";}else if(!sap.ui.Device.support.touch){return"compact";}else{return"cozy";}}});})();
