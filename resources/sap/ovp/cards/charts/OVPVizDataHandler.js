sap.ui.define(["sap/ui/core/Control"],function(C){"use strict";return C.extend("sap.ovp.cards.charts..OVPVizDataHandler",{metadata:{aggregations:{data:{type:"sap.ui.core.Element"},content:{multiple:false}},properties:{chartType:{defaultValue:false},scale:{defaultValue:""}}},renderer:function(r,c){r.write("<div");r.writeElementData(c);r.write(">");if(c.getContent()){r.renderControl(c.getContent());}r.write("</div>");},updateBindingContext:function(){var b=this.getBinding("data");var t=this;if(this.bindingC==b){return;}else{this.bindingC=b;if(b){var t=this;b.attachEvent("dataReceived",function(e){var d=e&&e.getParameter("data");var D=jQuery.extend(true,{},d);if(t.getChartType()=="donut"&&d.results.length>0&&d.results.length<d.__count){t.readAggregateNumber(b,d,function(r){D.results.push(r);var m=new sap.ui.model.json.JSONModel();m.setData(D.results);t.getContent().setModel(m,"analyticalmodel");});}else{var m=new sap.ui.model.json.JSONModel();m.setData(d.results);t.getContent().setModel(m,"analyticalmodel");}});}C.prototype.updateBindingContext.apply(this,arguments);}},readAggregateNumber:function(b,d,c){this.aggregate;var m=this.getModel();var p=b.mParameters;var D=jQuery.extend(true,{},d);var s=p.select.split(",");var e=b.getPath().substring(1);var a=-1;if(e){a=e.indexOf('Parameters');}if(a>=0){e=e.substr(0,e.indexOf('Parameters'));}var f=m.getMetaModel();var g=f.getODataEntitySet(e);var h=f.getODataEntityType(g.entityType);var k=[];var l=[];for(var i=0;i<h.property.length;i++){if(h.property[i]["com.sap.vocabularies.Analytics.v1.Measure"]||(h.property[i].hasOwnProperty("sap:aggregation-role")&&h.property[i]["sap:aggregation-role"]==="measure")){if(s.indexOf(h.property[i].name)!==-1){k.push(h.property[i].name);}}else{if(s.indexOf(h.property[i].name)!==-1){l.push(h.property[i].name);}}}for(var i=0;i<D.results.length-1;i++){for(var j=0;j<k.length;j++){D.results[0][k[j]]=Number(D.results[0][k[j]])+Number(D.results[i+1][k[j]]);}}var n=d.__count-D.results.length;var o={};o.results=[];o.results[0]=D.results[0];var q={};q.urlParameters=[b.sFilterParams,"$select="+k.join(","),"$top=1"];q.success=jQuery.proxy(function(r){var t=jQuery.extend(true,{},r);jQuery.each(k,function(i){t.results[0][k[i]]=String(Number(r.results[0][k[i]])-Number(o.results[0][k[i]]));});jQuery.each(l,function(i){t.results[0][l[i]]=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("OTHERS_DONUT",[n]);});t.results[0].$isOthers=true;c(t.results[0]);},this);m.read(b.getPath(),q);}});},true);
