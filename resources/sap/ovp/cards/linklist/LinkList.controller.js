(function(){"use strict";var I=72,a=56,b=48,c=60,d=48,f=40,C=27,g=8,L=8,h=8,O="ovpLinkList",P="pictureCarousel",l="ovpCardHeader";var D={onBeforeRendering:function(e){this.itemOnBeforeRendering(e);}};var o={onAfterRendering:function(e){this.itemOnAfterRendering(e);}};sap.ui.controller("sap.ovp.cards.linklist.LinkList",{onInit:function(){this._bInitialLoad=true;this._bListenerAttached=false;},onBeforeRendering:function(e){var i=this.getCardPropertiesModel();if(i.getProperty("/listFlavor")==="standard"&&!i.getProperty("/staticContent")){var j=this.byId("ovpCLI");if(j){j.addEventDelegate(D,this);}}},onAfterRendering:function(e){this.attachingListenerToTheEventRefresh();var i=this.getCardPropertiesModel();var r=i.getProperty("/cardLayout/rowSpan");var j=i.getProperty("/cardLayout/colSpan");switch(i.getProperty("/listFlavor")){case"standard":if(i.getProperty("/staticContent")){if(j&&r){this._itemOnEventBuildStandard(i,j,r,true);}else{this._aLinkListIds=[O];this._setListColumnWidthInStandardCard(1);}}break;case"carousel":if(i.getProperty("/staticContent")){if(r){this._setListHeightInCarouselCard(r);}this._setCarouselImageProperties();}else{var k=this.byId(P);k.addEventDelegate(o,this);}break;case"grid":jQuery.sap.log.info("FYI: currently nothing special to handle here");break;}},getCardItemsBinding:function(){var e=this.getView().byId("ovpLinkList");if(e){return e.getBinding("items");}else{return null;}},attachingListenerToTheEventRefresh:function(){var e=this.getCardItemsBinding();if(e){if(!this._bListenerAttached){e.attachRefresh(function(){if(this._aLinkListIds){for(var i=1;i<this._aLinkListIds.length;i++){var j=this.byId(this._aLinkListIds[i]);var k=j.getItems().length;j.getItems().splice(0,k);j.destroy();}this._aLinkListIds.splice(0,this._aLinkListIds.length);}if(this._oListRest){this._oListRest.destroy();}}.bind(this));e.attachChange(function(){this.settingHeightAndWidthOfLinkListCardsOnManageCardAndFilter();var t=e.getLength();if(t===0){var i=this.byId(O).$().parent();i.width("100%");}}.bind(this));}else if(this._aLinkListIds){this.settingHeightAndWidthOfLinkListCardsOnManageCardAndFilter();}this._bListenerAttached=true;}},settingHeightAndWidthOfLinkListCardsOnManageCardAndFilter:function(){if(this._aLinkListIds){var e=this.getCardPropertiesModel();var r=e.getProperty("/cardLayout/rowSpan");var i=e.getProperty("/cardLayout/colSpan");if(r){this._setListHeightInStandardCard(r);}if(i){this._setListColumnWidthInStandardCard(i);}else{this._setListColumnWidthInStandardCard(1);}}},itemOnBeforeRendering:function(e){var i=this.getCardPropertiesModel();switch(i.getProperty("/listFlavor")){case"standard":var r=i.getProperty("/cardLayout/rowSpan");var k=i.getProperty("/cardLayout/colSpan");var m=this.byId(O);var n=m.getItems();for(var j=0;j<n.length;j++){n[j].removeEventDelegate(D);}if(this._bInitialLoad){this._itemOnEventBuildStandard(i,k,r,true);}else{this._itemOnEventBuildStandard(i,k,r,false);}break;case"carousel":jQuery.sap.log.info("FYI: currently nothing special to handle here");break;case"grid":jQuery.sap.log.info("FYI: currently nothing special to handle here");break;}},itemOnAfterRendering:function(E){var i=this.getCardPropertiesModel();var r=i.getProperty("/cardLayout/rowSpan");var j=i.getProperty("/cardLayout/colSpan");switch(i.getProperty("/listFlavor")){case"standard":try{var k=this.byId(O);var m=k.getItems(this._aLinkListIds[this._aLinkListIds.length-1]);m[m.length-1].removeEventDelegate(o);}catch(e){jQuery.sap.log.info("FYI: Unable to remove the delagted event at the last item of the last list");}if(r){this._setListHeightInStandardCard(r);}if(j){this._setListColumnWidthInStandardCard(j);}else{this._setListColumnWidthInStandardCard(1);}break;case"carousel":try{var n=this.byId(P);n.removeEventDelegate(o);}catch(e){jQuery.sap.log.info("FYI: Unable to remove the delagted event on the carousel");}if(r){this._setListHeightInCarouselCard(r);}this._setCarouselImageProperties();break;case"grid":jQuery.sap.log.info("FYI: currently nothing special to handle here");break;}},_itemOnEventBuildStandard:function(k,m,r,n){var p;var q=this.byId(O);if(n&&this._oListRest===undefined){this._oListRest=new sap.m.List(this.getView().getId()+"--RestOfData",{});}this._aLinkListIds=[O];this._iAvailableItems=q.getItems().length;var s=k.getProperty("/cardLayout/items");if(s!==undefined){this._iNoOfItemsPerColumn=s;p=s;this._iVisibleColums=1;}else{var t=I;try{t=this._getLinkListItemHeight();}catch(e){jQuery.sap.log.info("Error: "+e);}var u=this._getListHeightInStandardCard(r);this._iNoOfItemsPerColumn=Math.floor(u/t);var N=Math.ceil(this._iAvailableItems/this._iNoOfItemsPerColumn);this._iVisibleColums=Math.min(N,m);p=this._iVisibleColums*this._iNoOfItemsPerColumn;}if(p>this._iAvailableItems){p=this._iAvailableItems;}else{for(var i=p;i<this._iAvailableItems;i++){this._oListRest.addItem(q.getItems()[p]);}}if(this._iVisibleColums>1){var v=this.byId("ovpListRow");var w=this._iNoOfItemsPerColumn;var x=0;for(var j=this._iNoOfItemsPerColumn;j<p;j++){if(w>=this._iNoOfItemsPerColumn){w=0;x++;var y=O+x;var z=new sap.m.List(this.getView().getId()+"--"+y,{showSeparators:q.getProperty("showSeparators")});this._aLinkListIds.push(y);if(q.hasStyleClass("_iNoOfItemsPerColumnPaddingCozy")){z.addStyleClass("sapOvpLinkListStandardPaddingCozy");}else{z.addStyleClass("sapOvpLinkListStandardPaddingCompact");}v.addItem(z);}z.addItem(q.getItems()[this._iNoOfItemsPerColumn]);w++;}var A=z.getItems();A[A.length-1].addEventDelegate(o,this);}else{if(n){this.itemOnAfterRendering(null);}else{var B=q.getItems();B[B.length-1].addEventDelegate(o,this);}}},resizeCard:function(n,$){var e=this.getCardPropertiesModel();e.setProperty("/cardLayout/rowSpan",n.rowSpan);e.setProperty("/cardLayout/colSpan",n.colSpan);switch(e.getProperty("/listFlavor")){case"standard":this._resizeStandard(n,e,$);break;case"carousel":this._resizeCarousel(n);break;case"grid":this._resizeGrid(n);break;}if(this.resizeHandlerId){sap.ui.core.ResizeHandler.deregister(this.resizeHandlerId);this.resizeHandlerId=null;}},_resizeStandard:function(n,m,$){if(this._aLinkListIds){var p=this.byId(this._aLinkListIds[0]);for(var i=1;i<this._aLinkListIds.length;i++){var q=this.byId(this._aLinkListIds[i]);var r=q.getItems().length;for(var j=0;j<r;j++){p.addItem(q.getItems()[0]);}q.destroy();}this._aLinkListIds.splice(0,this._aLinkListIds.length);var R=this._oListRest.getItems().length;try{for(var k=0;k<R;k++){p.addItem(this._oListRest.getItems()[0]);}}catch(e){jQuery.sap.log.info("Error: "+e);}if(!p){var s=this.byId(O).$().parent();s.width("100%");var m=this.getCardPropertiesModel();var t=m.getProperty("/cardLayout/rowSpan");if(t){this._setListHeightInStandardCard(t);}}var B=p.getBindingInfo("items");var u=this._getLinkListItemHeight();var N=this._getListHeightInStandardCard(n.rowSpan);var v=Math.floor(N/u)*n.colSpan;this._bInitialLoad=false;jQuery($).find(".sapOvpWrapper").css({height:N+"px"});if(B){if(v>this._iAvailableItems&&B.length<=this._iAvailableItems){B.length=v;p.bindItems(B);this._bListenerAttached=false;this.attachingListenerToTheEventRefresh();}else{this._itemOnEventBuildStandard(m,n.colSpan,n.rowSpan,false);}}else{this._itemOnEventBuildStandard(m,n.colSpan,n.rowSpan,false);}}},_resizeCarousel:function(n){var e=this.byId(P);e.next();e.previous();this._setListHeightInCarouselCard(n.rowSpan);this._setCarouselImageProperties();},_resizeGrid:function(n){var G=this.getView().byId("ovpLinkListGrid");var s=parseInt(this.getView().byId("idColSpan").getValue(),10);var N=n.colSpan;if(n.colSpan>5){N=5;}this.getView().byId("idColSpan").setValue(N);if(N!==s){var S="sapOvpCardLinkListGridColSpan"+s;G.removeStyleClass(S);var e="sapOvpCardLinkListGridColSpan"+N;G.addStyleClass(e);}var j=n.rowSpan*n.colSpan*2;var B=G.getBindingInfo("items");var k=G.getItems();if(j>k.length){B.length=j;G.bindItems(B);}else if(j<k.length){var r=k.length-j;var m=k.length-1;for(var i=0;i<r;i++){var p=m-i;G.removeItem(p);}}},_setListHeightInCarouselCard:function(r){var i=0;if(r){var H=0;var e=this.byId(l);if(e){H=e.$().outerHeight();}var j=this.getCardPropertiesModel();var R=j.getProperty("/cardLayout/iRowHeigthPx");i=(r*R)-(H+C+g);var k=this.byId(P);k.$().height(i+16);}},_setCarouselImageProperties:function(){var e=this.getCardPropertiesModel();var r=e.getProperty("/cardLayout/rowSpan");var i=e.getProperty("/cardLayout/colSpan");if(r&&i){var j=this.byId(P),k=this.byId(l),m=null,p=null,s,n;if(j.getPages().length===1&&k){p=sap.ui.getCore().byId(j.getActivePage());if(p&&p.getItems()[p.getItems().length-1]instanceof sap.m.Image){m=p.getItems()[p.getItems().length-1];if(p.getItems().length===1){s=j.$().height();}else{s=j.$().height()-p.getItems()[0].$().outerHeight();}if(s){s=s+"px";m.setHeight(s);}n=k.$().outerWidth();if(n){n=n+"px";m.setWidth(n);}m.setMode(sap.m.ImageMode.Background);m.setBackgroundPosition("center center");}}}},_setListHeightInStandardCard:function(r){var n=0;var e;var j;e=this.byId(O);if(e){n=this._getListHeightInStandardCard(r);j=e.$().parent();j.height(n);}if(this._aLinkListIds){for(var i=1;i<this._aLinkListIds.length;i++){e=this.byId(this._aLinkListIds[i]);n=this._getListHeightInStandardCard(r);j=e.$().parent();j.height(n);}}},_getListHeightInStandardCard:function(r){var i=0;var e=this.getCardPropertiesModel();if(r){var H=0;var j=this.byId(l);if(j){H=j.$().outerHeight();}var R=e.getProperty("/cardLayout/iRowHeigthPx");i=(r*R)-(H+L+h);}return i;},_setListColumnWidthInStandardCard:function(i){var e;var k;var s="100%";if(this._aLinkListIds){if(this._aLinkListIds.length>1){for(var j=0;j<this._aLinkListIds.length;j++){e=this.byId(this._aLinkListIds[j]);k=e.$().parent();s=(100/i)+"%";k.width(s);}}else{e=this.byId(this._aLinkListIds[0]);if(e){k=e.$().parent();k.width(s);}}}},_getLinkListItemHeight:function(s){var i=(s)?s:O;var k=this.getCardPropertiesModel(),m=this.byId(i),n=I,p="",t=false,S=false,N=1,q=k.getProperty("/densityStyle"),T=0,r=0;var u=m.getItems();for(var j=0;j<u.length;j++){try{var v=u[j].getAggregation("content")[0].getAggregation("items")[0].getAggregation("items")[0].getAggregation("items")[0].getProperty("src");if(v.length>0){if(v.toLowerCase().indexOf("icon")>0){p="icon";}else{p="image";}T=1;break;}}catch(e){jQuery.sap.log.info("Item:"+j+" doesn´t contain a image");}}if(p==="image"){N=2;}else{try{var w=m.getItems()[0].getAggregation("content")[0].getAggregation("items")[T].getAggregation("items")[0].getProperty("text");t=w.length>0;r=1;}catch(e){jQuery.sap.log.info("Item doesn´t contain a title");}try{var x=m.getItems()[0].getAggregation("content")[0].getAggregation("items")[T].getAggregation("items")[r].getProperty("text");S=x.length>0;}catch(e){jQuery.sap.log.info("Item doesn´t contain a subTitle");}if(t===true&&S===true){N=2;}}if(q==="cozy"){n=I;if(N===1){n=p!=="image"?b:a;}}else{n=c;if(N===1){n=p!=="image"?f:d;}}return n;},onLinkListItemPressLocalData:function(e){var t=e.getSource().data("targetUri");var i=e.getSource().data("openInNewWindow");var B=this.getView().getModel("ovpCardProperties").getProperty("/baseUrl");t=this.buildUrl(B,t);if(i==="true"){window.open(t);}else{window.location.href=t;}},onLinkListActionPressLocalData:function(e){var A=e.getSource().data("dataAction");this.getView().getModel().callFunction(A,{method:"POST",urlParameters:{FunctionImport:A},success:(this.onFuImpSuccess.bind(this)),error:(this.onFuImpFailed.bind(this))});},onFuImpSuccess:function(e){sap.m.MessageToast.show(sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("Toast_Action_Success"),{duration:3000});},onFuImpFailed:function(r){sap.m.MessageToast.show(sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("Toast_Action_Error"),{duration:3000});},onLinkListItemPress:function(e){var n=this.getEntityNavigationEntries(e.getSource().getBindingContext(),this.getCardPropertiesModel().getProperty("/annotationPath"));this.doNavigation(e.getSource().getBindingContext(),n[0]);},onLinkPopover:function(e){var p;switch(this.getCardPropertiesModel().getProperty("/listFlavor")){case"grid":p=e.getSource().getParent().getParent().getParent().getParent().getParent().getAggregation("items")[1].getAggregation("items")[1];break;case"standard":p=this.getView().byId("ovpListRow").getParent().getAggregation("items")[2];if(!p){p=this.getView().byId("ovpListRow").getParent().getAggregation("items")[1];}break;case"carousel":if(e.getParameter("id").indexOf("link")>0){p=e.getSource().getParent().getParent().getParent().getParent().getAggregation("items")[1];}else{p=e.getSource().getParent().getParent().getParent().getAggregation("items")[1];}break;}p.bindElement(e.getSource().getBindingContext().getPath());p.openBy(e.getSource());},onLinkListLineItemUrl:function(e){var t=this.entityType["com.sap.vocabularies.UI.v1.LineItem"][0].Url.String;window.location.href=t;},onLinkNavigationSingleTarget:function(e){var n=this.getEntityNavigationEntries(e.getSource().getBindingContext(),undefined);this.doNavigation(e.getSource().getBindingContext(),n[0]);},onLinkNavigation:function(e){if(sap.ushell.Container.getService("CrossApplicationNavigation")){var B=e.getSource().getBindingContext();if(B.getProperty("SemanticObject")){var n={target:{semanticObject:B.getProperty("SemanticObject"),action:B.getProperty("SemanticAction")}};sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(n);}}},buildUrl:function(B,m){if(m.lastIndexOf(B,0)===0||m.indexOf("://")>0){return m;}else if(m.lastIndexOf("/",0)===0){return B+m;}else{return B+"/"+m;}},onLinkListActionPress:function(e){var A=e.getSource().data("dataAction");this.getView().getModel().callFunction(A,{method:"POST",urlParameters:{FunctionImport:A},success:(this.onFuImpSuccess.bind(this)),error:(this.onFuImpFailed.bind(this))});},onLinkListSemanticObjectPressLocalData:function(e){var r=parseInt(e.getSource().data("contentRowIndex"),10);this._oStaticContent=this.getCardPropertiesModel().getProperty("/staticContent");if(this._oStaticContent[r].semanticObject&&this._oStaticContent[r].action){var n={target:{semanticObject:this._oStaticContent[r].semanticObject,action:this._oStaticContent[r].action},params:this._oStaticContent[r].params};sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(n);}else{sap.m.MessageToast.show(sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("Toast_Action_Error"),{duration:3000});}}});})();
