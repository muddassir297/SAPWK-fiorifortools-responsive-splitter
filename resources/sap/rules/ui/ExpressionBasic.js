/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2016 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","sap/rules/ui/InstructionRenderer","sap/rules/ui/ExpressionBase"],function(q,l,C,I,E){"use strict";var a=E.extend("sap.rules.ui.ExpressionBasic",{metadata:{properties:{value:{type:"string",defaultValue:"",bindable:"bindable"}},aggregations:{_instructionRenderer:{type:"sap.rules.ui.InstructionRenderer",multiple:false}}},init:function(){this.shouldReload=true;},_removeFurtherInstructions:function(i){var n=this.instructions.length;var b=n-i-1;this.instructions.splice(i+1,b);},_onChange:function(e){var i=e.getParameter("instructionNum");this._onChangeByIndex(i);},_onChangeByIndex:function(i,p,o){p=p||"";o=(o===undefined||o===null)?i:o;var b=this.getAggregation("_instructionRenderer");var u=b.getExpression();if(i>1){this.setProperty("value",u);return;}this._removeFurtherInstructions(o);u=b.getExpression();var e=sap.ui.getCore().byId(this.getExpressionLanguage());var s=sap.rules.ui.SuggestionsPart;var c;var d;if(i==0){c=e._getBasicSuggestions(u,s.compPart);}if(i==1){c=e._getBasicSuggestions(p+" "+u,s.rightPart);}d=this._createInstructions(c);this.instructions=this.instructions.concat(d);b.setInstructions(this.instructions);this.setProperty("value",u);},_callbackForActionControl:function(i,s){var b=this._createInstructions(s);this.instructions.splice.apply(this.instructions,[i,0].concat(b));var o=this.getAggregation("_instructionRenderer");o.setInstructions(this.instructions);},_createInstructions:function(s){var b=[];var c;var d;var e;for(var i=0;i<s.length;i++){d={};c=s[i];if(Array.isArray(c)){d.type="action";d.callback=this._callbackForActionControl.bind(this,i,c);d.editable=true;}else{e=c.sugg;if(e&&e.length!==0){d.valueOptions={};d.valueOptions.type="Set";d.valueOptions.values=[];var v=d.valueOptions.values;for(var j=0;j<e.length;j++){v.push({"token":e[j],"text":e[j]});}}d.text=c.currentValue;d.token=c.currentValue;if(c.BDT){d.businessDataType=c.BDT;}d.editable=true;}d.visible=true;if(c.tokenCategory==="reservedword.undefined"||c.tokenCategory==="reservedword.null"){d.editable=false;}else{d.editable=true;}b.push(d);}return b;},setValue:function(v){this.shouldReload=true;this.setProperty("value",v);},_reload:function(){this.shouldReload=false;var s=sap.ui.getCore().byId(this.getExpressionLanguage())._getBasicSuggestions(this.getValue());this.instructions=this._createInstructions(s);var i=new I({instructions:this.instructions,useIndent:false,change:this._onChange.bind(this)});this.setAggregation("_instructionRenderer",i,true);},onBeforeRendering:function(){if(this.shouldReload==true){this._reload();}},onAfterRendering:function(){if(this.shouldReload==true){this._reload();}var i=this.getAggregation("_instructionRenderer");var c=i.getAggregation("_content");c[c.length-1].focus();q.sap.byId(this.getId()).on("change",null,function(e){this.focus();}.bind(this));}});return a;},true);
