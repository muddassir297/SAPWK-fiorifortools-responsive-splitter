/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2016 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","./library","sap/rules/ui/ExpressionBasic","sap/rules/ui/InstructionRenderer"],function(q,l,E,I){"use strict";var D=E.extend("sap.rules.ui.DecisionTableCellExpressionBasic",{metadata:{library:"sap.rules.ui",properties:{headerValue:{type:"string",defaultValue:"",bindable:"bindable"},fixedOperator:{type:"string",defaultValue:"",bindable:"bindable"},type:{type:"sap.rules.ui.ExpressionType",defaultValue:sap.rules.ui.ExpressionType.BooleanEnhanced,bindable:"bindable"}}},_reload:function(){this.shouldReload=false;this.sHeaderValue=this.getHeaderValue();this.FixedOperatorValue=this.getFixedOperator();this.sCellValue=this.getValue();this.sValueFromSettings=(this.sHeaderValue+" "+this.FixedOperatorValue);this.sValue=(this.sValueFromSettings+this.sCellValue).trim();var e=sap.ui.getCore().byId(this.getExpressionLanguage());var s;if(!this.sHeaderValue&&!this.FixedOperatorValue){this.setProperty("value",this.sValue);sap.rules.ui.ExpressionBasic.prototype._reload.apply(this,arguments);return;}else{if(this.sHeaderValue&&this.FixedOperatorValue){s=e._getRightSuggestions(this.sHeaderValue,this.FixedOperatorValue,this.sCellValue,null,null);}else if(this.sHeaderValue&&!this.FixedOperatorValue){var t=e.validateExpression(this.sHeaderValue);if(t.status==="Error"){this.bReadOnly=true;this.bFlagForChange=true;s=[e._getLeftSuggestions("","")];}else{var c=this._getSubExpression(this.sCellValue);var a=(c[1])?c[1].exp:"";s=[e._getCompSuggestions(this.sHeaderValue,a,null)];if(a){var r;var b=(c[2])?c[2].exp:"";r=e._getRightSuggestions(this.sHeaderValue,a,b,null,null);s.push.apply(s,r);}}}this.instructions=this._createInstructions(s);var i=new I({instructions:this.instructions,useIndent:false,change:this._onChange.bind(this)});this.setAggregation("_instructionRenderer",i,true);}},_calculateOffSet:function(){if(!this.sHeaderValue&&!this.FixedOperatorValue){this.offSet=0;}else if(this.sHeaderValue&&this.FixedOperatorValue){this.offSet=2;}else{this.offSet=1;}},_onChangeByIndex:function(i,p){sap.rules.ui.ExpressionBasic.prototype._onChangeByIndex.apply(this,[this.offSet+i,this.sHeaderValue+this.FixedOperatorValue,i]);}});D.prototype.init=function(){};D.prototype.validateExpression=function(){};D.prototype.onAfterRendering=function(){sap.rules.ui.ExpressionBasic.prototype.onAfterRendering.apply(this,arguments);this._calculateOffSet();};D.prototype.onBeforeRendering=function(){sap.rules.ui.ExpressionBasic.prototype.onBeforeRendering.apply(this,arguments);};D.prototype._getSubExpression=function(e){var o=sap.ui.getCore().byId(this.getExpressionLanguage());return o._getSubExpressions(null,"dummy "+e);};D.prototype._handleValidation=function(){var e=this.getHeaderValue()+" "+this.getFixedOperator()+" "+this.getValue();var a=sap.ui.getCore().byId(this.getExpressionLanguage());if(e){var r=a.validateExpression(e);if(r.status==="Error"){this.setProperty("valueStateText",r.errorDetails);}else{this.setProperty("valueStateText","");}}};return D;},true);
