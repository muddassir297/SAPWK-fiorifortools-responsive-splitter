jQuery.sap.declare("sap.rules.ui.parser.resources.common.lib.resourcesConvertor");jQuery.sap.require("sap.rules.ui.parser.resources.vocabulary.lib.validationUtils");jQuery.sap.require("sap.rules.ui.parser.resources.common.lib.oDataHandler");jQuery.sap.require("sap.rules.ui.parser.infrastructure.util.utilsBase");sap.rules.ui.parser.resources.common.lib.resourcesConvertor=sap.rules.ui.parser.resources.common.lib.resourcesConvertor||{};sap.rules.ui.parser.resources.common.lib.resourcesConvertor.lib=(function(){var d=sap.rules.ui.parser.resources.common.lib.oDataHandler.lib;var u=new sap.rules.ui.parser.infrastructure.util.utilsBase.lib.utilsBaseLib();var v=sap.rules.ui.parser.resources.vocabulary.lib.validationUtils.lib;var g=d.getOdataPropName;var a=d.getOdataPropertyValue;var b=d.getEnumPropertyValue;var c=false;function e(D,i,s,t){var w,x,y,z;var A=a(D,d.PROPERTY_NAME_ID);if(a(D,d.PROPERTY_NAME_TYPE)===d.TYPE_CONDITION){w={colID:A,type:"condition",expression:"",alias:""};y=g(D,d.PROPERTY_NAME_CONDITION);t=u.buildJsonPath(t,y);w.inputModelPath=t;w.expression=a(D[y],d.PROPERTY_NAME_EXPRESSION);if(w.expression==='true'){w.expression='';}z=a(D[y],d.PROPERTY_NAME_FIXED_OPERATOR);if(z){w.fixedOperator={};w.fixedOperator.operator=z;i[A]=z+' ';}}else if(a(D,d.PROPERTY_NAME_TYPE)===d.TYPE_RESULT){w={colID:A,name:"",type:"output",businessDataType:""};x=g(D,d.PROPERTY_NAME_RESULT);w.businessDataType=a(D[x],d.PROPERTY_NAME_BUSINESS_DATA_TYPE);w.name=a(D[x],d.PROPERTY_NAME_DO_ATTRIBUTE_NAME);}s[A]=w.type;return w;}function f(D,i,s,t){var w,x,y,z,A,B,C,E=true;var F={rowID:0,row:[]};F.rowID=a(D,d.PROPERTY_NAME_ID);C=g(D,d.PROPERTY_NAME_CELLS);x=a(D,d.PROPERTY_NAME_CELLS);if(x){x.forEach(function(O,G){w=u.buildJsonPath(t,C,G);y={colID:0,content:""};y.colID=a(O,d.PROPERTY_NAME_COLUMN_ID);z=i[y.colID]||"";B=a(O,d.PROPERTY_NAME_CONTENT);A=s[y.colID];if(E&&B){E=false;}y.inputModelPath=w;y.content=(A==='output'&&!B)?null:z+B;if(!(A==='condition'&&!B)){F.row.push(y);}});}if(E){return null;}return F;}function h(D,t){var i;var s=null;var w=null;var x=null;for(i=0;i<D.length;i++){x=D[i];s=g(x,d.PROPERTY_NAME_USAGE);if(s&&x[s]===d.TYPE_DO){s=g(x,d.PROPERTY_NAME_ID);if(s&&x[s]===t){w=a(x,d.PROPERTY_NAME_NAME);break;}}}return w;}function j(D,i){var s={};s.source=a(D,d.PROPERTY_NAME_ATTRIBUTE_MAPPINGS_SOURCE);s.target=a(D,d.PROPERTY_NAME_ATTRIBUTE_MAPPINGS_TARGET);i.push(s);}function k(i,s,t,w){var x=null;var y=null;var z={};z.name=a(i,d.PROPERTY_NAME_NAME);if(c){z.description=a(i,d.PROPERTY_NAME_DESCRIPTION);w.validateDescription(z,d.PROPERTY_NAME_ATTRIBUTE,t);}y=a(i,d.PROPERTY_NAME_BUSINESS_DATA_TYPE);z.dataType=a(i,d.PROPERTY_NAME_DATA_TYPE);x=g(i,d.PROPERTY_NAME_VALUE_HELP_ID);if(x&&i[x]){w.validateValueHelpBusinessDataType(i[x],y);z.valueList=i[x];}else{z.businessDataType=y;}x=g(i,d.PROPERTY_NAME_SIZE);if(x){z.size=i[x];}x=g(i,d.PROPERTY_NAME_MAPPING_INFO);if(x){z.dataMapping={};z.dataMapping.column=a(i[x],d.PROPERTY_NAME_NAME);}z.sourceType=d.SOURCE_TYPE_DATA;s.push(z);}function l(D,i,s,t,w){var x=null;var y={};y.name=a(i,d.PROPERTY_NAME_NAME);if(c){y.description=a(i,d.PROPERTY_NAME_DESCRIPTION);w.validateDescription(y,d.PROPERTY_NAME_ASSOCIATION,t);}x=g(i,d.PROPERTY_NAME_TARGET_DATA_OBJECT_ID);y.target=h(D,i[x]);y.cardinality=b(i,d.PROPERTY_NAME_CARDINALITY);y.attributeMappings=[];x=g(i,d.PROPERTY_NAME_ATTRIBUTE_MAPPINGS);if(x&&i[x]&&Array.isArray(i[x])){i[x].forEach(function(z){j(z,y.attributeMappings);});}s.push(y);}function m(i,s){var t={};t.name=a(i,d.PROPERTY_NAME_NAME);t.businessDataType=a(i,d.PROPERTY_NAME_BUSINESS_DATA_TYPE);t.dataType=a(i,d.PROPERTY_NAME_DATA_TYPE);t.size=a(i,d.PROPERTY_NAME_SIZE);t.id=i.Id;s.push(t);}function n(D,i){var s=null;i.name=a(D,d.PROPERTY_NAME_NAME);i.type=a(D,d.PROPERTY_NAME_TYPE);s=g(D,d.PROPERTY_NAME_SCHEMA);i.schema="";if(D[s]){i.schema=D[s];}s=g(D,d.PROPERTY_NAME_PARAMETERS);if(D[s]){i.parameters=D[s];}}function o(D,i,s){var t={};var w=a(D,d.PROPERTY_NAME_ID);var x=s.getValueHelpBusinessDataType(w);if(!x){return;}t.businessDataType=x;t.metadata={};t.metadata.serviceURL=a(D,d.PROPERTY_NAME_SERVICE_URL);t.metadata.propertyPath=a(D,d.PROPERTY_NAME_PROPERTY_PATH);t.metadata.type=a(D,d.PROPERTY_NAME_TYPE);i.valueLists[w]=t;}function p(D,i,s,t,w){var x=null;var y={};x=g(i,d.PROPERTY_NAME_USAGE);if(x){y.name=a(i,d.PROPERTY_NAME_NAME);if(i[x]===d.TYPE_DO){if(c){y.description=a(i,d.PROPERTY_NAME_DESCRIPTION);w.validateDescription(y,d.PROPERTY_NAME_DATA_OBJECT,t);}x=g(i,d.PROPERTY_NAME_ATTRIBUTES);if(x){y.attributes=[];var z=i[x];z.forEach(function(F){k(F,y.attributes,y.name,w);});}x=g(i,d.PROPERTY_NAME_ASSOCIATIONS);if(x){var A=i[x];y.associations=[];A.forEach(function(F){l(D,F,y.associations,y.name,w);});}x=g(i,d.PROPERTY_NAME_MAPPING_INFO);if(x){var B=i[x];y.mappingInfo={};n(B,y.mappingInfo);}s.dataObjects.push(y);}else if(i[x]===d.TYPE_RESULT){y.id=a(i,d.PROPERTY_NAME_ID);var C=a(i,d.PROPERTY_NAME_DESCRIPTION);if(C){y.description=C;}x=g(i,d.PROPERTY_NAME_ATTRIBUTES);if(x){y.inputParams=[];var E=i[x];E.forEach(function(F){m(F,y.inputParams);});}s.outputs.push(y);}}}var q=function(D,i){var s={"id":"","output":"","ruleBody":{"content":{"headers":[],"rows":[]},"type":"","hitPolicy":"","ruleFormat":""}};var t=g(D,d.PROPERTY_NAME_DECISION_TABLE);var w=u.buildJsonPath(i,t);var x={};var y={};s.id=a(D,d.PROPERTY_NAME_ID);s.ruleBody.ruleFormat=b(D,d.PROPERTY_NAME_RULE_FORMAT);s.output=a(D,d.PROPERTY_NAME_RESULT_DO_NAME);s.ruleBody.type=b(D,d.PROPERTY_NAME_TYPE);s.ruleBody.relVersion=a(D,d.PROPERTY_NAME_REL_VERSION);s.ruleBody.hitPolicy=b(D[t],d.PROPERTY_NAME_HIT_POLICY);var z=a(D[t],d.PROPERTY_NAME_DT_COLUMNS);var A=g(D[t],d.PROPERTY_NAME_DT_COLUMNS);var B=a(D[t],d.PROPERTY_NAME_DDT_ROWS);var C=g(D[t],d.PROPERTY_NAME_DDT_ROWS);if(z){var E;z.forEach(function(G,H){i=u.buildJsonPath(w,A,H);E=e(G,x,y,i);s.ruleBody.content.headers.push(E);});}if(B){var F;B.forEach(function(G,H){i=u.buildJsonPath(w,C,H);F=f(G,x,y,i);if(F){s.ruleBody.content.rows.push(F);}});}return s;};var r=function(D,t){var i;var s=new v.validationUtilsLib();var w=null;var x={"dataObjects":[],"outputs":[],"valueLists":{}};for(i=0;i<t.length;i++){if(t[i]==='byDescription'){c=true;break;}}w=g(D,d.PROPERTY_NAME_DATA_OBJECTS);if(w){D[w].forEach(function(y){p(D[w],y,x,D.id,s);});}w=g(D,d.PROPERTY_NAME_VALUE_HELPS);if(w&&Array.isArray(D[w])){D[w].forEach(function(y){o(y,x,s);});}return x;};return{"convertRuleODataToInternalModel":q,"convertVocabularyODataToInternalModel":r};}());
