/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','./ShapeMarker','sap/ui/core/Control','sap/ui/layout/form/SimpleForm','sap/ui/layout/Grid','sap/m/Text','sap/m/ObjectNumber','sap/m/Label','sap/ui/core/TextAlign'],function(q,S,C,a,G,T,O,L,b){"use strict";var c=C.extend('sap.viz.ui5.controls.chartpopover.ContentPanel',{metadata:{properties:{'showLine':'boolean'},publicMethods:["setContentData"]},renderer:{render:function(r,o){r.write('<div');r.addClass("viz-controls-chartPopover-contentPanel");r.writeClasses();r.writeControlData(o);r.writeAttribute("aria-labelledby",o._oDimLabel.getId()+" "+o._oForm.getId());r.writeAttribute('tabindex',-1);r.write('>');r.renderControl(o._oShapeLabel);r.renderControl(o._oPanel);r.write('</div>');}}});c.prototype.init=function(){this._measureItemsLen=0;this._maxMeasureLableLen=15;this._maxMeasureValueLen=12;this._oShapeLabel=new S(this._createId('vizShapeMarker'),{}).addStyleClass('viz-controls-chartPopover-dimension-marker');this._oDimLabel=new T(this._createId('vizDimensionLabel'),{}).addStyleClass('viz-controls-chartPopover-dimension-label');this._oForm=new a({editable:false,maxContainerCols:2,layout:"ResponsiveGridLayout",labelSpanL:6,labelSpanM:6,labelSpanS:6,emptySpanL:0,emptySpanM:0,emptySpanS:0,columnsL:2,columnsM:2,content:[]});this._oPanel=new G({width:'100%',defaultSpan:"L12 M12 S12",content:[this._oDimLabel,this._oForm]}).addStyleClass('viz-controls-chartPopover-Vlt');};c.prototype.setContentData=function(d){var v=d.val,e='',m,f,g={},n;this._measureItemsLen=0;if(v){this._oForm.removeAllContent();var h=false,i,j;for(i=0;i<v.length;i++){if(v[i].type&&v[i].type.toLowerCase()==='dimension'){if(d.isTimeSeries&&v.hasOwnProperty("timeDimensions")&&v.timeDimensions.indexOf(i)>-1){f=v[i].value;var k=(v[i].timeAxis&&v[i].timeAxis.getFiscalUnitLabels&&v[i].timeAxis.getFiscalUnitLabels());if(k&&k.length>0){j=f.fiscalperiod;if(f.fiscalyear){if(!j||j.length<f.fiscalyear.length){j=f.fiscalyear;}}}else{j=f.time;if(f.day){if(!j||j.length<f.day.length){j=f.day;}}}if(v[i].name.length>this._maxMeasureLableLen||j.length>this._maxMeasureValueLen){h=true;break;}else{if(k&&k.length>0&&k[0].length>this._maxMeasureLableLen){h=true;break;}if(k&&k.length>1&&k[1].length>this._maxMeasureLableLen){h=true;break;}}}}else if(v[i].type&&v[i].type.toLowerCase()==='measure'){m=v[i].value;if(m==null){m=this._getNoValueLabel();}if((v[i].dataName||v[i].name).length>this._maxMeasureLableLen||m.length>this._maxMeasureValueLen){h=true;break;}}}for(i=0;i<v.length;i++){n=v[i].dataName||v[i].name;if(v[i].type&&v[i].type.toLowerCase()==='dimension'){f=v[i].value;if(d.isTimeSeries&&v.hasOwnProperty("timeDimensions")&&v.timeDimensions.indexOf(i)>-1){var k=(v[i].timeAxis&&v[i].timeAxis.getFiscalUnitLabels&&v[i].timeAxis.getFiscalUnitLabels());if(k&&k.length>0){g.name=k[0];g.value=f.fiscalyear;this._renderLabels(h,g,d.isTimeSeries);if(k.length>1){g.name=k[1];g.value=f.fiscalperiod;this._renderLabels(h,g,d.isTimeSeries);}}else{if(f.time){g.name=n;g.value=f.time;this._renderLabels(h,g,d.isTimeSeries);}if(f.day){g.name=f.time?"":n;g.value=f.day;this._renderLabels(h,g,d.isTimeSeries);}}}else{if(e==null){e=this._getNoValueLabel();}else if(e.length>0){if(f===null){e=e+' - '+this._getNoValueLabel();}else{e=e+' - '+f;}}else{if(f===null){e=this._getNoValueLabel();}else{e=f.toString();}}}}else if(v[i].type&&v[i].type.toLowerCase()==='measure'){g.name=n;g.value=v[i].value;g.unit=v[i].unit;this._renderLabels(h,g);}}var l=function(){var r=false;if(d.selectByTimeAxisGroup&&d.val){var p=0;for(i=0;i<d.val.length;i++){if(d.val[i].type==='Measure'){p++;}}if(p>1){r=true;}}return r;};if(!l()&&typeof d.color==='string'){var o=this._oDimLabel.$().css('margin-left');if(o){o=parseInt(o.substr(0,o.length-2),10);this._oShapeLabel.setMarkerSize(o);}this._oShapeLabel.setColor(d.color).setType((d.shape?d.shape:'square'));if(this.getShowLine()){this._oShapeLabel.setShowWithLine(d.type).setLineInfo(d.lineInfo);}else{this._oShapeLabel.setShowWithLine(undefined);}if(d.stroke&&d.stroke.visible){this._oShapeLabel.setStroke(d.stroke);}}else{this._oShapeLabel.setType(null);this._oShapeLabel.setShowWithLine(undefined);}if(d.pattern){this._oShapeLabel.setPattern(d.pattern);}else{this._oShapeLabel.setPattern(null);}if(e&&e.length>0){this._oDimLabel.setVisible(true);this._oDimLabel.setText(e);}else{this._oDimLabel.setVisible(false);}this._measureItemsLen=d.val.length;}};c.prototype._renderLabels=function(i,d,e){var v;if(i){this._oForm.setLabelSpanS(12);if(d.name!==''){this._oForm.addContent(new T({text:d.name}).addStyleClass('viz-controls-chartPopover-measure-labels viz-controls-chartPopover-measure-labels-wrapper-name'));}v=new O({number:d.value,unit:d.unit,textAlign:b.Begin}).addStyleClass('viz-controls-chartPopover-measure-labels viz-controls-chartPopover-measure-labels-wrapper-value');this._oForm.addContent(v);if(e&&(d.name==='')){v.addStyleClass('viz-controls-chartPopover-timeDayDimValue');}}else{this._oForm.setLabelSpanS(6);this._oForm.addContent(new L({text:d.name}).addStyleClass('viz-controls-chartPopover-measure-labels viz-controls-chartPopover-measure-name'));if(d.value!==null){v=new O({number:d.value,unit:d.unit,textAlign:b.End}).addStyleClass('viz-controls-chartPopover-measure-labels viz-controls-chartPopover-measure-value');}else{v=new O({number:this._getNoValueLabel(),textAlign:b.End}).addStyleClass('viz-controls-chartPopover-measure-labels viz-controls-chartPopover-measure-value');}if(e&&(d.name==='')){v.addStyleClass('viz-controls-chartPopover-timeDayValue');}this._oForm.addContent(v);}};c.prototype.isMultiSelected=function(){return this._measureItemsLen===0;};c.prototype._createId=function(i){return this.getId()+"-"+i;};c.prototype._getNoValueLabel=function(){return sap.viz.extapi.env.Language.getResourceString("IDS_ISNOVALUE");};c.prototype.exit=function(i){if(this._oForm){this._oForm.destroy();this._oForm=null;}if(this._oShapeLabel){this._oShapeLabel.destroy();this._oShapeLabel=null;}if(this._oDimLabel){this._oDimLabel.destroy();this._oDimLabel=null;}if(this._oPanel){this._oPanel.destroy();this._oPanel=null;}};return c;});
