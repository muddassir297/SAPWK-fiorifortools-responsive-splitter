/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/chart/library','sap/viz/ui5/controls/VizFrame','sap/viz/ui5/controls/common/BaseControl','sap/viz/ui5/data/Dataset','sap/viz/ui5/data/FlattenedDataset','sap/viz/ui5/data/DimensionDefinition','sap/viz/ui5/data/MeasureDefinition','sap/chart/data/Dimension','sap/chart/data/TimeDimension','sap/chart/data/Measure','sap/ui/model/analytics/ODataModelAdapter','sap/chart/utils/RoleFitter','sap/chart/utils/ChartUtils','sap/chart/utils/SeriesColorTracker','sap/chart/utils/ChartTypeAdapterUtils','sap/chart/utils/DateFormatUtil','sap/chart/utils/DataSourceUtils','sap/chart/utils/SelectionAPIUtils','sap/chart/utils/MeasureSemantics','sap/viz/ui5/controls/common/feeds/FeedItem','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/model/analytics/odata4analytics','sap/ui/model/Sorter','sap/chart/TimeUnitType','sap/chart/coloring/Colorings','sap/chart/ChartLog'],function(l,V,B,D,F,a,M,b,T,c,O,R,C,S,f,g,h,n,q,r,s,t,u,w,x,y,z){"use strict";var A=sap.chart.SelectionMode;var E=B.extend("sap.chart.Chart",{metadata:{library:"sap.chart",properties:{chartType:{type:"string",defaultValue:"bar"},uiConfig:{type:"object",group:"Misc"},visibleDimensions:{type:"string[]",defaultValue:[]},inResultDimensions:{type:"string[]",defaultValue:[]},visibleMeasures:{type:"string[]",defaultValue:[]},vizProperties:{type:"object",group:"Misc"},vizScales:{type:"object[]",group:"Misc"},isAnalytical:{type:"boolean"},selectionBehavior:{type:"sap.chart.SelectionBehavior",defaultValue:sap.chart.SelectionBehavior.DataPoint},selectionMode:{type:"sap.chart.SelectionMode",defaultValue:sap.chart.SelectionMode.Multi},enablePagination:{type:"boolean",defaultValue:false},customMessages:{type:"object",defaultValue:null},colorings:{type:"object",defaultValue:null},activeColoring:{type:"object",defaultValue:null}},aggregations:{data:{type:"sap.ui.core.Element",multiple:true,bindable:"bindable"},_vizFrame:{type:"sap.viz.ui5.controls.VizFrame",multiple:false,visibility:"hidden"},dimensions:{type:"sap.chart.data.Dimension",multiple:true},measures:{type:"sap.chart.data.Measure",multiple:true}},events:{drilledDown:{parameters:{dimensions:{type:"string[]"}}},drilledUp:{parameters:{dimensions:{type:"string[]"}}},renderComplete:{},selectData:{},deselectData:{}}},renderer:function(o,d){o.write("<div");o.writeControlData(d);o.addStyle("width",d.getWidth());o.addStyle("height",d.getHeight());o.writeStyles();o.write(">");o.renderControl(d.getAggregation("_vizFrame"));o.write("</div>");}});E.getMetadata().getAggregation("data")._doesNotRequireFactory=true;function G(v){return v.indexOf("%")!==-1?"100%":v;}E.prototype.setHeight=function(v){this.setProperty("height",v);var o=this._getVizFrame();if(o){o.setHeight(G(this.getProperty("height")));}return this;};E.prototype.setWidth=function(v){this.setProperty("width",v);var o=this._getVizFrame();if(o){o.setWidth(G(this.getProperty("width")));}return this;};E.prototype.setChartType=function(d,e){this.setProperty("chartType",d,e);this._bIsPagingChartType=C.CONFIG.pagingChartTypes.indexOf(d)>-1;if(this._isEnablePaging()){this._initPagination(true);}else{var o=this._getDataset();if(o){o.setPagingOption(null);}}this._invalidateBy({source:this,keys:{vizFrame:true}});this._bNeedToApplyDefaultProperties=true;return this;};E.prototype.setColorings=function(v){this.setProperty("colorings",v);this._invalidateBy({source:this,keys:{vizFrame:true,checkBinding:true}});return this;};E.prototype.setActiveColoring=function(v){this.setProperty("activeColoring",v);this._invalidateBy({source:this,keys:{vizFrame:true,checkBinding:true}});return this;};E.prototype.removeDimension=function(d){var v=this._getVisibleDimensions()||[];var i;if(this.getIsAnalytical()===false&&d&&d.getName()){i=v.indexOf(d.getName());if(i!==-1){jQuery.sap.log.error('Data source does not support aggregation. The method "removeDimension" therefore cannot be used!');return;}}var o=this.removeAggregation("dimensions",d);if(o){i=v.indexOf(o.getName());if(i!==-1){v.splice(i,1);this.setVisibleDimensions(v);}var e=this.getInResultDimensions()||[];i=e.indexOf(o.getName());if(i!==-1){e.splice(i,1);this.setInResultDimensions(e);}}return o;};E.prototype.removeAllDimensions=function(){var o;if(this.getIsAnalytical()===false){jQuery.sap.log.error('Data source does not support aggregation. The method "removeAllDimensions" therefore cannot be used!');}else{o=this.removeAllAggregation("dimensions");this.setVisibleDimensions([]);this.setInResultDimensions([]);}return o;};E.prototype.destroyDimensions=function(){var o;if(this.getIsAnalytical()===false){jQuery.sap.log.error('Data source does not support aggregation. The method "destroyDimensions" therefore cannot be used!');}else{o=this.destroyAggregation("dimensions");this.setVisibleDimensions([]);this.setInResultDimensions([]);}return o;};E.prototype.removeMeasure=function(m){var o=this.removeAggregation("measures",m);if(o){var v=this._getVisibleMeasures()||[],i=v.indexOf(o.getName());if(i!==-1){v.splice(i,1);this.setVisibleMeasures(v);}}return o;};E.prototype.removeAllMeasures=function(){var o=this.removeAllAggregation("measures");this.setVisibleMeasures([]);return o;};E.prototype.destroyMeasures=function(){var o=this.destroyAggregation("measures");this.setVisibleMeasures([]);return o;};E.prototype._getVisibleDimensions=function(d){var o=this._getDrillStateTop();var e=o?o.dimensions:this.getProperty("visibleDimensions");return d?this._normalizeDorM(e,true):e;};E.prototype.getVisibleDimensions=function(){var v=this._getVisibleDimensions();return this._aFeeds?v.filter(function(d){return this._aFeeds._unused.indexOf(d)===-1;},this):v;};E.prototype._getVisibleMeasures=function(d){var o=this._getDrillStateTop();var m=o?o.measures:this.getProperty("visibleMeasures");return d?this._normalizeDorM(m):m;};E.prototype.getVisibleMeasures=function(){var v=this._getVisibleMeasures();return this._aFeeds?v.filter(function(d){return this._aFeeds._unused.indexOf(d)===-1;},this):v;};E.prototype.setVisibleDimensions=function(v,d){var m=this._dimensionSanityCheck({visible:v});this.setProperty("visibleDimensions",v,d);this.setProperty("inResultDimensions",m.inResult,d);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});return this;};E.prototype.setInResultDimensions=function(i,d){var m=this._dimensionSanityCheck({inResult:i});this.setProperty("inResultDimensions",i,d);this.setProperty("visibleDimensions",m.visible,d);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});};E.prototype.setVisibleMeasures=function(m,d){this.setProperty("visibleMeasures",m,d);this._createDrillStack();this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true}});return this;};E.prototype.setEnablePagination=function(e,d){if(!this._bIsInitialized){this.setProperty("enablePagination",e,d);this._invalidateBy({source:this,keys:{binding:true,dataSet:true,vizFrame:true,drillStack:true}});}return this;};E.prototype._dimensionSanityCheck=function(d){var v=d.visible||this.getVisibleDimensions()||[],i=d.inResult||this.getInResultDimensions()||[];var m=[].concat(v).concat(i).reduce(function(e,j){var k=v.indexOf(j)!==-1,o=i.indexOf(j)!==-1;if(k&&o){e.common[j]=true;}else if(k){e.visible[j]=true;}else if(o){e.inResult[j]=true;}return e;},{visible:{},inResult:{},common:{}});m.visible=Object.keys(m.visible);m.inResult=Object.keys(m.inResult);m.common=Object.keys(m.common);return m;};E.prototype._prepareFeeds=function(){if(!this._aFeeds){var d=this._normalizeDorM(this._getVisibleDimensions(),true),m=this._normalizeDorM(this._getVisibleMeasures(),false),i=this._normalizeDorM(this.getInResultDimensions(),true);this._sAdapteredChartType=this.getEnablePagination()?this.getChartType():f.adaptChartType(this.getChartType(),d);this._aFeeds=R.fit(this._sAdapteredChartType,d,m,i,this._enableSemanticPattern());if((!this._aFeeds._valid||this._aFeeds._unused.length)&&this._sAdapteredChartType!==this.getChartType()){this._sAdapteredChartType=this.getChartType();this._aFeeds=R.fit(this._sAdapteredChartType,d,m,i);}if(this._sAdapteredChartType!==this.getChartType()){this._bNeedToApplyDefaultProperties=true;}}return this._aFeeds;};E.prototype._normalizeDorM=function(m,i){var d=i?this.getDimensions():this.getMeasures(),e=d.reduce(function(p,v){p[v.getName()]=v;return p;},{}),j=i?b:c;var o=m.reduce(function(o,p){var v;if(typeof p==="string"){v=p;}else if(p instanceof j){v=p.getName();}else{o.errors.push(p);}if(e[v]){o.normalized.push(e[v]);}else{o.errors.push(p);}return o;},{normalized:[],errors:[]});var k=o.normalized;if(o.errors.length>0){k.errors=o.errors;}return k;};E.prototype._redundantsFromSelection=function(){var d=this._getVizFrame().vizSelection();if(!d||d.length===0){return{measureNames:{}};}var o=this._getContinuesSemanticTuples();var m=d.reduce(function(i,j){var p=[];for(var Q in o){if(o.hasOwnProperty(Q)){var U=o[Q];if(j.data[Q]){p.push((j.data[U.timeAxis]<U.projectedValueStartTime)?U.projected:U.actual);}else{p.push(U.actual);p.push(U.projected);}}}jQuery.each(j.data,function(k,v){if(!(p.length>0&&p.indexOf(k)>-1)){if(!i[k]){i[k]=[];}if(i[k].indexOf(v)===-1){i[k].push(v);}}});return i;},{});var e=this._getVisibleDimensions().reduce(function(i,j){var v=m[j];if(v.length===1){i[j]=v[0];}return i;},{});e.measureNames=this._getVisibleMeasures().reduce(function(i,j){if(!m[j]){i[j]=true;}return i;},{});return e;};E.prototype._deriveFilterFromSelection=function(){var v=this._getVisibleDimensions();var d=this;var e=this._getVizFrame().vizSelection().map(function(o){var j=v.reduce(function(k,m){var p=d.getDimensionByName(m);var Q;Q=o.data[m];if(C.CONFIG.timeChartTypes.indexOf(d._sAdapteredChartType)>-1&&p instanceof T){var W=g.getInstance(p.getTimeUnit());if(W){var X=W.format.bind(W);Q=X(new Date(o.data[m]));}}k.filters.push(new s({path:m,operator:t.EQ,value1:Q}));k.signature.push(m+"="+o.data[m]);return k;},{filters:[],signature:[]});j.signature=j.signature.join(";");return j;});var U=e.reduce(function(m,o){if(!m[o.signature]&&o.filters.length>0){m[o.signature]=new s(o.filters,true);}return m;},{});var i=Object.keys(U).map(function(k){return U[k];});if(i.length>1){return new sap.ui.model.Filter(i,false);}else if(i.length===1){return i[0];}else{return null;}};E.prototype._checkDrilldownValid=function(i){var v=this._getVisibleDimensions().concat(this.getInResultDimensions()).reduce(function(e,j){e[j]=true;return e;},{});if(i.some(function(e){return v[e.getName()];})){jQuery.sap.log.error("Drill down not possible, because one of the given dimensions is already drilled down!");return false;}var m=i.reduce(function(e,j){e[j.getName()]=j;return e;},{});function d(e){if(jQuery.isArray(e.aFilters)){return e.aFilters.some(d);}else{return!!m[e.sPath];}}var o=this._getDrillStateTop();if(o&&o.filter&&d(o.filter)){jQuery.sap.log.error("Drill down not possible, because one of the given dimensions is already filtered!");return false;}return true;};E.prototype._createDrillStack=function(){var v=this.getProperty("visibleDimensions")||[],d=this.getProperty("visibleMeasures")||[],e=[{dimensions:[],measures:d,filter:undefined}],j=[];for(var i=0;i<v.length;i++){j.push(v[i]);e.push({dimensions:j.slice(),measures:d,filter:undefined});}this._drillStateStack=e;};E.prototype._invalidateBy=function(o){var d=o.source;var e=this._oCandidateColoringSetting?(this._oCandidateColoringSetting.additionalDimensions||[]):[];if(d===this){jQuery.each(o.keys||{},function(k,v){this._markForUpdate(k,v);}.bind(this));}else if(d instanceof c&&this._getVisibleMeasures().indexOf(d.getName())!==-1){this._markForUpdate("dataSet",true);this._markForUpdate("vizFrame",true);if(o.property==="unitBinding"){this._markForUpdate("binding",true);}}else if(d instanceof b&&this._getVisibleDimensions().concat(e).indexOf(d.getName())!==-1){this._markForUpdate("dataSet",true);this._markForUpdate("vizFrame",true);if(d.getDisplayText()&&(o.property==="textProperty"||o.property==="displayText")){this._markForUpdate("binding",true);}}this.invalidate(o);};E.prototype._handleNonAnalyticalFeeding=function(){var d=this;var i=this.getInResultDimensions();var v=this._getVisibleDimensions(),e=this.getDimensions().map(function(o){return o.getName();});var j=[];e.forEach(function(m){if(d.getDimensionByName(m)){var o=d.getDimensionByName(m).getTextProperty();if(o){j.push(o);}}});var k=v.concat(e.filter(function(m){return(v.indexOf(m)<0);})).filter(function(m){return(j.indexOf(m)<0)&&(i.indexOf(m)<0);});this.setProperty("visibleDimensions",k);this._createDrillStack();};E.prototype._markForUpdate=function(k,d){if(!this._mNeedToUpdate){this._mNeedToUpdate={};}this._mNeedToUpdate[k]=d;var o=this._updaters.onInvalidate[k];if(o){o.call(this);}};E.prototype._updaters=(function(){return{onInvalidate:{vizFrame:function(){this._aFeeds=null;this._bColoringParsed=null;},checkBinding:function(){this._bColoringParsed=null;},binding:function(){this._bColoringParsed=null;}},checkBinding:function(){var o=this._getCandidateColoringSetting();var d=o.additionalDimensions;var e=o.additionalMeasures;if((d&&d.length)||(e&&e.length)){this._markForUpdate("binding",true);}},drillStack:function(){this._createDrillStack();},dataSet:function(){var d=this._getDataset();d.updateData.apply(d,arguments);},binding:function(){var o=this._getDataset().getBinding("data"),i=this.getInResultDimensions();if(!o){return;}var d=this._getVisibleDimensions(true).concat(this._normalizeDorM(i,true));var m=this._getVisibleMeasures(true);h.updateModel(this.getIsAnalytical())(this,d,m);var e=this._getDrillStateTop();if(d.length>0||m.length>0){this._getVizFrame()._pendingDataRequest(true);this.setBusy(true);}o.filter((e&&e.filter)?e.filter:undefined);this._resetPagingOptions();},vizFrame:function(){var d=this,o=this._getDataset(),v=this._getVizFrame(),m=this._mMeasureRange||{};o.removeAllAggregation("dimensions",true);o.removeAllAggregation("measures",true);v.removeAllAggregation("feeds",true);if(this.getIsAnalytical()===false){this._handleNonAnalyticalFeeding();}var e=this._prepareFeeds();e._def.dim.forEach(function(Q){o.addAggregation("dimensions",Q,true);},this);e._def.msr.forEach(function(Q){if(Q){var U=m[Q.getIdentity()];if(U){Q.setRange([U.min,U.max]);}if(!d.getDimensionByName(Q.getUnit())){Q.setUnit(null);}o.addAggregation("measures",Q,true);}},this);e.forEach(function(Q){v.addFeed(Q);});this._semanticTuples=e._semanticTuples;var i=e._context||[];var j=this._getCandidateColoringSetting();var k=j.additionalMeasures||[];var p=j.additionalDimensions||[];k.forEach(function(Q){i.push({id:Q,showInTooltip:false});o.addMeasure(new M({name:Q,identity:Q,value:'{'+Q+'}'}));});p.forEach(function(Q){i.push({id:Q,showInTooltip:false});o.addDimension(new a({name:Q,identity:Q,value:'{'+Q+'}'}));});if(!this._mNeedToUpdate['binding']){this._markForUpdate('loopData',true);}o.setContext(i);v.invalidate();o.invalidate();v.setVizType(this._sAdapteredChartType);v.setVizProperties(this._getEffectiveProperties());v._setCustomMessages(this.getCustomMessages());},loopData:function(){var v=this._getVizFrame();try{this._prepareData();}catch(e){if(e instanceof z){e.display();}else{throw e;}}var o=this._getEffectiveProperties();this._usingDisplayNameForSemantics(o);v.setVizProperties(o);this._setEffectiveScales();}};})();E.prototype._getDrillStateTop=function(){return this._drillStateStack?this._drillStateStack[this._drillStateStack.length-1]:null;};E.prototype._getVizFrame=function(){return this.getAggregation("_vizFrame");};E.prototype._getDataset=function(){var v=this._getVizFrame();return v?v.getDataset():null;};E.prototype._restoreUserSemanticColoringProperties=function(){this._oColoringsDataPointStyle={plotArea:{dataPointStyle:this._oDataPointStyle},legend:{title:this._oLegendtitle}};this._oColoringScale=null;};E.prototype._prepareData=function(){var o={},d;var i=this.getVisibleMeasures().some(function(m){return this.getMeasureByName(m).getSemantics()!==sap.chart.data.MeasureSemantics.Actual;}.bind(this));if(!i&&((this._sAdapteredChartType==="heatmap"&&this._oVizColorScale===undefined)||(this._sAdapteredChartType!=="heatmap"&&!this._oDataPointStyle))){o=this._getCandidateColoringSetting();d=o.contextHandler;}var j=[];if(d){j.push(d);this._loopContext(j);}if(!i){if(o.ruleGenerator){var k;try{k=o.ruleGenerator();this._oColoringsDataPointStyle=k.properties;this._oColoringScale=k.colorScale;}catch(e){if(e instanceof z){e.display();}else{throw e;}this._restoreUserSemanticColoringProperties();}}else{this._restoreUserSemanticColoringProperties();}}};E.prototype._getContexts=function(){var o=this.getBinding("data");if(o){var i,d;if(this._isEnablePaging()&&this._bNeedPaging){i=this._oPagingOption.iStartIndex;if(this._oPagingOption.iPageNo===0){d=this._oPagingOption.iLength*2;}else{d=this._oPagingOption.iLength;}}else{i=0;d=o instanceof sap.ui.model.analytics.AnalyticalBinding?o.getTotalSize():o.getLength();}return o.getContexts(i,d);}else{return[];}};E.prototype._loopContext=function(d){var e=this._getContexts();if(e.length>0&&!e.dataRequested){var i=this;e.forEach(function(o){d.forEach(function(j){j.call(i,o);});});}};E.prototype._bindingChangeListener=function(){var v=this._getVizFrame();v.invalidate();this.setBusy(false);if(this._isEnablePaging()){if(this._bNeedTotal){this._initPagination();this._bNeedTotal=false;}else if(this._bNeedPaging){var d=v._states().plot.transform.translate.position;this._updatePage(d);}}else{this._mMeasureRange={};v._pendingDataRequest(false);v.invalidate();}try{this._prepareData();}catch(e){if(e instanceof z){e.display();}}var o=this._getEffectiveProperties();this._usingDisplayNameForSemantics(o);v.setVizProperties(o);this._setEffectiveScales();};E.prototype._initPagination=function(d){var o=this.getBinding("data");if(!o){return;}var i=o instanceof sap.ui.model.analytics.AnalyticalBinding?o.getTotalSize():o.getLength();if(i>=0){this._iTotalSize=i;if(this._iTotalSize>this._iPageSize*2){this._iMaxPageNo=Math.floor(this._iTotalSize/this._iPageSize)-1;this._iRemainingRecords=this._iTotalSize%this._iPageSize;this._bNeedPaging=true;this._iOffset=null;var e=this._iPageSize/this._iTotalSize;this._oPagingOption={bEnabled:true,iStartIndex:0,iLength:this._iPageSize,sMode:"reset",thumbRatio:e,iPageNo:0};if(d){this._getVizFrame()._pendingDataRequest(false);}else{this._getVizFrame()._pendingDataRequest(true);this._queryMinMax(this._measureRangeReceivedHandler.bind(this));}}else{this._mMeasureRange={};this._bNeedPaging=false;this._oPagingOption={bEnabled:false,iStartIndex:0,iLength:this._iTotalSize};this._getVizFrame()._pendingDataRequest(false);}this._getDataset().setPagingOption(this._oPagingOption);}};E.prototype._resetPagingOptions=function(){var d=this;var o=this.getBinding("data");var e=this._getDataset();if(!e||!o){return;}if(this._isEnablePaging()){var i=this._prepareFeeds();i._order=i._order.filter(function(k){return k!=="MND"&&d.getDimensions().map(function(v){return v.getName();}).indexOf(k)>-1;});if(i._order.length){var j=this._aFeeds._order.map(function(p){return new w(p);});o.sort(j);}this._bNeedTotal=true;this._oPagingOption={bEnabled:false,iStartIndex:0,iLength:this._iPageSize*2,iPageNo:0};e.setPagingOption(this._oPagingOption);this._oColorTracker.clear();this._getVizFrame()._runtimeScales(this._oColorTracker.get(),true);}else{e.setPagingOption(null);}this._oColoringStatus={};this._mMeasureRange={};};E.prototype._enableSemanticPattern=function(){return!(this._oDataPointStyle||this._oSeriesStyle);};E.prototype._hasSemanticPattern=function(){return this._semanticTuples&&this._semanticTuples.length>0;};E.prototype._getContinuesSemanticTuples=function(){var d={};if(this._hasSemanticPattern()){d=this._semanticTuples.reduce(function(e,i){if(i.semanticMsrName){e[i.semanticMsrName]=i;}return e;},{});}return d;};E.prototype._getContinuesSemanticMap=function(){var d=[];if(this._hasSemanticPattern()){d=this._semanticTuples.filter(function(e){return e.projectedValueStartTime;});}return d;};E.prototype._getInternalVisibleMeasures=function(){var m=this._getVisibleMeasures();if(this._hasSemanticPattern()){m=m.concat(this._getContinuesSemanticMap().map(function(d){return d.semanticMsrName;}));}return m;};E.prototype._buildSelectedDataPoints=function(o,d){var m=this._getInternalVisibleMeasures(),e=this._getVisibleDimensions().concat(this.getInResultDimensions()),i=this._getEffectiveContinuesDataPoints(d);return n.buildSelectionVizCtx(m,e,o,i);};E.prototype._getEffectiveContinuesSeries=function(d){var e=d.slice(),i=this._getContinuesSemanticMap();if(this._hasSemanticPattern()){var m=e.map(function(j){return j.measures;});i.forEach(function(j){if(m.indexOf(j.actual)>-1||m.indexOf(j.projected)>-1){e=e.filter(function(k){return k.measures!==j.actual&&k.measures!==j.projected;});if(m.indexOf(j.actual)>-1&&m.indexOf(j.projected)>-1){e.push({measures:j.semanticMsrName});}}});}return e;};E.prototype._getEffectiveContinuesDataPoints=function(d){var e=d.slice(),k=this._getContinuesSemanticMap();if(this._hasSemanticPattern()){var m,p,o,v;for(var i=0;i<e.length;i++){o=e[i].measures;for(var j=0;j<k.length;j++){v=k[j];m=o.indexOf(v.actual);if(m>-1){o.splice(m,1);}p=o.indexOf(v.projected);if(p>-1){o.splice(p,1);}if(m>-1||p>-1){o.push(v.semanticMsrName);}}}}return e;};E.prototype._buildSelectEventData=function(d){if(d&&d.length>0&&this._hasSemanticPattern()){var v,e;var k=this._getContinuesSemanticMap();for(var i=0;i<d.length;i++){v=jQuery.extend(true,{},d[i].data);for(var j=0;j<k.length;j++){e=k[j];if(v.measureNames===e.semanticMsrName){if(v[e.timeAxis]<e.projectedValueStartTime){v.measureNames=e.actual;delete v[e.projected];delete v[e.semanticMsrName];}else{v.measureNames=e.projected;delete v[e.actual];delete v[e.semanticMsrName];}}else{if(v[e.actual]&&v.measureNames!==e.actual){delete v[e.actual];}if(v[e.projected]&&v.measureNames!==e.projected){delete v[e.projected];}}}d[i].data=v;}}};E.prototype.addData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "addData" therefore cannot be used programmatically!');};E.prototype.destroyData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "destroyData" therefore cannot be used programmatically!');};E.prototype.getData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "getData" therefore cannot be used programmatically!');};E.prototype.indexOfData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "indexOfData" therefore cannot be used programmatically!');};E.prototype.insertData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "insertData" therefore cannot be used programmatically!');};E.prototype.removeData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "removeData" therefore cannot be used programmatically!');};E.prototype.removeAllData=function(){jQuery.sap.log.error('Chart manages the "data" aggregation only via data binding. The method "removeAllData" therefore cannot be used programmatically!');};E.prototype._createOData4SAPAnalyticsModel=function(m){var o=null;try{o=new u.Model(new u.Model.ReferenceByModel(m));}catch(e){return undefined;}return o;};E.prototype.getIsAnalytical=function(){return this.getProperty("isAnalytical");};E.prototype.setIsAnalytical=function(v,d){if(this._bIsInitialized){jQuery.sap.log.error('The proeprty isAnalytical will programmatically set according to data source. The method "setIsAnalytical" therefore cannot be used!');}else{this.setProperty("isAnalytical",v,d);}};E.prototype._setIsAnalyticalProperty=function(o,d){var v=o.findQueryResultByName(h.getEntitySet(this.getIsAnalytical())(d))!==undefined;if(this.getIsAnalytical()!==v){this.setProperty("isAnalytical",v);}};E.prototype.bindAggregation=function(d,o){if(d==="data"){var m=this.getModel(o.model);var e;if(m){if(m instanceof sap.ui.model.json.JSONModel){if(this.getIsAnalytical()!==false){this.setProperty("isAnalytical",false);}else if(this.getEnablePagination()!==false){this.setProperty("enablePagination",false);}}else{e=this._createOData4SAPAnalyticsModel(m);this._setIsAnalyticalProperty(e,o);}if(this.getIsAnalytical()){if(o){o.parameters=jQuery.extend(true,{},{analyticalInfo:[{name:""}],useBatchRequests:true,provideGrandTotals:false,provideTotalsResultSize:false,autoexpand:false,reloadSingleUnitMeasures:true,noPaging:true},o.parameters);if(this._isEnablePaging()){var p={noPaging:false};o.parameters=jQuery.extend(true,o.parameters,p);}}O.apply(m);if(e){m.setAnalyticalExtensions(e);}}}}return B.prototype.bindAggregation.apply(this,arguments);};E.prototype._bindAggregation=function(d,o){if(d==="data"){var m=this.getModel(o.model);if(m){if(m instanceof sap.ui.model.json.JSONModel){if(this.getIsAnalytical()!==false){this.setProperty("isAnalytical",false);}else if(this.getEnablePagination()!==false){this.setProperty("enablePagination",false);}}else{var e=this._createOData4SAPAnalyticsModel(m);this._setIsAnalyticalProperty(e,o);}if(this.getIsAnalytical()){if(o){o.parameters=jQuery.extend(true,{},{analyticalInfo:[{name:""}],useBatchRequests:true,provideGrandTotals:false,provideTotalsResultSize:false,autoexpand:false,reloadSingleUnitMeasures:true,noPaging:true},o.parameters);if(this._isEnablePaging()){var p={noPaging:false};o.parameters=jQuery.extend(true,o.parameters,p);}}O.apply(m);if(e){m.setAnalyticalExtensions(e);}}this._deriveColumns(m,o);}var i=this._getDataset(),j=i.getBinding("data");if(j){j.detachChange(this._bindingChangeListener,this);}i.bindAggregation("data",o);var k=i.getBinding("data");if(k){i.getBinding("data").attachChange(this._bindingChangeListener,this);}this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}});}else{B.prototype._bindAggregation.apply(this,arguments);}};E.prototype.unbindAggregation=function(d,e){if(d==="data"){var o=this._getDataset();if(o){o.unbindAggregation.apply(o,arguments);}e=true;}return B.prototype.unbindAggregation.apply(this,[d,e]);};E.prototype.unbindData=function(){if(!this.getIsAnalytical()){this.removeAllAggregation("dimensions");this.removeAllAggregation("measures");this.setProperty("visibleDimensions",[]);this.setProperty("inResultDimensions",[]);this.setProperty("visibleMeasures",[]);this._createDrillStack();}this.unbindAggregation("data");};E.prototype._deriveColumns=function(m,o){var d=this.getAggregation("dimensions");var e=this.getAggregation("measures");if((d===null||d.length===0)&&(e===null||e.length===0)){var i=h.deriveColumns(this.getIsAnalytical())(m,o);i.dimensions.forEach(this.addDimension.bind(this));i.measures.forEach(this.addMeasure.bind(this));}};E.prototype.onBeforeRendering=function(){B.prototype.onBeforeRendering.apply(this,arguments);var o=["onInvalidate","drillStack","dataSet","vizFrame","checkBinding","binding","loopData"];o.forEach(function(k){if(this._mNeedToUpdate[k]){this._updaters[k].call(this);}}.bind(this));jQuery.each(this._mNeedToUpdate,function(k){this._mNeedToUpdate[k]=false;}.bind(this));};E.prototype.onAfterRendering=function(){this._showLoading(this._bLoading);};E.prototype.onlocalizationChanged=function(){this._invalidateBy({source:this,keys:{vizFrame:true}});};E.prototype.exit=function(){this._getDataset().unbindAggregation('data',true);B.prototype.exit.apply(this,arguments);var v=this._getVizFrame();if(this._delegateEventHandlers){this._delegateEventHandlers.forEach(function(o){v["detach"+o.name](o.handler,this);delete o.handler;},this);delete this._delegateEventHandlers;}v.detachRenderComplete(this._vizFrameRenderCompleteHandler,this);};E.prototype.applySettings=function(){this._oDataPointStyle=null;this._oSeriesStyle=null;sap.ui.core.Control.prototype.applySettings.apply(this,arguments);var d=new F();var i=jQuery.extend(true,{},{'applicationSet':'fiori'},this.getUiConfig());this.setUiConfig(i);this._bNeedToApplyDefaultProperties=true;var v=new V({width:G(this.getWidth()),height:G(this.getHeight()),vizType:this.getChartType(),uiConfig:this.getUiConfig(),vizProperties:jQuery.extend(true,{'title':{'visible':false}},this._getEffectiveProperties())});v.setDataset(d);v.attachRenderComplete(null,this._updateLoadingIndicator.bind(this));this._rendered=false;v.attachEventOnce("renderComplete",function(){this._rendered=true;},this);v.attachEvent("renderFail",null,function(e){this._showLoading(false);},this);v._pendingDataRequest(true);this.setAggregation("_vizFrame",v);this._delegateEvents();this._bNeedTotal=true;this._bNeedPaging=false;this._iPageSize=500;this._oColorTracker=new S();this._sAdapteredChartType=this.getChartType();this._bIsInitialized=true;this._oCandidateColoringSetting={};this._oDataPointStyle=null;this._oLegendtitle=null;this._oColoringStatus={};};E.prototype.setCustomMessages=function(o){this.setProperty("customMessages",o);var v=this._getVizFrame();if(v){v._setCustomMessages(o);}return this;};E.prototype.resetLayout=function(){this._invalidateBy({source:this,keys:{binding:true,vizFrame:true,drillStack:true,dataSet:true}});return this;};E.prototype.setSelectedDataPoints=function(d){if(this.getSelectionMode()!==A.None){var o=this.getBinding("data"),v=this._getVizFrame();if(!o||!v||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this;}v.vizSelection([],{clearSelection:true});v.vizSelection(this._buildSelectedDataPoints(o,d),{selectionMode:this.getSelectionMode()});}return this;};E.prototype.addSelectedDataPoints=function(d){if(this.getSelectionMode()!==A.None){var o=this.getBinding("data"),v=this._getVizFrame();if(!o||!v||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this;}v.vizSelection(this._buildSelectedDataPoints(o,d),{selectionMode:A.Multi});}return this;};E.prototype.getSelectedDataPoints=function(){var v=this._getVizFrame();if(!v||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return{count:0,dataPoints:[]};}var o=this._getContinuesSemanticTuples();var m=this._getVisibleMeasures(),d=this._getDataset(),e=v.vizSelection(),j={};for(var i=0,k=e.length;i<k;i++){var p=e[i],Q=p.data._context_row_number;if(!j[Q]){j[Q]={index:Q,measures:[],context:d.findContext({"_context_row_number":Q})};}p.measures=n.filterVisibleMsr(p.data,m);if(!jQuery.isEmptyObject(o)){n.filterSemMsr(o,m,p);}j[Q].measures=j[Q].measures.concat(p.measures);if(p.unit){j[Q].unit=jQuery.extend(true,j[Q].unit,p.unit);}if(p.dataName){j[Q].dataName=jQuery.extend(true,j[Q].dataName,p.dataName);}}return{count:e.length,dataPoints:Object.keys(j).map(function(U){return j[U];})};};E.prototype.removeSelectedDataPoints=function(d){if(this.getSelectionMode()!==A.None){var o=this.getBinding("data"),v=this._getVizFrame();if(!v||this.getSelectionBehavior().toUpperCase()!=="DATAPOINT"){return this;}var e=this._buildSelectedDataPoints(o,d);v.vizSelection(e,{deselection:true});}return this;};E.prototype.setSelectedCategories=function(d){if(this.getSelectionMode()!==A.None){var v=this._getVizFrame(),e=this.getSelectionBehavior().toUpperCase();if(!v||e!=="CATEGORY"){return this;}v.vizSelection([],{clearSelection:true});v.vizSelection(d.map(n.toVizCSCtx),{selectionMode:this.getSelectionMode()});}return this;};E.prototype.addSelectedCategories=function(d){if(this.getSelectionMode()!==A.None){var v=this._getVizFrame(),e=this.getSelectionBehavior().toUpperCase();if(!v||e!=="CATEGORY"){return this;}v.vizSelection(d.map(n.toVizCSCtx),{selectionMode:A.Multi});}return this;};E.prototype.removeSelectedCategories=function(d){if(this.getSelectionMode()!==A.None){var v=this._getVizFrame(),e=this.getSelectionBehavior().toUpperCase();if(!v||e!=="CATEGORY"){return this;}v.vizSelection(d.map(n.toVizCSCtx),{deselection:true});}return this;};E.prototype.getSelectedCategories=function(){var v=this._getVizFrame(),d=this.getSelectionBehavior().toUpperCase();if(!v||d!=="CATEGORY"){return{count:0,categories:[]};}else{var e=v.vizSelection();return{count:e.length,categories:(e.category||[]).map(n.fromVizCSCtx)};}};E.prototype.setSelectedSeries=function(d){if(this.getSelectionMode()!==A.None){var v=this._getVizFrame(),e=this.getSelectionBehavior().toUpperCase();if(!v||e!=="SERIES"){return this;}v.vizSelection([],{clearSelection:true});var i=this._getEffectiveContinuesSeries(d);v.vizSelection(i.map(n.toVizCSCtx),{selectionMode:this.getSelectionMode()});}return this;};E.prototype.addSelectedSeries=function(d){if(this.getSelectionMode()!==A.None){var v=this._getVizFrame(),e=this.getSelectionBehavior().toUpperCase();if(!v||e!=="SERIES"){return this;}var i=this._getEffectiveContinuesSeries(d);v.vizSelection(i.map(n.toVizCSCtx),{selectionMode:A.Multi});}return this;};E.prototype.removeSelectedSeries=function(d){if(this.getSelectionMode()!==A.None){var v=this._getVizFrame(),e=this.getSelectionBehavior().toUpperCase();if(!v||e!=="SERIES"){return this;}var i=this._getEffectiveContinuesSeries(d);v.vizSelection(i.map(n.toVizCSCtx),{deselection:true});}return this;};E.prototype.getSelectedSeries=function(){var v=this._getVizFrame(),d=this.getSelectionBehavior().toUpperCase();if(!v||d!=="SERIES"){return{count:0,series:[]};}else{var e=v.vizSelection(),i=(e.series||[]).map(n.fromVizCSCtx),j=[],k=this._getContinuesSemanticTuples();i=i.filter(function(m){var o=true;if(m&&m.measures){var p=k[m.measures];if(p&&p.semanticMsrName===m.measures){j.push({measures:p.actual});j.push({measures:p.projected});o=false;}}return o;});i=i.concat(j);return{count:e.length,series:i};}};E.prototype.drillDown=function(d){if(this.getIsAnalytical()===false){jQuery.sap.log.error('Data source does not support drillDown/drillUp. The method "drillDown" therefore cannot be used!');return;}if(d&&!(d instanceof Array)){d=[d];}var e=this._normalizeDorM(d,true);if(e.length===0){return;}if(!this._checkDrilldownValid(e)){jQuery.sap.log.warning("Drill down not possible for "+e+". Already drilled down.");return;}var o=this._getDrillStateTop(),m=this._redundantsFromSelection(),i=this._deriveFilterFromSelection();var j;if(i){j=!(o&&o.filter)?i:new s([i,o.filter],true);}this._drillStateStack.push({dimensions:o.dimensions.slice().concat(e.map(function(p){return p.getName();})).filter(function(p){return!m[p];}),measures:o.measures.filter(function(p){return!m.measureNames[p];}),filter:j,redundant:m});var k=e.map(function(p){return p.getName();});this.fireDrilledDown({dimensions:k});this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}});};E.prototype.drillUp=function(i){if(this.getIsAnalytical()===false){jQuery.sap.log.error('Data source does not support drillDown/drillUp. The method "drillUp" therefore cannot be used!');return;}if(arguments.length===0){i=this._drillStateStack.length-2;}var o=this._drillStateStack[i];if(o&&i!=this._drillStateStack.length-1){var p=this._drillStateStack.pop();this._drillStateStack.splice(i+1);this.fireDrilledUp({dimensions:p.dimensions.filter(function(d){return o.dimensions.indexOf(d)===-1;})});this._invalidateBy({source:this,keys:{binding:true,vizFrame:true}});}};E.prototype.getDrillStack=function(){if(this.getIsAnalytical()===false){jQuery.sap.log.error('Data source does not support drillDown/drillUp. The method "getDrillStack" therefore cannot be used!');return;}return jQuery.map(this._drillStateStack||[],function(o,i){return{dimension:o.dimensions.slice(),measure:o.measures.slice(),filter:o.filter};});};E.prototype.setUiConfig=function(U){this.setProperty("uiConfig",U);if(this._getVizFrame()){this._getVizFrame().setUiConfig(U);}};var H=(function(){var d=["interaction.selectability.mode","interaction.selectability.behavior"];function e(o,p){var j=o,v;v=p.reduce(function(m,Q){if(j.hasOwnProperty(Q)){m.push({parent:j,val:j[Q],key:Q});j=j[Q];}return m;},[]);if(v.length!==p.length){return;}var k=v.pop();delete k.parent[k.key];while(v.length>0){k=v.pop();if(Object.keys(k.val).length>0){return;}else{delete k.parent[k.key];}}}function i(v,j){var o=jQuery.extend(true,{},v);d.forEach(function(p){delete o[p];e(o,p.split("."));});return o;}return{sanitize:i,modify:function(p,k,j){var m=k.split("."),o=p;while(m.length>1&&o.hasOwnProperty(m[0])){o=o[m.shift()];}var v=m[0];if(m.length===1&&o.hasOwnProperty(v)){o[v]=j(o[v]);}}};})();E.prototype.setVizProperties=function(v){v=H.sanitize(v);this.setProperty("vizProperties",v);this._oLegendtitle=v.legend?v.legend.title:null;if(v.plotArea){if(v.plotArea.dataPointStyle){this._oDataPointStyle=v.plotArea.dataPointStyle;this._invalidateBy({source:this,keys:{loopData:true}});}if(v.plotArea.seriesStyle){this._oSeriesStyle=v.plotArea.seriesStyle;}}if(this._getVizFrame()){this._getVizFrame().setVizProperties(this._getEffectiveProperties());}};E.prototype.getVizProperties=function(){var o=this._getVizFrame();var d=H.sanitize(o?o.getVizProperties():this.getProperty("vizProperties"));function e(i){var j=sap.viz.api.env.Format.numericFormatter();if(!j||jQuery.type(j.stripUnit)!=="function"){return i;}if(jQuery.type(i)==="string"){return j.stripUnit(i);}else if(jQuery.type(i)==="object"){jQuery.each(i,function(k,v){i[k]=j.stripUnit(v);});return i;}else{return i;}}H.modify(d,"plotArea.dataLabel.formatString",e);H.modify(d,"tooltip.formatString",e);return d;};E.prototype.setVizScales=function(v){this.setProperty("vizScales",v);this._oVizColorScale=v.filter(function(o){return o.feed==="color";})[0];if(this._getVizFrame()){this._getVizFrame().setVizScales(v);}};E.prototype.getVizScales=function(){var v=this._getVizFrame();return v?v.getVizScales():this.getProperty("vizScales");};E.prototype.getVizUid=function(){return this._getVizFrame().getVizUid();};E.prototype.zoom=function(o){this._getVizFrame().zoom(o);};var I=["selectData","deselectData"];E.prototype._delegateEvents=function(){if(this._delegateEventHandlers){return;}var v=this._getVizFrame();this._delegateEventHandlers=I.map(function(e){var d=e.charAt(0).toUpperCase()+e.slice(1);var i=function(o){var p=o.getParameters();this._buildSelectEventData(p.data);delete p.id;this.fireEvent(e,p);};i=i.bind(this);v["attach"+d](null,i);return{name:d,handler:i};},this);this._vizFrameRenderCompleteHandler=P.bind(this);v.attachRenderComplete(null,this._vizFrameRenderCompleteHandler);v.attachEvent("_scroll",N.bind(this));};E.getChartTypes=sap.chart.api.getChartTypes;E.prototype.getAvailableChartTypes=function(){var d=this._getVisibleDimensions(true),m=this._getVisibleMeasures(true);return C.CONFIG.chartTypes.reduce(function(o,e){var i=R.compatible(e,d,m);if(i.compatible){o.available.push({chart:e});}else{var j={};if(i.error.missing.dim){j.Dimension=i.error.missing.dim;}if(i.error.missing.time){j.DateTimeDimension=i.error.missing.time;}if(i.error.missing.msr){j.Measure=i.error.missing.msr;}o.unavailable.push({chart:e,error:j});}return o;},{available:[],unavailable:[]});};E.prototype._getEffectiveProperties=function(){var v={};if(this._bNeedToApplyDefaultProperties){v=jQuery.extend(true,v,this._getDefaultVizProperties());this._bNeedToApplyDefaultProperties=false;}v=jQuery.extend(true,v,q.getSemanticVizProperties(this._sAdapteredChartType,this._semanticTuples),this._oColoringsDataPointStyle,this.getProperty("vizProperties"),this._getHostedVizProperties(),this._getPagingVizProperties(),this._getTimeProperties());return v;};E.prototype._setEffectiveScales=function(){var v=this._getVizFrame();if(this._oColoringScale){v.setVizScales([this._oColoringScale]);}};E.prototype._usingDisplayNameForSemantics=function(v){var d=function(o){if((typeof(o)==='undefined')||(o===null)){return false;}return true;};if(v.plotArea&&v.plotArea.dataPointStyle&&v.plotArea.dataPointStyle.rules){var e=this._getContexts();if(e.length>0&&!e.hasOwnProperty("dataRequested")){var k=this.getVisibleDimensions(),m=v.plotArea.dataPointStyle.rules;for(var i=0;i<m.length;i++){var p=m[i].dataContext;if(p&&p.length!==0){var Q=Object.keys(p);if(!d(m[i].displayName)&&Q.length===1){var U=Q[0];if(p[U].hasOwnProperty("equal")&&k.indexOf(U)!==-1){var W=this.getDimensionByName(U).getTextProperty();for(var j=0;j<e.length;j++){if(e[j].getProperty(U)===p[U].equal){var X=e[j].getProperty(W);if(!d(W)||!d(X)||typeof(X)==="object"||this.getDimensionByName(U).getDisplayText()===false){m[i].displayName=p[U].equal;break;}else{m[i].displayName=X;break;}}}}}}}}}};E.prototype._getCandidateColoringSetting=function(){if(!this._bColoringParsed){this._bColoringParsed=true;this._oCandidateColoringSetting={};var o=this.getColorings();var d=this.getActiveColoring();var m=this._normalizeDorM(this.getVisibleMeasures());var i=this._normalizeDorM(this.getVisibleDimensions(),true);var j=this._normalizeDorM(this.getInResultDimensions(),true);if(o){try{var U=jQuery.sap.getResourcePath("sap/chart/i18n/i18n.properties");var k=jQuery.sap.resources({url:U});this._oCandidateColoringSetting=y.getCandidateSetting(o,d,m,i,j,this._oColoringStatus||{},this.getChartType(),k);}catch(e){if(e instanceof z){e.display();}else{throw e;}}}}return this._oCandidateColoringSetting;};E.prototype._hostedVizProperties={selectionMode:{prop:"interaction.selectability.mode"},selectionBehavior:{prop:"interaction.selectability.behavior"}};E.prototype._getHostedVizProperties=function(){return Object.keys(this._hostedVizProperties).reduce(function(o,p){var d=this._hostedVizProperties[p].prop.split(".").reverse().reduce(function(o,e){var i={};i[e]=o;return i;},this.getProperty(p));return jQuery.extend(true,o,d);}.bind(this),{});};var J="__UI5__ShortIntegerMaxFraction10";var K="__UI5__FloatMaxFraction2";var L="__UI5__ShortIntegerMaxFraction2";E.prototype._getDefaultVizProperties=function(){var d='info/'+(this._sAdapteredChartType||this.getChartType());var i=(d.indexOf("info/100_")===0);var j=(d==="info/pie"||d==="info/donut");var o={interaction:{extraEventInfo:true}};return jQuery.extend(true,o,v({},d,["valueAxis.label.formatString","valueAxis2.label.formatString"],i?'':J),v({},d,["legend.formatString","sizeLegend.formatString"],L),v({},d,["plotArea.dataLabel.formatString"],j?'':L),v({},d,["tooltip.formatString"],i?'':K));function k(e,Q,U){if(Q.length===0){return U;}e=e||{};var p=e[Q[0]];e[Q[0]]=k(p,Q.slice(1),U);return e;}function m(p,Q){if(p==null||Q.legnth===0){return p;}var e=p[Q[0]];if(e&&e.children){return m(e.children,Q.slice(1));}return e;}function v(e,Q,U,W){var X=sap.viz.api.metadata.Viz.get(Q);if(X){var Y=X.properties;U.forEach(function(Z){Z=Z.split(".");var p=m(Y,Z);if(p&&p.hasOwnProperty("defaultValue")){k(e,Z,W);}});}return e;}};E.prototype._getPagingVizProperties=function(){if(this._isEnablePaging()){var p={interaction:{zoom:{enablement:false},selectability:{mode:"NONE"}},plotArea:{isFixedDataPointSize:true}};return p;}else{return{};}};E.prototype._getTimeProperties=function(){var d=["year","month","day"];var o=null;var e=this;var i=this.getVisibleDimensions().filter(function(m){var v=e.getDimensionByName(m);return(v instanceof sap.chart.data.TimeDimension&&v._getFixedRole()==="category");})[0];if(i){var j=this.getDimensionByName(i);switch(j.getTimeUnit()){case x.yearmonthday:d=["year","month","day"];break;case x.yearquarter:d=["year","quarter"];break;case x.yearmonth:d=["year","month"];break;case x.fiscalyear:d=["fiscal_year"];break;case x.fiscalyearperiod:d=["fiscal_period","fiscal_year"];break;default:}o=j.getFiscalYearPeriodCount();}var p=this.getProperty("vizProperties");if(p&&p.timeAxis){var k=p.timeAxis;if(k.levels){d=k.levels;}if(k.fiscal&&k.fiscal.periodNumbers){o=k.fiscal.periodNumbers;}}return{"timeAxis":{"levels":d,"fiscal":{"periodNumbers":o}}};};E.prototype.setSelectionMode=function(v){this.setProperty("selectionMode",v);var o=this._getVizFrame();if(o){o.setVizProperties({interaction:{selectability:{mode:v}}});}return this;};E.prototype.getSelectionMode=function(){var v=this._getVizFrame();if(v){return v.getVizProperties().interaction.selectability.mode;}else{return this.getProperty("selectionMode");}};E.prototype.setSelectionBehavior=function(v){this.setProperty("selectionBehavior",v);var o=this._getVizFrame();if(o){o.setVizProperties({interaction:{selectability:{behavior:v}}});}return this;};E.prototype.getSelectionBehavior=function(){var v=this._getVizFrame();if(v){return v.getVizProperties().interaction.selectability.behavior;}else{return this.getProperty("selectionBehavior");}};E.prototype.getDimensionByName=function(e){return this.getDimensions().filter(function(d){return d.getName()===e;})[0];};E.prototype.getMeasureByName=function(d){return this.getMeasures().filter(function(m){return m.getName()===d;})[0];};E.prototype.getTimeDimensions=function(){return this.getDimensions().filter(function(d){return d instanceof T;});};function N(e){if(this._isEnablePaging()&&this._bNeedPaging){var d=e.getParameters().position;this._updatePage(d);}}E.prototype._isEnablePaging=function(){this._bMobile=sap.ui.Device.system.tablet||sap.ui.Device.system.phone;var d=this.getEnablePagination()&&this._bIsPagingChartType&&!this._bMobile;return d;};E.prototype._updatePage=function(d){var v=this._getVizFrame();var i=Math.floor(this._iTotalSize*d/this._iPageSize);i=Math.min(i,this._iMaxPageNo);this._iOffset=null;var e=Math.max((i-1)*this._iPageSize,0);var j,k;if(i===0){j=this._iPageSize;k=this._iPageSize;}else if(i===this._iMaxPageNo){j=this._iPageSize*2+this._iRemainingRecords;k=this._iPageSize+this._iRemainingRecords;}else{j=this._iPageSize*2;k=this._iPageSize;}this._iOffset=(this._iTotalSize*d-i*this._iPageSize)/k;var o=this._getDataset();if(o.getRenderedPageNo()===i){var m={plot:{transform:{translate:{translateByPage:{context:this._middleCtx,offset:this._iOffset}}}}};v._states(m);this._showLoading(false);}else{if(this._pagingTimer){jQuery.sap.clearDelayedCall(this._pagingTimer);}this._pagingTimer=jQuery.sap.delayedCall(50,this,function(){this._oPagingOption={bEnabled:true,iStartIndex:e,iLength:j,sMode:"update",thumbRatio:null,iPageNo:i};var p=this.getBinding("data").getContexts(e,j),Q;if(p.dataRequested){Q=true;}else{Q=p.some(function(U){return U===undefined;});}if(Q){o.suppressInvalidate();}else{o.setPagingOption(this._oPagingOption);o.updateData();v.invalidate();this._oColorTracker.add(this._getVizFrame()._runtimeScales());this._getVizFrame()._runtimeScales(this._oColorTracker.get(),true);}});this._sLoadingTimer=this._sLoadingTimer||jQuery.sap.delayedCall(200,this,function(){this._showLoading(true);});}};function P(e){var p=e.getParameters();delete p.id;if(this._isEnablePaging()&&this._bNeedPaging){if(this._sLoadingTimer){jQuery.sap.clearDelayedCall(this._sLoadingTimer);this._sLoadingTimer=null;}var v=this._getVizFrame();var o=this.getBinding("data");var d=this._getDataset();var i=d.getRenderedPageNo();if(i!==0){var m=i*this._iPageSize-1;this._middleCtx=o.getContexts(m,1)[0].getObject();}else{this._middleCtx=null;}if(this._middleCtx||this._iOffset){var j={plot:{transform:{translate:{translateByPage:{context:this._middleCtx,offset:this._iOffset}}}}};v._states(j);}this._showLoading(false);}this.fireEvent("renderComplete",p);}E.prototype._showLoading=function(d){var $=this.$();if(!$){return;}if(!d){if(this._$loadingIndicator){this._$loadingIndicator.remove();}}else{if(!this._$loadingIndicator){this._$loadingIndicator=this._createLoadingIndicator();}this._updateLoadingIndicator();$.append(this._$loadingIndicator);}this._bLoading=d;};E.prototype._createLoadingIndicator=function(){var $=jQuery(sap.ui.core.BusyIndicatorUtils.getElement());var d=jQuery("<p>").attr("class","loading-text").text("Loading");d.css({"position":"absolute","transform":"translateY(-3em)","width":"100%","text-align":"center"});d.insertBefore($.children()[0]);$.css({opacity:1});return $;};E.prototype._updateLoadingIndicator=function(){var $=this.$();if(!$||!this._$loadingIndicator){return;}var d=this._sAdapteredChartType,e=d==="bar"||d.indexOf("horizontal")!==-1;var i=$.find(".v-plot-bound"),o=$.offset(),p={top:o.top,left:o.left,width:$.width(),height:$.height()};if(i.length){var j=i.offset(),k=i[0].getBoundingClientRect();p.top=j.top-1;p.left=j.left;p.width=k.width+1;if(e){p.height=Math.ceil(k.height+1);}else{p.height=Math.floor(k.height+1);}}this._$loadingIndicator.css(p);var m=this._$loadingIndicator.find(".loading-text");m.css({"top":p.height/2,"font-weight":sap.ui.core.theming.Parameters.get("sapUiChartTitleFontWeight"),"font-size":sap.ui.core.theming.Parameters.get("sapUiChartMainTitleFontSize"),"color":sap.ui.core.theming.Parameters.get("sapUiChartMainTitleFontSize")});this._$loadingIndicator.css({"background-color":sap.ui.core.theming.Parameters.get("sapUiExtraLightBG")});};E.prototype._getRequiredDimensions=function(){var v=this._getVisibleDimensions(),i=this.getInResultDimensions();return this._normalizeDorM(v.concat(i),true);};E.prototype._getRequiredMeasures=function(){return this._getVisibleMeasures(true);};E.prototype._queryMinMax=function(d){var e=this._getRequiredDimensions().map(function(W){return W.getName();}),m=this._getRequiredMeasures().map(function(W){return W.getName();});var o=m.reduce(function(o,W){o[W]={min:{},max:{}};return o;},{});function i(){var W=m.every(function(X){return o[X].min.requested&&o[X].max.requested;});if(W){d(o);}}function j(W,X,Y){o[W][X].requested=true;o[W][X].value=parseFloat(Y&&Y.results[0][W]);i();}function k(W,X,Y){o[W][X].requested=true;o[W][X].error=Y;i();}var Q=m.reduce(function(Q,W){return Q.concat({urlParameters:{"$select":e.concat(W).join(","),"$top":1,"$orderby":W+" asc"},success:j.bind(null,W,"min"),error:k.bind(null,W,"min")},{urlParameters:{"$select":e.concat(W).join(","),"$top":1,"$orderby":W+" desc"},success:j.bind(null,W,"max"),error:k.bind(null,W,"max")});},[]);var p=this.getBinding("data"),v=p.getPath(),U=p.getModel();Q.forEach(function(W){U.read(v,W);});return Q;};E.prototype._measureRangeReceivedHandler=function(Q){var m={};jQuery.each(Q,function(d,o){m[d]={min:o.min.value,max:o.max.value};});this._mMeasureRange=m;var v=this._getVizFrame();v._pendingDataRequest(false);this._invalidateBy({source:this,keys:{vizFrame:true}});this.setBusy(false);};E.prototype.exportToSVGString=function(o){var d="<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\"/>",v=this._getVizFrame();if(v){d=v.exportToSVGString(o);}return d;};return E;});
