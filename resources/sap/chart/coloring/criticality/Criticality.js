/*
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/chart/coloring/criticality/measureValues/MeasureValues','sap/chart/coloring/criticality/DimensionValues','sap/chart/coloring/ColoringUtils','sap/chart/coloring/ColorPalette','sap/chart/ChartLog','sap/chart/library'],function(M,D,C,a,b,c){"use strict";var t=jQuery.type;var S=['DimensionValues','MeasureValues'];var d=c.coloring.CriticalityType;var m=[d.Positive,d.Neutral,d.Critical,d.Negative,'Unmentioned'];var e=[d.Positive,d.Critical,d.Negative,d.Neutral];function u(o,A){var p=A?A.parameters:{};var i=Object.keys(o).filter(function(T){return!S.indexOf(T)!==-1;});if(p&&p.dimension&&p.measure){throw new b('error','colorings.Criticality','Both "DimensionValues" and "MeasureValues" present in coloring CRITICALITY, activeColoring.parameters is required to specify which to use');}else if(p&&p.dimension){return'DimensionValues';}else if(p&&p.measure){return'MeasureValues';}else if(i.length===1){return i[0];}else{return null;}}function f(i,l){var r=[];l.forEach(function(s){i.forEach(function(o){if(o.chartLog){throw o.chartLog;}var k=o.parsed.callbacks[s]||[];k.forEach(function(n,p){var q,v;if(s==="Unmentioned"){q=C.assignUnmentionedColor(a.CRITICALITY.Neutral,k.length);v=o.parsed.legend[p];}else{q=C.assignColor(a.CRITICALITY[s],k.length);var L=o.parsed.legend[s];v=(t(L)==="array")?L[p]:L;}r.push({callback:n,properties:{color:q[p]},displayName:v});});});});return r;}function g(i){var o=i[0];var l=o.parsed.legend;var p=[],B=[];var n=(l.segments[0].upperBound>l.min)?true:false;var N=(l.segments[l.segments.length-2].upperBound<l.max)?true:false;l.segments.forEach(function(s){var k=C.assignColor(a.CRITICALITY[s.CriticalityType],1);p.push(k[0]);B.push(s.upperBound);});if(n){B=[l.min].concat(B);}else{p.splice(0,1);}if(N){B[B.length-1]=l.max;}else{p.splice(p.length-1,1);B.splice(B.length-1,1);}if(p.length<=1){return null;}return{feed:"color",palette:p,numOfSegments:p.length,legendValues:B};}function h(i){var l;if(i.legendTitle){l={title:{text:i.legendTitle,visible:true}};}else{l={title:{text:null,visible:false}};}return l;}function j(i,l){return function(){var k,p;if(i.bMBC){k=g(i);}else{var r=f(i,l);p={plotArea:{dataPointStyle:{rules:r}},legend:h(i)};}return{colorScale:k,properties:p};};}return{getCandidateSetting:function(o,A,k,l,I,s,n,L){var p=n.bMBC;var q=o.Criticality||{};var U=u(q,A);var r={additionalMeasures:[],additionalDimensions:[]};var Q,P,v;switch(U){case'DimensionValues':Q=D.qualify(q.DimensionValues,k,l,I,A,"Criticality",n);if(Q){Q.parsed=D.parse(Q,l,s,L,n);r.contextHandler=D.getContextHandler(Q,L);r.ruleGenerator=j([Q],e);}break;case'MeasureValues':Q=M.qualify(q.MeasureValues,k,l,s,A,n);if(Q.sMethod){jQuery.each(Q,function(i,w){P=M.parse(w,k,l,I,s,n,L);jQuery.each(P.additionalMeasures,function(i,T){r.additionalMeasures[T]=true;});jQuery.each(P.additionalDimensions,function(i,x){r.additionalDimensions[x]=true;});w.parsed=P;if(w.settings.Legend&&w.settings.Legend.Title){Q.legendTitle=w.settings.Legend.Title;}});v=Q.sMethod;r.additionalMeasures=Object.keys(r.additionalMeasures);r.additionalDimensions=Object.keys(r.additionalDimensions);r.contextHandler=M.getContextHandler(v,Q,p,L);r.ruleGenerator=j(Q,m);Q.bMBC=p;}break;default:return{};}return r;}};});
