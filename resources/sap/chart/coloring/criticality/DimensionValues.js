sap.ui.define(['sap/chart/coloring/ColoringUtils','sap/chart/ChartLog','sap/chart/library','sap/chart/data/TimeDimension'],function(C,a,c,T){"use strict";var t=jQuery.type;var b=c.coloring.CriticalityType;var D={};var v=function(m,M,d,i,s,o){var r=m._getFixedRole();var e='Colorings.'+s+'.DimensionValues';if(m instanceof T&&m._getFixedRole()==="category"){throw new a('error',e,'Do not support '+s+' on timeAxis');}if(i.length){throw new a('error',e,'InResult dimension is not allowed in dimension based Criticality');}var S=d.filter(function(g){return g._getFixedRole()==="series";});var f=d.filter(function(g){return g._getFixedRole()==="category";});if(r==="category"&&!o.bIsPie){if(o.chartType!=="waterfall"){if(S.length>0||M.length>1){throw new a('error',e,'Existing color legend shall not be changed in Criticality');}}}else if(r==="series"||o.bIsPie){var V=false;switch(o.chartType){case"bubble":if(S.length===1){V=true;}break;case"waterfall":V=true;break;case"pie":case"donut":var A=S.concat(f);if(M.length===1&&A.length===1){V=true;}break;default:if(M.length===1||(M.length>1&&f.length===0)){if(S.length===0||(s==="Criticality"&&S.length===1&&S[0]===m)){V=true;}}}if(!V){throw new a('error',e,'Existing color legend shall not be changed in Criticality');}}return;};D.qualify=function(o,m,d,i,A,s,e){var f,g;s=s||"Criticality";var h='Colorings.'+s+'.DimensionValues';if(e.bMBC){throw new a('error','Colorings','Heatmap only support Criticality.MeasureValues.ConstantThresholds');}if(!A.parameters||!A.parameters.dimension){if(o){var k=Object.keys(o);if(k.length>1){throw new a('error',h,'Multiple dimensions are defined, please resolve by activeColoring property');}else if(k.length===1){f=k[0];}else{return null;}}}else{f=A.parameters.dimension;}if(f){var M=C.find(f,d);if(!M||!o[f]){throw new a('error',h,'Active dimension should be visible');}else{g={dim:f,setting:o};v(M,m,d,i,s,e);}}return g;};D.parse=function(o,d,s,l,e){var S={};var L={};var f=o.dim;var g=[];var r=C.find(f,d)._getFixedRole();var h=o.setting[f];jQuery.each(h,function(k,p){var q=(t(p)!=="array")?[p]:p;q.forEach(function(u){var V=(t(u.Values)!=="array")?[u.Values]:u.Values;if(V.length>1){if(!u.Legend){throw new a('error','Colorings.Criticality.DimensionValues','Legend is mandatory when one criticality type has multiple values');}else if(r==="series"||e.bIsPie){throw new a('error','Colorings.Criticality.DimensionValues','Existing color legend shall not be changed in Criticality');}}});});jQuery.each(h,function(k,p){var q=(t(p)!=="array")?[p]:p;if(k!==b.Neutral){S[k]=q.map(function(u){return(t(u.Values)==="array")?u.Values:[u.Values];});g=Array.prototype.concat.apply(g,S[k]);}L[k]=q.map(function(u){var V=(t(u.Values)==="array")?u.Values[0]:u.Values;var w=(u.Legend!=null)?u.Legend:V;return w;});});var n=function(k){return g.indexOf(k[f])===-1;};var N=[];if(h.Neutral){N=(t(h.Neutral.Values)==="array")?h.Neutral.Values:[h.Neutral.Values];}var i={callback:[n],NeutralValues:N,CriticalityValues:g};function j(V){return function(k){return V.indexOf(k[f])!==-1;};}var m={Negative:(S.Negative||[]).map(j),Critical:(S.Critical||[]).map(j),Positive:(S.Positive||[]).map(j)};return{callbacks:m,legend:L,NeutralInfo:i,status:s};};D.getContextHandler=function(o,l){var d=o.dim;var n=o.parsed.NeutralInfo;return function(e){var V=e.getProperty(d);var s=o.parsed.status;var f=this.getDimensionByName(d);if(n.CriticalityValues.indexOf(V)===-1){if(!s.singleOtherValue){s.singleOtherValue=V;}else if(s.singleOtherValue!==V&&f._getFixedRole()==="series"){var g=new a('error','Colorings.Criticality.DimensionValues','Existing color legend shall not be changed in Criticality');o.chartLog=g;}o.parsed.callbacks.Neutral=n.callback;if(n.NeutralValues.indexOf(V)===-1){o.parsed.legend.Neutral=l.getText("COLORING_TYPE_OTHER");}}};};return D;});
