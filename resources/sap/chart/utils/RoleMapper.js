/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['sap/chart/data/TimeDimension','sap/chart/utils/MeasureSemantics','sap/chart/utils/ChartUtils','sap/chart/utils/DateFormatUtil'],function(T,M,C,D){"use strict";function R(f){this._bTimeFed=false;}R.prototype.toFeedingId=function(o){if(o instanceof T&&!this._bTimeFed){this._bTimeFed=true;return"timeAxis";}else{return"@context";}};function t(a){while(a.length&&!a[a.length-1]){a.pop();}return a;}function c(a){return C.CONFIG.timeChartTypes.indexOf(a)>-1;}function d(a){return a.indexOf('dual')>-1;}R.semantics={semanticBulletMsrs:function(m,c){var a=m["@semanticBulletMsrs"];var b=a.reduce(function(b,o){b[o.getName()]=o;return b;},{});var s=M.getTuples(a);var S={actualValues:[],additionalValues:[],targetValues:[]};jQuery.each(s,function(i,o){S.actualValues.push(o.actual?b[o.actual]:null);S.additionalValues.push(o.projected?b[o.projected]:null);S.targetValues.push(o.reference?b[o.reference]:null);});Object.keys(S).forEach(function(k){S[k]=t(S[k]);});delete m["@semanticBulletMsrs"];jQuery.extend(m,S);},semanticPatternMsrs:function(f,e){var A=[],g=[];Object.keys(f.msrs).forEach(function(k){var s=[];var m=f.msrs[k];var h=m.reduce(function(h,a){h[a.getName()]=a;return h;},{});var S=M.getTuples(m);var j=S.filter(function(n){return n.actual&&!n.projected&&!n.reference;}).length!==m.length;if(f.dims.color&&f.dims.color.length>0){jQuery.sap.log.warning("If Chart has series dimensions, semantic pattern rule doesn't work.");}else if(j){if(e&&d(e)){S.forEach(function(v){v.valueAxisID=k;});}A=A.concat(S);if(c(e)){if(f.dims.timeAxis&&f.dims.timeAxis.length===1){var l=f.dims.timeAxis[0];var n;var p=l.getProjectedValueStartTime();if(p){var o,q=D.getInstance(l.getTimeUnit());if(q){if(q.parse(p)){o=q.parse(p).getTime();}}else{o=new Date(p).getTime();}if(o){if(e.indexOf('bullet')===-1){for(var i=0;i<S.length;i++){n=S[i];if(n.actual&&n.projected){n.timeAxis=f.dims.timeAxis[0].getName();n.projectedValueStartTime=o;n.semanticMsrName=n.actual+"-"+n.projected;s.push(n.actual);s.push(n.projected);m.push(h[n.actual].clone().setName(n.semanticMsrName));}}}f.msrs[k]=m.filter(function(a){return s.indexOf(a.getName())===-1;});g=g.concat(m.filter(function(a){return s.indexOf(a.getName())>-1;}));}}}}var r=[];var u=['actual','projected','semanticMsrName','reference'];S.forEach(function(a){for(var i=0;i<u.length;i++){if(a[u[i]]){r.push(a[u[i]]);}}});f.msrs[k].sort(function(a,b){return r.indexOf(a.getName())-r.indexOf(b.getName());});}});return{semanticTuples:A,contexts:g};}};return R;});
