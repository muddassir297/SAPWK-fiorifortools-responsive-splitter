/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/IconPool","sap/ui/base/EventProvider","sap/m/Button","sap/m/ButtonType","sap/m/OverflowToolbarButton","sap/m/OverflowToolbarLayoutData","./SemanticConfiguration","./SemanticContainer"],function(q,I,E,B,a,O,b,S,c){"use strict";var d=c.extend("sap.f.semantic.SemanticShareMenu",{constructor:function(C,p){c.call(this,C,p);this._aShareMenuActions=[];this._aCustomShareActions=[];this._setMode(d._Mode.initial);}});d._Mode={initial:"initial",button:"button",actionSheet:"actionSheet"};d.prototype.addCustomAction=function(C){var p=this._onControlAdded(C);if(!p){this._aCustomShareActions.push(C);return this;}this._callContainerAggregationMethod("insertButton",C,this._getCustomActionInsertIndex());this._aCustomShareActions.push(C);return this;};d.prototype.insertCustomAction=function(C,i){var p=this._onControlAdded(C);if(!p){this._aCustomShareActions.splice(i,0,C);return this;}this._callContainerAggregationMethod("insertButton",C,this._getCustomActionInsertIndex(i));this._aCustomShareActions.splice(i,0,C);return this;};d.prototype.getCustomActions=function(){return this._aCustomShareActions;};d.prototype.indexOfCustomAction=function(C){return this._aCustomShareActions.indexOf(C);};d.prototype.removeCustomAction=function(C){var r=this._callContainerAggregationMethod("removeButton",C);this._aCustomShareActions.splice(this._aCustomShareActions.indexOf(C),1);this._onControlRemoved();return r;};d.prototype.removeAllCustomActions=function(){var r=[];this._aCustomShareActions.forEach(function(C){var R=this._callContainerAggregationMethod("removeButton",C);if(R){r.push(C);}},this);this._aCustomShareActions=[];this._onControlRemoved();return r;};d.prototype.destroyCustomActions=function(){this.removeAllCustomActions(true).forEach(function(C){C.destroy();});return this;};d.prototype.addContent=function(s){var C=this._getControl(s),p=this._onControlAdded(C);this._aShareMenuActions.push(s);if(!p){return this;}this._preProcessOverflowToolbarButton(C);this._callContainerAggregationMethod("insertButton",C,this._getSemanticActionInsertIndex(s));return this;};d.prototype.removeContent=function(s){var C=this._getControl(s);this._callContainerAggregationMethod("removeButton",C);this._aShareMenuActions.splice(this._aShareMenuActions.indexOf(s),1);this._postProcessOverflowToolbarButton(s);this._onControlRemoved();return this;};d.prototype.destroy=function(){this._aShareMenuActions=null;this._aCustomShareActions=null;this._oShareMenuBtn=null;return c.prototype.destroy.call(this);};d.prototype._getMode=function(){return this._mode;};d.prototype._setMode=function(m,o){var C=this._getContainer();if(!d._Mode[m]){q.sap.log.error("unknown shareMenu mode "+m,this);return this;}if(this._getMode()===m){return this;}if(m===d._Mode.initial){this._setBaseButton(this._getShareMenuButton().applySettings({visible:false}));this._mode=d._Mode.initial;return this;}if(m===d._Mode.button){if(this._isInitialMode()){this._setBaseButton(o);}else if(this._isMenuMode()){var f=C.getButtons()[0];C.removeButton(f);this._postProcessOverflowToolbarButton(f);this._setBaseButton(f);}this._mode=d._Mode.button;return this;}if(m===d._Mode.actionSheet){var e=this._oBaseButton;this._setBaseButton(this._getShareMenuButton().applySettings({visible:true}));if(e){this._preProcessOverflowToolbarButton(e);C.addButton(e);}this._mode=d._Mode.actionSheet;}return this;};d.prototype._setBaseButton=function(o){var e;if(this._oBaseButton===o){return this;}e=this._oBaseButton;this._oBaseButton=o;if(e){this._fireBaseBtnChanged(e,this._oBaseButton);}return this;};d.prototype.getBaseButton=function(){return this._oBaseButton;};d.prototype._fireBaseBtnChanged=function(o,n){E.prototype.fireEvent.call(this._getParent(),"_shareMenuBtnChanged",{"oOldButton":o,"oNewButton":n});};d.prototype._getShareMenuButton=function(){var C=this._getContainer();if(!this._oShareMenuBtn){this._oShareMenuBtn=new O(C.getId()+"-shareButton",{icon:I.getIconURI("action"),tooltip:sap.ui.getCore().getLibraryResourceBundle("sap.f").getText("SEMANTIC_CONTROL_ACTION_SHARE"),layoutData:new b({closeOverflowOnInteraction:false}),text:sap.ui.getCore().getLibraryResourceBundle("sap.f").getText("SEMANTIC_CONTROL_ACTION_SHARE"),type:a.Transparent,press:function(){C.openBy(this._oShareMenuBtn);}.bind(this)});this._oShareMenuBtn.addEventDelegate({onAfterRendering:function(){this._oShareMenuBtn.$().attr("aria-haspopup",true);}.bind(this)},this);}return this._oShareMenuBtn;};d.prototype._getCustomActionInsertIndex=function(i){var C=this._aCustomShareActions.length;if(i===undefined){return this._aShareMenuActions.length+C;}i=i>=C?C:i;i+=this._aShareMenuActions.length;return i;};d.prototype._getSemanticActionInsertIndex=function(s){this._aShareMenuActions.sort(this._sortControlByOrder.bind(this));return this._aShareMenuActions.indexOf(s);};d.prototype._onControlAdded=function(C){if(this._isInitialMode()){this._setMode(d._Mode.button,C);return false;}if(this._isButtonMode()){this._setMode(d._Mode.actionSheet);}return true;};d.prototype._onControlRemoved=function(){var A=this._aShareMenuActions.length,C=this._aCustomShareActions.length,e=(A+C)===0;if(this._isButtonMode()||e){this._setMode(d._Mode.initial);return;}if(A===1&&C===0){this._setMode(d._Mode.button,this._aShareMenuActions[0]);return;}if(A===0&&C===1){this._setMode(d._Mode.button,this._aCustomShareActions[0]);}};d.prototype._preProcessOverflowToolbarButton=function(o){if(o instanceof O){o._bInOverflow=true;}};d.prototype._postProcessOverflowToolbarButton=function(o){if(o instanceof O){delete o._bInOverflow;}};d.prototype._isInitialMode=function(){return this._getMode()===d._Mode.initial;};d.prototype._isButtonMode=function(){return this._getMode()===d._Mode.button;};d.prototype._isMenuMode=function(){return this._getMode()===d._Mode.actionSheet;};return d;},false);
