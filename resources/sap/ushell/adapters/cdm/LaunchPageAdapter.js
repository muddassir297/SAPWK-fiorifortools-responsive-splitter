// @copyright@
(function(){"use strict";jQuery.sap.declare("sap.ushell.adapters.cdm.LaunchPageAdapter");jQuery.sap.require("sap.ushell.resources");jQuery.sap.require("sap.m.Text");sap.ushell.adapters.cdm.LaunchPageAdapter=function(u,p,a){var _;this._mResolvedTiles={};this._mResolvedCatalogTiles={};this._mCatalogTilePromises={};this._mFailedResolvedCatalogTiles={};this._mFailedResolvedTiles={};this.TileType={Tile:"tile",Link:"link"};this.getGroups=function(){var D=new jQuery.Deferred();this._assureLoaded().done(function(G){D.resolve(G);}).fail(function(){D.resolve([]);});return D.promise();};this._getTileFromHash=function(H){var D=new jQuery.Deferred(),C=this._mCatalogTilePromises[H];if(!C){C=sap.ushell.Container.getService("ClientSideTargetResolution").resolveTileIntent(H);this._mCatalogTilePromises[H]=C;}C.done(function(T){var o={tileIntent:H,tileResolutionResult:T};D.resolve(o);}).fail(function(e){D.reject("Hash '"+H+"' could not be resolved to a tile. "+e);});return D.promise();};this._assureGroupItemsResolved=function(G){var P=[],r,R;if(G.payload&&G.payload.tiles){r=this._assureGroupTilesResolved(G.payload.tiles);Array.prototype.push.apply(P,r);}if(G.payload&&G.payload.links){R=this._assureGroupLinksResolved(G.payload.links,G.identification.id);Array.prototype.push.apply(P,R);}return P;};this._assureGroupTilesResolved=function(G){return(G||[]).map(function(T,I){return this._getResolvedTile(T,I).then(function(r){r.isLink=false;return r;});},this);};this._assureGroupLinksResolved=function(G,s){return(G||[]).map(function(l,I){return this._getResolvedTile(l,I).then(function(r){r.isLink=true;return r;});},this);};this._prepareTileHash=function(T){var U=sap.ushell.Container.getService("URLParsing"),P={},o,r;if(this._isCatalogTile(T)){return T.tileIntent;}if(this._isGroupTile(T)){r=T.target.parameters||[];r.forEach(function(e){if(e.name&&e.value){P[e.name]=[e.value];}});o={target:{semanticObject:T.target.semanticObject,action:T.target.action},params:P,appSpecificRoute:T.target.appSpecificRoute};return"#"+U.constructShellHash(o);}return undefined;};this._allPromisesDone=function(P){var D=new jQuery.Deferred(),o;if(P.length===0){D.resolve();}else{var n=P.map(function(e){o=new jQuery.Deferred();e.always(o.resolve.bind(o));return o.promise();});jQuery.when.apply(this,n).done(function(){var A=Array.prototype.slice.call(arguments);D.resolve(A);});}return D.promise();};this._generateDefaultGroup=function(){var G,o,D=new jQuery.Deferred(),C=sap.ushell.Container.getService("CommonDataModel");C.getSite().done(function(s){G=sap.ushell.utils.generateUniqueId(s.site.payload.groupsOrder);o={"identification":{"id":G,"namespace":"","title":"Home"},"payload":{"isDefaultGroup":true,"locked":false,"tiles":[],"links":[],"groups":[]}};_=o;s.groups[G]=o;s.site.payload.groupsOrder.unshift(G);D.resolve(o);}).fail(function(e){D.reject("Failed to access site. "+e);});return D.promise();};this._assureLoaded=function(){var e=this,C=sap.ushell.Container.getService("CommonDataModel"),D,l=[],o;if(this._assureLoadedDeferred){return this._assureLoadedDeferred.promise();}o=new jQuery.Deferred();this._assureLoadedDeferred=o;C.getSite().done(function(s){var I=[];s.site.payload.groupsOrder.forEach(function(G,j){var k=s.groups[G];if(k){k.payload=k.payload||{};if(k.payload.hasOwnProperty("isDefaultGroup")){_=k;}l.push(k);I=e._assureGroupItemsResolved(k).concat(I);}});if(_===undefined){D=e._generateDefaultGroup();I.push(D);D.done(function(G){l.unshift(G);}).fail(function(E){jQuery.sap.log.error("Delivering hompage groups failed - "+E);e._assureLoadedDeferred.resolve([]);});}e._allPromisesDone(I).done(function(){e._assureLoadedDeferred.resolve(l);delete e._assureLoadedDeferred;});}).fail(function(E){jQuery.sap.log.error("Delivering hompage groups failed - "+E);e._assureLoadedDeferred.resolve([]);delete e._assureLoadedDeferred;});return o.promise();};this.getDefaultGroup=function(){var D=new jQuery.Deferred(),A;if(!_){A=this._assureLoaded();}if(A){A.done(function(){D.resolve(_);}).fail(function(m){D.reject("Failed to access default group. "+m);});}else{D.resolve(_);}return D.promise();};this._isValidTitle=function(T){if(typeof T!=='string'||!T){return false;}return true;};this._isGroupPreset=function(G){if(!G.payload.hasOwnProperty("isPreset")){return true;}return!!G.payload.isPreset;};this._isGroupLocked=function(G){return!!G.payload.locked;};this.addGroup=function(T){var D=new jQuery.Deferred(),C=sap.ushell.Container.getService("CommonDataModel"),G,s,e,j=this;if(!this._isValidTitle(T)){return D.reject("No valid group title").promise();}e="Failed to add the group with title '"+T+"' to the homepage. ";C.getSite().done(function(S){s=sap.ushell.utils.generateUniqueId(S.site.payload.groupsOrder);G={"identification":{"id":s,"namespace":"","title":T},"payload":{"locked":false,"isPreset":false,"tiles":[],"links":[],"groups":[]}};S.groups[s]=G;S.site.payload.groupsOrder.push(G.identification.id);C.save().done(function(){delete j._assureLoadedDeferred;D.resolve(S.groups[s],s);}).fail(function(E){D.reject(E);});}).fail(function(E){D.reject(e+E);});return D.promise();};this.getGroupTitle=function(G){return G.identification.title;};this.setGroupTitle=function(G,n){var e=this,D=new jQuery.Deferred(),C=sap.ushell.Container.getService("CommonDataModel"),o,s;if(typeof G!=='object'||!G.identification||!G.identification.id){return D.reject("Unexpected group value").promise();}if(!e._isValidTitle(n)){return D.reject("Unexpected oGroup title value").promise();}s="Failed to set new title for group with id '"+G.identification.id+"'. ";o=G.identification.title;C.getSite().done(function(S){if(S.groups[G.identification.id]){S.groups[G.identification.id].identification.title=n;}C.save().done(function(){D.resolve();}).fail(function(E){jQuery.sap.log.error(E);D.reject(o);});}).fail(function(E){D.reject(o,s+E);});return D.promise();};this.getGroupId=function(G){return G.identification.id;};this.hideGroups=function(H){var D=new jQuery.Deferred(),C=sap.ushell.Container.getService("CommonDataModel"),G;if(H&&jQuery.isArray(H)){G="Failed to hide group. ";C.getSite().done(function(s){if(H.length>0){Object.keys(s.groups).forEach(function(e){if(jQuery.inArray(s.groups[e].identification.id,H)>-1){s.groups[e].identification.isVisible=false;}else{delete s.groups[e].identification.isVisible;}});}if(H.length===0){Object.keys(s.groups).forEach(function(e){delete s.groups[e].identification.isVisible;});}C.save().done(function(){D.resolve();}).fail(function(e){D.reject("Hiding of groups did not work as expected - "+e);});}).fail(function(e){D.reject(G+e);});}else{D.reject("Invalid input parameter aHiddenGroupIds. Please pass a valid input parameter.");}return D.promise();};this.isGroupVisible=function(G){if(G.identification.isVisible===undefined||G.identification.isVisible===true){return true;}else{return false;}};this.moveGroup=function(G,n){var D=new jQuery.Deferred(),C=sap.ushell.Container.getService("CommonDataModel"),e,s;if(!G||!G.identification||!G.identification.id||n<0){return D.reject("Unable to move groups - invalid parameters").promise();}s="Failed to move group with id '"+G.identification.id+"'. ";C.getSite().done(function(S){if(!S.site.payload.groupsOrder){return D.reject("groupsOrder not found - abort operation of adding a group.");}else if(S.site.payload.groupsOrder.indexOf(G.identification.id)===n){return D.resolve();}e=sap.ushell.utils.moveElementInsideOfAnArray(S.site.payload.groupsOrder,S.site.payload.groupsOrder.indexOf(G.identification.id),n);if(!e){return D.reject("invalid move group operation - abort.");}C.save().done(function(){D.resolve();}).fail(function(E){D.reject(E);});}).fail(function(E){D.reject(s+E);});return D.promise();};this.removeGroup=function(G){var D=new jQuery.Deferred(),C=sap.ushell.Container.getService("CommonDataModel"),s;if(!G||typeof G!=="object"||!G.identification||!G.identification.id){return D.reject("no valid input parameter for 'oGroup'").promise();}s="Failed to remove group with id '"+G.identification.id+"'. ";C.getSite().done(function(S){if(S&&S.groups&&S.groups[G.identification.id]){delete S.groups[G.identification.id];}if(S&&S.site&&S.site.payload&&S.site.payload.groupsOrder){S.site.payload.groupsOrder=jQuery.grep(S.site.payload.groupsOrder,function(e){return e!==G.identification.id;});}C.save().done(function(){D.resolve();}).fail(function(e){D.reject(e);});}).fail(function(e){D.reject(s+e);});return D.promise();};this.resetGroup=function(G){var D=new jQuery.Deferred(),C=sap.ushell.Container.getService("CommonDataModel"),s={},e=this,j;if(G&&typeof G==="object"&&G.identification&&G.identification.id){j="Failed to reset group with id '"+G.identification.id+"'. ";C.getSite().done(function(S){jQuery.extend(true,s,S.groups);if(e.isGroupRemovable(G)===false){C.getGroupFromOriginalSite(G.identification.id).done(function(o){if(S&&typeof S==="object"&&S.groups&&S.groups[G.identification.id]){S.groups[G.identification.id]=o;}C.save().done(function(){D.resolve(o);}).fail(function(E){D.reject("Group could not be reset - "+E,s);});}).fail(function(E){D.reject("Group could not be reset - "+E,s);});}else{D.reject("Group could not be reset as it was created by the user",s);}}).fail(function(E){D.reject(j+E,s);});}return D.promise();};this.getTileTitle=function(T){var r;if(T&&T.isBookmark){return T.title;}r=this._mResolvedTiles[T.id];if(r){return T.title||r.tileResolutionResult.title;}else{return"";}};this.getTileSubtitle=function(T){var r;if(T.isBookmark){return T.subTitle;}r=this._mResolvedTiles[T.id];return T.subTitle||r.tileResolutionResult.subTitle;};this.getTileIcon=function(T){var r;if(T.isBookmark){return T.icon;}r=this._mResolvedTiles[T.id];return T.icon||r.tileResolutionResult.icon;};this.getTileIndicatorDataSource=function(T){var r=this._mResolvedTiles[T.id];var R={};var o;if(T.indicatorDataSource){R.indicatorDataSource=T.indicatorDataSource;if(T.dataSource){R.dataSource=T.dataSource;}return R;}if(r){o=r.tileResolutionResult;if(o.indicatorDataSource){R.indicatorDataSource=o.indicatorDataSource;}if(o.dataSource){R.dataSource=o.dataSource;}}return R;};this.isGroupRemovable=function(G){return!this._isGroupPreset(G);};this.isGroupLocked=function(G){return this._isGroupLocked(G);};this.getGroupTiles=function(G){var T=G.payload.tiles||[];if(G.payload.links&&jQuery.isArray(G.payload.links)&&G.payload.links.length>0){T=T.concat(G.payload.links);}return T;};this.getLinkTiles=function(G){if(G.payload.links&&jQuery.isArray(G.payload.links)&&G.payload.links.length>0){return G.payload.links;}else{return[];}};this.getTileType=function(T){var r=this._mResolvedTiles[T.id];if(r&&r.isLink){return this.TileType.Link;}return this.TileType.Tile;};this.getTileId=function(T){return T.id;};this.getTileSize=function(T){var r=this._mResolvedTiles[T.id];if(r&&r.tileResolutionResult&&r.tileResolutionResult.size){return r.tileResolutionResult.size;}return"1x1";};this.getTileTarget=function(T){var r,R=this._mResolvedTiles[T.id],s;if(R&&R.tileResolutionResult){r=R.tileResolutionResult;if(r.isCustomTile!==true){return R.tileIntent;}if(r&&typeof r.targetOutbound==="object"){s=this._toHashFromOutbound(r.targetOutbound);if(s){return s;}}}jQuery.sap.log.warning("Could not find a target for Tile with id '"+T.id+"'","sap.ushell.adapters.cdm.LaunchPageAdapter");return"";};this.isTileIntentSupported=function(T){return(this._mFailedResolvedTiles[T.id]===undefined)?true:false;};this.refreshTile=function(T){};this.setTileVisible=function(T,n){var r=this._mResolvedTiles[T.id];if(r&&r.tileComponent&&typeof r.tileComponent.tileSetVisible==="function"){if(r.visibility!==n){r.visibility=n;r.tileComponent.tileSetVisible(n);}}};this.getTileView=function(G){var A=this;return new jQuery.Deferred(function(D){return A._getTileView(G,false).then(function(T){if(!T){D.reject("Tile view or component could not be initialized");}D.resolve(T);},function(r){var e="Tile with ID '"+G.id+"' could not be initialized"+(r?":\n"+r:".");jQuery.sap.log.error(e,null,G.tileType);D.reject(e);});});};this._getResolvedTile=function(T,I){var H;var s=this._mResolvedTiles;var F=this._mFailedResolvedTiles;if(s[T.id]){return(new jQuery.Deferred()).resolve(s[T.id]).promise();}H=this._prepareTileHash(T,I);return this._getTileFromHash(H).then(function(r){s[T.id]=r;if(F[T.id]){delete F[T.id];}return r;},function(e){F[T.id]=e;return e;});};this._getTileUiComponentContainer=function(T,r,I){var e=this,s,j,R,m,C,o,k;if(I===true){s=e.getCatalogTileTitle(T);o=e._createTileComponentData(T,true);}else{s=e.getTileTitle(T);o=e._createTileComponentData(T,false);}R=r.tileResolutionResult;if(r.isLink){j=e.getTileTarget(T);return e._createLinkInstance(s,j);}if(typeof R.tileComponentLoadInfo==="string"){if(o.properties.indicatorDataSource&&o.properties.indicatorDataSource.path){C="sap.ushell.components.tiles.cdm.applauncherdynamic";}else{C="sap.ushell.components.tiles.cdm.applauncher";}}else if(typeof R.tileComponentLoadInfo==="object"){C=R.tileComponentLoadInfo.componentName;m=R.tileComponentLoadInfo.url;if(C&&m){jQuery.sap.registerModulePath(C,m);}}if(C){var l=new sap.ui.core.ComponentContainer({component:sap.ui.getCore().createComponent({componentData:o,name:C})});k=l.getComponentInstance();if(I===true){e._mResolvedCatalogTiles[T.id].tileComponent=k;}else{e._mResolvedTiles[T.id].tileComponent=k;}return l;}return null;};this._getTileView=function(G){var e=this,T,s,o,E,D=new jQuery.Deferred();if(typeof G!=="object"||!G.id){E="Invalid input parameter passed to _getTileView: "+G;jQuery.sap.log.error(E);return D.reject(E).promise();}s=this._prepareTileHash(G);T=(G.id&&this._mResolvedTiles[G.id])||this._getTileFromHash(s);jQuery.when(T).then(function(r){if(e._mResolvedTiles.hasOwnProperty(G.id)===false){e._mResolvedTiles[G.id]=r;}try{o=e._getTileUiComponentContainer(G,r,false);}catch(j){D.reject(j.message);}D.resolve(o);});return D.promise();};this._getCatalogTileView=function(C){if(typeof C!=="object"){throw new Error(C);}return this._getTileUiComponentContainer(C,C,true);};this._createTileComponentData=function(T,I){var s=I?this.getCatalogTileTitle(T):this.getTileTitle(T),S=I?this.getCatalogTilePreviewSubtitle(T):this.getTileSubtitle(T),e=I?this.getCatalogTilePreviewIcon(T):this.getTileIcon(T),j=I?this.getCatalogTileTargetURL(T):this.getTileTarget(T),o=this.getTileIndicatorDataSource(T),C={properties:{},startupParameters:{}};if(s){C.properties.title=s;}if(S){C.properties.subtitle=S;}if(e){C.properties.icon=e;}if(j){C.properties.targetURL=j;}if(o.indicatorDataSource){C.properties.indicatorDataSource=o.indicatorDataSource;if(o.dataSource){C.properties.dataSource=o.dataSource;}}return C;};this._createLinkInstance=function(T,U){var s={text:T};if(typeof U==="string"&&U!==""){s.href=U;}else{s.enabled=false;}return new sap.m.Link(s);};this._addTileToSite=function(P,G,n,C){var e=this,D=new jQuery.Deferred(),I=sap.ushell.Container.getService("URLParsing").parseShellHash(n.properties.targetURL),T={"id":e.getTileId(n),"target":{"semanticObject":I.semanticObject,"action":I.action,"parameters":h(I.params)}};P.groups[G.identification.id].payload.tiles.push(T);C.save().done(function(){D.resolve(T);}).fail(function(m){D.reject(m);});return D.promise();};this.addTile=function(C,G){if(!G){G=_;}var D=new jQuery.Deferred(),e=this,s;var H=e.getCatalogTileTargetURL(C);var U=sap.ushell.Container.getService("URLParsing");var I=U.parseShellHash(H);var T=b({},g(I));s="Failed to add tile with id '"+T.id+"' to group with id '"+G.identification.id+"'. ";e._getTileFromHash(H).fail(function(E){e._mFailedResolvedTiles[T.id]=E;}).done(function(n){e._mResolvedTiles[T.id]=n;var o=sap.ushell.Container.getService("CommonDataModel");o.getSite().done(function(S){S.groups[G.identification.id].payload.tiles.push(T);o.save().done(function(){D.resolve(T);}).fail(function(r){D.reject(r);});}).fail(function(E){D.reject(s+E);});});return D.promise();};this.removeTile=function(G,T,I){var C,s,D=new jQuery.Deferred();if(!G||typeof G!=="object"||!G.identification||!G.identification.id||!T||typeof T!=="object"||!T.id){return D.reject({},"Failed to remove tile. No valid input parameters passed to removeTile method.").promise();}s="Failed to remove tile with id '"+T.id+"' from group with id '"+G.identification.id+"'. ";C=sap.ushell.Container.getService("CommonDataModel");C.getSite().done(function(S){var P;I=+I;try{P=S.groups[G.identification.id].payload;}catch(e){D.reject(S.groups[G.identification.id],s);}if(I>=0){P.tiles.splice(I,1);}else{P.tiles=P.tiles.filter(function(o){return o.id!==T.id;});}C.save().done(function(){D.resolve();}).fail(function(E){jQuery.sap.log.error(E);D.reject(S.groups[G.identification.id],E);});}).fail(function(e){D.reject({},s+e);});return D.promise();};this.moveTile=function(T,s,e,S,o){var D=new jQuery.Deferred(),C=sap.ushell.Container.getService("CommonDataModel"),G,j;if(!T||jQuery.isEmptyObject(T)||s===undefined||s<0||e===undefined||e<0||!S||!S.identification||!S.identification.id||!o||!o.identification||!o.identification.id){return D.reject("Invalid input parameters").promise();}j="Failed to move tile with id '"+T.id+"'. ";C.getSite().done(function(k){if(S.identification.id===o.identification.id){if(s!==e){G=k.groups[o.identification.id].payload.tiles;G.splice(s,1);G.splice(e,0,T);}else{return D.resolve(T).promise();}}else{k.groups[S.identification.id].payload.tiles.splice(s,1);k.groups[o.identification.id].payload.tiles.splice(e,0,T);}C.save().done(function(){D.resolve(T);}).fail(function(E){jQuery.sap.log.error(E);C.getSite().done(function(l){D.reject(l.groups,E);}).fail(function(l){jQuery.sap.log.error(l);D.reject([],l);});});}).fail(function(E){D.reject([],j+E);});return D.promise();};this.getCatalogs=function(){var D=new jQuery.Deferred(),C=[],o=sap.ushell.Container.getService("CommonDataModel");window.setTimeout(function(){o.getSite().done(function(s){Object.keys(s.catalogs).forEach(function(e){var j=s.catalogs[e];j.id=e;C.push(j);D.notify(j);});D.resolve(C.sort(function(A,B){return A.identification.id-B.identification.id;}));});},0);return D.promise();};this._isStartableInbound=function(I){if(!jQuery.sap.getObject("signature.parameters",undefined,I)){return true;}var r=Object.keys(I.signature.parameters).every(function(p){return!I.signature.parameters[p].filter||(p==="sap-external-url");});return r;};this._isHiddenInbound=function(I){return!!I.hideLauncher;};this._toHashFromInbound=function(I){var s,P,C;s={target:{semanticObject:I.semanticObject,action:I.action},params:{}};P=jQuery.sap.getObject("signature.parameters",undefined,I)||{};Object.keys(P).forEach(function(k){if(P[k].filter&&Object.prototype.hasOwnProperty.call(P[k].filter,"value")&&(P[k].filter.format===undefined||P[k].filter.format==="plain")){s.params[k]=[P[k].filter.value];}if(P[k].launcherValue&&Object.prototype.hasOwnProperty.call(P[k].launcherValue,"value")&&(P[k].launcherValue.format===undefined||P[k].launcherValue.format==="plain")){s.params[k]=[P[k].launcherValue.value];}});C=sap.ushell.Container.getService("URLParsing").constructShellHash(s);if(!C){return undefined;}return"#"+C;};this._toHashFromOutbound=function(o){var s,P,C;s={target:{semanticObject:o.semanticObject,action:o.action},params:{}};P=o.parameters||{};Object.keys(P).forEach(function(k){if(P.hasOwnProperty(k)&&P[k].value!==undefined){s.params[k]=[P[k].value];}});C=sap.ushell.Container.getService("URLParsing").constructShellHash(s);if(!C){return undefined;}return"#"+C;};this._isCustomTile=function(A){if(sap.ushell.utils.getMember(A,"sap|flp.type")==="tile"){return true;}return false;};this.getCatalogTiles=function(C){var e=this,D=new jQuery.Deferred(),o,j=[],k=[],T;if(typeof C!=="object"){return D.reject("Invalid input parameter '"+C+"' passed to getCatalogTiles.").promise();}o=sap.ushell.Container.getService("CommonDataModel");o.getSite().done(function(s){C.payload=C.payload||{};(C.payload.appDescriptors||[]).forEach(function(A){var l=s.applications[A.id];var I=e._getMember(l,"sap|app.crossNavigation.inbounds")||{},m={};Object.keys(I).forEach(function(K){var n=I[K],q=e._toHashFromInbound(n,l);if(m.hasOwnProperty(n.semanticObject+"-"+n.action)){return;}else{m[n.semanticObject+"-"+n.action]=n;}if(e._isStartableInbound(n)&&!e._isHiddenInbound(n)){if(e._mResolvedCatalogTiles){if(!e._mResolvedCatalogTiles[q]&&!e._mFailedResolvedCatalogTiles[q]){T=e._getTileFromHash(q);k.push(T);T.done(function(r){r.id=q;j.push(r);e._mResolvedCatalogTiles[q]=r;}).fail(function(E){jQuery.sap.log.error(E,"sap.ushell.adapters.cdm.LaunchPageAdapter");e._mFailedResolvedCatalogTiles[q]=E;});}else{T=new jQuery.Deferred().resolve(e._mResolvedCatalogTiles[q]).promise();k.push(T);T.done(function(r){j.push(r);});}}}});});e._allPromisesDone(k).done(function(){D.resolve(j);}).fail(function(E){if(C.identification&&C.identification.id){D.reject("Failed to deliver tiles for catalog '"+C.identification.id+"'. "+E);}});}).fail(function(E){D.reject("Failed to get site: "+E);});return D.promise();};this.getCatalogError=function(C){return undefined;};this.getCatalogId=function(C){return C.identification.id;};this.getCatalogTitle=function(C){return C.identification.title;};this._isGroupTile=function(T){return!!(T&&T.id&&T.target);};this._isCatalogTile=function(T){return!!(T&&T.id&&T.tileIntent&&T.tileResolutionResult);};this._isFailedGroupTile=function(T){return!!(T&&this._mFailedResolvedTiles&&this._mFailedResolvedTiles[T.id]);};this._isFailedCatalogTile=function(T){return!!(T&&this._mFailedResolvedCatalogTiles&&this._mFailedResolvedCatalogTiles[T.id]);};this.getCatalogTileId=function(G){if(this._isGroupTile(G)){if(this._isFailedGroupTile(G)){return undefined;}return this._mResolvedTiles[G.id].tileIntent;}if(this._isCatalogTile(G)){return G.id;}};this.getCatalogTileTitle=function(G){if(this._isGroupTile(G)){if(this._isFailedGroupTile(G)){return"";}return this._mResolvedTiles[G.id].tileResolutionResult.title;}if(this._isCatalogTile(G)){if(this._isFailedCatalogTile(G)){return undefined;}return G.tileResolutionResult.title;}};this.getCatalogTileSize=function(C){return this.getTileSize(C);};this.getCatalogTileView=function(C){return this._getCatalogTileView(C);};this.getCatalogTileTargetURL=function(G){return this.getCatalogTileId(G);};this.getCatalogTilePreviewTitle=function(C){return(C.tileResolutionResult&&C.tileResolutionResult.title)||"";};this.getCatalogTilePreviewSubtitle=function(C){return(C.tileResolutionResult&&C.tileResolutionResult.subTitle)||"";};this.getCatalogTilePreviewIcon=function(C){return(C.tileResolutionResult&&C.tileResolutionResult.icon)||"";};this.getCatalogTileKeywords=function(G){var k=[],r=G;if(!r){jQuery.sap.log.error("Could not find the Tile","sap.ushell.adapters.cdm.LaunchPageAdapter");return k;}if(this._mResolvedTiles&&this._mResolvedTiles[G.id]){r=this._mResolvedTiles[G.id];}if(r&&r.tileResolutionResult&&r.tileResolutionResult.title){k.push(r.tileResolutionResult.title);}if(r&&r.tileResolutionResult&&r.tileResolutionResult.subTitle){k.push(r.tileResolutionResult.subTitle);}return k;};this._visitBookmarks=function(U,v){var C=sap.ushell.Container;var o=C.getService("URLParsing");var e=C.getService("CommonDataModel");var r=g(o.parseShellHash(U));return e.getSite().then(function(s){var G=s.groups;var T=Object.keys(G).filter(function(k){return!G[k].payload.locked;}).map(function(k){return G[k].payload.tiles.filter(function(j){return j.isBookmark&&i(r,j.target);});}).reduce(function(A,j){Array.prototype.push.apply(A,j);return A;},[]);if(!v){return T.length;}return jQuery.when(T.map(v)).then(function(){return T.length;});});};this.addBookmark=function(P,G){var T=this;return new jQuery.Deferred(function(D){var C=sap.ushell.Container;var U=C.getService("URLParsing");var o=C.getService("CommonDataModel");jQuery.when(G||T.getDefaultGroup(),o.getSite()).done(function(G,s){var e;var I=U.parseShellHash(P.url);if(!I){D.reject("Failed to parse bookmark URL.");return;}e=c(P,g(I));s.groups[G.identification.id].payload.tiles.push(e);o.save().done(function(){D.resolve(e);}).fail(function(r){D.reject(r);});}).fail(function(r){D.reject(r);});}).promise();};this.countBookmarks=function(U){return this._visitBookmarks(U);};this.updateBookmarks=function(U,P){var C=sap.ushell.Container;var o=C.getService("URLParsing");var e=C.getService("CommonDataModel");var r=this._mResolvedTiles;function j(T){return new jQuery.Deferred(function(D){var I,n;var k;var l=false;var m=Object.create(null);if(P.url||P.url===""){I=o.parseShellHash(P.url);if(!I){D.reject("Failed to parse bookmark URL.");return;}n=g(I);}if(T.icon!==P.icon){m.icon=P.icon;l=true;}if(T.title!==P.title){m.title=P.title;l=true;}if(T.subTitle!==P.subtitle){m.subtitle=P.subtitle;l=true;}d(T,P,n);if(l&&r[T.id]){k=r[T.id].tileComponent;k.tileSetVisualProperties(m);}D.resolve(T);}).promise;}return this._visitBookmarks(U,j).then(function(k){return e.save().then(function(){return k;});});};this.deleteBookmarks=function(U){var C=sap.ushell.Container;var o=C.getService("URLParsing");var e=C.getService("CommonDataModel");var r=g(o.parseShellHash(U));return e.getSite().then(function(s){var G=s.groups;var D=Object.keys(G).map(function(k){var P=G[k].payload;var j=0;P.tiles=P.tiles.filter(function(T){if(T.isBookmark&&i(r,T.target)){++j;return false;}return true;});return j;}).reduce(function(j,k){j+=k;return j;},0);return e.save().then(function(){return D;});});};this.onCatalogTileAdded=function(T){};this._onTileSettingsSave=function(T,s){var D=new jQuery.Deferred(),C,U,n,N,o,O;if(T&&T.id&&s){n=s.oTitleInput.getValue();N=s.oSubTitleInput.getValue();o=this.getTileTitle(T);O=this.getTileSubtitle(T);if(o===n&&O===N){return;}C=sap.ushell.Container.getService("CommonDataModel");var e=this;C.getSite().done(function(S){if(!S.modifiedTiles){S.modifiedTiles={};}if(!S.modifiedTiles[T.id]){S.modifiedTiles[T.id]={id:T.id};}U={};if(o!==n){U.title=n;S.modifiedTiles[T.id].title=n;T.title=n;}if(O!==N){U.subtitle=N;S.modifiedTiles[T.id].subTitle=N;T.subTitle=N;}e._mResolvedTiles[T.id].tileComponent&&e._mResolvedTiles[T.id].tileComponent.tileSetVisualProperties(U);C.save().fail(function(E){jQuery.sap.log.error(E);D.reject("Could not save personalization changes: "+E);}).done(function(){D.resolve();});}).fail(function(E){jQuery.sap.log.error(E);D.reject("Cannot get site: "+E);});}return D.promise();};this.getTileActions=function(T){var e=[],o,m;if(this._isGroupTile(T)&&!this._isFailedGroupTile(T)){m=new sap.ui.model.json.JSONModel({config:{display_title_text:this.getTileTitle(T),display_subtitle_text:this.getTileSubtitle(T)}});o=sap.ushell.components.tiles.utilsRT.getTileSettingsAction(m,this._onTileSettingsSave.bind(this,T));e.push(o);}return e;};function c(P,T){var o=b(P,T);o.isBookmark=true;return o;}function b(P,T){var o={id:sap.ushell.utils.generateUniqueId([])};d(o,P,T);return o;}function d(T,P,o){P=jQuery.extend(true,{},P);if(o){T.target=o;}if(P.title||P.title===""){T.title=P.title;}if(P.icon||P.icon===""){T.icon=P.icon;}if(P.subtitle||P.subtitle===""){T.subTitle=P.subtitle;}if(P.dataSource){T.dataSource={};jQuery.extend(true,T.dataSource,P.dataSource);delete P.serviceUrl;}else if(P.dataSource===null){delete T.dataSource;delete T.indicatorDataSource;delete P.serviceUrl;}if((P.dataSource||T.dataSource)&&P.serviceUrlPath){T.indicatorDataSource={path:P.serviceUrlPath};}if(P.serviceUrl||P.serviceUrl===""){if(T.dataSource){jQuery.sap.log.warning("`serviceUrl` is marked for deprecation in the future."+"It is not the preferred means for defining a dynamic "+"tile's data source. Please use `oParameter.dataSource`");delete T.dataSource;}T.indicatorDataSource={path:P.serviceUrl};}else if(P.serviceUrl===null&&!T.dataSource){delete T.indicatorDataSource;}if(P.serviceRefreshInterval||P.serviceRefreshInterval===0){T.indicatorDataSource.refresh=P.serviceRefreshInterval;}}function i(T,o){if(T&&o){return T.semanticObject===o.semanticObject&&T.action===o.action&&f(T.parameters,o.parameters);}return T===o;}function f(P,o){var F,O;P=P||[];o=o||[];if(P.length===o.length){F=t(P);O=t(o);return F===O;}return false;}function t(l){return l.map(function(P){return P.name+P.value;}).sort().join();}function g(I){var T={semanticObject:I.semanticObject,action:I.action,parameters:h(I.params)};if(I.appSpecificRoute){T.appSpecificRoute=I.appSpecificRoute;}return T;}function h(I){return Object.keys(I).map(function(k){var v=I[k]&&I[k][0];return{name:k,value:v||""};});}};sap.ushell.adapters.cdm.LaunchPageAdapter.prototype._getMember=function(o,a){return sap.ushell.utils.getMember(o,a);};}());
