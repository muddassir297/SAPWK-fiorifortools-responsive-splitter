// @copyright@
(function(){"use strict";jQuery.sap.declare("sap.ushell.adapters.cdm.ClientSideTargetResolutionAdapter");sap.ushell.adapters.cdm.ClientSideTargetResolutionAdapter=function(s,p,a){this._oAdapterConfig=a&&a.config;jQuery.sap.require("sap.ushell.utils");this._oLocalSystemAlias={http:{host:"",port:"",pathPrefix:"/sap/bc/"},https:{host:"",port:"",pathPrefix:"/sap/bc/"},rfc:{systemId:"",host:"",service:0,loginGroup:"",sncNameR3:"",sncQoPR3:""},id:"",client:"",language:""};};sap.ushell.adapters.cdm.ClientSideTargetResolutionAdapter.prototype.getInbounds=function(){var t=this;if(!this._getInboundsDeferred){this._getInboundsDeferred=new jQuery.Deferred();sap.ushell.Container.getService("CommonDataModel").getSite().done(function(s){var i=t._formatOSite(s)||[];t._getInboundsDeferred.resolve(i);}).fail(function(e){t._getInboundsDeferred.reject(e);});}return this._getInboundsDeferred.promise();};sap.ushell.adapters.cdm.ClientSideTargetResolutionAdapter.prototype._getSystemAliases=function(){var t=this;if(!this._getSystemAliasesDeferred){this._getSystemAliasesDeferred=new jQuery.Deferred();sap.ushell.Container.getService("CommonDataModel").getSite().done(function(s){var S=jQuery.extend(true,{},s.systemAliases||{});Object.keys(S).forEach(function(i){S[i].id=i;});t._getSystemAliasesDeferred.resolve(S);}).fail(function(e){t._getSystemAliasesDeferred.reject(e);});}return this._getSystemAliasesDeferred.promise();};sap.ushell.adapters.cdm.ClientSideTargetResolutionAdapter.prototype._getMember=function(o,a){return sap.ushell.utils.getMember(o,a);};sap.ushell.adapters.cdm.ClientSideTargetResolutionAdapter.prototype._formatOSite=function(s){var t=this;if(!s){return[];}function m(k,o,a){var I={};I.semanticObject=o.semanticObject;I.action=o.action;I.title=o.title||t._getMember(a,"sap|app.title");var T,b,c=false;I.resolutionResult=jQuery.extend(true,{},t._getMember(a,"sap|platform|runtime"));I.resolutionResult=I.resolutionResult||{};if(t._getMember(a,"sap|platform|runtime")){I.resolutionResult["sap.platform.runtime"]=jQuery.extend(true,{},t._getMember(a,"sap|platform|runtime"));}if(t._getMember(a,"sap|ui.technology")==="GUI"){I.resolutionResult["sap.gui"]=t._getMember(a,"sap|gui");}if(t._getMember(a,"sap|ui.technology")==="WDA"){I.resolutionResult["sap.wda"]=t._getMember(a,"sap|wda");}if(t._getMember(a,"sap|ui.technology")==="URL"&&I.resolutionResult["sap.platform.runtime"]){if(I.resolutionResult["sap.platform.runtime"].uri){I.resolutionResult["sap.platform.runtime"].url=I.resolutionResult["sap.platform.runtime"].uri;I.resolutionResult.url=I.resolutionResult["sap.platform.runtime"].uri;}}I.resolutionResult.applicationType=t._formatApplicationType(I.resolutionResult,a);I.resolutionResult.systemAlias=I.resolutionResult.systemAlias||o.systemAlias;I.resolutionResult.text=I.title;I.deviceTypes=t._getMember(a,"sap|ui.deviceTypes")||{};["desktop","tablet","phone"].forEach(function(M){if(Object.prototype.hasOwnProperty.call(o.deviceTypes||{},M)){I.deviceTypes[M]=o.deviceTypes[M];}if(!Object.prototype.hasOwnProperty.call(I.deviceTypes,M)){I.deviceTypes[M]=true;}I.deviceTypes[M]=!!I.deviceTypes[M];});I.signature=o.signature||{};I.signature.parameters=I.signature.parameters||{};I.signature.additionalParameters=(o.signature||{}).additionalParameters||"allowed";var d=o.indicatorDataSource||t._getMember(a,"sap|app.indicatorDataSource");var f=d?"#Shell-dynamicTile":"#Shell-staticTile";if(t._getMember(a,"sap|app.type")==="tile"||t._getMember(a,"sap|flp.type")==="tile"){f=I.resolutionResult;f.url=t._getMember(a,"sap|platform|runtime.componentProperties.url");f.componentName=t._getMember(a,"sap|ui5.componentName");b=t._getMember(a,"sap|app.crossNavigation.outbounds.target");c=true;}if(t._getMember(a,"sap|app.type")==="plugin"||t._getMember(a,"sap|flp.type")==="plugin"){return undefined;}if(t._getMember(a,"sap|flp.tileSize")){T=t._getMember(a,"sap|flp.tileSize");}I.tileResolutionResult={title:I.title,subTitle:o.subTitle||t._getMember(a,"sap|app.subTitle"),icon:o.icon||t._getMember(a,"sap|ui.icons.icon"),size:T,tileComponentLoadInfo:f,indicatorDataSource:d};I.tileResolutionResult.isCustomTile=c;if(b){I.tileResolutionResult.targetOutbound=b;}return I;}var i=[];try{var S=Object.keys(s.applications).sort();S.forEach(function(a){try{var A=s.applications[a];var o=t._getMember(A,"sap|app.crossNavigation.inbounds");if(o){var l=Object.keys(o).sort();l.forEach(function(I){var b=o[I];var r=m(I,b,A);if(r){i.push(r);}});}}catch(E){jQuery.sap.log.error("Error in application "+a+": "+E,E.stack);}});}catch(e){jQuery.sap.log.error(e);jQuery.sap.log.error(e.stack);return[];}return i;};sap.ushell.adapters.cdm.ClientSideTargetResolutionAdapter.prototype._formatApplicationType=function(r,a){var A=r.applicationType;if(A){return A;}var c=this._getMember(a,"sap|platform|runtime.componentProperties.self.name")||this._getMember(a,"sap|ui5.componentName");if(this._getMember(a,"sap|flp.appType")==="UI5"||this._getMember(a,"sap|ui.technology")==="UI5"){r.applicationType="SAPUI5";r.additionalInformation="SAPUI5.Component="+c;r.url=this._getMember(a,"sap|platform|runtime.componentProperties.url");r.applicationDependencies=this._getMember(a,"sap|platform|runtime.componentProperties");return"SAPUI5";}if(this._getMember(a,"sap|ui.technology")==="GUI"){r.applicationType="TR";r["sap.gui"]=this._getMember(a,"sap|gui");r.systemAlias=this._getMember(a,"sap|app.destination.name");return"TR";}if(this._getMember(a,"sap|ui.technology")==="WDA"){r.applicationType="WDA";r["sap.wda"]=this._getMember(a,"sap|wda");r.systemAlias=this._getMember(a,"sap|app.destination.name");return"WDA";}return"URL";};sap.ushell.adapters.cdm.ClientSideTargetResolutionAdapter.prototype.resolveSystemAlias=function(s){var d=new jQuery.Deferred(),t=this;this._getSystemAliases().done(function(S){var m,o=s===""?t._oLocalSystemAlias:S[s];if(o){d.resolve(o);}else{m="Cannot resolve system alias "+s;jQuery.sap.log.warning(m,"The system alias cannot be found in the site response","sap.ushell.adapters.cdm.ClientSideTargetResolutionAdapter");d.reject(m);}}).fail(function(){d.reject();});return d.promise();};}());
