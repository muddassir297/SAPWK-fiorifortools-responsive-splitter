// @copyright@
sap.ui.define(['sap/ui/core/HTML','sap/ui/core/IconPool','sap/ushell/ui/appfinder/AppBox','sap/ushell/ui/appfinder/PinButton','sap/ushell/ui/launchpad/CatalogEntryContainer','sap/ushell/ui/launchpad/CatalogTileContainer','sap/ushell/ui/launchpad/CatalogsContainer','sap/ushell/ui/launchpad/Panel','sap/ushell/ui/launchpad/Tile','sap/ushell/ui/launchpad/TileContainerUtils'],function(H,I,A,P,C,a,b,c,T,d){"use strict";sap.ui.jsview("sap.ushell.components.flp.launchpad.appfinder.Catalog",{oController:null,createContent:function(o){var t=this;this.oViewData=this.getViewData();this.parentComponent=this.oViewData.parentComponent;var m=this.parentComponent.getModel();this.setModel(m);this.setModel(this.oViewData.subHeaderModel,"subHeaderModel");this.oController=o;function i(L){return((L!==null)&&(L==="1x2"||L==="2x2"))||false;}function f(v){return parseInt(v,10)||0;}function g(e,u,G,v,w,x){var y;if(v){var R=sap.ushell.resources.i18n,z=$.inArray(w,G);y=R.getText(z!==-1?"removeAssociatedTileFromContextGroup":"addAssociatedTileToContextGroup",x);}else{y=G&&G.length?u:e;}return y;}var h=new P({icon:'sap-icon://pushpin-off',selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:function(e,u,G,v){if(G){var w=$.inArray(v,e);return w!==-1;}else{return!!u;}}},tooltip:{parts:["i18n>EasyAccessMenu_PinButton_UnToggled_Tooltip","i18n>EasyAccessMenu_PinButton_Toggled_Tooltip","associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id","/groupContext/title"],formatter:function(e,u,G,v,w,x,y){return g(e,u,G,w,x,y);}},press:[o.onTilePinButtonClick,o]});var j=new P({icon:'sap-icon://pushpin-off',selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:function(e,u,G,v){if(G){var w=$.inArray(v,e);return w!==-1;}else{return!!u;}}},tooltip:{parts:["i18n>EasyAccessMenu_PinButton_UnToggled_Tooltip","i18n>EasyAccessMenu_PinButton_Toggled_Tooltip","associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id","/groupContext/title"],formatter:function(e,u,G,v,w,x,y){return g(e,u,G,w,x,y);}},press:[o.onTilePinButtonClick,o]});this.oAppBoxesTemplate=new A({title:'{title}',icon:'{icon}',subtitle:'{subtitle}',url:'{url}',pinButton:j,press:[o.onAppBoxPressed,o]});j.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"tabindex",value:"-1",writeToDom:true}));j.addStyleClass("sapUshellPinButton");h.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"tabindex",value:"-1",writeToDom:true}));h.addStyleClass("sapUshellPinButton");this.oTileTemplate=new T({tileViews:{path:"content",factory:function(e,u){return u.getObject();}},"long":{path:"size",formatter:i},index:{path:"id",formatter:f},tileCatalogId:"{id}",pinButton:h,press:[o.catalogTilePress,o],afterRendering:o.onTileAfterRendering});this.oCatalogSelect=new sap.m.List("catalogSelect",{visible:"{/catalogSelection}",name:"Browse",tooltip:"{i18n>catalogSelect_tooltip}",rememberSelections:true,mode:"SingleSelectMaster",items:{path:"/masterCatalogs",template:new sap.m.StandardListItem({type:"Active",title:"{title}"})},showNoData:false,itemPress:[o._handleCatalogListItemPress,o]});this.getCatalogSelect=function(){return this.oCatalogSelect;};var k=this.oCatalogSelect.onAfterRendering;this.oCatalogSelect.addEventDelegate({onsaptabnext:function(u){try{u.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.components.flp.ComponentKeysHandler.setFocusOnCatalogTile();}catch(e){}},onsapskipforward:function(u){try{u.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.components.flp.ComponentKeysHandler.setFocusOnCatalogTile();}catch(e){}},onsapskipback:function(u){try{u.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);var v=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(v.getVisible()){v.focus();}else{sap.ushell.components.flp.ComponentKeysHandler.appFinderFocusMenuButtons(u);}}catch(e){}}});if(m.getProperty("/enableHelp")){this.oCatalogSelect.addStyleClass('help-id-catalogCategorySelect');}this.setCategoryFilterSelection=function(e){var u=t.getCatalogSelect(),v=u.getItems(),w=t.oController.oSubHeaderModel.getProperty('/tag/tagMode'),x=t.oController.oSubHeaderModel.getProperty('/search/searchMode'),y=e;if(x||w){u.setSelectedItem();}else{v.forEach(function(L,z){if(L.getTitle()===y){u.setSelectedItem(L);}});}};this.oCatalogSelect.onAfterRendering=function(){var e=t.oController.categoryFilter||sap.ushell.resources.i18n.getText('all');t.setCategoryFilterSelection(e);if(k){k.apply(this,arguments);}if(!this.getSelectedItem()){this.setSelectedItem(this.getItems()[0]);}setTimeout(function(){var u=jQuery("#catalog, #userMenu, #sapMenu").filter("[tabindex=0]");if(u.length){u.eq(0).focus();}else{jQuery("#catalog").focus();}},0);};var l=this.oCatalogSelect._onAfterRenderingPopover;this.oCatalogSelect._onAfterRenderingPopover=function(){if(this._oPopover){this._oPopover.setFollowOf(false);}if(l){l.apply(this,arguments);}};var E=sap.ui.getCore().getEventBus();E.subscribe("launchpad","catalogContentLoaded",function(){this.splitApp.toMaster('catalogSelect','show');if(sap.ui.Device.system.phone){this.splitApp.toDetail(this._calculateDetailPageId());}},this);var n=new H("sapUshellCatalogAccessibilityTileText",{content:"<div style='height: 0px; width: 0px; overflow: hidden; float: left;'>"+sap.ushell.resources.i18n.getText("tile")+"</div>"});var p=new C({header:"{title}",customTilesContainer:{path:"customTiles",template:this.oTileTemplate,templateShareable:true},appBoxesContainer:{path:"appBoxes",template:this.oAppBoxesTemplate,templateShareable:true}});this.oMessagePage=new sap.m.MessagePage({visible:true,showHeader:false,text:sap.ushell.resources.i18n.getText('EasyAccessMenu_NoAppsToDisplayMessagePage_Text'),description:''});this.oCatalogsContainer=new b("catalogTiles",{categoryFilter:"{/categoryFilter}",catalogs:{path:"/catalogs",templateShareable:true,template:p},busy:true});this.oCatalogsContainer.addStyleClass('sapUshellCatalogTileContainer');this.oCatalogsContainer.addEventDelegate({onsaptabprevious:function(e){var u=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader"),v=jQuery(e.srcControl.getDomRef());if(u.getVisible()&&!u.getPressed()&&!v.hasClass("sapUshellPinButton")){e.preventDefault();var w=sap.ui.getCore().byId("appFinderSearch");w.focus();}},onsapskipback:function(e){var u=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(u.getVisible()&&!u.getPressed()){e.preventDefault();u.focus();}}});this.oCatalogsContainer.onAfterRendering=function(){var e=sap.ui.getCore().byId('catalogTilesDetailedPage');if(!this.getBusy()){e.setBusy(false);jQuery.sap.measure.end("FLP:AppFinderLoadingStartToEnd");}else{e.setBusy(true);}jQuery("#catalogTilesDetailedPage-cont").scroll(function(){var u=sap.ui.getCore().byId('catalogTilesDetailedPage'),v=u.getScrollDelegate(),w=v.getScrollTop(),x=v.getMaxScrollTop();if(x-w<=30+t.oController.PagingManager.getTileHeight()){t.oController.allocateNextPage();}});};this.oCatalogEntrySearchContainer=new C({header:"{i18n>results_count}"});this.oCatalogEntrySearchContainer.addStyleClass('sapUshellCatalogTileContainer');this.oCatalogsSearchContainer=new b("catalogSearchContainer",{catalogs:[this.oCatalogEntrySearchContainer]});this.wrapCatalogsContainerInDetailPage=function(e,u){var D=new sap.m.Page(u,{showHeader:false,showFooter:false,showNavButton:false,content:[new c({translucent:true,content:e}).addStyleClass("sapUshellCatalogPage")]});return D},this.getCatalogContainer=function(){return this.oCatalogsContainer;};new sap.m.Page({showHeader:false,showFooter:false,showNavButton:false,content:[new c({translucent:true,content:[n,this.getCatalogContainer()]}).addStyleClass("sapUshellCatalogPage")]});var q=this.wrapCatalogsContainerInDetailPage([n,this.getCatalogContainer()],'catalogTilesDetailedPage'),r=new sap.m.Page('catalogMessagePage',{showHeader:false,showFooter:false,showNavButton:false,content:[this.oMessagePage]}),s=this.wrapCatalogsContainerInDetailPage([this.oCatalogsSearchContainer],'catalogTilesSearchPage');s.addEventDelegate({onAfterShow:function(e){jQuery(".sapUshellTile").find('[tabindex*=0]').attr("tabindex",-1);jQuery(".sapUshellAppBox:visible, .sapUshellTile:visible").first().attr("tabindex",0);}});var S=new sap.m.BusyIndicator('catalogSelectBusyIndicator',{size:"1rem"});this.splitApp=new sap.m.SplitApp('catalogViewMasterDetail',{masterPages:[S,this.oCatalogSelect],detailPages:[q,s,r]});document.toSearch=function(){this.splitApp.toDetail('catalogTilesSearchPage');}.bind(this);document.toDetail=function(){this.splitApp.toDetail('catalogTilesDetailedPage');}.bind(this);document.toMessage=function(){this.splitApp.toDetail('catalogMessagePage');}.bind(this);return this.splitApp;},_calculateDetailPageId:function(){var s=this.getModel('subHeaderModel');var S=s.getProperty('/search/searchMode');var t=s.getProperty('/tag/tagMode');var i;if(S||t){i=this.getController().bSearchResults?'catalogTilesSearchPage':'catalogMessagePage';}else{i="catalogTilesDetailedPage";}return i;},getControllerName:function(){return"sap.ushell.components.flp.launchpad.appfinder.Catalog";}});},false);
