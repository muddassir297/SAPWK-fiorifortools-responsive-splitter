// @copyright@
sap.ui.define(["sap/ushell/services/AppType","sap/m/Button","sap/m/List","sap/m/Text","sap/m/VBox","sap/m/HBox","sap/m/Image","sap/m/Dialog","sap/m/Popover","sap/m/OverflowToolbar","sap/m/ScrollContainer","sap/ushell/resources","sap/ushell/ui/launchpad/UserStatusItem","sap/ushell/ui/launchpad/AccessibilityCustomData"],function(a,B,L,T,V,H,I,D,P,O,S,r,U,A){"use strict";sap.ui.jsview("sap.ushell.renderers.fiori2.meArea.MeArea",{createContent:function(c){this.addStyleClass('sapUshellMeAreaView');this.aDanglingControls=[];var u=sap.ushell.Container.getUser().getFullName(),p,t=sap.ushell.resources.i18n,C=(this.getViewData()?this.getViewData().config:{})||{},s=C.appState,b=(s==='embedded'||s==='embedded-home'||s==='standalone'||s==='blank-home'||s==='blank'),d,o=sap.ui.core.service.ServiceFactoryRegistry.get("sap.ushell.ui5service.UserStatus");if(o){var e=o.createInstance(),f=function(i){e.then(function(o){o.setStatus(i);p.close();});};}d=[new U({status:U.prototype.STATUS_ENUM.AVAILABLE,id:"userStatusItem1",isOpener:false,press:function(i){f(sap.ushell.ui5service.UserStatus.prototype.AvailableStatus.AVAILABLE);}.bind(this)}).addStyleClass('sapUserStatusContainer'),new U({status:U.prototype.STATUS_ENUM.AWAY,id:"userStatusItem2",isOpener:false,press:function(i){f(sap.ushell.ui5service.UserStatus.prototype.AvailableStatus.AWAY);}.bind(this)}).addStyleClass('sapUserStatusContainer'),new U({status:U.prototype.STATUS_ENUM.BUSY,id:"userStatusItem3",isOpener:false,press:function(i){f(sap.ushell.ui5service.UserStatus.prototype.AvailableStatus.BUSY);}.bind(this)}).addStyleClass('sapUserStatusContainer'),new U({status:U.prototype.STATUS_ENUM.APPEAR_OFFLINE,id:"userStatusItem4",isOpener:false,press:function(i){f(sap.ushell.ui5service.UserStatus.prototype.AvailableStatus.APPEAR_OFFLINE);}.bind(this)}).addStyleClass('sapUserStatusContainer')];if(!C.disableSignOut){d.push(new U({status:U.prototype.STATUS_ENUM.SIGNOUT,id:"userStatusLogout",isOpener:false,press:[c.logout,c]}).addStyleClass('sapUserStatusSignOutContainer'));}var g=new L({id:"sapUshellUserStatusItemList",showSeparators:"None",items:d});g.addCustomData(new A({key:"aria-labelledBy",value:"userStatusItem1",writeToDom:true}));p=new P("statuses",{placement:sap.m.PlacementType.Bottom,showArrow:false,showHeader:false,content:g}).addStyleClass('sapUserStatusPopOver');p.addStyleClass("sapContrastPlus");p.setOffsetX(-3);d=[new T({text:u}).addStyleClass('sapUshellMeAreaUserName')];var h=new sap.ushell.ui.launchpad.UserStatusItem({id:"userStatusOpener",visible:{parts:["/userStatusEnabled","/userStatusUserEnabled"],formatter:function(i,v){if(i&&v){return true;}return false;}.bind(this)},status:{path:"/userStatus",formatter:function(i){return sap.ushell.ui.launchpad.UserStatusItem.prototype.STATUS_ENUM[i];}.bind(this)},tooltip:t.getText("userStatus_tooltip"),image:sap.ui.core.IconPool.getIconURI("account"),press:function(i){var v=sap.ui.getCore().byId(i.mParameters.id);if(p.isOpen()){p.close();}else{p.openBy(v);}}.bind(this),contentList:p}).addStyleClass('sapUserStatusOpener');h.addCustomData(new A({key:"tabindex",value:"0",writeToDom:true}));h.addCustomData(new A({key:"aria-label",value:sap.ushell.resources.i18n.getText("OnlineStatus")+" "+t.getText("userStatus_tooltip"),writeToDom:true}));h.addCustomData(new A({key:"role",value:"listbox",writeToDom:true}));d.push(h);if(!C.disableSignOut){var l;if(!b){l=new B("logoutBtn",{visible:{parts:["/userStatusEnabled","/userStatusUserEnabled"],formatter:function(i,v){if(i&&v){return false;}return true;}.bind(this)},type:sap.m.ButtonType.Transparent,icon:'sap-icon://log',text:sap.ushell.resources.i18n.getText("signoutBtn_title"),press:[c.logout,c]});d.push(l);}else{l=new sap.ushell.ui.launchpad.ActionItem("logoutBtn",{visible:true,type:sap.m.ButtonType.Transparent,icon:'sap-icon://log',text:sap.ushell.resources.i18n.getText("signoutBtn_title"),press:[c.logout,c]});}}var j=new V({items:[d]}).addStyleClass("sapUshellUserArea");var k=sap.ushell.Container.getUser().getImage(),m;if(!k){m=new sap.ui.core.Icon({src:sap.ui.core.IconPool.getIconURI("person-placeholder"),size:'4rem'});}else{m=this.createNewImage(k);}m.addStyleClass("sapUshellMeAreaUserImage");var n=new H({items:[m,j]});n.addStyleClass('sapUshellMeAreaUserInfo');n.addStyleClass('sapContrastPlus');var q=c.createSaveButton(),w=c.createCancelButton();this.oSettingsDialog=new D({id:"userSettingsDialog",showHeader:false,content:null,buttons:[q,w],afterClose:function(){sap.ushell.Container.getUser().resetChangedProperties();},stretch:sap.ui.Device.system.phone}).addStyleClass("sapUshellUserSetting");this.oSettingsDialog.addContent(c.getSettingsDialogContent());this.aDanglingControls.push(w,q,this.oSettingsDialog);n.addEventDelegate({onsapskipback:function(i){i.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(i);},onsaptabprevious:function(i){i.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(i);}});var x=new O({id:"overflowActions",design:sap.m.ToolbarDesign.Transparent,content:{path:"/currentState/actions",factory:function(i,v){var F=sap.ui.getCore().byId(v.getObject());if(F){if(F.setActionType){F.setActionType("action");}c._addPressHandlerToActions(F);}return F;}}}).addStyleClass('sapContrastPlus');x._getOverflowButtonSize=function(){return 82.4;};if(x._getOverflowButton){var y=x._getOverflowButton();if(y){var z=y.onAfterRendering;y.onAfterRendering=function(){if(z){z.apply(this,arguments);}this.addStyleClass('sapUshellActionItem');this.setText(sap.ushell.resources.i18n.getText('meAreaMoreActions'));};}}x.updateAggregation=function(N){var F=this.mBindingInfos[N],G=this.getMetadata().getJSONKeys()[N],J;jQuery.each(this[G._sGetter](),jQuery.proxy(function(i,v){this[G._sRemoveMutator](v);},this));jQuery.each(F.binding.getContexts(),jQuery.proxy(function(i,v){J=F.factory(this.getId()+"-"+i,v)?F.factory(this.getId()+"-"+i,v).setBindingContext(v,F.model):"";this[G._sMutator](J);},this));};var M=new V("sapUshellMeAreaContent",{});if(C.enableRecentActivity){this.actionBox=x;M.addItem(n);M.addItem(x);var E=this.createIconTabBar(c);E.done(function(i){M.addItem(i);});}else{x.addEventDelegate({onsaptabnext:function(i){var v=i.originalEvent,F=v.srcElement,G=jQuery('.sapUshellActionItem:last')[0].id,J;J=G===F.id;if(J===true){i.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(i);}},onsapskipforward:function(i){i.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(i);}});M.addItem(n);M.addItem(x);}return new S({vertical:true,horizontal:false,height:"100%",content:M});},createIconTabBar:function(c){var R=new jQuery.Deferred(),t=this,i,o,b,m,d,s,C;sap.ui.require(['sap/m/IconTabBar','sap/m/StandardListItem','sap/m/IconTabFilter'],function(e,f,g){i=new e('meAreaIconTabBar',{backgroundDesign:sap.m.BackgroundDesign.Transparent,expandable:false,items:[t.createIconTab("recentActivities",true,c,f,g),t.createIconTab("frequentActivities",false,c,f,g)]}).addStyleClass('sapUshellMeAreaTabBar');i.addEventDelegate({onsaptabnext:function(E){var o=E.originalEvent,s=o.srcElement,C=s.classList,h;h=jQuery.inArray('sapUshellMeAreaActivityItem',C)>-1;if(h===true){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(E);}},onsapskipforward:function(E){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(E);}});b=i.onAfterRendering;i.onAfterRendering=function(){if(b){b.apply(t,arguments);}d=sap.ui.getCore().byId('meAreaIconTabBar--header');if(d){d.addStyleClass('sapContrastPlus');d.addStyleClass('sapUshellTabBarHeader');}};R.resolve(i);});return R.promise();},createIconTab:function(i,s,c,b,d){var o,e,t,f,l,g,h,j,m,p,v;o=function(k,C){e=C.getProperty("icon");t=C.getProperty("title");f=a.getDisplayName(C.getProperty("appType"));l={title:t,description:f,icon:e,type:sap.m.ListType.Active};if(s){l.info=C.getProperty("timestamp");}g=new b(l).addStyleClass('sapUshellMeAreaActivityItem');g.addCustomData(new A({key:"aria-describedby",value:h.getId(),writeToDom:true}));if(!e){g.addStyleClass('sapUshellMeAreaActivityItemNoIcon');}return g;};h=new d({id:"sapUshellIconTabBar"+i,text:r.i18n.getText(i)});j=new L({id:"sapUshellActivityList"+i,showSeparators:"None",items:{path:"meAreaModel>/apps/"+i,factory:o.bind(this)},noDataText:sap.ushell.resources.i18n.getText(i+'NoDataText'),itemPress:function(E){m=this.getModel('meAreaModel');v=sap.ui.getCore().byId("viewPortContainer");if(v){v.switchState("Center");}p=E.getParameter('listItem').getBindingContextPath();c.setLastVisited(m.getProperty(p).url);setTimeout(function(){hasher.setHash(m.getProperty(p).url);},200);}});h.addContent(j);return h;},onViewStateShow:function(){this.getController().refreshRecentActivities();this.getController().refreshFrequentActivities();if(this.actionBox){this.actionBox.updateAggregation("content");}this.getController().updateScrollBar(hasher.getHash());},createNewImage:function(u){return new I({src:u});},getControllerName:function(){return"sap.ushell.renderers.fiori2.meArea.MeArea";}});},false);
