// @copyright@
(function(g){"use strict";jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchShellHelper');jQuery.sap.require('sap.m.Bar');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchHelper');sap.ui.jsview("sap.ushell.renderers.fiori2.search.container.App",{createContent:function(){var t=this;if(!this.oModel){this.oModel=sap.ushell.renderers.fiori2.search.getModelSingleton();}this.setModel(sap.ushell.resources.i18nModel,"i18n");this.oSearchResults=sap.ui.view({id:"searchContainerResultsView",tooltip:"{i18n>searchResultsView_tooltip}",viewName:"sap.ushell.renderers.fiori2.search.container.Search",type:sap.ui.core.mvc.ViewType.JS});this.oSearchResults.setModel(t.oModel);this.oSearchResults.setAppView(t);var s=new sap.m.Bar({contentLeft:[t.oSearchResults.assembleFilterButton(),t.oSearchResults.assembleDataSourceTapStrips()],contentRight:t.oSearchResults.assembleSearchToolbar()});s.addStyleClass('sapUshellSearchBar');var f=new sap.ushell.renderers.fiori2.search.controls.SearchFilterBar({visible:{parts:[{path:'/facetVisibility'},{path:'/uiFilter/defaultConditionGroup'}],formatter:function(a,b){if(!a&&b&&b.conditions&&b.conditions.length>0){return true;}else{return false;}}}});this.oModel.deserializeURL();this.oPage=this.pageFactory("searchPage",this.oSearchResults,s,f);this.oSearchResults.reorgTabBarSequence();return this.oPage;},beforeExit:function(){},pageFactory:function(i,c,h,s){var t=this;var p=new sap.m.Page({id:i,customHeader:h,subHeader:s,content:[c],enableScrolling:true,showFooter:{parts:['/multiSelectionAvailable','/multiSelectionActions','/errors/length'],formatter:function(m,a,n){return m||n>0;}},showHeader:true,showSubHeader:{parts:[{path:'/facetVisibility'},{path:'/uiFilter/defaultConditionGroup'}],formatter:function(f,a){if(!f&&a&&a.conditions&&a.conditions.length>0){return true;}else{return false;}}}});p.setModel(t.oModel);var e=["onAfterHide","onAfterShow","onBeforeFirstShow","onBeforeHide","onBeforeShow"];var d={};t.createFooter(p);jQuery.each(e,function(I,E){d[E]=jQuery.proxy(function(a){jQuery.each(this.getContent(),function(I,c){c._handleEvent(a);});},p);});p.addEventDelegate(d);if(!sap.ui.Device.system.desktop){p._bUseIScroll=true;}return p;},getControllerName:function(){return"sap.ushell.renderers.fiori2.search.container.App";},createFooter:function(p){var t=this;if(jQuery.device.is.phone){return;}var m=new sap.m.ToggleButton({icon:"sap-icon://multi-select",tooltip:sap.ushell.resources.i18n.getText("toggleSelectionModeBtn"),press:function(){var c=t.oBar.getContent();var i,a;if(this.getPressed()){t.oSearchResults.resultList.enableSelectionMode();t.oModel.setProperty("/multiSelectionEnabled",true);for(i=0;i<c.length;i++){a=c[i];if(a.hasStyleClass("sapUshellSearchResultList-multiSelectionActionButton")){t.oBar.removeContent(a);}}var d=t.oModel.getDataSource();var b=t.oModel.config.getDataSourceConfig(d);var s=new b.searchResultListSelectionHandlerControl();var h=s.actionsForDataSource();t.oModel.setProperty("/multiSelectionActions",h);for(i=0;i<h.length;i++){var k=h[i];var l=new sap.m.Button({text:k.text,press:function(){var r=t.oModel.getProperty("/results");var j=[];for(var i=0;i<r.length;i++){var o=r[i];if(o.selected){j.push(o);}}k.action(j);},visible:{parts:[{path:'/multiSelectionEnabled'}],mode:sap.ui.model.BindingMode.OneWay}});l.setModel(t.oModel);l.addStyleClass("sapUshellSearchResultList-multiSelectionActionButton");t.oBar.insertContent(l,2);}}else{var n=t.oSearchResults.resultList.disableSelectionMode();n.done(function(){t.oModel.setProperty("/multiSelectionEnabled",false);t.oModel.setProperty("/multiSelectionActions",undefined);var r=t.oModel.getProperty("/boResults");if(r){for(var j=0;j<r.length;j++){var o=r[j];o.selected=false;}}for(i=0;i<c.length;i++){a=c[i];if(a.hasStyleClass("sapUshellSearchResultList-multiSelectionActionButton")){t.oBar.removeContent(a);}}});}},visible:{parts:[{path:'/multiSelectionAvailable'}],mode:sap.ui.model.BindingMode.OneWay}});m.setModel(this.oModel);m.addStyleClass("sapUshellSearchResultList-toggleMultiSelectionButton");var e=new sap.m.MessagePopover({placement:"Top"}).setModel(this.oModel);e.bindAggregation("items","/errors",function(i,C){var a=new sap.m.MessagePopoverItem({title:"{title}",description:"{description}"});switch(C.oModel.getProperty(C.sPath).type.toLowerCase()){case"error":a.setType(sap.ui.core.MessageType.Error);break;case"warning":a.setType(sap.ui.core.MessageType.Warning);break;default:a.setType(sap.ui.core.MessageType.Information);}return a;});var E=new sap.m.Button("searchErrorButton",{icon:sap.ui.core.IconPool.getIconURI("alert"),text:{parts:[{path:'/errors/length'}],formatter:function(l){return l;}},visible:{parts:[{path:'/errors/length'}],formatter:function(l){return l>0;},mode:sap.ui.model.BindingMode.OneWay},type:sap.m.ButtonType.Emphasized,tooltip:sap.ushell.resources.i18n.getText('errorBtn'),press:function(){e.openBy(E);}});E.addDelegate({onAfterRendering:function(){if(!t.oModel.getProperty('/isErrorPopovered')){E.firePress();t.oModel.setProperty('/isErrorPopovered',true);}}});E.setLayoutData(new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow}));m.setLayoutData(new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow}));var c=[E,new sap.m.ToolbarSpacer(),m];t.oBar=new sap.m.OverflowToolbar({content:c}).addStyleClass("MyBar");var f=p.getFooter();if(f&&f.destroy){f.destroy();}p.setFooter(t.oBar);}});}(window));
