(function(g){"use strict";jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchHelper');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchResultListFormatter');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchFacetsFormatter');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchTabStripsFormatter');jQuery.sap.require('sap.ushell.renderers.fiori2.search.FacetItem');jQuery.sap.require('sap.ushell.renderers.fiori2.search.suggestions.SuggestionHandler');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchIntentsResolver');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchConfiguration');jQuery.sap.require("sap.ushell.renderers.fiori2.search.personalization.PersonalizationStorage");jQuery.sap.require("sap.ushell.renderers.fiori2.search.SearchNavigationObject");jQuery.sap.require("sap.ushell.renderers.fiori2.search.eventlogging.EventLogger");var s=g.sap;var S=s.ushell.renderers.fiori2.search.SearchHelper;var a=s.ushell.renderers.fiori2.search.SearchResultListFormatter;var T=s.ushell.renderers.fiori2.search.SearchTabStripsFormatter.Formatter;var b=s.ushell.renderers.fiori2.search.suggestions.SuggestionHandler;var c=s.ushell.renderers.fiori2.search.SearchConfiguration;var p=s.ushell.renderers.fiori2.search.personalization.PersonalizationStorage;var d=s.ushell.renderers.fiori2.search.SearchNavigationObject;var E=s.ushell.renderers.fiori2.search.eventlogging.EventLogger;s.ushell.renderers.fiori2.search.getModelSingleton=function(){if(!s.ushell.renderers.fiori2.search.oModel){s.ushell.renderers.fiori2.search.oModel=new s.ushell.renderers.fiori2.search.SearchModel();}return s.ushell.renderers.fiori2.search.oModel;};s.ui.model.json.JSONModel.extend("sap.ushell.renderers.fiori2.search.SearchModel",{constructor:function(e){var t=this;e=e||{};s.ui.model.json.JSONModel.prototype.constructor.apply(t,[]);t.config=c.getInstance();t.setSizeLimit(200);t.sina=t.config.getSina();this.suggestionQuery=this.sina.createSuggestionQuery();t.suggestionHandler=new b({model:this});t.query=t.sina.createPerspectiveQuery({templateFactsheet:true});if(t.config.multiSelect){t.query.setIncludeFacetsWithFilters(true);}t.setProperty('/uiFilter',t.sina.createFilter());t.resetFilterConditions(false);t.createAllAndAppDataSource();t.query.getResultSet=S.refuseOutdatedRequests(t.query.getResultSet,'search');t.searchApplications=S.refuseOutdatedRequests(t.searchApplications,'search');t.oFacetFormatter=new s.ushell.renderers.fiori2.search.SearchFacetsFormatter();t.tabStripFormatter=new T(t.allDataSource);t.dataSourceTree=t.tabStripFormatter.tree;t.pageSize=10;t.appTopDefault=20;t.boTopDefault=t.pageSize;t.setProperty('/isQueryInvalidated',true);t.setProperty('/isBusy',false);t.setProperty('/tableColumns',[]);t.setProperty('/tableSortableColumns',[]);t.setProperty('/tableResults',[]);t.setProperty('/results',[]);t.setProperty('/appResults',[]);t.setProperty('/boResults',[]);t.setProperty('/count',0);t.setProperty('/boCount',0);t.setProperty('/appCount',0);t.setProperty('/facets',[]);t.setProperty('/dataSources',[t.allDataSource,t.appDataSource]);t.setProperty('/currentPersoServiceProvider',null);t.setProperty('/businessObjSearchEnabled',true);t.setProperty('/suggestions',[]);t.setProperty('/resultToDisplay',S.loadResultViewType());t.setProperty('/displaySwitchVisibility',false);t.setProperty('/documentTitle','Search');t.setProperty('/top',t.boTopDefault);t.setProperty('/orderBy',{});t.setProperty('/facetVisibility',false);t.setProperty('/focusIndex',0);t.setProperty('/fuzzy',false);t.setProperty('/errors',[]);t.setProperty('/isErrorPopovered',false);t.setProperty('/defaultDataSource',t.allDataSource);t.resetDataSource(false);t.setProperty('/multiSelectionAvailable',false);t.setProperty('/multiSelectionEnabled',false);t.setProperty('/multiSelection/actions',[]);t.initBusinessObjSearch();t.eventLogger=E.newInstance({sina:t.sina});},initBusinessObjSearch:function(){var t=this;if(!t.config.searchBusinessObjects){t.setDataSource(t.appDataSource,false);t.setProperty('/businessObjSearchEnabled',false);t.setProperty('/facetVisibility',false);t.setProperty('/defaultDataSource',t.appDataSource);return;}t.sina.sinaSystem().getServerInfo().done(function(e){t.serverInfo=e;t.loadDataSources();}).fail(function(){t.setDataSource(t.appDataSource,false);t.setProperty('/businessObjSearchEnabled',false);t.setProperty('/facetVisibility',false);t.setProperty('/defaultDataSource',t.appDataSource);});},initPersonalization:function(){var t=this;if(this.initPersonalizationPromise){return this.initPersonalizationPromise;}this.initPersonalizationPromise=p.getInstance().then(function(f){var h=false;try{h=f.getItem('search-facet-panel-button-state');}catch(e){}t.setFacetVisibility(h,false);},function(){return jQuery.Deferred().resolve(true);});return this.initPersonalizationPromise;},isBusinessObjSearchConfigured:function(){try{var f=window['sap-ushell-config'].renderers.fiori2.componentData.config;return f.searchBusinessObjects!=='hidden';}catch(e){return true;}},isBusinessObjSearchEnabled:function(){return this.getProperty('/businessObjSearchEnabled');},setProperty:function(n,v,C,A){var t=this;var r=s.ui.model.json.JSONModel.prototype.setProperty.apply(this,arguments);switch(n){case'/boResults':case'/appResults':t.calculateResultList();break;case'/appCount':case'/boCount':r=t.setProperty('/count',t.getProperty('/appCount')+t.getProperty('/boCount'));break;default:break;}return r;},setFuzzy:function(f){if(f===true){this.query.addOption(g.sinabase.QueryOptions.FUZZY);}else{this.query.removeOption(g.sinabase.QueryOptions.FUZZY);}this.setProperty("/fuzzy",f);},getPersonalizationStorageInstance:function(){return p.getInstanceSync();},getSearchBoxTerm:function(){return this.getProperty('/uiFilter/searchTerms');},setSearchBoxTerm:function(e,f){var t=this;var h=e.replace(/^\s+/,"");this.setProperty('/uiFilter/searchTerms',h);this.calculateSearchButtonStatus();if(h.length===0){return;}if(f||f===undefined){t._firePerspectiveQuery();}},getLastSearchTerm:function(){return this.query.getSearchTerms();},setFacetVisibility:function(v,f){if(s.ui.Device.system.phone){v=false;}this.setProperty('/facetVisibility',v);try{this.getPersonalizationStorageInstance().setItem('search-facet-panel-button-state',v);}catch(e){}if((f||f===undefined)&&v){this._firePerspectiveQuery({preserveFormerResults:true});}},getFacetVisibility:function(){return this.getProperty('/facetVisibility');},getTop:function(){return this.getProperty('/top');},setTop:function(t,f){this.setProperty('/top',t);if(f||f===undefined){this._firePerspectiveQuery({preserveFormerResults:true});}},resetTop:function(){this.setProperty('/focusIndex',0);if(this.isAppCategory()){this.setTop(this.appTopDefault,false);}else{this.setTop(this.boTopDefault,false);}},getOrderBy:function(){return this.getProperty('/orderBy');},setOrderBy:function(o,f){this.setProperty('/orderBy',o);if(f||f===undefined){this._firePerspectiveQuery({preserveFormerResults:true});}},resetOrderBy:function(f){this.setProperty('/orderBy',{});if(f||f===undefined){this._firePerspectiveQuery({preserveFormerResults:true});}},isEqualOrderBy:function(o,e){if(jQuery.isEmptyObject(o)&&jQuery.isEmptyObject(e)){return true;}else if(o.orderBy===e.orderBy&&o.sortOrder===e.sortOrder){return true;}else{return false;}},getDocumentTitle:function(){var e=this.getSearchBoxTerm();var f=this.getDataSource().label;var t;if(this.getDataSource().equals(this.allDataSource)){t=s.ushell.resources.i18n.getText('searchTileTitleProposalAll',[e]);}else{t=s.ushell.resources.i18n.getText('searchTileTitleProposal',[e,f]);}return t;},resetQuery:function(){S.hasher.reset();this.resetTop();this.setSearchBoxTerm('');this.resetDataSource(false);this.resetFilterConditions(false);this.query.resetFilterConditions();this.query.setSearchTerms('random-jgfhfdskjghrtekjhg');this.setProperty('/facets',[]);this.setProperty('/results',[]);this.setProperty('/appResults',[]);this.setProperty('/boResults',[]);this.setProperty('/count',0);this.setProperty('/boCount',0);this.setProperty('/appCount',0);},createAllAndAppDataSource:function(){this.allDataSource=this.sina.getRootDataSource();this.allDataSource.label=s.ushell.resources.i18n.getText("label_all");this.allDataSource.labelPlural=s.ushell.resources.i18n.getText("label_all");this.appDataSource=this.sina.createDataSource({objectName:"$$APPS$$",label:s.ushell.resources.i18n.getText("label_apps"),labelPlural:s.ushell.resources.i18n.getText("label_apps"),type:'Apps',name:'Apps',sina:this.sina});},loadDataSources:function(){var t=this;t.getServerDataSources().done(function(e){if(!jQuery.isArray(e)){e=[];}e=e.slice();e.splice(0,0,t.appDataSource);e.splice(0,0,t.allDataSource);t.setProperty("/dataSources",e);t.updateDataSourceList(t.getDataSource());t.setProperty("/searchTermPlaceholder",t.calculatePlaceholder());var f=t.getProperty('/uiFilter/dataSource/key');t.setProperty('/uiFilter/dataSource/key','');t.setProperty('/uiFilter/dataSource/key',f);});},resetDataSource:function(f){this.setDataSource(this.getDefaultDataSource(),f);},isAllCategory:function(){var e=this.getProperty("/uiFilter/dataSource");return e.equals(this.allDataSource);},isOtherCategory:function(){var e=this.getProperty("/uiFilter/dataSource");return e.getType().toLowerCase()==="category"&&!this.isAllCategory();},isAppCategory:function(){var e=this.getProperty("/uiFilter/dataSource");return e.equals(this.appDataSource);},getDataSource:function(){return this.getProperty("/uiFilter/dataSource");},getDefaultDataSource:function(){return this.getProperty("/defaultDataSource");},setDataSource:function(e,f){this.updateDataSourceList(e);this.getProperty("/uiFilter").setDataSource(e);this.setProperty("/searchTermPlaceholder",this.calculatePlaceholder());this.resetTop();this.calculateSearchButtonStatus();if(f||f===undefined){this._firePerspectiveQuery();}},getServerDataSources:function(){var t=this;if(t.getDataSourcesDeffered){return t.getDataSourcesDeffered;}t.getDataSourcesDeffered=t.sina.getDataSources().then(function(e){return jQuery.grep(e,function(f){return f.getType()!=='Category';});},function(e){e.keep=true;e.type='warning';e.message=s.ushell.resources.i18n.getText('searchScopeDeterminationErrorMessage');t.normalSearchErrorHandling(e);});return t.getDataSourcesDeffered;},notifyFilterChanged:function(){jQuery.each(this.aBindings,function(i,e){if(e.sPath==='/uiFilter/defaultConditionGroup'){e.checkUpdate(true);}});},addFilterCondition:function(f,e){if(f.attribute||f.conditions){this.getProperty("/uiFilter").addFilterCondition(f);}else{this.setDataSource(f,false);}if(e||e===undefined){this._firePerspectiveQuery({preserveFormerResults:false});}this.notifyFilterChanged();},removeFilterCondition:function(f,e){if(f.attribute||f.conditions){this.getProperty("/uiFilter").removeFilterCondition(f);}else{this.setDataSource(f,false);}if(e||e===undefined){this._firePerspectiveQuery({preserveFormerResults:true});}this.notifyFilterChanged();},resetFilterConditions:function(f){this.getProperty("/uiFilter").resetFilterConditions();if(f||f===undefined){this._firePerspectiveQuery();}this.notifyFilterChanged();},doSuggestion:function(){this.suggestionQuery.setFilter(this.getProperty('/uiFilter').clone());this.suggestionHandler.doSuggestion();},abortSuggestions:function(){this.suggestionHandler.abortSuggestions();},_firePerspectiveQuery:function(e,f){var t=this;this.setProperty('/isBusy',true);var h=function(){return t._doFirePerspectiveQuery(e,f);};this.initPersonalization().then(h).always(function(){t.setProperty('/isBusy',false);});},_doFirePerspectiveQuery:function(e,f){var t=this;var h,i;if(jQuery.isPlainObject(e)){h=e.deserialization;i=e.preserveFormerResults;}else{h=e?e:undefined;i=f?f:undefined;}var u=this.getProperty('/uiFilter');if(u.equals(this.query.getFilter())&&this.getTop()===this.query.getTop()&&this.isEqualOrderBy(this.getOrderBy(),this.query.getOrderBy())&&this.calculateRequestsEntities().length===this.query.requestedEntities.length&&!this.getProperty('/isQueryInvalidated')){return(new jQuery.Deferred()).resolve();}if((this.query.getFilter().getDataSource()&&!u.getDataSource().equals(this.query.getFilter().getDataSource()))||(this.query.getFilter().getSearchTerms()&&u.getSearchTerms()!==this.query.getFilter().getSearchTerms())){this.resetOrderBy(false);}if(!h){if(u.getSearchTerms()!==this.query.getFilter().getSearchTerms()||!u.defaultConditionGroup.equals(this.query.getFilter().defaultConditionGroup)||!u.getDataSource().equals(this.query.getFilter().getDataSource())){this.resetTop();}}if(u.getSearchTerms()!==this.query.getFilter().getSearchTerms()||!u.defaultConditionGroup.equals(this.query.getFilter().defaultConditionGroup)){this.tabStripFormatter.invalidate(this.getDataSource());}if(this.getProperty('/isQueryInvalidated')===true){this.query.resetResultSet();this.setProperty('/isQueryInvalidated',false);}this.query.setFilter(this.getProperty('/uiFilter').clone());this.query.setTop(this.getTop());this.query.setOrderBy(this.getOrderBy());this.query.setRequestedEntities(this.calculateRequestsEntities());this.cleanErrors();this.setProperty("/queryFilter",this.query.getFilter());s.ui.getCore().getEventBus().publish("allSearchStarted");this.abortSuggestions();S.abortRequests('search');this.calculateVisibility();if(!h){this.updateSearchURLSilently();}this.eventLogger.logEvent({type:this.eventLogger.SEARCH_REQUEST,searchTerm:this.getProperty('/uiFilter/searchTerms'),dataSourceKey:this.getProperty('/uiFilter/dataSource').key});var j=this.getDataSource();return jQuery.when.apply(null,[this.normalSearch(i),this.appSearch()]).then(function(){t.setProperty('/tabStrips',t.tabStripFormatter.format(j,t.perspective,t));return t.oFacetFormatter.getFacets(j,t.perspective,t).then(function(k){t.setProperty('/facets',k);});}).always(function(){document.title=t.getDocumentTitle();s.ui.getCore().getEventBus().publish("allSearchFinished");});},calculateRequestsEntities:function(){if(this.getDataSource().getType()==='Category'||this.getFacetVisibility()){return['SearchResults','Facets','TotalCount'];}else{return['SearchResults','TotalCount'];}},appSearch:function(){var t=this;this.setProperty("/appResults",[]);this.setProperty("/appCount",0);if(!this.isAllCategory()&&!this.isAppCategory()){return jQuery.when(true);}var e=this.query.getFilter().getDataSource().equals(this.allDataSource)?this.appTopDefault:this.query.getTop();return this.searchApplications(this.query.getFilter().getSearchTerms(),e,0).then(function(r){t.setProperty("/appCount",r.totalResults);t.setProperty("/appResults",r.getElements());},function(){return jQuery.when(true);});},searchApplications:function(e,t,f){return s.ushell.Container.getService("Search").queryApplications({searchTerm:e,searchInKeywords:true,top:t,skip:f});},normalSearch:function(e){var t=this;if(!e){t.resetAndDisableMultiSelection();}if(!t.isBusinessObjSearchEnabled()||t.isAppCategory()){this.setProperty("/boResults",[]);this.setProperty("/boCount",0);return jQuery.when(true);}t.setFuzzy(false);return this.query.getResultSet().then(function(f){if(f.getSearchResultSet().totalcount<1&&t.serverInfo.services.Search.capabilities.OptionFuzzy&&t.query.getFilter().getSearchTerms()!=='*'){t.setProperty("/boResults",[]);t.setProperty("/boCount",0);t.setFuzzy(true);return t.query.getResultSet().then(function(h){t.perspective=h;return t._afterSearchPrepareResultList(t.perspective,e);},function(h){t.normalSearchErrorHandling(h);t.perspective=null;return jQuery.when(true);});}t.perspective=f;return t._afterSearchPrepareResultList(t.perspective,e);},function(f){t.normalSearchErrorHandling(f);t.perspective=null;return jQuery.when(true);});},_prepareTableResults:function(r){var t=this;var e=r;var i,j,f;for(i=0;i<e.length;i++){var h=e[i].itemattributes;if(h.length>0){f=1;for(j=0;j<e[i].itemattributes.length;j++){if(j<=11){e[i].itemattributes[j].indexInTable=f;f++;}}if(!h[0].isTitle){e[i].itemattributes.unshift({name:e[i].dataSourceName,value:e[i].$$Name$$,key:"DATASOURCE_AS_COLUMN_KEY",isTitle:true,isSortable:false,uri:e[i].uri,titleNavigation:e[i].titleNavigation,onlyUsedInTable:true,indexInTable:0});}if(e[i].navigationObjects!==undefined&&e[i].navigationObjects.length>0&&!h[h.length-1].hasIntents){e[i].itemattributes.splice(f,0,{name:s.ushell.resources.i18n.getText("intents"),navigationObjects:e[i].navigationObjects,key:"RELATED_OBJECTS",isNavigationObjects:true,isSortable:false,onlyUsedInTable:true,indexInTable:f});}}}t.setProperty("/tableResults",e);var l=[];var m=[];var n=e[0];var o="";if(n){var q=n.itemattributes;for(i=0;i<q.length;i++){if(q[i].indexInTable!==undefined&&q[i].key!==undefined){o=q[i].key;l.push({"name":q[i].name,"key":"columnKey"+i,"originalKey":o,"index":q[i].indexInTable});if(q[i].isSortable){m.push({"name":q[i].name,"key":"normalColumn"+i,"originalKey":o,"selected":t.getProperty("/orderBy").orderBy===o});}}}t.setProperty("/tableColumns",l);var u=n.titleattributes;for(var k=u.length-1;k>=0;k--){if(u[k].key!==undefined){o=u[k].key;if(u[k].isSortable){m.unshift({"name":n.dataSourceName===u[k].name?n.dataSourceName:n.dataSourceName+" / "+u[k].name,"key":"titleColumn"+i,"originalKey":o,"selected":t.getProperty("/orderBy").orderBy===o});}}}m.unshift({"name":s.ushell.resources.i18n.getText("defaultRank"),"key":"ushellSearchDefaultSortItem","originalKey":"ushellSearchDefaultSortItem","selected":jQuery.isEmptyObject(t.getProperty("/orderBy"))});t.setProperty("/tableSortableColumns",m);}},_afterSearchPrepareResultList:function(e,f){var t=this;var i;var h=[];if(f){var _=t.getProperty("/boResults");for(i=0;i<_.length;i++){if(_[i].expanded||_[i].selected){h.push(_[i]);}}}t.setProperty("/boResults",[]);t.setProperty("/boCount",0);var k=new a();var n=k.format(e.getSearchResultSet(),this.query.filter.searchTerms);var l;for(i=0;i<n.length;i++){l=n[i];if(l.uri){l.titleNavigation=new d({href:l.uri});l.titleNavigationIsOldURL=true;}}for(i=0;i<n.length;i++){l=n[i];if(!l.navigationObjects){l.navigationObjects=[];}if(l.suvlink&&l.suvlink.value){var m=new d({text:l.suvlink.label,href:l.suvlink.value,target:"_blank"});l.navigationObjects.push(m);}}var o=new s.ushell.renderers.fiori2.search.SearchIntentsResolver(t);var q=o.resolveIntents(n);q.done(function(r){if(!t.isAllCategory()&&!t.isOtherCategory()&&!t.isAppCategory()){t._prepareTableResults(n);}if(h&&h.length>0){var R=t.sina.ResultElementKeyStatus;var u=[];for(i=0;i<n.length;i++){var l=n[i];if(l.keystatus===R.OK){for(var j=0;j<h.length;j++){var v=h[j];if(v.keystatus===R.OK&&v.key===l.key){l.selected=v.selected;l.expanded=v.expanded;h.splice(j,1);break;}}}else{u.push(l);}}if(u.length>0){var w=[];var x="";for(i=0;i<u.length;i++){var y=u[i].dataSource.key;if(jQuery.inArray(y,w)<0){w.push(y);x+=y+"\n";}}t.pushError({type:"warning",title:s.ushell.resources.i18n.getText("preserveFormerResultErrorTitle"),description:s.ushell.resources.i18n.getText("preserveFormerResultErrorDetails",x)});}}var z=t.getDataSource();if(z.getType().toLowerCase()==="businessobject"){var A=[];for(i=0;i<n.length;i++){var B=n[i];var C=B.semanticObjectType;if(!C){A=[];break;}if(jQuery.inArray(C,A)==-1){A.push(C);}}if(A.length==1){z.semanticObjectType=A[0];}else if(A.length>1){z.semanticObjectTypes=A;}}t.setProperty("/boCount",e.getSearchResultSet().totalcount);t.setProperty("/boResults",n);t.enableOrDisableMultiSelection();});return q;},resetAndDisableMultiSelection:function(){this.setProperty("/multiSelectionAvailable",false);this.setProperty("/multiSelectionEnabled",false);},enableOrDisableMultiSelection:function(){var e=this.getDataSource();var f=this.config.getDataSourceConfig(e);var h=new f.searchResultListSelectionHandlerControl();if(h){this.setProperty("/multiSelectionAvailable",h.isMultiSelectionAvailable());}else{this.setProperty("/multiSelectionAvailable",false);}},_endWith:function(e,f){return e.indexOf(f,e.length-f.length)!==-1;},calculatePlaceholder:function(){var t=this;if(t.isAllCategory()){return s.ushell.resources.i18n.getText("search");}else{return s.ushell.resources.i18n.getText("searchInPlaceholder",t.getDataSource().labelPlural);}},updateDataSourceList:function(n){var e=this.getProperty('/dataSources');while(e.length>0&&!e[0].equals(this.allDataSource)){e.shift();}if(n.equals(this.allDataSource)||n.equals(this.appDataSource)){return;}if(n&&n.key){if(n.key.indexOf('~')>=0){return;}}for(var i=0;i<e.length;++i){var f=e[i];if(f.equals(n)){return;}}e.unshift(n);this.setProperty('/dataSources',e);},invalidateQuery:function(){this.setProperty('/isQueryInvalidated',true);},autoStartApp:function(){var t=this;if(t.getProperty("/appCount")&&t.getProperty("/appCount")===1&&t.getProperty("/count")&&t.getProperty("/count")===1){var A=t.getProperty("/appResults");if(A&&A.length>0&&A[0]&&A[0].url&&t.getProperty('/uiFilter/searchTerms')&&A[0].tooltip&&t.getProperty('/uiFilter/searchTerms').toLowerCase().trim()===A[0].tooltip.toLowerCase().trim()){if(A[0].url[0]==='#'){window.location.href=A[0].url;}else{window.open(A[0].url,'_blank');}}}},getResultToDisplay:function(){return this.getProperty('/resultToDisplay');},setResultToDisplay:function(t){this.setProperty('/resultToDisplay',t);S.saveResultViewType(t);},calculateVisibility:function(){var t=this;if(t.isAppCategory()){t.setResultToDisplay("appSearchResult");t.setProperty('/displaySwitchVisibility',false);}else if(t.isAllCategory()||t.isOtherCategory()){t.setResultToDisplay("searchResultList");t.setProperty('/displaySwitchVisibility',false);}else{var r=t.getResultToDisplay();if(!(r==="searchResultList"||r==="searchResultTable")){t.setResultToDisplay("searchResultList");}t.setProperty('/displaySwitchVisibility',true);}},calculateSearchButtonStatus:function(){if(this.getDataSource().equals(this.getProperty('/defaultDataSource'))&&this.getSearchBoxTerm().length===0){this.setProperty('/searchButtonStatus','close');}else{this.setProperty('/searchButtonStatus','search');}},calculateResultList:function(){var t=this;var r=[];var e=t.getProperty('/boResults');if(e&&e.length){r.push.apply(r,e);}var f=t.getProperty('/appResults');if(f&&f.length>0){var h={type:'appcontainer',tiles:f};if(r.length>0){if(r.length>3){r.splice(3,0,h);}else{r.push(h);}}else{r=[h];}}s.ui.model.json.JSONModel.prototype.setProperty.apply(this,['/results',r]);},getDebugInfo:function(){var t=['\n'];if(this.serverInfo){t.push('Search Backend System:');t.push('System:'+this.serverInfo.systemid);t.push('Client:'+this.serverInfo.sapclient);t.push('');}t.push('See also Enterprise Search Setup Documentation:');t.push('http://help.sap.com/saphelp_uiaddon10/helpdata/en/57/7d77c891954c21a19c242694e83177/frameset.htm');return t.join('\n');},getErrors:function(){return this.getProperty('/errors');},cleanErrors:function(){this.setProperty('/errors',jQuery.grep(this.getProperty('/errors'),function(e){return e.keep;}));},pushError:function(e){var t=this;e.title=e.title==="[object Object]"?s.ushell.resources.i18n.getText('searchError'):e.title;var f=this.getProperty('/errors');f.push(e);t.setProperty('/errors',f);},isInaError:function(f){var i;try{i=jQuery.parseJSON(f.responseText);}catch(e){return false;}if(i&&i.Error){return i;}else{return false;}},normalSearchErrorHandling:function(e){var f=["ESH_FED_MSG016"];if(!e){return;}if(e.status===500){jQuery.sap.log.error(e.responseText);this.pushError({type:"error",title:e.statusText,description:e.responseText+this.getDebugInfo(),keep:e.keep});return;}var h=this.isInaError(e);if(h){var j=true;var k='';var l='';if(e.message){k+=e.message+' ';}if(h.Error){if(h.Error.Message){k+=''+h.Error.Message;}if(h.Error.Code){k+=' (Code '+h.Error.Code+').';}}if(h.ErrorDetails){l+='';for(var i=0;i<h.ErrorDetails.length;i++){l+=h.ErrorDetails[i].Message+' (Code '+h.ErrorDetails[i].Code+')';if(f.indexOf(h.ErrorDetails[i].Code)!==-1){j=false;}}}jQuery.sap.log.error(k+' Details: '+l);if(j){this.pushError({type:e.type||"error",title:k,description:l+this.getDebugInfo(),keep:e.keep});}return;}this.pushError({type:"error",title:e.toString(),description:e.toString()+this.getDebugInfo(),keep:e.keep});},createSearchURL:function(){var h="#Action-search";var u=this.getProperty('/uiFilter').getJson();h+="&/searchterm="+encodeURIComponent(u.searchTerms);h+="&datasource="+encodeURIComponent(JSON.stringify(u.dataSource));h+="&top="+this.getTop();h+="&filter="+encodeURIComponent(JSON.stringify(u.defaultConditionGroup));return h;},updateSearchURLSilently:function(){var h=this.createSearchURL();S.hasher.setHash(h);},deserializeURL:function(){if(S.getHashFromUrl().indexOf('#Action-search')!==0){return;}if(!S.hasher.hasChanged()){return;}var P=S.getUrlParameters();if($.isEmptyObject(P)){return;}var u={};if(P.searchterm){u.searchTerms=P.searchterm;}if(P.datasource){u.dataSource=JSON.parse(P.datasource);}else{this.resetDataSource(false);}if(P.top){var t=parseInt(P.top,10);this.setTop(t,false);}this.resetFilterConditions(false);if(P.filter){u.defaultConditionGroup=JSON.parse(P.filter);}this.getProperty("/uiFilter").setJson(u);if(u.dataSource&&u.dataSource.name&&u.dataSource.name==='Apps'){this.setDataSource(this.appDataSource,false);}this.calculateSearchButtonStatus();this._firePerspectiveQuery(true);}});})(window);
