(function(){"use strict";var d=function(o,a){var t=null;var b=function(){var c=arguments;var e=this;if(t){window.clearTimeout(t);}t=window.setTimeout(function(){t=null;o.apply(e,c);},a);};b.abort=function(){if(t){window.clearTimeout(t);}};return b;};sap.ui.core.Control.extend('sap.ushell.renderers.fiori2.search.controls.SearchResultMap',{metadata:{aggregations:{"_map":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}}},appId:"yPAjYBbnvu87r-bURAc-",appCode:"m3WAJo5rFmc5BG1IxJ3d2w",init:function(){var m={"MapProvider":[{"name":"HEREMAPS","type":"","description":"","tileX":"256","tileY":"256","maxLOD":"20","copyright":"Tiles Courtesy of HERE Maps","Source":[{"id":"s1","url":"http://1.maps.nlp.nokia.com/maptile/2.1/maptile/newest/normal.day/{LOD}/{X}/{Y}/256/png?app_code="+this.appCode+"&app_id="+this.appId},{"id":"s2","url":"http://2.maps.nlp.nokia.com/maptile/2.1/maptile/newest/normal.day/{LOD}/{X}/{Y}/256/png?app_code="+this.appCode+"&app_id="+this.appId}]}],"MapLayerStacks":[{"name":"DEFAULT","MapLayer":{"name":"layer1","refMapProvider":"HEREMAPS","opacity":"1.0","colBkgnd":"RGB(255,255,255)"}}]};var g=new sap.ui.vbm.GeoMap({legendVisible:false,scaleVisible:false,refMapLayerStack:'DEFAULT',mapConfiguration:m,width:'100%',height:'100%',zoomChanged:this.zoomChanged.bind(this),centerChanged:this.centerChanged.bind(this)});this.setAggregation('_map',g);this.loadObjects=d(this.loadObjects,500);},splitCoordinates:function(c){var a=c.split(';');return[parseFloat(a[0]),parseFloat(a[1])];},deg2rad:function(a){return Math.PI*a/180;},rad2deg:function(r){return 180*r/Math.PI;},mercator:function(p){var l=p[0];var a=p[1];var r=6378137.0;var m=this.deg2rad(l)*r;var b=Math.log(Math.tan(this.deg2rad((90+a)/2)))*r;return[m,b];},gps:function(p){var l=p[0];var a=p[1];var r=6378137.0;var g=this.rad2deg(l/r);var b=2*this.rad2deg(Math.atan(Math.exp(a/r)))-90;return[g,b];},createPolygonFromViewport:function(v){var u=this.mercator(this.splitCoordinates(v.upperLeft));var l=this.mercator(this.splitCoordinates(v.lowerRight));var p={"type":"Polygon","coordinates":[[]]};var a=p.coordinates[0];a.push(u,[l[0],u[1]],l,[u[0],l[1]],u);return p;},zoomChanged:function(e){},centerChanged:function(e){},loadObjects:function(f){var t=this;$.get('/geofacet?type=grid&filter='+encodeURIComponent(JSON.stringify(f))).then(function(r){r=JSON.parse(r);var s=[];for(var i=0;i<r.cities.length;++i){var c=r.cities[i];if(!c.name){continue;}var g=t.gps(c.location_3857.coordinates);var l=g[0];var a=g[1];var b=new sap.ui.vbm.Spot({position:l+';'+a+';0',text:c.name,type:(c.type==='single')?sap.ui.vbm.SemanticType.Default:sap.ui.vbm.SemanticType.Warning});s.push(b);}var e=new sap.ui.vbm.Spots({items:s});t.getAggregation('_map').removeAllVos();t.getAggregation('_map').addVo(e);});},renderer:function(r,c){r.write('<div ');r.writeControlData(c);r.addClass('sapUshellSearchResultMap');r.writeClasses();r.write('>');r.renderControl(c.getAggregation('_map'));r.write('</div>');}});})();
