// @copyright@
sap.ui.define(["sap/ushell/services/_CommonDataModel/PersonalizationProcessor","sap/ushell/services/ClientSideTargetResolution"],function(P,C){"use strict";function a(A,c,p,s){var t=this,S=new jQuery.Deferred();function f(m){S.reject(m);}this._oAdapter=A;this._oPersonalizationProcessor=new P();this._oSitePromise=S.promise();A.getSite().done(function(o){t._oOriginalSite=jQuery.extend(true,{},o);A.getPersonalization().done(function(b){t._oPersonalizationProcessor.mixinPersonalization(o,b).done(function(d){t._oPersonalizedSite=d;S.resolve(t._oPersonalizedSite);}).fail(f);}).fail(f);}).fail(f);}a.prototype.getHomepageGroups=function(){var d=new jQuery.Deferred();this._oSitePromise.then(function(s){var g=(s&&s.site&&s.site.payload&&s.site.payload.groupsOrder)?s.site.payload.groupsOrder:[];d.resolve(g);});return d.promise();};a.prototype.getGroups=function(){var d=new jQuery.Deferred();this._oSitePromise.then(function(s){var g=[];Object.keys(s.groups).forEach(function(k){g.push(s.groups[k]);});d.resolve(g);});return d.promise();};a.prototype.getGroup=function(i){var d=new jQuery.Deferred();this._oSitePromise.then(function(s){var g=s.groups[i];if(g){d.resolve(g);}else{d.reject("Group "+i+" not found");}});return d.promise();};a.prototype.getSite=function(){return this._oSitePromise;};a.prototype.getGroupFromOriginalSite=function(g){var d=new jQuery.Deferred();if(typeof g==="string"&&this._oOriginalSite&&this._oOriginalSite.groups&&this._oOriginalSite.groups[g]){d.resolve(jQuery.extend(true,{},this._oOriginalSite.groups[g]));}else{d.reject("Group does not exist in original site.");}return d.promise();};a.prototype.save=function(){var d=new jQuery.Deferred(),t=this;this._oPersonalizationProcessor.extractPersonalization(this._oPersonalizedSite,this._oOriginalSite).done(function(e){if(e){t._oAdapter._storePersonalizationData(e).done(function(){d.resolve();}).fail(function(m){d.reject(m);});}else{d.resolve();}});return d.promise();};a.hasNoAdapter=false;return a;},true);
