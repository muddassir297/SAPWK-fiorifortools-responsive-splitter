/* SAP APF Analysis Path Framework
* 
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
jQuery.sap.declare("sap.apf.ui.representations.treeTable");jQuery.sap.require("sap.apf.core.constants");jQuery.sap.require("sap.apf.ui.utils.formatter");jQuery.sap.require("sap.apf.ui.representations.BaseUI5ChartRepresentation");(function(){'use strict';var t;function _(T,s,o){var f=new sap.apf.ui.utils.formatter({getEventCallback:o.oApi.getEventCallback.bind(o.oApi),getTextNotHtmlEncoded:o.oApi.getTextNotHtmlEncoded},o.metadata,o.aDataResponse);var c=function(g){return function(h){if(o.metadata!==undefined){var i;if(h){i=f.getFormattedValue(g,h);if(i!==undefined){return i;}}}return h;};};t=new sap.ui.table.TreeTable({showNoData:false,title:s,enableSelectAll:false,selectionMode:sap.ui.table.SelectionMode.None});var C=[],d,e;T.name.forEach(function(g,n){d=new sap.m.Text().bindText(T.value[n],c(T.value[n]),sap.ui.model.BindingMode.OneWay);e=new sap.ui.table.Column({label:new sap.m.Label({text:g}),template:d,tooltip:g});C.push(e);});C.forEach(function(g){t.addColumn(g);});o.oTreeTableModel.attachBatchRequestCompleted(function(){a();if(t.getParent().getParent()){t.getParent().getParent().getParent().getParent().setBusy(false);}});t.setModel(o.oTreeTableModel);t.bindRows(o.oTreeTableControlObject);return t;}function a(){var c;if(jQuery('.layoutView').height()){c=jQuery('.chartContainer').height()-(jQuery(".chartContainer > div :first-child").height()+120);}var v=(c>0)?c/32:15;var n=Math.floor(v);t.setVisibleRowCount(n);}function b(T){var c={name:[],value:[]};var p=T.oParameters.hierarchicalProperty.concat(T.oParameters.properties);p.forEach(function(d,i){var e=T.metadata.getPropertyMetadata(d.fieldName).label||T.metadata.getPropertyMetadata(d.fieldName).name;c.name[i]=d.fieldDesc===undefined||!T.oApi.getTextNotHtmlEncoded(d.fieldDesc).length?e:T.oApi.getTextNotHtmlEncoded(d.fieldDesc);c.value[i]=d.fieldName;if(d.fieldDesc){c.name[i]=T.oApi.getTextNotHtmlEncoded(d.fieldDesc);}});return c;}sap.apf.ui.representations.treeTable=function(A,p){this.oParameters=p;this.type=sap.apf.ui.utils.CONSTANTS.representationTypes.TREE_TABLE_REPRESENTATION;sap.apf.ui.representations.BaseUI5ChartRepresentation.apply(this,[A,p]);};sap.apf.ui.representations.treeTable.prototype=Object.create(sap.apf.ui.representations.BaseUI5ChartRepresentation.prototype);sap.apf.ui.representations.treeTable.prototype.constructor=sap.apf.ui.representations.treeTable;sap.apf.ui.representations.treeTable.prototype.getMainContent=function(s,i){if(!i){var T=b(this);t=_(T,s,this);t.addEventDelegate({onAfterRendering:function(){a();}});}var c=new sap.m.ScrollContainer({content:[t],horizontal:false}).addStyleClass("treeTableRepresentation");c.addStyleClass("sapUiSizeCompact");return c;};sap.apf.ui.representations.treeTable.prototype.updateTreetable=function(c,m,u,M){this.oTreeTableModel=m;this.oTreeTableControlObject=c;this.metadata=M;u();};sap.apf.ui.representations.treeTable.prototype.getThumbnailContent=function(){var T;var o=new sap.ui.core.Icon({src:"sap-icon://tree",size:"70px"}).addStyleClass('thumbnailTableImage');T=o;return T;};sap.apf.ui.representations.treeTable.prototype.getPrintContent=function(s){var T=t.clone();var p={oRepresentation:T};return p;};sap.apf.ui.representations.treeTable.prototype.destroy=function(){if(this.oParameters){this.oParameters=null;}if(this.oTreeTableModel){this.oTreeTableModel=null;}if(this.oTreeTableControlObject){this.oTreeTableControlObject=null;}if(this.metadata){this.metadata=null;}};}());
