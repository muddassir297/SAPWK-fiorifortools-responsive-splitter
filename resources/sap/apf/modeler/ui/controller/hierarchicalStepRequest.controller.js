/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.apf.modeler.ui.utils.textManipulator");sap.ui.define(["sap/apf/modeler/ui/controller/stepRequest.controller"],function(B){"use strict";var t=new sap.apf.modeler.ui.utils.TextManipulator();var o=new sap.apf.modeler.ui.utils.OptionsValueModelBuilder();var n=new sap.apf.modeler.ui.utils.NullObjectChecker();return B.extend("sap.apf.modeler.ui.controller.hierarchicalStepRequest",{onBeforeRendering:function(){var c=this;c.byId("idOptionalPropertyLabel").setVisible(true);c.byId("idOptionalProperty").setVisible(true);},setDisplayText:function(){var c=this;var T=c.getView().getViewData().oTextReader;c.byId("idSourceLabel").setText(T("source"));c.byId("idEntityLabel").setText(T("hierarchicalEntity"));c.byId("idOptionalPropertyLabel").setText(T("hierarchicalProperty"));c.byId("idSelectPropertiesLabel").setText(T("nonHierarchicalProperty"));c.byId("idOptionalRequestFieldLabel").setText(T("requiredFilters"));},setOptionalHierarchicalProperty:function(){var c=this;var d=jQuery.Deferred();var m,s,h,v;s=c.byId("idSource").getValue();h=c.byId("idEntity").getSelectedKey();c.byId("idOptionalProperty").setModel(null);c.byId("idOptionalProperty").clearSelection();if(!n.checkIsNotNullOrUndefinedOrBlank(s)){d.resolve();return d.promise();}c.getHierarchicalProperty(s,h).done(function(a){var S=c.getSelectedHierarchicalProperty();if(n.checkIsNotNullOrUndefinedOrBlank(S)){v=c.validateSelectedValues(c,[S],a);a=v.aValues;S=v.aSelectedValues[0];}m=o.convert(a);c.byId("idOptionalProperty").setModel(m);if(!n.checkIsNotNullOrUndefinedOrBlank(S)||a.indexOf(S)===-1){c.getHierarchicalProperty(s,h).done(function(b){S=b[0];if(n.checkIsNotNullOrUndefinedOrBlank(S)){c.byId("idOptionalProperty").setSelectedKey(S);}d.resolve();});}else if(n.checkIsNotNullOrUndefinedOrBlank(S)){c.byId("idOptionalProperty").setSelectedKey(S);d.resolve();}});return d.promise();},addOrRemoveMandatoryFieldsAndRequiredFlag:function(r){var c=this;if(r===false){return;}c.byId("idSourceLabel").setRequired(r);c.byId("idEntityLabel").setRequired(r);c.byId("idOptionalPropertyLabel").setRequired(r);c.viewValidator.addFields(["idSource","idEntity","idOptionalProperty"]);},handleChangeForOptionalHierarchicalProperty:function(e){var c=this;var h=[t.removePrefixText(c.byId("idOptionalProperty").getSelectedKey(),sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE)];c.updateHierarchicalProperty(h);c.oConfigurationEditor.setIsUnsaved();c.fireRelevantEvents(e);},getAllEntitiesAsPromise:function(s){var c=this;return c.oConfigurationEditor.getAllHierarchicalEntitySetsOfServiceAsPromise(s);},getHierarchicalProperty:function(s,e){var c=this;return c.oConfigurationEditor.getHierarchicalPropertiesOfEntitySetAsPromise(s,e);},getSelectedHierarchicalProperty:function(){var c=this;return c.oParentObject.getHierarchyProperty();},getAllEntitySetPropertiesAsPromise:function(s,e){var c=this;return c.oConfigurationEditor.getNonHierarchicalPropertiesOfEntitySet(s,e);},resetEntityAndProperties:function(){var c=this;c.clearEntity();c.byId("idEntity").setModel(null);c.byId("idEntity").setSelectedKey(undefined);c.clearHierarchicalEntity();c.byId("idOptionalProperty").setModel(null);c.byId("idOptionalProperty").setSelectedKey(undefined);c.clearSelectProperties();c.byId("idSelectProperties").setModel(null);c.byId("idSelectProperties").setSelectedKeys([]);},clearHierarchicalEntity:function(){var c=this;c.oParentObject.setHierarchyProperty(undefined);},updateHierarchicalProperty:function(h){var c=this;c.clearHierarchicalEntity();c.oParentObject.setHierarchyProperty(h);}});});
