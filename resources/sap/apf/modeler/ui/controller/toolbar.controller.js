/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
(function(){'use strict';sap.ui.controller("sap.apf.modeler.ui.controller.toolbar",{onInit:function(){this.oCoreApi=this.getView().getViewData().oConfigListInstance.oCoreApi;this.oConfigListInstance=this.getView().getViewData().oConfigListInstance;this._setDisplayText();},_setDisplayText:function(){this.byId("idAddButton").setText(this.oCoreApi.getText("addButton"));this.byId("idCopyButton").setText(this.oCoreApi.getText("copyButton"));this.byId("idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));this.byId("idMoveUp").setTooltip(this.oCoreApi.getText("moveUp"));this.byId("idMoveDown").setTooltip(this.oCoreApi.getText("moveDown"));},enableCopyDeleteButton:function(){if(!this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(true);}if(!this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(true);}},disableCopyDeleteButton:function(){if(this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(false);}if(this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(false);}},_setAddMenuText:function(){sap.ui.core.Fragment.byId("idAddMenuFragment","idNewConfig").setText(this.oCoreApi.getText("newConfiguration"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewFacetFilter").setText(this.oCoreApi.getText("newFacetFilter"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewCategory").setText(this.oCoreApi.getText("newCategory"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewNavigationTarget").setText(this.oCoreApi.getText("newNavigationTarget"));sap.ui.core.Fragment.byId("idAddMenuFragment","idStep").setText(this.oCoreApi.getText("step"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewStep").setText(this.oCoreApi.getText("newStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idExistingStep").setText(this.oCoreApi.getText("existingStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idHierarchicalStep").setText(this.oCoreApi.getText("hierarchicalStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewRepresentation").setText(this.oCoreApi.getText("newRepresentation"));},_setExistingStepDialogText:function(){sap.ui.core.Fragment.byId("idExistingStepDialogFragment","idExistingStepDialog").setTitle(this.oCoreApi.getText("existingStepDialogTitle"));},_enableDisableAddMenuItems:function(s,a){var f;var A=a.getItems();var n,m={};if(this.oConfigListInstance.configEditor){f=Object.keys(this.oConfigListInstance.configEditor.getFilterOption())[0];}if(this.oConfigListInstance.configurationHandler.getList().length===0||s===null){n="default";}else{n=s.nodeObjectType;}m["default"]=1;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]=4;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER]=4;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR]=4;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]=5;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]=6;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION]=6;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET]=4;A.forEach(function(M,i){if(i<m[n]){M.setEnabled(true);if(f!==sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER&&i===1){M.setEnabled(false);}}else{M.setEnabled(false);}});},_handlePressAddButton:function(e){var s;var S=this,i=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){s=(typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;}e.getSource().$().blur();var n=sap.apf.modeler.ui.utils.navigationHandler.getInstance();if(s!==undefined){i=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}var c=this.oConfigListInstance.configEditor?jQuery.extend(true,{},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=c?c.isSaved():undefined;var a=false;var o=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());var A=e.getSource();var b=function(){if(!this.addMenu){this.addMenu=new sap.ui.xmlfragment("idAddMenuFragment","sap.apf.modeler.ui.fragment.addMenu",this);this.getView().addDependent(this.addMenu);this._setAddMenuText();}var d=sap.ui.core.Popup.Dock;this._enableDisableAddMenuItems(o,this.addMenu);this.addMenu.open(false,A,d.BeginTop,d.BeginBottom,A);};if(!i){n.throwMandatoryPopup(S.oConfigListInstance,{yes:function(){var p=S.oConfigListInstance.oTreeInstance.getParentNodeContext(o);S.oConfigListInstance.configEditor=S.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(p.configId);if(S.oConfigListInstance.bIsSaved===false&&S.oConfigListInstance.configEditor){S.oConfigListInstance.configEditor.setIsUnsaved();}var N=S.oConfigListInstance._navMandatoryResetState(S.oConfigListInstance);if(!N.isNewView){b.call(S);}}});a=true;}if(!a){b.call(S);}},_handleAddMenuItemPress:function(e){var i=this.addMenu.getItems();var a=e.getParameters("item");var n;var N={"idAddMenuFragment--idNewFacetFilter":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER,"idAddMenuFragment--idNewCategory":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY,"idAddMenuFragment--idNewStep":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP,"idAddMenuFragment--idHierarchicalStep":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP,"idAddMenuFragment--idNewRepresentation":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION,"idAddMenuFragment--idNewConfig":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION,"idAddMenuFragment--idNewNavigationTarget":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET,"default":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION};i.forEach(function(o){if(o.getId()===a.id){n=N[o.getId()];}else if(o.getSubmenu()){o.getSubmenu().getItems().forEach(function(o){if(o.getId()===a.id){n=N[o.getId()];}});}});var I=false;if(a.id==="idAddMenuFragment--idExistingStep"){this._handleAddExistingStepPress();}else if(a.id!=="idAddMenuFragment--idStep"&&n!==undefined){if(a.id==="idAddMenuFragment--idHierarchicalStep"){I=true;}this.oConfigListInstance.oTreeInstance.addNodeInTree(n,undefined,I);}},_copyConfiguration:function(c,n){var C=this.oConfigListInstance.configurationHandler.getConfiguration(c);var o={},a;o.AnalyticalConfiguration=C.AnalyticalConfiguration;o.name="< "+C.AnalyticalConfigurationName+" >";o.Application=C.Application;o.type=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION;o.bIsLoaded=false;o.bToggleState=false;o.isSelected=true;o.expanded=true;o.selectable=true;o.hasExpander=true;this.oConfigListInstance.oModel.getData().aConfigDetails.push(o);this.oConfigListInstance.oModel.updateBindings();a=this.oConfigListInstance.oTreeInstance.getModel().getContext(n);this.oConfigListInstance.selectedNode=this.oConfigListInstance.oTreeInstance.getNodeByContext(a);this.oConfigListInstance.modelUpdateDeferred[this.oConfigListInstance.oModel.getData().aConfigDetails.length-1]=new jQuery.Deferred();var b={appId:this.oConfigListInstance.appId,configId:c};sap.ui.core.UIComponent.getRouterFor(this.oConfigListInstance).navTo(o.type,b,true);},_handlePressCopyButton:function(e){var s,a;var S=this,b=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){s=(typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;}e.getSource().$().blur();var n=sap.apf.modeler.ui.utils.navigationHandler.getInstance();if(s!==undefined){b=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}var c=this.oConfigListInstance.configEditor?jQuery.extend(true,{},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=c?c.isSaved():undefined;var d=false;var f=function(){var C=this;var N;var k=this.oTreeInstance.getAPFTreeNodeContext(this.oTreeInstance.getSelection()||this.selectedNode);this.selectedNode=this.oTreeInstance.getSelection()||this.selectedNode;var l,m,p,q,O,r,t,u,v,w;p=k.nodeContext;switch(k.nodeObjectType){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:var F=this.oCoreApi.getText("copyOf")+"  "+k.nodeTitle;var x=this.configEditor.copyFacetFilter(k.nodeAPFId);var y=this.configEditor.getFacetFilter(x);var T=sap.apf.modeler.ui.utils.TranslationFormatMap.FACETFILTER_LABEL;this.oTextPool.setTextAsPromise(F,T).done(function(i){y.setLabelKey(i);O=p.split("/");a=O[2];r=O[6];var j=this.oModel.getData().aConfigDetails[a].configData[0].filters[r];j.isSelected=false;var f1=jQuery.extend(true,{},j);f1.id=x;f1.name="< "+F+" >";f1.isSelected=true;q=this.oModel.getData().aConfigDetails[a].configData[0].filters.length;this.oModel.getData().aConfigDetails[a].configData[0].filters.push(f1);O[6]=q;m=O.join("/");}.bind(this));break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:var z=this.oCoreApi.getText("copyOf")+"  "+k.nodeTitle;var A=this.configEditor.copyCategory(k.nodeAPFId);var B=sap.apf.modeler.ui.utils.TranslationFormatMap.CATEGORY_TITLE;this.oTextPool.setTextAsPromise(z,B).done(function(f1){var g1={labelKey:f1};this.configEditor.setCategory(g1,A);O=p.split("/");a=O[2];t=O[6];var h1=[];var i1=this.configEditor.getSteps();i1.forEach(function(m1){if(C.configEditor.getCategoriesForStep(m1.getId())[0]===A){h1.push(m1.getId());}});var j1=this.oModel.getData().aConfigDetails[a].configData[1].categories[t];j1.isSelected=false;var k1=jQuery.extend(true,{},j1);if(k1.steps){for(var i=0;i<k1.steps.length;i++){k1.steps[i].id=h1[i];var l1=C.configEditor.getStep(h1[i]);N=l1.getRepresentations();if(k1.steps[i].representations){for(var j=0;j<k1.steps[i].representations.length;j++){k1.steps[i].representations[j].id=N[j].getId();}}}}k1.id=A;k1.name="< "+z+" >";k1.isSelected=true;q=this.oModel.getData().aConfigDetails[a].configData[1].categories.length;this.oModel.getData().aConfigDetails[a].configData[1].categories.push(k1);O[6]=q;m=O.join("/");}.bind(this));break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:var D=this.oCoreApi.getText("copyOf")+"  "+k.nodeTitle;var E=this.configEditor.copyNavigationTarget(k.nodeAPFId);O=p.split("/");a=O[2];u=O[6];var G=this.oModel.getData().aConfigDetails[a].configData[2].navTargets[u];G.isSelected=false;var H=jQuery.extend(true,{},G);H.id=E;H.name="< "+D+" >";H.isSelected=true;q=this.oModel.getData().aConfigDetails[a].configData[2].navTargets.length;this.oModel.getData().aConfigDetails[a].configData[2].navTargets.push(H);O[6]=q;m=O.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:var I=this.oCoreApi.getText("copyOf")+"  "+k.nodeTitle;var J=this.configEditor.copyStep(k.nodeAPFId);var K=this.configEditor.getCategoriesForStep(J);var L=this.configEditor.getStep(J);var M=sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_TITLE;this.oTextPool.setTextAsPromise(I,M).done(function(i){var j;L.setTitleId(i);O=p.split("/");a=O[2];t=O[6];v=O[8];var f1=this.oModel.getData().aConfigDetails[a].configData[1].categories[t].steps[v];f1.isSelected=false;var g1=jQuery.extend(true,{},f1);N=L.getRepresentations();g1.id=J;g1.name="< "+I+" >";if(g1.representations){for(j=0;j<g1.representations.length;j++){g1.representations[j].id=N[j].getId();}}q=this.oModel.getData().aConfigDetails[a].configData[1].categories[t].steps.length;O[8]=q;m=O.join("/");for(var h1=0;h1<K.length;h1++){var i1=jQuery.extend(true,{},g1);var j1={arguments:{configId:S.oConfigListInstance.configId,categoryId:K[h1]}};var k1=S.oConfigListInstance.getSPathFromURL(j1).sPath.split("/");var l1=k1[6];this.oModel.getData().aConfigDetails[a].configData[1].categories[l1].steps.push(i1);}this.oModel.getData().aConfigDetails[a].configData[1].categories[t].steps[q].isSelected=true;}.bind(this));break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:O=p.split("/");a=O[2];t=O[6];v=O[8];w=O[10];var P=this.oModel.getData().aConfigDetails[a].configData[1].categories[t].steps[v].id;var Q=this.configEditor.getStep(P);var R=this.configEditor.getCategoriesForStep(P);this.oModel.getData().aConfigDetails[a].configData[1].categories[t].steps[v].representations[w].isSelected=false;var U=this.oModel.getData().aConfigDetails[a].configData[1].categories[t].steps[v].representations[w];var V=jQuery.extend(true,{},U);var W=Q.copyRepresentation(V.id);V.id=W;q=this.oModel.getData().aConfigDetails[a].configData[1].categories[t].steps[v].representations.length;O[10]=q;m=O.join("/");for(var X=0;X<R.length;X++){var Y=jQuery.extend(true,{},V);var Z={arguments:{configId:S.oConfigListInstance.configId,categoryId:R[X],stepId:P}};var $=S.oConfigListInstance.getSPathFromURL(Z).sPath.split("/");var _=$[6];var a1=$[8];this.oModel.getData().aConfigDetails[a].configData[1].categories[_].steps[a1].representations.push(Y);}this.oModel.getData().aConfigDetails[a].configData[1].categories[t].steps[v].representations[q].isSelected=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:var b1=this.oCoreApi.getText("copyOf")+"  "+k.nodeTitle;O=p.split("/");a=O[2];var c1=this.oModel.getData().aConfigDetails[a];c1.isSelected=false;O[2]=this.oModel.getData().aConfigDetails.length;m=O.join("/");this.configurationHandler.copyConfiguration(k.nodeAPFId,function(i){var j={AnalyticalConfigurationName:b1};var f1=C.configurationHandler.setConfiguration(j,i);C.configTitle=b1;C.configurationHandler.loadConfiguration(f1,function(g1){var b1=C.configTitle;var h1=sap.apf.modeler.ui.utils.TranslationFormatMap.APPLICATION_TITLE;C.configurationHandler.getTextPool().setTextAsPromise(b1,h1).done(function(i1){g1.setApplicationTitle(i1);});});S._copyConfiguration(i,m);});break;default:break;}if(k.nodeObjectType!==sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION){this.oModel.updateBindings();l=this.oTreeInstance.getModel().getContext(m);this.selectedNode=this.oTreeInstance.getNodeByContext(l);var d1=this.oTreeInstance.getAPFTreeNodeContext(this.selectedNode);var e1=this.oTreeInstance.getParentNodeContext(d1);this.navigateToDifferntView(e1,d1);this.configEditor.setIsUnsaved();}};var g=function(){var i=new sap.m.Label().addStyleClass("noConfigSelected");i.setText(S.oConfigListInstance.oCoreApi.getText("noConfigSelected"));i.placeAt(S.oConfigListInstance.byId("idConfigDetailData"));S.oConfigListInstance.toolbarController.disableCopyDeleteButton();S.oConfigListInstance._enableDisableExportAndExecuteButton();};var o;if(!b){n.throwMandatoryPopup(S.oConfigListInstance,{yes:function(){var i=S.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(S.oConfigListInstance.oTreeInstance.getSelection());var p=S.oConfigListInstance.oTreeInstance.getParentNodeContext(i);S.oConfigListInstance.bIsDifferntConfig=S.oConfigListInstance.oTreeInstance.isConfigurationSwitched(S.oConfigListInstance.oPreviousSelectedNode,S.oConfigListInstance.selectedNode);S.oConfigListInstance.configEditor=S.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(p.configId);if(S.oConfigListInstance.bIsSaved===false&&S.oConfigListInstance.configEditor){S.oConfigListInstance.configEditor.setIsUnsaved();}if(S.oConfigListInstance.bIsDifferntConfig===false){var s=(typeof S.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?S.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var j=S.oConfigListInstance._isNewSubView(s.getView().getViewData().oParams);if(!j){f.call(S.oConfigListInstance);S.oConfigListInstance._navHandleExpandDelete.call(S.oConfigListInstance,S.oConfigListInstance.oSelectedNodeDetails,p);}else{S.oConfigListInstance.handleConfirmDeletion();}}else{var N=S.oConfigListInstance._navMandatoryResetState(S.oConfigListInstance);if(!N.isNewView){if(N.bIsSaved===false){o(S.oConfigListInstance);}else{f.call(S.oConfigListInstance);}}}}});d=true;}var h;if(s.getView().getViewData().oParams.name==="configuration"){h=true;}o=function(i){n.throwLossOfDataPopup(i,{yes:function(j){S.oConfigListInstance._navSaveState(function(){j(function(k){if(S.oConfigListInstance.selectedNode){var B=S.oConfigListInstance.selectedNode.getBindingContext().sPath;var C=B.split("/");var a=C[2];}S.oConfigListInstance.oModel.getData().aConfigDetails[a].AnalyticalConfiguration=S.oConfigListInstance.configId;S.oConfigListInstance.oModel.updateBindings();f.call(S.oConfigListInstance);});});},no:function(){var i={appId:S.oConfigListInstance.appId,configId:S.oConfigListInstance.configId};var s=(typeof S.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?S.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var h=(s.getView().getViewData().oParams.name==="configuration")?true:false;if(S.oConfigListInstance.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){S.oConfigListInstance._navHandleExpandDelete.call(S.oConfigListInstance,{},i,h);S.oConfigListInstance.clearTitleAndBreadCrumb();S.oConfigListInstance.byId("idConfigDetailData").removeAllContent();g();}else{S.oConfigListInstance._navConfigResetState(S.oConfigListInstance,function(){f.call(S.oConfigListInstance);});}}});};if(S.oConfigListInstance.bIsSaved===false&&b&&h){o(S.oConfigListInstance);d=true;}if(!d){f.call(S.oConfigListInstance);}},_handlePressDeleteButton:function(e){var d;var s=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());var n=this.oCoreApi.getText(s.nodeObjectType);e.getSource().$().blur();if(s.nodeObjectType===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP){d=this.oCoreApi.getText("confirmStepDeletion",[s.nodeTitle]);}else{d=this.oCoreApi.getText("confirmDeletion",[n,s.nodeTitle]);}this._openDeleteConfirmationDialog(d);},_openDeleteConfirmationDialog:function(d){var s=this;var c=jQuery.extend(s.oConfigListInstance,{closeDialog:s.closeDialog.bind(s)});if(!this.confirmationDialog){this.confirmationDialog=sap.ui.xmlfragment("idConfigConfirmationDialogFragment","sap.apf.modeler.ui.fragment.deleteConfirmationDialog",c);this.getView().addDependent(this.confirmationDialog);this._setConfirmationDialogText();}var a=new sap.m.Label();a.addStyleClass("dialogText");a.setText(d);this.confirmationDialog.removeAllContent();this.confirmationDialog.addContent(a);jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this.confirmationDialog);this.confirmationDialog.open();},closeDialog:function(){if(this.confirmationDialog&&this.confirmationDialog.isOpen()){this.confirmationDialog.close();}},_setConfirmationDialogText:function(){sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idDeleteConfirmation").setTitle(this.oCoreApi.getText("confirmation"));sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idCancelButtonDialog").setText(this.oCoreApi.getText("cancel"));},_handlePressMoveUpButton:function(){this.bIsDown=false;var s=this.oConfigListInstance.oTreeInstance.getSelection();if(s!==null){var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(s);if(a!==undefined){this._moveUpOrDown(a,this.bIsDown);}}},_handlePressMoveDownButton:function(){this.bIsDown=true;var s=this.oConfigListInstance.oTreeInstance.getSelection();if(s!==null){var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(s);if(a!==undefined){this._moveUpOrDown(a,this.bIsDown);}}},_moveUpOrDown:function(s,i){var a=s.nodeObjectType;var b=s.nodeAPFId;var n=s.nodeContext;var c=n.split('/')[2];var o,d,t,T,l;var S=false;var e=n.split('/')[n.split('/').length-1];switch(a){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:o=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[0].filters;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(b,-1);d=parseInt(e,10)-1;S=true;}}break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:o=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[1].categories;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(b,-1);d=parseInt(e,10)-1;S=true;}}break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:o=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[2].navTargets;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(b,-1);d=parseInt(e,10)-1;S=true;}}break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:var f=n.split('/')[6];var g=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[1].categories[f];o=g.steps;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(g.id,b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(g.id,b,-1);d=parseInt(e,10)-1;S=true;}}break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:var h=this.oConfigListInstance.oTreeInstance.getSelection();var j=sap.ui.getCore().byId(h.getId());var k=j.getParent();var m=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(k).nodeAPFId;var p=this.oConfigListInstance.configEditor.getStep(m);f=n.split('/')[6];var q=n.split('/')[8];o=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[1].categories[f].steps[q].representations;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){p.moveRepresentationUpOrDown(b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){p.moveRepresentationUpOrDown(b,-1);d=parseInt(e,10)-1;S=true;}}break;default:break;}if(S){t=o[e];T=o[d];o[d]=t;o[e]=T;this.oConfigListInstance.oModel.updateBindings();this.oConfigListInstance.configEditor.setIsUnsaved();}},_handleAddExistingStepPress:function(){var s=this;var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());var c=this.oConfigListInstance.oTreeInstance.getParentNodeContext(a).categoryId;var S=this.oConfigListInstance.configEditor.getStepsNotAssignedToCategory(c);var b;var d=[];S.forEach(function(e){var o={};var f=s.oConfigListInstance.configEditor.getStep(e);b=s.oConfigListInstance.oTextPool.get(f.getTitleId()).TextElementDescription;o.id=e;o.name=b;d.push(o);});var m=new sap.ui.model.json.JSONModel({existingStepData:d});if(!this.addExistingStepDialog){this.addExistingStepDialog=sap.ui.xmlfragment("idExistingStepDialogFragment","sap.apf.modeler.ui.fragment.existingStepDialog",this);this._setExistingStepDialogText();}this.getView().addDependent(this.addExistingStepDialog);this.addExistingStepDialog.setModel(m);this.addExistingStepDialog.open();},_handleExistingStepDialogOK:function(e){var n=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP;var s=e.getParameters("listItem").selectedItems;var a=s.length;var b=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());var c=this.oConfigListInstance.oTreeInstance.getParentNodeContext(b).categoryId;var E=[];for(var i=0;i<a;i++){var p=e.getParameters("selectedItems").selectedContexts[i].sPath.split('/')[2];var o=e.getSource().getModel().getData().existingStepData[p];var d=this.oConfigListInstance.configEditor.getStep(o.id);this.oConfigListInstance.configEditor.addCategoryStepAssignment(c,o.id);var r=d.getRepresentations();var f=r.length;var R=[];for(var j=0;j<f;j++){var g={};g.id=r[j].getId();g.name=r[j].getRepresentationType();g.icon=this._getRepresentationIcon(g.name);R.push(g);}var S={};S.step=o;S.representations=R;S.noOfReps=f;E.push(S);}if(a!==0){var h={noOfSteps:a,aExistingStepsToBeAdded:E};this.oConfigListInstance.oTreeInstance.addNodeInTree(n,h);}},_getRepresentationIcon:function(r){var i;var R=this.oCoreApi.getRepresentationTypes();for(var a=0;a<R.length;a++){if(r===R[a].id){i=R[a].picture;break;}}return i;},_handleExistingStepDialogSearch:function(e){var v=e.getParameter("value");var f=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,v);var b=e.getSource().getBinding("items");b.filter([f]);},_handleExistingStepDialogClose:function(e){if(this.addExistingStepDialog){e.getSource().getBinding("items").filter([]);}}});}());
