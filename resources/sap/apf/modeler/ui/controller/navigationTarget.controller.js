jQuery.sap.require("sap.apf.modeler.ui.utils.nullObjectChecker");jQuery.sap.require("sap.apf.modeler.ui.utils.viewValidator");jQuery.sap.require("sap.apf.modeler.ui.utils.staticValuesBuilder");jQuery.sap.require("sap.apf.modeler.ui.utils.optionsValueModelBuilder");(function(){"use strict";var p,t,T,c,C,n,v,N;var a=new sap.apf.modeler.ui.utils.NullObjectChecker();var o=new sap.apf.modeler.ui.utils.OptionsValueModelBuilder();function _(i){i.byId("idNavigationTargetHeaderLabel").setText(t("basicData"));i.byId("idSemanticObjectLabel").setText(t("semanticObject"));i.byId("idActionLabel").setText(t("action"));i.byId("idDescriptionLabel").setText(t("navigationTargetTitle"));i.byId("idNavigationTargetTypeHeaderLabel").setText(t("navigationTargetType"));i.byId("idNavigationTargetTypeLabel").setText(t("assignmentType"));i.byId("idAssignedStepsLabel").setText(t("assignedSteps"));i.byId("idContextMapping").setText(t("contextMapping"));}function b(i){var w;if(p&&p.arguments&&p.arguments.navTargetId){n=C.getNavigationTarget(p.arguments.navTargetId);}if(!a.checkIsNotUndefined(n)){w=C.createNavigationTarget();n=C.getNavigationTarget(w);l(i);}}function d(i){var w,x;var V={oTextReader:t,oConfigurationHandler:c,oConfigurationEditor:C,oParentObject:n,getCalatogServiceUri:i.getView().getViewData().getCalatogServiceUri};w=new sap.ui.controller("sap.apf.modeler.ui.controller.navTargetContextMapping");x=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.requestOptions",type:sap.ui.core.mvc.ViewType.XML,id:i.createId("idContextMappingView"),viewData:V,controller:w});i.getView().attachEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.UPDATESUBVIEWINSTANCESONRESET,x.getController().updateSubViewInstancesOnReset.bind(x.getController()));x.addStyleClass("formTopPadding");i.byId("idContextMappingVBox").insertItem(x);}function e(i){var P=jQuery.Deferred();N.getAllAvailableSemanticObjects(function(w,x){if(x===undefined){var M=o.prepareModel(w,w.length);i.byId("idSemanticObjectField").setModel(M);if(a.checkIsNotNullOrUndefinedOrBlank(n.getSemanticObject())){i.byId("idSemanticObjectField").setValue(n.getSemanticObject());}P.resolve();}else{s(i,x,"11504");}});return P.promise();}function f(i){var M,P;P=jQuery.Deferred();M=o.prepareModel([],0);i.byId("idActionField").setModel(M);h(undefined,i);g(i).then(function(S){P.resolve(S);});i.byId("idActionField").setValue(n.getAction());return P.promise();}function g(i){var M,S,P,w;w=new jQuery.Deferred();S=n.getSemanticObject();if(a.checkIsNotUndefined(S)){P=N.getSemanticActions(S);P.then(function(x){M=o.prepareModel(x.semanticActions,x.semanticActions.length);i.byId("idActionField").setModel(M);w.resolve(x);},function(x){s(i,x,"11505");});}return w.promise();}function h(S,w){var x,y,i;var A=S?S:w.byId("idActionField").getModel().getData().Objects;if(a.checkIsNotNullOrBlank(w.byId("idActionField").getValue())){for(i=0;i<A.length;i++){if(A[i].id===n.getAction()){x=A[i].text;break;}}}y=x?x:n.getSemanticObject();w.byId("idDescription").setValue(y);}function j(i){var w=new sap.apf.modeler.ui.utils.StaticValuesBuilder(t,o);var M=w.getNavTargetTypeData();i.byId("idNavigationTargetTypeField").setModel(M);var x=n.isStepSpecific()?t("stepSpecific"):t("globalNavTargets");i.byId("idNavigationTargetTypeField").setSelectedKey(x);}function k(w){var x=n.isStepSpecific()?t("stepSpecific"):t("globalNavTargets");if(x===t("stepSpecific")){r(w,true);var A=[];var S=C.getSteps();var i,y;for(i=0;i<S.length;i++){y={};y.stepKey=S[i].getId();y.stepName=T.get(S[i].getTitleId()).TextElementDescription;A.push(y);}var M=o.prepareModel(A,A.length);w.byId("idAssignedStepsCombo").setModel(M);var z=C.getStepsAssignedToNavigationTarget(n.getId());w.byId("idAssignedStepsCombo").setSelectedKeys(z);}}function l(i){var w={id:n.getId(),icon:n.isGlobal()?"sap-icon://BusinessSuiteInAppSymbols/icon-where-used":"sap-icon://pushpin-off"};if(i.byId("idDescription").getValue()){w.name=i.byId("idDescription").getValue();}N.updateSelectedNode(w);}function m(i){var F=t("navigationTarget")+": "+i.byId("idDescription").getValue();N.updateTitleAndBreadCrumb(F);}function q(i){var w={key:n.getId(),value:i.byId("idDescription").getValue()};N.setNavigationTargetName(w);}function r(i,I){i.byId("idAssignedStepsLabel").setVisible(I);i.byId("idAssignedStepsCombo").setVisible(I);}function s(i,M,w){var x=N.createMessageObject({code:w});x.setPrevious(M);N.putMessage(x);}function u(){var i=C.getStepsAssignedToNavigationTarget(n.getId());var w,S;for(w=0;w<i.length;w++){S=C.getStep(i[w]);S.removeNavigationTarget(n.getId());}}sap.ui.controller("sap.apf.modeler.ui.controller.navigationTarget",{onInit:function(){var i=this;N=i.getView().getViewData();c=N.oConfigurationHandler;C=N.oConfigurationEditor;T=c.getTextPool();t=N.getText;p=N.oParams;if(!C){c.loadConfiguration(p.arguments.configId,function(w){C=w;});}_(i);v=new sap.apf.modeler.ui.utils.ViewValidator(i.getView());v.addFields(["idSemanticObjectField","idActionField"]);b(i);d(i);i.setDetailData();},onAfterRendering:function(){var i=this;if(i.getView().byId("idSemanticObjectField").getValue().length===0){i.getView().byId("idSemanticObjectField").focus();}},setDetailData:function(){var i=this;e(i).then(function(){f(i).then(function(S){h(S.semanticActions,i);});});j(i);k(i);},updateSubViewInstancesOnReset:function(i){var w=this;C=i;n=C.getNavigationTarget(n.getId());w.getView().fireEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.UPDATESUBVIEWINSTANCESONRESET,{"oConfigurationEditor":C,"oParentObject":n});},handleChangeSemanticObjectValue:function(E){var S,i=this;S=E.getParameter("value").trim();if(a.checkIsNotNullOrBlank(S)){n.setSemanticObject(S);g(i).then(function(w){if(w.semanticActions.length>0){n.setAction(i.byId("idActionField").getModel().getData().Objects[0].id);i.byId("idActionField").setSelectedKey(w.semanticActions[0].id);}else{i.byId("idActionField").setValue("");}h(w.semanticActions,i);l(i);m(i);q(i);});}C.setIsUnsaved();},handleChangeofAction:function(E){var A,i=this;A=E.getParameter("value");if(a.checkIsNotNullOrBlank(A)){n.setAction(A);}h(undefined,i);l(i);m(i);q(i);C.setIsUnsaved();},handleChangeOfNavigationTargetType:function(){var i=this;C.setIsUnsaved();var w=i.byId("idNavigationTargetTypeField").getSelectedKey();if(w===t("stepSpecific")){n.setStepSpecific();k(i);}else{n.setGlobal();r(i,false);i.byId("idAssignedStepsCombo").setSelectedKeys([]);u();}l(i,i.byId("idDescription").getValue());},handleChangeForAssignedSteps:function(){var i=this;C.setIsUnsaved();var w=i.byId("idAssignedStepsCombo").getSelectedKeys();var x=C.getStepsAssignedToNavigationTarget(n.getId());x.forEach(function(S){if(w.indexOf(S)===-1){var y=C.getStep(S);y.removeNavigationTarget(n.getId());}});w.forEach(function(S){if(x.indexOf(S)===-1){var y=C.getStep(S);y.addNavigationTarget(n.getId());}});},getValidationState:function(){var i=this;return v.getValidationState()&&i.byId("idContextMappingView").getController().getValidationState();},onExit:function(){var i=this;i.byId("idContextMappingView").destroy();}});}());
