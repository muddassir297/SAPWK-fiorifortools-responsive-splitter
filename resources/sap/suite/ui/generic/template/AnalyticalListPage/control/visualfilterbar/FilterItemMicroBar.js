sap.ui.define(["sap/suite/ui/microchart/InteractiveBarChart","sap/suite/ui/microchart/InteractiveBarChartBar","sap/viz/ui5/controls/common/feeds/FeedItem","sap/viz/ui5/data/FlattenedDataset","sap/ui/model/Sorter","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition"],function(I,a,F,b,S,D,M){"use strict";var c=I.extend("sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroBar",{metadata:{properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},dimensionField:{type:"string",group:"Misc",defaultValue:null},dimensionFieldIsDateTime:{type:"boolean",group:"Misc",defaultValue:false},dimensionFieldDisplay:{type:"string",group:"Misc",defaultValue:null},dimensionFilter:{type:"string[]",group:"Misc",defaultValue:null},dimensionFilterExternal:{type:"sap.ui.model.Filter",group:"Misc",defaultValue:null},measureField:{type:"string",group:"Misc",defaultValue:null},measureSortDescending:{type:"boolean",group:"Misc",defaultValue:false},unitField:{type:"string",group:"Misc",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},labelWidthPercent:{type:"float",group:"Misc",defaultValue:1/3}},aggregations:{control:{type:"sap.suite.ui.microchart.InteractiveBarChart",multiple:false}},events:{filterChange:{},unitChange:{}}},renderer:function(r,C){r.renderControl(C.getAggregation("control"));}});c.prototype.init=function(){var B=new a({label:"S/4 Hana Implementations",value:20});this._chart=new sap.suite.ui.microchart.InteractiveBarChart({maxDisplayedSegemnts:3,selectionEnabled:true,bars:[B.clone(),B.clone(),B.clone()],min:0,max:100});this.setControl(this._chart);this._attachChartEvents();};c.prototype._attachChartEvents=function(){if(this._chart.onAfterRendering){var o=this._chart.onAfterRendering;var m=this;this._chart.onAfterRendering=function(){o.apply(this,arguments);m._chart.setBusy(false);};}};c.prototype.setWidth=function(w){this.setProperty("width",w);};c.prototype.setHeight=function(h){this.setProperty("height",h);};c.prototype.setEntitySet=function(e){this.setProperty("entitySet",e);this._updateBinding();};c.prototype.setDimensionField=function(d){this.setProperty("dimensionField",d);this._updateBinding();};c.prototype.setDimensionFieldIsDateTime=function(d){this._isDateTimeChanged=this.getDimensionFieldIsDateTime()!=d;this.setProperty("dimensionFieldIsDateTime",d);this._updateBinding();this._isDateTimeChanged=false;};c.prototype.setDimensionFieldDisplay=function(d){this.setProperty("dimensionFieldDisplay",d);this._updateBinding();};c.prototype.setMeasureField=function(m){this.setProperty("measureField",m);this._updateBinding();};c.prototype.setMeasureSortDescending=function(m){this.setProperty("measureSortDescending",m);this._updateBinding();};c.prototype.setUnitField=function(u){this.setProperty("unitField",u);this._updateBinding();};c.prototype.setDimensionFilterExternal=function(f){this.setProperty("dimensionFilterExternal",f);this._updateBinding();};c.prototype.getP13NConfig=function(){var p=["width","height","entitySet","dimensionField","dimensionFieldDisplay","dimensionFieldIsDateTime","dimensionFilter","measureField","measureSortDescending"];var d={};for(var i=0;i<p.length;i++){var n=p[i];d[n]=this.getProperty(n);}return d;};c.prototype.setDimensionFilter=function(d){this.setProperty("dimensionFilter",d);};c.prototype._updateBinding=function(){var e=this.getEntitySet();var d=this.getDimensionField();var f=this.getDimensionFieldDisplay();var m=this.getMeasureField();var u=this.getUnitField();var g=this.getDimensionFilterExternal();if(!e||!m||!d||!f)return;var h=this._chart.getFeeds();var i=true;if(h&&h.length==2){var j=h[0];var k=h[1];i=j.getValues()!=f||k.getValues()!=m;}if(i){this._chart.removeAllFeeds();this._chart.addFeed(new F({"uid":"categoryAxis","type":"Dimension","values":f}));this._chart.addFeed(new F({"uid":"valueAxis","type":"Measure","values":m}));}var s=[m,d];if(d!=f)s.push(f);if(u)s.push(u);var l=[];if(g&&g.aFilters&&g.aFilters.length>0)l=[g];var n=this;var o=3;var p=this.getMeasureSortDescending();var q={path:"/"+e,startIndex:0,length:o,sorter:new S(m,p),filters:l,parameters:{select:s.join(",")},events:{dataReceived:function(v){n._onDataReceived(v);}}};var r=new b({data:q,dimensions:new D({name:f,value:"{"+d+"}",displayValue:"{"+f+"}"}),measures:[new M({"name":m,"value":"{"+m+"}"})]});this._chart.setDataset(r);this._applyDimensionFilter();var t=r.getBinding("data");if(t)t.getContexts(0,o);this._chart.setBusy(true);};c.prototype._onDataReceived=function(e){var d=e.getParameter("data");var u=this.getUnitField();if(!d||!d.results||!u){this._applyUnitValue("");return;}var p="";for(var i=0;i<d.results.length;i++){var f=d.results[i][u];if(!f||(p&&f!=p)){this._applyUnitValue("");return;}p=f;}this._applyUnitValue(p);};c.prototype._applyUnitValue=function(v){if(this._lastUnit!=v){this._lastUnit=v;this.fireUnitChange({unitValue:v});}};return c;},true);
