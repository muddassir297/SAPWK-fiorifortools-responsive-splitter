sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/LayoutType"],function(q,B,F,L){"use strict";function o(O){sap.ui.require(["sap/suite/ui/generic/template/lib/routingHelper"],O);}var r=Promise.resolve();var d=2;var c=["begin","mid","end"];var m=["messagePageBeginColumn","messagePageMidColumn","messagePageEndColumn"];function t(v){return c[v]?v:d;}function a(v){return t(v)===v;}function g(v){return c[t(v)]+"ColumnPages";}function A(R,T,p){R.showBeginColumn=R.viewLevel<3;R.showMidColumn=R.viewLevel===1||R.viewLevel===2;R.showEndColumn=R.viewLevel>1;R.target=R.showMidColumn?p.concat([T]):T;return g(R.viewLevel);}function b(C){for(var i=0;i<c.length;i++){C(m[i],g(i));}}function e(v){return m[t(v)];}function f(v){return c[t(v)];}function h(j,n){var k=F.getInstanceFor(j,{});var D=k.getDefaultLayouts();var R;var l;var u;var C;var s;var M=-1;var E;var T=n.oTemplateContract,p=n.oRouter;function v(i){return i===D.defaultLayoutType||i===D.defaultTwoColumnLayoutType||i===D.defaultThreeColumnLayoutType;}function w(i,i1,j1){var k1=T.mRouteToTemplateComponentPromise[j1];if(k1){return k1.then(function(l1){return n.activateOneComponent(i1,i,l1);});}return r;}function x(i){var i1=i.substring(i.length-5,i.length);if(i1==="query"){return i.substring(0,i.length-5);}return i;}function y(i){return Promise.all(i).then(n.afterActivation);}function z(i,i1){var j1=v(i);if(l.name.lastIndexOf("query")===l.name.length-"query".length){l.arguments.query=l.arguments["?query"];if(j1){delete l.arguments.query.FCLLayout;if(q.isEmptyObject(l.arguments.query)){delete l.arguments.query;l.name=x(l.name);}}else{l.arguments.query.FCLLayout=i;}}else if(!j1){l.name=l.name+"query";l.arguments.query={FCLLayout:i};}var k1=p.getURL(l.name,l.arguments);k1=k1.replace("/?","?");n.navigate(k1,i1);}function G(i,i1){return new Promise(function(j1){o(function(k1){j1(k1.determinePath(i,i1,T.routeViewLevel1.pattern));});});}function H(){var i=function(i1){var j1={};var k1=l.event.getParameter("config").viewLevel;if(k1<3){j1.begin={route:"root",path:"",isVisible:u.columnsVisibility.beginColumn};if(k1===0){i1(j1);return;}}var l1=x(l.name);if(k1>0){var m1=f(k1);j1[m1]={route:l1,path:l.path,isVisible:k1>2||(k1===1&&u.columnsVisibility.midColumn)||(k1===2&&u.columnsVisibility.endColumn)};}if(k1===2){G(l.routeConfig,l.event).then(function(n1){j1.mid={route:T.routeViewLevel1.name,path:n1,isVisible:u.columnsVisibility.midColumn};i1(j1);});}else{i1(j1);}};return new Promise(i);}function I(i){var i1=H();i1.then(function(j1){var k1=[];var l1=[j1.begin,j1.mid,j1.end];var m1=n.performPseudoHashChange(l1);for(var n1 in i){if(i[n1]){var o1=j1[n1];if(o1){k1.push(w(m1,o1.path,o1.route));}}}y(k1);});}function J(i){var i1=k.getCurrentUIState();var j1={};j1.end=u&&(u.columnsVisibility.endColumn!==i1.columnsVisibility.endColumn);j1.mid=u&&(u.columnsVisibility.midColumn!==i1.columnsVisibility.midColumn);j1.begin=u&&(u.columnsVisibility.beginColumn!==i1.columnsVisibility.beginColumn);u=i1;T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/midActionButtons",{fullScreen:u.actionButtonsInfo.midColumn.fullScreen!==null,exitFullScreen:u.actionButtonsInfo.midColumn.exitFullScreen!==null,closeColumn:u.actionButtonsInfo.midColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/endActionButtons",{fullScreen:u.actionButtonsInfo.endColumn.fullScreen!==null,exitFullScreen:u.actionButtonsInfo.endColumn.exitFullScreen!==null,closeColumn:u.actionButtonsInfo.endColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/isLogicallyFullScreen",u.isLogicallyFullScreen);var k1;if(u.columnsVisibility.endColumn){k1=k1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");}else if(u.columnsVisibility.midColumn){k1=1;}else{k1=0;}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/highestViewLevel",k1);var l1;if(u.columnsVisibility.midColumn){l1=1;}else{l1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/lowestDetailViewLevel",l1);if(l&&C!==u.layout){z(u.layout,true);}else if((j1.begin||j1.mid||j1.end)&&!i){I(j1);}}function K(i,i1,j1,k1){return new Promise(function(l1){J(true);var m1=H();m1.then(function(n1){E=n1;var o1=[];for(var p1 in n1){var q1=n1[p1];if(q1.isVisible){o1.push(w(k1,q1.path,q1.route));}}y(o1).then(l1);});});}function N(i){var i1=i.getParameter("config").viewLevel;var j1=i.getParameter("arguments")["?query"];if(a(i1)){C=(j1&&j1.FCLLayout);if(!C){switch(i1){case 0:C=D.defaultLayoutType;break;case 1:C=D.defaultTwoColumnLayoutType;break;case 2:C=D.defaultThreeColumnLayoutType;}}}else{C=L.EndColumnFullScreen;}j.setLayout(C);}function O(i,i1,j1,k1){M=-1;var l1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");R=l1===2?i:null;l={name:i.getParameter("name"),arguments:i.getParameter("arguments"),path:j1,event:i,routeConfig:i1};return K(i,i1,j1,k1);}function P(i){return v(i)?{}:{FCLLayout:[i]};}function Q(i){return i===L.EndColumnFullScreen||i===L.MidColumnFullScreen;}function S(i,i1){if(!a(i)){return n.getParStringPromise(i1,false);}var j1=s||k.getNextUIState(i).layout;q.extend(i1,P(j1));s=null;if(Q(j1)){return n.getParStringPromise(i1,false);}var k1=(i===2)?n.addUrlParameterInfoForRoute(T.routeViewLevel1.name,i1):r;return new Promise(function(l1){k1.then(function(){n.getParStringPromise(i1,true).then(l1);});});}function U(){n.navigateToRoot(true);}function V(){s=u.actionButtonsInfo.endColumn.closeColumn;var i=R.getParameter("config");G(i,R).then(function(i1){n.navigateToContext(i1,null,true,0);});}function W(i,i1){var j1=n.oHashChanger.getHash()||"";j1=j1.split("?")[0];var k1=n.getParStringPromise(i,i1);n.navigateToParStringPromise(j1,k1,false);}function X(){var i1=u.actionButtonsInfo.midColumn.fullScreen;var j1;if(i1===null){i1=u.actionButtonsInfo.endColumn.fullScreen;var k1=n.getActiveComponents();for(var i=0;i<k1.length;i++){var l1=T.componentRegistry[k1[i]];if(l1.viewLevel===2){j1=l1.route;break;}}}else{j1=T.routeViewLevel1.name;}var m1=P(i1);n.addUrlParameterInfoForRoute(j1,m1).then(function(){W(m1,false);});}function Y(){var i=u.actionButtonsInfo.midColumn.exitFullScreen;var i1;var j1;if(i===null){i=u.actionButtonsInfo.endColumn.exitFullScreen;}var k1=P(i);if(i===u.actionButtonsInfo.endColumn.exitFullScreen){var l1=n.getActiveComponents();var m1=l1[0];var n1=T.componentRegistry[m1];if(n1){i1=n.addUrlParameterInfoForRoute(n1.route,k1);j1=G(l.routeConfig,l.event);}}(i1||r).then(function(){(j1||r).then(function(o1){var p1=n.addUrlParameterInfoForRoute(T.routeViewLevel1.name,k1,o1);p1.then(function(){W(k1,true);});});});}function Z(i){return a(i)&&{onCloseColumnPressed:i===1?U:V,onFullscreenColumnPressed:X,onExitFullscreenColumnPressed:Y};}function $(i){return T.oApplicationProxy.getDraftSiblingPromise(i);}function _(i){if(T.oTemplatePrivateGlobalModel.getProperty("/generic/FCL/highestViewLevel")===2){var i1=R.getParameter("config");var j1=T.mRouteToTemplateComponentPromise[x(i1.name)];j1.then(function(k1){var l1=k1.getBindingContext();var m1=$(l1,true);m1.then(function(n1){o(function(o1){var p1=i1.navigationProperty;var q1=i.getPath()+"/"+o1.determineNavigationPath(n1,p1).path;s=u.layout;n.navigateToContext(q1,null,true,2);});});});}else{n.navigateToContext(i,null,true,2);}}function a1(i){if(T.oTemplatePrivateGlobalModel.getProperty("/generic/FCL/highestViewLevel")!==2){return Promise.resolve(i);}return new Promise(function(i1){var j1=R.getParameter("config");var k1=T.mRouteToTemplateComponentPromise[x(j1.name)];k1.then(function(l1){var m1=l1.getBindingContext();var n1=$(m1,true);n1.then(function(o1){if(!o1){i1(i);return;}o(function(p1){var q1=j1.navigationProperty;var r1=i.getPath()+"/"+p1.determineNavigationPath(o1,q1).path;i1(r1);});});});});}function b1(i,i1){var j1=E.mid&&i.indexOf(E.mid.path)>=0;var k1=E.end&&i.indexOf(E.end.path)>=0;if(j1){n.navigateToRoot(true);}else if(k1){n.navigateToContext(E.mid.path,null,true);}}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL",{});function c1(i){var i1=n.getTargetLevel(i);switch(i1){case 1:return!u.columnsVisibility.midColumn;case 2:return!u.columnsVisibility.endColumn;default:return true;}}function d1(i){C=k.getNextUIState(i).layout;j.setLayout(C);}function e1(i,i1){i1(u.isLogicallyFullScreen&&i);}function f1(i1){M=t(i1.viewLevel);d1(i1.viewLevel);var j1=n.oRouter.getTargets();var k1=e(i1.viewLevel);j1.display(k1);var l1;if(i1.viewLevel===M){l1=[];for(var i=0;i<i1.viewLevel;i++){l1.push(true);}}return l1;}function g1(i){if(i<M||M<0){return u.columnsVisibility[f(i)+"Column"];}return false;}function h1(i,i1){if(!a(i1)){return i;}var j1=k.getNextUIState(i1).layout;if(v(j1)){return i;}return i+"?FCLLayout="+j1;}j.attachStateChange(J.bind(null,false));return{adaptRoutingInfo:A,createMessagePageTargets:b,displayMessagePage:f1,isLevelActive:g1,handleBeforeRouteMatched:N,handleRouteMatched:O,getAppStateParStringForNavigation:S,getActionButtonHandlers:Z,navigateToDraft:_,getTargetAfterCancelPromise:a1,adaptAfterDeletion:b1,isNewHistoryEntryRequired:c1,setTitleForActiveComponent:e1,adaptBreadCrumbUrl:h1};}return B.extend("sap.suite.ui.generic.template.lib.FlexibleColumnLayoutHandler",{constructor:function(i,n){q.extend(this,h(i,n));}});});
