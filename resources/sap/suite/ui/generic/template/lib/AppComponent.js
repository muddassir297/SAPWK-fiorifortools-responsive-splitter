/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/UIComponent","sap/m/NavContainer","sap/f/FlexibleColumnLayout","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/generic/app/ApplicationController","sap/suite/ui/generic/template/lib/Application","sap/suite/ui/generic/template/lib/BusyHelper","sap/suite/ui/generic/template/lib/NavigationController","sap/suite/ui/generic/template/lib/ProcessObserver","sap/suite/ui/generic/template/lib/TemplateAssembler","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/ViewDependencyHelper","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/library"],function(q,U,N,F,J,R,A,a,B,b,P,T,C,V,t){"use strict";A=t.observableConstructor(A);var D=sap.m.DraftIndicatorState;var r=T.getRegisterAppComponent();var o;function g(){o=o||new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"}).getResourceBundle();return o.getText.apply(o,arguments);}function c(){return new P({processObservers:[]});}function d(e,f){var h={oAppComponent:e,componentRegistry:{},aRunningSideEffectExecutions:[],getText:g,mRouteToTemplateComponentPromise:{},oTemplatePrivateGlobalModel:(new J()).setDefaultBindingMode("TwoWay"),aStateChangers:[]};var j;var n;var k;function l(){h.oTemplatePrivateGlobalModel.setProperty("/generic",{draftIndicatorState:D.Clear,hasOwnTitle:false,paginatorInfo:{},forceFullscreenCreate:false});e.setModel(h.oTemplatePrivateGlobalModel,"_templPrivGlobal");h.oNoOwnTitlePromise.then(function(i){h.oTemplatePrivateGlobalModel.setProperty("/generic/hasOwnTitle",!i);});}function m(){j.attachEvent("beforeSideEffectExecution",function(K){if(K.getParameter("valueChange")||K.getParameter("fieldControl")){var L=K.getParameter("promise");h.oBusyHelper.setBusy(L);var i=0;for(;h.aRunningSideEffectExecutions[i];){i++;}h.aRunningSideEffectExecutions[i]=L;var M=function(){h.aRunningSideEffectExecutions[i]=null;};L.then(M,M);}});var G=e.getModel("_templPrivGlobal");var H="/generic/draftIndicatorState";j.attachBeforeQueueItemProcess(function(i){if(i.draftSave){G.setProperty(H,D.Saving);}});j.attachOnQueueCompleted(function(){if(G.getProperty(H)===D.Saving){G.setProperty(H,D.Saved);}});j.attachOnQueueFailed(function(){if(G.getProperty(H)===D.Saving){G.setProperty(H,D.Clear);}});}function p(M){M.attachPropertyChange(function(i){C.propertyChange(i.getParameter("path"),i.getParameter("context"),h,e);});}function s(){var i={appComponent:e,oTemplateContract:h,application:new a(h),oViewDependencyHelper:new V(h)};var S=sap.ui.core.service.ServiceFactoryRegistry.get("sap.ushell.ui5service.ShellUIService");var G=S&&S.createInstance();h.oNoOwnTitlePromise=G?G.then(function(H){h.oShellService=H;return H.getUxdVersion()===2;}):Promise.resolve(false);(U.prototype.init||q.noop).apply(e,arguments);h.oBusyHelper.setBusy(h.oNoOwnTitlePromise);k=r(i);var M=e.getModel();j=new A(M);l();n=new b(h);m();p(M);if((!M.oMetadata||!M.oMetadata.isLoaded())||M.oMetadata.isFailed()){M.attachMetadataFailed(function(){n.navigateToMessagePage({title:g("ST_GENERIC_ERROR_TITLE"),text:g("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE"),icon:"sap-icon://message-error",description:g("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE_DESC")});for(var H in h.componentRegistry){h.componentRegistry[H].fnViewRegisteredResolve();}});}h.oBusyHelper.setBusyReason("initAppComponent",false);}function u(){if(h.oNavigationHost){return"";}if(h.sRoutingType==="f"){var M=e.getManifestEntry("sap.ui.generic.app");var i=M.settings&&M.settings.flexibleColumnLayout;var G=new F(i);h.oNavigationHost=G;h.aNavigationObservers=[new P({processName:"BeginColumnNavigation",eventHandlers:{attachProcessStart:G.attachBeginColumnNavigate.bind(G),attachProcessStop:G.attachAfterBeginColumnNavigate.bind(G)}}),new P({processName:"MidColumnNavigation",eventHandlers:{attachProcessStart:G.attachMidColumnNavigate.bind(G),attachProcessStop:G.attachAfterMidColumnNavigate.bind(G)}}),new P({processName:"EndColumnNavigation",eventHandlers:{attachProcessStart:G.attachEndColumnNavigate.bind(G),attachProcessStop:G.attachAfterEndColumnNavigate.bind(G)}})];h.oNavigationObserver=new P({processObservers:h.aNavigationObservers});h.aHeaderLoadingObservers=[c(),c(),c()];}else{var H=new N({id:e.getId()+"-appContent"});h.oNavigationHost=H;h.oNavigationObserver=new P({processName:"Navigation",eventHandlers:{attachProcessStart:H.attachNavigate.bind(H),attachProcessStop:H.attachAfterNavigate.bind(H)}});h.oNavigationHost.attachAfterNavigate(h.oApplicationProxy.onAfterNavigate);}h.oHeaderLoadingObserver=new P({processObservers:h.aHeaderLoadingObservers||[]});h.oPagesDataLoadedObserver=new P({processObservers:[h.oHeaderLoadingObserver,h.oNavigationObserver]});h.oNavigationHost.addStyleClass(h.oApplicationProxy.getContentDensityClass());h.oBusyHelper=new B(h);h.oBusyHelper.setBusyReason("initAppComponent",true,true);return h.oNavigationHost;}function v(){if(h.oNavigationHost){h.oNavigationHost.destroy();}if(j){j.destroy();}if(n){n.destroy();}(U.prototype.exit||q.noop).apply(e,arguments);k();t.endApp(f);}function w(i){var G=Object.keys(i).map(function(H){var K=i[H];if(K.pages){K.pages=w(K.pages);}return i[H];});return G;}var x;function y(){if(!x){var M=e.getMetadata();x=M.getManifestEntry("sap.ui.generic.app");if(x._version==="1.3.0"&&x.pages&&q.isPlainObject(x.pages)){x.pages=w(x.pages);}}return x;}var I;function z(){if(!I){I=q.extend({},e.getMetadata().getManifest());I["sap.ui.generic.app"]=y();}return I;}function E(){var M=e.getManifestObject();var S=M.getEntry("sap.ui.generic.app").settings;h.sRoutingType=(S&&S.flexibleColumnLayout)?"f":"m";return"sap."+h.sRoutingType+".routing.Router";}return{init:s,createContent:u,exit:v,_getRouterClassName:E,getConfig:y,getInternalManifest:z,getTransactionController:function(){return j.getTransactionController();},getApplicationController:function(){return j;},getNavigationController:function(){return n;}};}return U.extend("sap.suite.ui.generic.template.lib.AppComponent",{metadata:{config:{title:"SAP UI Application Component",fullWidth:true},properties:{forceGlobalRefresh:{type:"boolean",defaultValue:true}},events:{pageDataLoaded:{}},routing:{config:{async:true,viewType:"XML",viewPath:"",clearTarget:false},routes:[],targets:[]},library:"sap.suite.ui.generic.template"},constructor:function(){var e=t.startApp();q.extend(this,d(this,e));(U.prototype.constructor||q.noop).apply(this,arguments);}});});
