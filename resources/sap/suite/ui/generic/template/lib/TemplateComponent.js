jQuery.sap.require("sap.ui.core.CustomizingConfiguration");(function(){"use strict";var o=sap.ui.core.CustomizingConfiguration.getViewExtension;sap.ui.core.CustomizingConfiguration.getViewExtension=function(v,e,a){var c=a&&typeof a==="string"?a:(a&&sap.ui.core.Component.getOwnerIdFor(a));var C=c&&sap.ui.component(c);if(C instanceof sap.suite.ui.generic.template.lib.TemplateComponent){a=C.getAppComponent().getId();}var r=o(v,e,a);return r;};var O=sap.ui.core.CustomizingConfiguration.getControllerExtension;sap.ui.core.CustomizingConfiguration.getControllerExtension=function(c,C){var a=null;if(C){a=sap.ui.component(C);if(a instanceof sap.suite.ui.generic.template.lib.TemplateComponent){a=a.getAppComponent();if(a){C=a.getId();}}}var r=O(c,C);return r;};sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/ViewType","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/Device"],function(q,V,U,J,R,D){function e(C){var i=new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"});var t=C.getModel("i18n");if(t){i.enhance(t.getResourceBundle());}var m=C.getAppComponent().getModel("i18n|"+C.getMetadata().getComponentName()+"|"+C.getEntitySet());if(m){i.enhance(m.getResourceBundle());}C.setModel(i,"i18n");}function E(C,m){var M=C.getAppComponent().getManifestEntry("sap.ui5");var f=M.extends&&M.extends.extensions&&M.extends.extensions["sap.ui.controllerExtensions"];var t=C.getTemplateName();var T=f&&f[t]&&f[t]["sap.ui.generic.app"];var g=m.getMetaModel();var s=g.getODataEntitySet(C.getEntitySet()).name;var B=T&&T[s]&&T[s].Actions;var h={};if(B){a(h,B);}else{var S=T&&T[g.getODataEntitySet(C.getEntitySet()).name];for(var i in S){B=S[i]["Actions"];if(B){a(h,B);}}}C.getModel("_templPriv").setProperty("/generic/listCommons/breakoutActionsEnabled",h);}function a(B,f){var g;for(var A in f){g=true;if(f[A].requiresSelection){g=false;}B[f[A].id]={enabled:g};}}function d(C){if(C.getAppComponent().getMetadata().getComponentName()===""||C.getTemplateName()===""||C.getEntitySet()===""){}return C.getAppComponent().getMetadata().getComponentName()+"::"+C.getTemplateName()+"::"+C.getEntitySet();}function c(s,C,m,t){var i=C.getAppComponent().getTransactionController().getDraftController().getDraftContext().isDraftEnabled(C.getEntitySet());var S=null;var A=C.getComponentContainer().getSettings();S=q.extend({},A);delete S.appComponent;delete S.entitySet;delete S.navigationProperty;return new J({entitySet:C.getEntitySet(),entityType:s,"sap-ui-debug":window["sap-ui-debug"],isDraftEnabled:i,settings:S,manifest:C.getAppComponent().getInternalManifest(),metaModel:m,templateSpecific:t&&t()});}function b(C,f){var g=C.oComponent,h=C.createViewController,t=C.methods&&C.methods.getTemplateSpecificParameters;var v=null;var m=g.getModel();var M=g.getModel().getMetaModel();var i=M.getODataEntitySet(g.getEntitySet());if(!i||!i.entityType){return null;}e(g);E(g,m);q.sap.require("sap.ui.model.odata.AnnotationHelper");var s=d(g);v=sap.ui.getCore().byId(s);if(v){q.sap.log.warning("View with ID: "+s+" already exists - old view is getting destroyed now!");try{v.destroy();}catch(j){q.sap.log.warning("Error destroying view: "+j);}v=null;}var k=new J(D);k.setDefaultBindingMode("OneWay");g.runAsOwner(function(){var p=C.preprocessorsData;var l={async:true,preprocessors:{xml:{bindingContexts:{meta:M.createBindingContext(M.getODataEntityType(i.entityType,true)),entitySet:M.createBindingContext(M.getODataEntitySet(g.getEntitySet(),true))},models:{device:k,meta:M,entitySet:M,parameter:c(i.entityType,g,M,t)},preprocessorsData:p}},id:s,type:V.XML,viewName:g.getTemplateName(),height:"100%",cache:{keys:f,additionalData:[p]}};if(h){var n=h();l.controller=new n();}v=sap.ui.view(l);});return v;}return U.extend("sap.suite.ui.generic.template.lib.TemplateComponent",{metadata:{properties:{templateName:{type:"string",defaultValue:null},entitySet:{type:"string",defaultValue:null},navigationProperty:{type:"string",defaultValue:null},appComponent:{type:"object",defaultValue:null},isRefreshRequired:{type:"boolean",defaultValue:false},isLeaf:{type:"boolean"}},library:"sap.suite.ui.generic.template"},init:function(){(U.prototype.init||q.noop).apply(this,arguments);var u=new J({editable:false,enabled:false});this.setModel(u,"ui");var p=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("URLParsing");var t=new J({generic:{crossAppNavSupport:!!p&&p.isIntentUrl(document.URL),draftIndicatorState:sap.m.DraftIndicatorState.Clear,listCommons:{functionEnabled:{}},viewLevel:this.getComponentData().registryEntry.viewLevel,controlProperties:{},supportedIntents:{}}});t.setDefaultBindingMode("TwoWay");this.setModel(t,"_templPriv");},getComponentContainer:function(){return this.oContainer;},onBeforeRendering:function(C){if(C){var f=C.oComponent.getComponentContainer();var m=!C.createViewStarted&&f&&f.getModel();if(m){m.getMetaModel().loaded().then(function(){if(!C.createViewStarted){var g=[];var p=m.metadataLoaded().then(function(P){var s;if(P&&P.lastModified){s=new Date(P.lastModified).getTime()+"";}else{q.sap.log.error("TemplateComponent: no valid cache key segment last modification date provided by the OData Model");s=new Date().getTime()+"";}return s;});g.push(p);var h=m.annotationsLoaded().then(function(P){var j=0;if(P){for(var i=0;i<P.length;i++){if(P[i].lastModified){var l=new Date(P[i].lastModified).getTime();if(l>j){j=l;}}}}if(j===0){q.sap.log.error("TemplateComponent: no valid cache key segment last modification date provided by OData annotations");j=new Date().getTime();}return j+"";});g.push(h);C.createViewStarted=true;b(C,g).loaded().then(function(v){C.oComponent.setAggregation("rootControl",v);f.invalidate();});}});}}},setContainer:function(){U.prototype.setContainer.apply(this,arguments);},getRouter:function(){if(this.getAppComponent()){return this.getAppComponent().getRouter();}return U.prototype.getRouter.apply(this,arguments);}});});})();
