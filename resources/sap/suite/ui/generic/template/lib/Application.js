sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/ui/core/routing/HistoryDirection","sap/m/MessageToast","sap/m/ActionSheet","sap/m/Dialog","sap/m/Popover","sap/suite/ui/generic/template/lib/routingHelper","sap/suite/ui/generic/template/lib/ContextBookkeeping","sap/suite/ui/generic/template/lib/testableHelper"],function(q,B,D,J,H,a,M,A,b,P,r,C,t){"use strict";var c=(t.testableStatic(function(T,o){var s="sapUiSizeCozy",e="sapUiSizeCompact";if(o.hasClass(s)||o.hasClass(e)){return"";}else{return T?s:e;}},"Application_determineContentDensityClass")(D.support.touch,q(document.body)));function g(){return c;}function f(o,p){q.sap.syncStyleClass(c,p,o);p.addDependent(o);}var f=t.testableStatic(f,"Application_attachControlToParent");function d(T){var o=new C(T.oAppComponent);var e={api:{}};var h={};var R={};function j(i){var X=i.getParameters();if(X.name!==R.name){R=X;return true;}var Y=q.extend({},R.arguments,X.arguments);for(var Z in Y){if(Z.indexOf("?")!==0&&Y[Z]!==R.arguments[Z]){R=X;return true;}}return false;}function k(){return e.api||{};}var I=false;function p(X){if(I){return;}var i=0;for(;i<T.aRunningSideEffectExecutions.length&&!T.aRunningSideEffectExecutions[i];i++){i++;}if(T.aRunningSideEffectExecutions[i]){I=true;var Y=T.aRunningSideEffectExecutions[i];Y.then(function(){if(T.aRunningSideEffectExecutions[i]===Y){T.aRunningSideEffectExecutions[i]=null;}I=false;p(X);});}else{X();}}function m(i){var X;if(i instanceof b){X="open";}else if(i instanceof P||i instanceof A){X="openBy";}if(X){var Y=i[X];i[X]=function(){var Z=arguments;p(function(){if(!T.oBusyHelper.isBusy()){T.oBusyHelper.getUnbusy().then(function(){Y.apply(i,Z);});}});};}}var F={};function l(i,X,Y,Z,$){i=i||T.oNavigationHost;var _=i.getId();var a1=F[_]||(F[_]={});var b1=a1[X];if(!b1){b1=sap.ui.xmlfragment(_,X,Y);f(b1,i);var c1;if(Z){c1=new J();b1.setModel(c1,Z);}($||q.noop)(b1,c1);a1[X]=b1;m(b1);}return b1;}function n(){return new Promise(function(i){T.oNavigationObserver.getProcessFinished(true).then(function(){T.oBusyHelper.getUnbusy().then(i);});});}function s(i){if(T.oShellService){T.oShellService.setBackNavigation(i);}}function u(i){if(T.oShellService){T.oShellService.setTitle(i);}}function v(i){if(!T.oFlexibleColumnLayoutHandler){return{};}return{oActionButtonHandlers:T.oFlexibleColumnLayoutHandler.getActionButtonHandlers(i),navigateToDraft:T.oFlexibleColumnLayoutHandler.navigateToDraft};}var w=false;function x(i){w=i;}function y(i,X){if(!T.oFlexibleColumnLayoutHandler){return true;}var Y=r.determineNavigationPath(i,X);return T.oFlexibleColumnLayoutHandler.isNewHistoryEntryRequired(Y);}function z(i){T.aStateChangers.push(i);}function E(i){return T.oFlexibleColumnLayoutHandler?T.oFlexibleColumnLayoutHandler.getTargetAfterCancelPromise(i):Promise.resolve(i);}function G(i,X){o.adaptAfterDeletion(i);if(i.length===0||!T.oFlexibleColumnLayoutHandler){return;}T.oFlexibleColumnLayoutHandler.adaptAfterDeletion(i,X);}function K(i,X,Y){var Z=T.mEntityTree[i];var $;if(Z.navigationProperty){$=X?Z.entitySet:Z.navigationProperty;}else{$=i;}if(Y.indexOf($)<0){Y.unshift($);if(Z.navigationProperty){K(Z.parent,X,Y);}}}function L(i,X){var Y=[];K(i,X,Y);return Y;}function N(X){var Y=L(X);Y.pop();var Z="";var $="";var _=[];for(var i=0;i<Y.length;i++){Z=Z+$+Y[i];_.push(Z);$="/";}return _;}function O(){var i=T.oNavigationControllerProxy.oHashChanger.getHash();var X=i.split("?")[0];var Y=X.split("/");if(Y[0]===""||Y[0]==="#"){Y.splice(0,1);}return Y;}function Q(i,X,Y){if(T.oFlexibleColumnLayoutHandler){return T.oFlexibleColumnLayoutHandler.adaptBreadCrumbUrl(i,X,Y);}return i;}function S(){var X=T.oNavigationControllerProxy.getActiveComponents();var Y=0;var Z;for(var i=0;i<X.length;i++){var $=T.componentRegistry[X[i]];if($.viewLevel>0&&(Y===0||$.viewLevel<Y)){Y=$.viewLevel;Z=$.oComponent;}}var _=Z?Promise.resolve(Z):T.oNavigationControllerProxy.getRootComponentPromise();return _.then(function(a1){return a1.getModel("i18n").getResourceBundle();});}var U=H.getInstance();var V;var W;T.oApplicationProxy={getDraftSiblingPromise:o.getDraftSiblingPromise,getAlternativeContextPromise:o.getAlternativeContextPromise,getResourceBundleForEditPromise:S,onAfterNavigate:function(i){V=i.getParameter("toId");var X=i.getParameter("to");var Y=X&&X.getComponent&&X.getComponent();var Z=Y&&T.componentRegistry[Y];if(Z){var $=function(){e.currentView=Z.oController.getView();};if(Z.oController){$();}else{Z.viewRegisterd.then($);}}else{e.currentView=null;}},onBypassed:function(){R={};e.api.outdated=true;e.api={};},onRouteMatched:function(i){if(!j(i)){return;}e.api.outdated=true;e.api={isBack:U.getDirection()===a.Backwards,dataFromLastPage:h};h={};var X=i.getParameter("config").target;var Y=T.mRouteToTemplateComponentPromise[X];Y.then(function(Z){W=Z.getComponentContainer().getId();if(!V||W===V){V=W;}});},getHierarchySectionsFromCurrentHash:O,getCurrentDisplayObject:k,getContentDensityClass:g,setEditableNDC:x,getDialogFragment:l.bind(null,null),destroyView:function(i){delete F[i];}};return{setEditableNDC:x,getEditableNDC:function(){return w;},getCurrentDisplayObject:k,getContentDensityClass:g,attachControlToParent:f,getDialogFragmentForView:l,getBusyHelper:function(){return T.oBusyHelper;},performAfterSideEffectExecution:p,isTemplateComponentActive:function(i){return i.getComponentContainer().getId()===W;},showMessageToast:function(){var i=arguments;var X=function(){q.sap.log.info("Show message toast");M.show.apply(M,i);};Promise.all([n(true),T.oBusyHelper.getUnbusy()]).then(X);},setBackNavigation:s,setTitle:u,getFclProxy:v,isNewHistoryEntryRequired:y,registerStateChanger:z,getDraftSiblingPromise:o.getDraftSiblingPromise,registerContext:o.registerContext,activationStarted:o.activationStarted,cancellationStarted:o.cancellationStarted,editingStarted:o.editingStarted,getTargetAfterCancelPromise:E,adaptAfterDeletion:G,getBreadCrumbInfo:N,adaptBreadCrumbUrl:Q,getSections:L,getHierarchySectionsFromCurrentHash:O};}return B.extend("sap.suite.ui.generic.template.lib.Application",{constructor:function(T){q.extend(this,d(T));}});});
