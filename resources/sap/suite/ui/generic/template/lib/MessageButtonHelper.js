sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/m/MessagePopover","sap/m/MessagePopoverItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/suite/ui/generic/template/lib/testableHelper"],function(q,B,M,a,F,b,t){"use strict";F=t.observableConstructor(F,true);var p=new F({path:"persistent",operator:b.EQ,value1:false});var v=new F({path:"validation",operator:b.EQ,value1:true});var I=new F({path:"validation",operator:b.EQ,value1:"bla"});function g(c,C){var m;var s;var o=C.byId("showMessages");var d=c.getDialogFragment("sap.suite.ui.generic.template.fragments.MessagePopover");d.setModel(sap.ui.getCore().getMessageManager().getMessageModel(),"msg");var e;var E;(function(){var i=C.getOwnerComponent();E=new F({path:"target",operator:b.EQ,value1:"/"+i.getEntitySet()});e=d.getBinding("items");var T=i.getModel("_templPriv");T.setProperty("/generic/messageCount",0);var K=c.getText("MESSAGE_BUTTON_TOOLTIP_P",0);T.setProperty("/generic/messageButtonTooltip",K);e.attachChange(function(){var L=e.getLength();T.setProperty("/generic/messageCount",L);K=c.getText(L===1?"MESSAGE_BUTTON_TOOLTIP_S":"MESSAGE_BUTTON_TOOLTIP_P",L);T.setProperty("/generic/messageButtonTooltip",K);});})();var f=[];var h;var j=0;var n;var k;function l(K){if(q.isArray(K)){var L=false;for(var i=0;i<K.length;i++){L=l(K[i])||L;}return L;}if(K instanceof Promise){K.then(n);return false;}k.push(K);return true;}function r(){var K=k;if(s){for(var i=0;i<s.length;i++){K=K.concat(s[i].filters);}}return K;}function A(){var i=r();if(m){m.propagateFilters(i);}else if(s){var K=new F(i.concat(v),false);var L=[K,p];e.filter(L);}}function R(i,K){if(i===j&&l(K)){A();}}function u(i){var K=i();return l(K);}function w(){f.forEach(u);}function x(i){h=i;j++;n=R.bind(null,j);k=[new F({path:"target",operator:b.StartsWith,value1:h}),E];w();A();}function y(i){f.push(i);if(h!==undefined&&u(i)){A();}}var S;function z(){if(m){m.showMessagePopover();return;}if(s){S=S||d.openBy.bind(d,o);setTimeout(S,0);}}function D(){m=null;if(s){for(var i=0;i<s.length;i++){s[i].free();}s=null;k=null;e.filter(I);}}function P(i,K){if(s){s[i].filters=K;if(k){A();}}}function G(K){s=[];for(var i=0;i<K.length;i++){var L={showMessagePopover:z,propagateFilters:P.bind(null,i)};var N=K[i].serve(L);s.push(N);}if(k){A();}}function H(){m=null;}function J(i){m=i;e.filter(I);return{filters:k?r():[],free:H};}return{adaptToContext:x,toggleMessagePopover:d.toggle.bind(d,o),showMessagePopover:z,registerMessageFilterProvider:y,suspend:D,resume:G,serve:J};}return B.extend("sap.suite.ui.generic.template.lib.MessageButtonHelper",{constructor:function(c,C){q.extend(this,(t.testableStatic(g,"MessageButtonHelper"))(c,C));}});});
