sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/View","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/suite/ui/generic/template/lib/TemplateViewController","sap/suite/ui/generic/template/lib/TemplateComponent","sap/suite/ui/generic/template/lib/Application","sap/suite/ui/generic/template/lib/CRUDManager","sap/suite/ui/generic/template/lib/CommonUtils","sap/suite/ui/generic/template/lib/ComponentUtils","sap/suite/ui/generic/template/lib/CommonEventHandlers","sap/suite/ui/generic/template/lib/ViewDependencyHelper","sap/suite/ui/generic/template/lib/testableHelper"],function(q,V,J,R,T,a,A,C,b,c,d,e,t){"use strict";var m={};var f={};var r=function(o){var s=o.appComponent.getId();m[s]=o;return function(){delete m[s];};};function g(o){var s=o.getId();var k=m[s];return k;}function h(o){return g(o.getAppComponent()).oTemplateContract.componentRegistry[o.getId()];}function F(o){while(o&&!(o instanceof V)){o=o.getParent();}return o;}function G(o){while(o){var v=F(o);var k=v&&v.getController();var l=k&&k.getOwnerComponent();if(l instanceof a){var n=h(l);return n;}else{o=l&&l.oContainer;}}}function i(k,s,o,l,n){o=o||{};o.constructor=function(){T.prototype.constructor.apply(this,arguments);var M=k(l,this);this._templateEventHandlers=Object.freeze(M.handlers||{});this._templateFormatters=Object.freeze(M.formatters||{});this.extensionAPI=Object.freeze(M.extensionAPI||{});this.fnGenericOnInit=function(p){var v=p.getView();var u=v.getId();q.sap.log.info("Init view "+u+" of template "+s);var w=p.getOwnerComponent();var x=h(w);x.oControllerRegistryEntry={onExit:M.onExit||q.noop,oTemplateUtils:l,oAppRegistryEntry:n};f[u]=x.oControllerRegistryEntry;l.oServices.oApplicationController.registerView(v);l.oCommonUtils=new b(p,l.oServices,l.oComponentUtils);l.oServices.oCRUDManager=new C(p,l.oComponentUtils,l.oServices,l.oCommonUtils,n.oTemplateContract.oBusyHelper);l.oCommonEventHandlers=new d(p,l.oComponentUtils,l.oServices,l.oCommonUtils);(M.onInit||q.noop)();x.oController=this;x.fnViewRegisteredResolve();delete x.fnViewRegisteredResolve;};};o.onInit=function(){this.fnGenericOnInit(this);delete this.fnGenericOnInit;};o.onExit=function(){var v=this.getView().getId();var p=f[v];p.oAppRegistryEntry.oTemplateContract.oApplicationProxy.destroyView(v);p.onExit();delete f[v];q.sap.log.info("View "+v+" of template "+s+" exited");};return T.extend(s,o);}function j(o){var k=o.methods.oControllerSpecification;return k&&function(){var l=o.oComponent.getAppComponent();var n=g(l);var p=l.getTransactionController();var s={oComponentUtils:o.utils,oServices:{oTemplateCapabilities:{},oApplicationController:l.getApplicationController(),oTransactionController:p,oNavigationController:l.getNavigationController(),oDraftController:p.getDraftController(),oApplication:n.application,oViewDependencyHelper:n.oViewDependencyHelper}};return i(k.getMethods,o.oComponent.getTemplateName(),k.oControllerDefinition,s,n);};}r=t.testableStatic(r,"TemplateComponent_RegisterAppComponent");return{getTemplateComponent:function(k,s,o){var l=s+".Component";o=o||{};o.init=function(){var n=this.getComponentData().registryEntry;n.viewRegisterd=new Promise(function(p){n.fnViewRegisteredResolve=p;});n.oViewRenderdPromise=new Promise(function(p){n.fnViewRenderdResolve=p;});(a.prototype.init||q.noop).apply(this,arguments);n.componentName=l;n.oComponent=this;n.activationTakt=0;n.utils=new c(this,n);n.methods=k(this,n.utils)||{};n.oGenericData={mRefreshInfos:{}};(n.methods.init||q.noop)();};o.exit=function(){var I=this.getId();var n=h(this);var p=g(this.getAppComponent());var M=n.methods;(M.exit||q.noop)();delete p.oTemplateContract.componentRegistry[I];(a.prototype.exit||q.noop).apply(this,arguments);};o.onBeforeRendering=function(){var n=h(this);(a.prototype.onBeforeRendering||q.noop).bind(this,n).apply(this,arguments);var M=n.methods;(M.onBeforeRendering||q.noop)();};o.onAfterRendering=function(){var n=h(this);if(n.fnViewRenderdResolve&&!n.fnViewRegisteredResolve){n.fnViewRenderdResolve();delete n.fnViewRenderdResolve;}(a.prototype.onAfterRendering||q.noop).bind(this,n).apply(this,arguments);var M=n.methods;(M.onAftereRendering||q.noop)();};o.onActivate=function(B,I){var n=h(this);n.sCurrentBindingPath=B;var p=function(){n.utils.bindComponent(n.sCurrentBindingPath,I);var u=this.getIsRefreshRequired();if(u||!q.isEmptyObject(n.oGenericData.mRefreshInfos)){(n.methods.refreshBinding||q.noop)(u,u?{}:n.oGenericData.mRefreshInfos);this.setIsRefreshRequired(false);n.oGenericData.mRefreshInfos={};}return(n.methods.onActivate||q.noop)(B);}.bind(this);return n.fnViewRegisteredResolve?n.viewRegisterd.then(p):(p()||Promise.resolve());};o.setContainer=function(){a.prototype.setContainer.apply(this,arguments);var I=this.getId();var n=this.getAppComponent();var p=g(n);if(!p.oTemplateContract.componentRegistry[I]){var u=this.getComponentData();var v=u.registryEntry;delete u.registryEntry;v.componentCreateResolve(this);delete v.componentCreateResolve;p.oTemplateContract.componentRegistry[I]=v;p.oTemplateContract.oBusyHelper.setBusy(v.viewRegisterd,true);v.oApplication=p.application;v.createViewController=j(v);(v.methods.setContainer||q.noop)();}};o.onDeactivate=q.noop;return a.extend(l,o);},getRegisterAppComponent:function(){var k=r;r=null;return k;},getExtensionAPIPromise:function(o){var k=G(o);if(!k){return Promise.reject();}return k.viewRegisterd.then(function(){return k.oController.extensionAPI;});},getExtensionAPI:function(o){var k=G(o);return k&&k.oController&&k.oController.extensionAPI;}};});
