sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/comp/smarttable/SmartTable","sap/ui/table/Table","sap/m/Table","sap/m/ListBase","sap/m/MessageBox","sap/ui/generic/app/navigation/service/NavigationHandler","sap/ui/generic/app/navigation/service/NavError","sap/suite/ui/generic/template/lib/testableHelper"],function(q,B,D,J,S,U,R,L,M,N,a,t){"use strict";function g(p,e){for(var i in p){var E=p[i];if(E.entitySet===e&&E.component.list&&E.navigationProperty){return E.navigationProperty;}else if(E.pages){var r=g(E.pages,e);if(r){return r;}}}}function b(c,s,C){var n;function A(i){s.oApplication.attachControlToParent(i,c.getView());}function d(i,j,c1,d1){return s.oApplication.getDialogFragmentForView(c.getView(),i,j,c1,d1);}var r;function e(){r=r||c.getOwnerComponent().getModel("i18n").getResourceBundle();return r.getText.apply(r,arguments);}function f(){var i=s.oDraftController.getDraftContext();return i.isDraftEnabled(c.getOwnerComponent().getEntitySet());}function h(j){var c1=[];if(j instanceof S){j=j.getTable();}else if(j instanceof sap.ui.comp.smartchart.SmartChart){j=j.getChart();if(j&&j.getMetadata().getName()==="sap.chart.Chart"){var d1=j.getSelectedDataPoints();if(d1.count>0){var e1=d1.dataPoints;for(var i=0;i<e1.length;i++){c1.push(e1[i].context);}}}}if(j instanceof L){c1=j.getSelectedContexts();}else if(j instanceof U){var f1=j.getSelectedIndices();for(var i=0;i<f1.length;i++){c1.push(j.getContextByIndex(f1[i]));}}return c1;}function k(j){var c1,d1,e1,f1,g1,h1;var i1=this.getOwnerControl(j);var j1=i1.getMetadata().getName();if(j1!=="sap.ui.comp.smarttable.SmartTable"&&j1!=="sap.ui.comp.smartchart.SmartChart"){i1=i1.getParent();j1=i1.getMetadata().getName();}var k1=this.getSelectedContexts(i1);var l1=i1.getModel();var m1=l1.getMetaModel();var n1=c.getView();if(j1==="sap.ui.comp.smarttable.SmartTable"){c1=i1.getCustomToolbar()&&i1.getCustomToolbar().getContent();d1=this.getBreakoutActionsForTable(i1);this.fillEnabledMapForBreakoutActions(d1,k1,l1);}else if(j1==="sap.ui.comp.smartchart.SmartChart"){c1=i1.getToolbar()&&i1.getToolbar().getContent();}if(c1&&c1.length>0){for(var i=0;i<c1.length;i++){g1=undefined;e1=c1[i];if(e1.getMetadata().getName()==="sap.m.Button"&&e1.getVisible()){h1=this.getElementCustomData(e1);if(h1&&h1.Type){f1=n1.getLocalId(e1.getId());if(h1.Type==="CRUDActionDelete"){g1=p(l1,m1,k1,i1);}else if(h1.Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||h1.Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){g1=o(l1,m1,k1,h1.Type,h1.Action);}}if(/generic\/controlProperties/.test(e1.getBindingPath("enabled"))&&g1!==undefined){m(f1,"enabled",g1);}}}}}function l(i,c){var j=this.getBreakoutActionsForFooter(c);var c1=this.getSelectedContexts(i);var d1=i.getModel();this.fillEnabledMapForBreakoutActions(j,c1,d1);}function m(i,j,c1){var d1=c.getView().getModel("_templPriv");var e1=d1.getProperty("/generic/controlProperties/"+i);if(!e1){e1={};e1[j]=c1;d1.setProperty("/generic/controlProperties/"+i,e1);}else{d1.setProperty("/generic/controlProperties/"+i+"/"+j,c1);}}function o(i,c1,d1,e1,f1){var g1,h1,i1,j1;var k1=false;if(e1==="com.sap.vocabularies.UI.v1.DataFieldForAction"){g1=c1.getODataFunctionImport(f1);i1=g1&&g1["sap:action-for"];if(i1&&i1!==""&&i1!==" "){if(d1.length>0){j1=g1["sap:applicable-path"];if(j1&&j1!==""&&j1!==" "){for(var j=0;j<d1.length;j++){h1=i.getObject(d1[j].getPath());if(h1&&h1[j1]===true){k1=true;break;}}}else{k1=true;}}}else{k1=true;}}else if(e1==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&d1.length>0){k1=true;}return k1;}function p(j,c1,d1,e1){var f1=G(e1);var g1=false;var h1=c1.getODataEntitySet(e1.getEntitySet());if(sap.suite.ui.generic.template.js.AnnotationHelper.areDeleteRestrictionsValid(c1,h1.entityType,f1)){if(d1.length>0){var i1=f1&&f1.Deletable&&f1.Deletable.Path;if(i1){for(var i=0;i<d1.length;i++){if(j.getProperty(i1,d1[i])){g1=true;break;}}}else{g1=true;}}}return g1;}function G(i){var j=i.getModel()&&i.getModel().getMetaModel();var c1=j&&j.getODataEntitySet(i.getEntitySet());var d1=c1&&c1["Org.OData.Capabilities.V1.DeleteRestrictions"];return d1;}function u(i,j,c1){var d1=y(c1);var e1=c.getView().getModel("_templPriv");var f1=e1.getProperty("/generic/listCommons/breakoutActionsEnabled");if(d1){v(f1,d1,i,j,c1);}e1.setProperty("/generic/listCommons/breakoutActionsEnabled",f1);}function v(i,j,c1,d1,e1){var f1;for(var g1 in j){if(q.inArray(j[g1].id,c1)!==-1){f1=true;if(j[g1].requiresSelection){if(d1.length>0){if(j[g1].applicablePath!==undefined&&j[g1].applicablePath!==""){f1=false;for(var h1=0;h1<d1.length;h1++){var i1="";var j1=j[g1].applicablePath.split("/");if(j1.length>1){for(var k1=0;k1<j1.length-1;k1++){i1+="/"+j1[k1];}}var l1=e1.getObject(d1[h1].getPath()+i1);var m1=j1[j1.length-1];if(l1[m1]===true){f1=true;break;}}}}else{f1=false;}}i[j[g1].id]={enabled:f1};}}}function w(i){var j=[];var c1=q.grep(i.getCustomToolbar().getContent(),function(f1){return f1.getMetadata().getName()==="sap.m.Button";});for(var d1=0;d1<c1.length;d1++){var e1=c1[d1].getId().split("--");j.push(e1[e1.length-1]);}return j;}function x(c){var i=[];var j=[];var c1=c.getView().byId("page");if(c1&&c1.getFooter()){j=q.grep(c1.getFooter().getContent(),function(f1){return f1.getMetadata().getName()==="sap.m.Button";});}for(var d1=0;d1<j.length;d1++){var e1=j[d1].getId().split("--");i.push(e1[e1.length-1]);}return i;}function y(i){var j=c.getOwnerComponent().getAppComponent().getManifestEntry("sap.ui5");var c1=j.extends&&j.extends.extensions&&j.extends.extensions["sap.ui.controllerExtensions"];if(c1){var d1=(c1[c.getOwnerComponent().getTemplateName()]||{})["sap.ui.generic.app"]||{};var e1=i.getMetaModel();var f1=(d1[e1.getODataEntitySet(c.getOwnerComponent().getEntitySet()).name]||{})["Actions"];if(!f1){f1={};var g1=(d1[e1.getODataEntitySet(c.getOwnerComponent().getEntitySet()).name]||{})["Sections"];if(g1){for(var h1 in g1){f1=q.extend(f1,g1[h1]["Actions"]);}}}return f1;}}function z(i){var j=i;while(j){if(j instanceof R||j instanceof U||j instanceof S||j instanceof sap.ui.comp.smartchart.SmartChart){return j;}if(j.getParent){j=j.getParent();}else{return null;}}return null;}function E(i){if(i instanceof S){i=i.getTable();}if(i instanceof U){return i.getBindingInfo("rows");}else if(i instanceof R){return i.getBindingInfo("items");}return null;}function F(i,j){var c1=i.getPath();var d1=c.getOwnerComponent();var e1="";if(d1.getComponentContainer().getElementBinding()){e1=d1.getComponentContainer().getElementBinding().getPath();}var f1=null;if(c1.indexOf(e1)!==0){f1=E(j).path;}var g1=!s.oApplication.isNewHistoryEntryRequired(i,f1);var h1;if(f()){h1=s.oDraftController.isActiveEntity(i)?1:6;}else{h1=c.getOwnerComponent().getModel("ui").getProperty("/editable")?6:1;}s.oNavigationController.navigateToContext(i,f1,g1,h1);}function H(i,j){var c1;if(j&&j.navigationProperty){c1=j.navigationProperty;}s.oNavigationController.navigateToContext(i,c1,false);}function I(i){if(i instanceof a){M.show(i.getErrorCode(),{title:e("ST_GENERIC_ERROR_TITLE")});}}function K(i,j){V(function(){n=a1();n.navigate(i.semanticObject,i.action,n.mixAttributesAndSelectionVariant(i.parameters).toJSONString(),j.getCurrentAppState&&j.getCurrentAppState()||{},I);},q.noop,j,"LeavePage");}function O(i,j,c1){if(!i){return e("DRAFT_OBJECT");}else if(j){return e(c1?"LOCKED_OBJECT":"UNSAVED_CHANGES");}else{return"";}}function P(){var i=d("sap.suite.ui.generic.template.fragments.DraftAdminDataPopover",{formatText:function(){var j=Array.prototype.slice.call(arguments,1);var c1=arguments[0];if(!c1){return"";}if(j.length>0&&(j[0]===null||j[0]===undefined||j[0]==="")){if(j.length>3&&(j[3]===null||j[3]===undefined||j[3]==="")){return(j.length>2&&(j[1]===null||j[1]===undefined||j[1]===""))?"":j[2];}else{return e(c1,j[3]);}}else{return e(c1,j[0]);}},closeDraftAdminPopover:function(){i.close();},formatDraftLockText:O},"admin");return i;}function Q(i,j,c1,d1,e1){var f1=s.oApplication.getBusyHelper();if(!e1&&f1.isBusy()){return;}if(!f()){var g1=false;if(c1&&c1.aUnsavedDataCheckFunctions){g1=c1.aUnsavedDataCheckFunctions.some(function(i1){return i1();});}if(g1||c.getView().getModel().hasPendingChanges()){var h1;X(function(){c.getView().getModel().resetChanges();C.fire(c,"AfterCancel",{});h1=i();},function(){h1=j();},d1);return h1;}}return i();}function T(i,j,c1){var d1=false;if(c1&&c1.aUnsavedDataCheckFunctions){d1=c1.aUnsavedDataCheckFunctions.some(function(f1){return f1();});}if(d1||c.getView().getModel().hasPendingChanges()){var e1;Z(function(){c.getView().getModel().resetChanges();C.fire(c,"AfterCancel",{});e1=i();},function(){e1=j();});return e1;}return i();}function V(i,j,c1,d1,e1){if(e1){return Q(i,j,c1,d1,true);}s.oApplication.performAfterSideEffectExecution(Q.bind(null,i,j,c1,d1,false));}var W;function X(i,j,c1){W=i;if(!c1){c1="LeavePage";}var d1=d("sap.suite.ui.generic.template.fragments.DataLoss",{onDataLossOK:function(){d1.close();W();},onDataLossCancel:function(){d1.close();j();}},"dataLoss");var e1=d1.getModel("dataLoss");e1.setProperty("/mode",c1);d1.open();}var Y;function Z(i,j){Y=i;var c1=d("sap.suite.ui.generic.template.fragments.DataLossTechnicalError",{onDataLossOK:function(){c1.close();Y();},onDataLossCancel:function(){c1.close();j();}});c1.open();}function $(i,j,c1,d1,e1,f1){if(j.busy.check&&d1.isBusy()){f1();return;}var g1=(j.dataloss.popup?V(i,f1,c1,(j.dataloss.navigation?"LeavePage":"Proceed"),true):i());if(g1 instanceof Promise){g1.then(e1,f1);}else{e1();}}function _(i,j,c1){j=q.extend(true,{busy:{set:true,check:true},dataloss:{popup:true,navigation:false}},j);var d1=s.oApplication.getBusyHelper();var e1=new Promise(function(f1,g1){s.oApplication.performAfterSideEffectExecution($.bind(null,i,j,c1,d1,f1,g1));});if(j.busy.set){d1.setBusy(e1);}return e1;}function a1(){n=n||new N(c);return n;}function b1(j,c1){var d1,e1,f1,g1,h1,i1=[],j1=[],i,k1,l1,m1,n1,o1,p1;var q1,r1;d1=c.getOwnerComponent().getAppComponent();e1=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");f1=c1.getProperty("/generic/supportedIntents/");g1=j.getCustomToolbar().getContent();h1=g1.length;for(i=0;i<h1;i++){k1=this.getElementCustomData(g1[i]);if(k1.hasOwnProperty("SemanticObject")&&k1.hasOwnProperty("Action")){l1=k1.SemanticObject;m1=k1.Action;n1={semanticObject:l1,action:m1,ui5Component:d1};i1.push([n1]);o1=q.extend({},n1);o1.bLinkIsSupported=false;j1.push(o1);}}if(i1.length>0&&!!e1){p1=e1.getLinks(i1);p1.done(function(s1){f1=c1.getProperty("/generic/supportedIntents/");q1=s1.length;for(i=0;i<q1;i++){if(s1[i][0].length>0){j1[i].bLinkIsSupported=true;}l1=j1[i].semanticObject;m1=j1[i].action;r1=c1.getProperty("/generic/supportedIntents/"+l1);if(!r1){f1[l1]={};f1[l1][m1]={"visible":j1[i].bLinkIsSupported};}else if(!r1[m1]){r1[m1]={"visible":j1[i].bLinkIsSupported};}else{r1[m1]["visible"]=j1[i].bLinkIsSupported;}}});}}var a1=t.testable(a1,"getNavigationHandler");var f=t.testable(f,"isDraftEnabled");return{getNavigationProperty:g,getText:e,isDraftEnabled:f,getNavigationHandler:a1,executeGlobalSideEffect:function(){if(f()){var i=c.getView();i.attachBrowserEvent("keyup",function(j){if(j.keyCode===13&&i.getModel("ui").getProperty("/editable")){var c1=c.getOwnerComponent().getAppComponent().getManifestEntry("sap.ui.generic.app");var d1=c1.settings&&c1.settings.forceGlobalRefresh;s.oApplicationController.executeSideEffects(i.getBindingContext(),null,null,d1);}});}},setEnabledToolbarButtons:k,setEnabledFooterButtons:l,fillEnabledMapForBreakoutActions:u,getBreakoutActionsForTable:w,getBreakoutActionsForFooter:x,getBreakoutActionsFromManifest:y,getSelectedContexts:h,getDeleteRestrictions:G,setPrivateModelControlProperty:m,navigateFromListItem:F,navigateToContext:H,navigateExternal:K,getCustomData:function(j){var c1=j.getSource().getCustomData();var d1={};for(var i=0;i<c1.length;i++){d1[c1[i].getKey()]=c1[i].getValue();}return d1;},formatDraftLockText:O,showDraftPopover:function(i,j){var c1=P();var d1=c1.getModel("admin");d1.setProperty("/IsActiveEntity",i.getProperty("IsActiveEntity"));d1.setProperty("/HasDraftEntity",i.getProperty("HasDraftEntity"));c1.bindElement({path:i.getPath()+"/DraftAdministrativeData"});if(c1.getBindingContext()){c1.openBy(j);}else{c1.getObjectBinding().attachDataReceived(function(){c1.openBy(j);});}},getContentDensityClass:function(){return s.oApplication.getContentDensityClass();},attachControlToView:A,getDialogFragment:d,processDataLossConfirmationIfNonDraft:V,processDataLossTechnicalErrorConfirmation:T,securedExecution:_,getOwnerControl:z,getTableBinding:E,getElementCustomData:function(i){var j={};if(i instanceof sap.ui.core.Element){i.getCustomData().forEach(function(c1){j[c1.getKey()]=c1.getValue();});}return j;},triggerAction:function(i,j,c1,d1,e1){V(function(){s.oCRUDManager.callAction({functionImportPath:c1.Action,contexts:i,sourceControl:d1,label:c1.Label,operationGrouping:"",navigationProperty:""}).then(function(f1){if(f1&&f1.length>0){var g1=f1[0];if(g1.response&&g1.response.context&&(!g1.actionContext||g1.actionContext&&g1.response.context.getPath()!==g1.actionContext.getPath())){s.oViewDependencyHelper.setMeToDirty(c.getOwnerComponent(),j);}}});},q.noop,e1,"Proceed");},checkToolbarIntentsSupported:b1};}return B.extend("sap.suite.ui.generic.template.lib.CommonUtils",{constructor:function(c,s,C){q.extend(this,b(c,s,C));}});});
