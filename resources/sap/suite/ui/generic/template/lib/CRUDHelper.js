sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/model/Context","sap/suite/ui/generic/template/lib/MessageUtils"],function(q,B,C,M){"use strict";function c(d,E,b,m,s){b=b||"/"+E;return new Promise(function(a,f){if(d.getDraftContext().isDraftEnabled(E)){d.createNewDraftEntity(E,b).then(function(R){a(R.context);},function(o){f(o);});}else{s(true);return a(m.createEntry(b,{batchGroupId:"Changes",changeSetId:"Changes"}));}});}function r(m,b,t){var P=new Promise(function(a,d){m.read(b,{urlParameters:{"$expand":"DraftAdministrativeData"},success:function(R){a(R);},error:function(R){d(R);}});});t.oBusyHelper.setBusy(P,true);return P;}function p(P,o,t,a){var A=a.getApplicationController();if(!A.getTransactionController().getDraftController().getDraftContext().hasDraft(o)){return Promise.resolve();}return A.propertyChanged(P,o).catch(function(E){t.oApplicationProxy.getResourceBundleForEditPromise().then(function(R){var n=a.getNavigationController();var m=a.getModel();M.handleError(M.operations.modifyEntity,null,null,E,{resourceBundle:R,navigationController:n,model:m});M.handleTransientMessages(t.oApplicationProxy.getDialogFragment);});});}function u(t,d,b){return new Promise(function(a,f){var U=t.oApplicationProxy.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.UnsavedChangesDialog",{onEdit:function(){U.close();a();},onCancel:function(){U.close();f();}},"Dialog");var s=t.getText("DRAFT_LOCK_EXPIRED",[d.LastChangedByUserDescription||d.LastChangedByUser]);U.getModel("Dialog").setProperty("/unsavedChangesQuestion",s);(b||q.noop)();t.oBusyHelper.getUnbusy().then(function(){U.open();});});}function e(t,E,b,m,T,f){var d=t.getDraftController().getDraftContext();var o=new C(m,b);if(d.isDraftEnabled(E)){if(true||!d.hasPreserveChanges(o)){return new Promise(function(a,g){r(m,b,T).then(function(R){if(!R.DraftAdministrativeData||R.DraftAdministrativeData.DraftIsCreatedByMe){a(t.editEntity(o,false));}else if(R.DraftAdministrativeData.InProcessByUser){g({lockedByUser:R.DraftAdministrativeData.InProcessByUserDescription||R.DraftAdministrativeData.InProcessByUser});}else{u(T,R.DraftAdministrativeData,f).then(function(){a(t.editEntity(o,false));},function(){g({lockedByUser:R.DraftAdministrativeData.LastChangedByUserDescription||R.DraftAdministrativeData.LastChangedByUser});});}},function(R){g({draftAdminReadResponse:R});});});}}else{T.oApplicationProxy.setEditableNDC(true);return Promise.resolve({context:o});}}return{create:c,edit:e,propertyChange:p};});
