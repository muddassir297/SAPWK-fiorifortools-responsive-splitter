/*!
 * 
 * 		SAP UI development toolkit for HTML5 (SAPUI5)
 * 		(c) Copyright 2009-2015 SAP SE. All rights reserved
 * 	
 */
jQuery.sap.declare("sap.suite.ui.commons.TargetFilter");jQuery.sap.require("sap.suite.ui.commons.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.suite.ui.commons.TargetFilter",{metadata:{deprecated:true,publicMethods:["getFilters","getParameters","search"],library:"sap.suite.ui.commons",properties:{"entitySet":{type:"string",group:"Misc",defaultValue:null}},aggregations:{"columns":{type:"sap.suite.ui.commons.TargetFilterColumn",multiple:true,singularName:"column"},"_countDisplay":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"_quad0":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"_quad1":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"_quad2":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"_quad3":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"measureColumn":{type:"sap.suite.ui.commons.TargetFilterMeasureColumn",multiple:false}},associations:{"selectedColumns":{type:"sap.suite.ui.commons.TargetFilterColumn",multiple:true,singularName:"selectedColumn"}},events:{"search":{},"filterChange":{},"cancel":{}}}});sap.suite.ui.commons.TargetFilter.M_EVENTS={'search':'search','filterChange':'filterChange','cancel':'cancel'};sap.m.ComboBox.extend("sap.suite.ui.commons.TargetFilterComboBox",{metadata:{properties:{popoverPlacement:{type:"sap.m.PlacementType",group:"Misc",defaultValue:sap.m.PlacementType.Bottom}}},_createPopover:function(){var p=new sap.m.Popover({showHeader:false,placement:this.getPopoverPlacement(),offsetX:0,offsetY:0,initialFocus:this,bounce:false});p.addStyleClass("TFComboBox");this._decoratePopover(p);return p;},renderer:function(r,c){sap.m.ComboBoxRenderer.render.apply(this,arguments);}});sap.m.Link.extend("sap.suite.ui.commons.TargetFilterLink",{metadata:{properties:{count:{type:"sap.ui.core/int"},key:{type:"sap.ui.core/string"}}},onmouseover:function(e){if(this.$()[0].scrollWidth>this.$().innerWidth()){this.firePress();}},renderer:function(r,c){sap.m.LinkRenderer.render.apply(this,arguments);}});sap.m.StandardListItem.extend("sap.suite.ui.commons.TargetFilterListItem",{metadata:{properties:{index:{type:"sap.ui.core/int"},key:{type:"sap.ui.core/string"}}},ontap:function(e){if(!jQuery(e.target).hasClass("sapMCbMarkChecked")){this.setSelected(!this.getSelected());this.informList("Select",!this.getSelected());}this.firePress();},onkeyup:function(e){if(e.which==jQuery.sap.KeyCodes.ENTER||e.which==jQuery.sap.KeyCodes.SPACE){this.firePress();}},renderer:function(r,c){sap.m.StandardListItemRenderer.render.apply(this,arguments);}});sap.ui.core.Control.extend("sap.suite.ui.commons.TargetFilterLinksCloud",{metadata:{properties:{index:{type:"sap.ui.core/int"}},aggregations:{links:{cardinality:"0..n",type:"sap.suite.ui.commons.TargetFilterLink"}}},init:function(){var t=this;this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");this._oOthersLink=new sap.suite.ui.commons.TargetFilterLink(this.getId()+"-others-link",{text:"+000 "+t._oRb.getText("TARGETFILTER_MORE_TEXT"),press:function(){var T=t.getParent();var f=Object.getOwnPropertyNames(T._oFilters);var d=0;for(var i=0;i<f.length;i++){if(!T._oFilters[f[i]].linkId){delete T._oFilters[f[i]];d++;}}this.setCount(this.getCount()-d);T.fireFiltersChanged();}});this._oOthersLink.addStyleClass("sapSuiteUiTFOthersLine");this._oOthersLink.setEmphasized(true).setSubtle(false);this._oOthersLink.setCount=function(c){this.setProperty("count",c,true);if(c>0){this.$().removeClass("Hidden");this.setText("+"+c+" "+t._oRb.getText("TARGETFILTER_MORE_TEXT"));}else{this.$().addClass("Hidden");}};},exit:function(){this._oOthersLink.destroy();},_setFontSizes:function(l){var L=["Large","Medium","Small","Smallest"];var O=jQuery.unique(l.map(function(o){return o.getCount();}));switch(O.length){case 1:for(var b=0;b<l.length;b++){l[b].addStyleClass(L[1]);}break;case 2:for(var b=0;b<l.length;b++){if(O[0]==l[b].getCount()){l[b].addStyleClass(L[1]);}else{l[b].addStyleClass(L[2]);}}break;default:var i=Math.min.apply(null,O);var a=Math.max.apply(null,O);for(var b=0;b<l.length;b++){var s=Math.floor(3.99*(a-l[b].getCount())/(a-i));l[b].addStyleClass(L[s]);}}},renderer:function(r,c){var l=c.getLinks();r.write("<div");r.writeControlData(c);r.addClass("sapSuiteUiTFLinksCloud");r.writeClasses();r.write(">");c._setFontSizes(l);for(var i=0;i<l.length;i++){if(!!l[i].getText())r.renderControl(l[i]);}c._oOthersLink.addStyleClass("Quad"+c.getIndex()).addStyleClass("Hidden");r.renderControl(c._oOthersLink);r.write("</div>");},updateVisibleLinks:function(){var t=this.getParent();var l=this.$().find(".sapSuiteUiTFLine:not(.Hidden)");var v=0;var f=Object.getOwnPropertyNames(t._oFilters);for(var i=0;i<f.length;i++){delete t._oFilters[f[i]].linkId;}l.each(function(){var L=sap.ui.getCore().byId(this.id);var F=t._oFilters[L.getKey()];if(F){L.setEmphasized(true).setSubtle(false);F.linkId=L.getId();v++;}else{L.setEmphasized(false).setSubtle(true);}});this._oOthersLink.setCount(f.length-v);},onAfterRendering:function(){if(this.getLinks().length!=0){this.drawCloudCircle();this.updateVisibleLinks();}},drawCloudCircle:function(){var r=sap.ui.getCore().getConfiguration().getRTL();var o=Math.ceil(parseFloat(jQuery(".sapSuiteUiTFOuterCircle").width()/2))-5;var c=Math.ceil(parseFloat(jQuery(".sapSuiteUiTFCentralCircle").outerWidth()/2));var v=Math.ceil(parseFloat(jQuery(".sapSuiteUiTFOuterCont").outerHeight()/2));var I=jQuery("html").hasClass("sapUiMedia-Std-Phone");var b=Math.ceil(parseFloat(jQuery(".sapSuiteUiTFBox").outerHeight()));var B=Math.ceil(parseFloat(jQuery(".sapSuiteUiTFBox").outerWidth()));if(!I){B+=Math.ceil(parseFloat(jQuery(".sapSuiteUiTFBox.Quad0").css("right")));}var m=8;this.initQuadArea(o-m,v,c+m,b,B,m);var t=this;var q=this.getIndex();var x=((q==0||q==3)!=r)?"left":"right";var y=(q==0||q==1)?"bottom":"top";var l=this.getLinks();for(var i=0;i<l.length;i++){var L=l[i].$();if(L.length>0){var R=L[0].scrollWidth;if(l.length<=5&&this.isCompact()){var a=[0,2,[1,3][i],[1,2,3][i],[0,1,2,3][i],[0,1,2,3,4][i]][l.length];if(L.width()>this._bgArea[a].width){L.width(this._bgArea[a].width);}this._bgArea[a].placed.push(L);}else if(l.length<=3&&!this.isCompact()){var a=[0,1,[0,2][i],[0,1,2][i]][l.length];if(L.width()>this._bgArea[a].width){L.width(this._bgArea[a].width);}this._bgArea[a].placed.push(L);}else{var M=48;if(l[i].getText().length<3){R=Math.ceil(l[i].getText().length*M/3);}L.width(R);var O=L.outerWidth();var d=-1;var e=1000;var f=-1;var g=0;for(var h=0;h<t._bgArea.length;h++){var E=t._bgArea[h].width-O;if(E>=0&&E<e){e=E;d=h;}if(E<0&&E<g){g=E;f=h;}}if(d!=-1){this._bgArea[d].placed.push(L);this._bgArea[d].width-=O;}else if(f!=-1&&t._bgArea[f].width>=M){if(L.width()>this._bgArea[f].width){L.width(this._bgArea[f].width);}O=L.outerWidth();this._bgArea[f].width-=O;this._bgArea[f].placed.push(L);}else{L.addClass("Hidden");}}}}for(var h=0;h<this._bgArea.length;h++){var X=this._bgArea[h].start;var p=this._bgArea[h].placed.length;var j=Math.max(0,this._bgArea[h].width);for(var k=0;k<p;k++){var w=2.0*j/p;var K=this._bgArea[h].placed[k];K.css(y,this._bgArea[h].offset+"px");K.css(x,X+"px");X+=K.outerWidth()+Math.ceil(w*Math.random());}}this.initItemNavigation();},onsappageup:function(){var n=this.oItemNavigation.getFocusedIndex()-this.oItemNavigation.iPageSize;if(n<0||!this.oItemNavigation.getItemDomRefs()[n]){for(var i=0;i<this.oItemNavigation.getItemDomRefs().length;i++){if(this.oItemNavigation.getItemDomRefs()[i]){this.oItemNavigation.setFocusedIndex(i);jQuery.grep(this.oItemNavigation.getItemDomRefs(),function(o){return o;})[0].focus();return;}}}},initItemNavigation:function(){var q=this.getIndex();var f=this.getDomRef();var l=this.getLinks();if(l){var d=new Array(l.length);if(this._bgArea){var r=(q==0||q==1)?this._bgArea.reverse():this._bgArea;r.forEach(function(a){var p=a.placed;if(p){p=(q==1||q==2)?p.reverse():p;p.forEach(function(L){d.push(L);});}});}if(!this.oItemNavigation){this.oItemNavigation=new sap.ui.core.delegate.ItemNavigation();this.addDelegate(this.oItemNavigation);}this.oItemNavigation.setRootDomRef(f);this.oItemNavigation.setItemDomRefs(d);this.oItemNavigation.setCycling(false);this.oItemNavigation.setPageSize(5);}},isCompact:function(){return this.$().closest(".sapUISizeCompact").length>0;},initQuadArea:function(o,v,i,b,B,a){var I=jQuery("html").hasClass("sapUiMedia-Std-Phone");if(v<0){v=0;}var r=this.isCompact()?5:3;this._bgArea=new Array(r);var y=(v-a-b)/r;var O=b;for(var R=0;R<r;R++){var s=i*i-O*O;var S=((s>0)?Math.ceil(parseFloat(Math.sqrt(s))):0)+a;this._bgArea[R]={start:S,width:(I?o:Math.ceil(parseFloat(Math.sqrt(o*o-(O+y)*(O+y)))))-S,offset:O,placed:[]};O+=Math.ceil(y);}}});sap.ui.core.Control.extend("sap.suite.ui.commons.TargetFilterQuadrant",{metadata:{properties:{index:{type:"sap.ui.core/int"}},aggregations:{linkClouds:{cardinality:"0..n",type:"sap.suite.ui.commons.TargetFilterLinksCloud"},dialog:{cardinality:"0..n",type:"sap.m.SelectDialog"}},events:{filtersChanged:{}}},init:function(){var t=this;this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");this._oFilters={};this._assignedFilters=[];this._oFilterCb=new sap.suite.ui.commons.TargetFilterComboBox(this.getId()+"-cb",{selectionChange:function(){t.setColumn(this.getSelectedKey(),true);},});this._oValueHelpBtn=new sap.m.Button(this.getId()+"-btn",{icon:"sap-icon://search",press:function(){t.fnShowValueHelper();}});this.addLinkCloud(new sap.suite.ui.commons.TargetFilterLinksCloud(this.getId()+"-links"));this._oSelectDialog=new sap.m.SelectDialog(this.getId()+"-browser",{multiSelect:true,liveChange:function(e){var s=e.getParameter("value");var i=e.getParameter("itemsBinding");var f=[];try{if(s!==undefined&&s.length){f.push(new sap.ui.model.Filter(t._oColumn.getPath(),t._oColumn.getType().getName()=="String"?sap.ui.model.FilterOperator.Contains:sap.ui.model.FilterOperator.EQ,t._oColumn.getType().parseValue(s,"string")));}i.filter(f);}catch(a){jQuery.sap.log.warning("'"+s+"' is not valid "+t._oColumn.getType().getName(),this);this.removeAllItems();}},confirm:function(e){var s=e.getParameter("selectedContexts");t._oFilters={};for(var v in t.oSelectedDialogSaveItems){if(t.oSelectedDialogSaveItems[v]){t._oFilters[v]={filter:new sap.ui.model.Filter(t._oColumn.getPath(),sap.ui.model.FilterOperator.EQ,v),text:t._oColumn.getType().formatValue(v,"string")};}}t.oSelectedDialogSaveItems={};t.fireFiltersChanged();t.getLinkClouds()[0].updateVisibleLinks();},cancel:function(e){t.oSelectedDialogSaveItems={};}});this.addAggregation("dialog",this._oSelectDialog);},hasFilters:function(){return Object.getOwnPropertyNames(this._oFilters).length!=0;},hasFilter:function(v){return this._oFilters.hasOwnProperty(v);},getFiltersSet:function(){var f=[];var F=Object.getOwnPropertyNames(this._oFilters);for(var i=0;i<F.length;i++){f.push({key:F[i],text:this._oFilters[F[i]].text});}return f;},getFilters:function(){var f=[];var F=Object.getOwnPropertyNames(this._oFilters);for(var i=0;i<F.length;i++){f.push(this._oFilters[F[i]].filter);}if(f.length){return new sap.ui.model.Filter(f,false);}},filter:function(f){this._assignedFilters=f;this._oFilters={};var b=this.getLinkClouds()[0].getBinding("links");b.filter(this._assignedFilters);},removeFilter:function(v){var f=this._oFilters[v];if(f.linkId){sap.ui.getCore().byId(f.linkId).setEmphasized(false).setSubtle(true);}else{this.getLinkClouds()[0]._oOthersLink.setCount(this.getLinkClouds()[0]._oOthersLink.getCount()-1);}delete this._oFilters[v];this.fireFiltersChanged();},setProperty:function(p,v,s){sap.ui.core.Element.prototype.setProperty.apply(this,arguments);if(p==="index"){if(v==0||v==1){this._oFilterCb.setPopoverPlacement(sap.m.PlacementType.VerticalPreferedTop).addStyleClass("sapSuiteTFCBTop");}else{this._oFilterCb.setPopoverPlacement(sap.m.PlacementType.VerticalPreferedBottom);}if(v==0||v==3){this._oFilterCb.addStyleClass("sapSuiteTFCBArrowBeforeVal");}this.getLinkClouds()[0].setIndex(v);}},setColumn:function(c,d){this._oColumn=sap.ui.getCore().byId(c);if(this._oColumn){if(!d){this._oFilterCb.setSelectedKey(c);}var t=this.getParent();var a=this;var r=new sap.suite.ui.commons.TargetFilterLink({key:"{"+this._oColumn.getPath()+"}",text:{path:this._oColumn.getPath(),type:this._oColumn.getType()},count:{path:t.getMeasureColumn().getPath()},press:function(e){if(this.$()[0].scrollWidth>this.$().innerWidth()){var p=this;var i=this.getParent().getParent().getId();if(sap.ui.getCore().byId(i+"-popover"))a._selectPopover.destroy();a._selectPopover=new sap.m.Popover(i+"-popover",{title:sap.ui.getCore().byId(i+"-cb").getValue(),content:[new sap.m.Text({text:this.getText(),wrapping:true}).addStyleClass("sapSuiteUiTFPopoverText")],footer:[new sap.m.Bar({contentRight:[new sap.m.Button({text:a._oRb.getText(this.getEmphasized()?"TARGETFILTER_BUTTON_DESELECT":"TARGETFILTER_BUTTON_SELECT"),type:"Emphasized",press:function(){a.toggleLinkSelection(p);a._selectPopover.close();}}),new sap.m.Button({text:a._oRb.getText("TARGETFILTER_BUTTON_CANCEL"),press:function(){a._selectPopover.close();}})]})],placement:sap.m.PlacementType.Vertical,afterClose:function(E){if(E)E.getSource().destroy();}}).addStyleClass("sapSuiteUiTFPopover");a._selectPopover.openBy(this);a._selectPopover.$().attr("role","alert").removeAttr("aria-label");return;}a.toggleLinkSelection(this);}});r.addStyleClass("sapSuiteUiTFLine");r.addStyleClass("Quad"+this.getIndex());this.getLinkClouds()[0].bindAggregation("links",{path:"/"+t.getEntitySet(),parameters:{select:this._oColumn.getPath()+","+t.getMeasureColumn().getPath()},template:r,length:this._oColumn.getLength(),sorter:[new sap.ui.model.Sorter(t.getMeasureColumn().getPath(),true),new sap.ui.model.Sorter(this._oColumn.getPath(),false)],filters:this._assignedFilters});var f=this.hasFilters();this._oFilters={};if(f){this.fireFiltersChanged();}}else{this.getLinkClouds()[0].removeAllLinks();}},toggleLinkSelection:function(p){if(this._oFilters[p.getKey()]){delete this._oFilters[p.getKey()];p.setEmphasized(false).setSubtle(true);}else{this._oFilters[p.getKey()]={filter:new sap.ui.model.Filter(this._oColumn.getPath(),sap.ui.model.FilterOperator.EQ,p.getKey()),linkId:p.getId(),text:p.getText()};p.setEmphasized(true).setSubtle(false);}this.fireFiltersChanged();},fnShowValueHelper:function(){var t=this.getParent();var a=this;var e=" "+a._oRb.getText("TARGETFILTER_ENTRIES_TEXT");this._oSelectDialog.bindAggregation("items",{path:"/"+t.getEntitySet(),parameters:{select:this._oColumn.getPath()+","+t.getMeasureColumn().getPath()},sorter:[new sap.ui.model.Sorter(t.getMeasureColumn().getPath(),true),new sap.ui.model.Sorter(this._oColumn.getPath(),false)],filters:this._assignedFilters,factory:function(i,c){var I=new sap.suite.ui.commons.TargetFilterListItem({key:{path:a._oColumn.getPath()},title:{type:a._oColumn.getType(),path:a._oColumn.getPath()},description:{path:t.getMeasureColumn().getPath(),formatter:function(n){return n+e;}},selected:a.fnSelectDialogItemSelection(c),press:function(E){a.oSelectedDialogSaveItems[this.getProperty("key")]=this.getSelected();}});return I;}});this._oSelectDialog.setTitle(this._oColumn.getTitle()),this._oSelectDialog.open();},oSelectedDialogSaveItems:{},fnSelectDialogItemSelection:function(c){var C=c.getProperty(this._oColumn.getPath());if(this.oSelectedDialogSaveItems[C]==undefined){this.oSelectedDialogSaveItems[C]=this.hasFilter(C);}return this.oSelectedDialogSaveItems[C];},rebindColumns:function(){var t=this.getParent();this._oFilterCb.removeAllItems();for(var i=0;i<t.getColumns().length;i++){var c=t.getColumns()[i];var I=new sap.ui.core.Item({key:c.getId(),text:c.getTitle()});this._oFilterCb.addItem(I);}if(t.getSelectedColumns()&&t.getSelectedColumns()[this.getIndex()]){this.setColumn(t.getSelectedColumns()[this.getIndex()]);}else if(t.getColumns()[this.getIndex()]){this.setColumn(t.getColumns()[this.getIndex()].getId());}else{this.setColumn();}},exit:function(){if(this.oItemNavigation){this.removeDelegate(this.oItemNavigation);this.oItemNavigation.destroy();}this._oFilterCb.destroy();this._oValueHelpBtn.destroy();},renderer:function(r,c){var q=c.getIndex();r.write("<div");r.writeControlData(c);r.addClass("sapSuiteUiTFQuadrant");r.addClass("Quad"+q);r.writeClasses();r.write(">");r.write("<div");r.addClass("sapSuiteUiTFBox");r.addClass("Quad"+q);r.writeClasses();r.write(">");r.write("<div");r.addClass("sapSuiteUiTFParCont");r.addClass("Quad"+q);r.writeClasses();r.write(">");r.renderControl(c._oFilterCb);r.write("</div>");r.write("<div");r.addClass("sapSuiteUiTFValHel");r.addClass("Quad"+q);r.writeClasses();r.write(">");r.renderControl(c._oValueHelpBtn);r.write("</div>");r.write("</div>");r.write("<div");r.addClass("sapSuiteUiTFHorizontalLineBg");r.addClass("Quad"+q);r.writeClasses();r.write(">");r.write("<div");r.addClass("sapSuiteUiTFHorizontalLine");r.addClass("Quad"+q);r.writeClasses();r.write(">");r.write("</div>");r.write("</div>");r.renderControl(c.getLinkClouds()[0]);r.write("</div>");}});sap.ui.core.Control.extend("sap.suite.ui.commons.TargetFilterCountDisplay",{metadata:{aggregations:{counts:{cardinality:"0..n",type:"sap.suite.ui.commons.TargetFilterCount"}}},init:function(){this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");},renderer:function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapSuiteUiTFCentralLabel");r.writeClasses();r.write(">");if(c.getCounts().length){r.write(c.getCounts()[0].getCount());}r.write("</div>");},filter:function(f){this.getBinding("counts").filter(f);this.getParent()._oShowSelectedLink.setText(this._oRb.getText((this.getParent().iCountFilters>0)?"TARGETFILTER_SHOW_SELECTED_TEXT":"TARGETFILTER_SHOW_ALL_TEXT"));}});sap.ui.core.Element.extend("sap.suite.ui.commons.TargetFilterCount",{metadata:{properties:{count:{type:"string"}},events:{countUpdated:{}}},setProperty:function(p,v,s){sap.ui.core.Element.prototype.setProperty.apply(this,arguments);if(p==="count"){this.fireCountUpdated({});}}});
sap.suite.ui.commons.TargetFilter.prototype.init=function(){sap.ui.Device.media.attachHandler(this.rerender,this,sap.ui.Device.media.RANGESETS.SAP_STANDARD);this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var t=this;this._aQuadrants=[];this._aSelectionHistory=[];for(var i=0;i<4;i++){var q=new sap.suite.ui.commons.TargetFilterQuadrant(this.getId()+"-quad"+i,{index:i,filtersChanged:function(){t._handleFiltersChange(this.getIndex());}});this._aQuadrants.push(q);this.setAggregation("_quad"+i,q);}this._aQuadrants[0].getLinkClouds()[0].addDelegate({onAfterRendering:function(e){t._setVariantsFilterItems(0);}});this._aQuadrants[1].getLinkClouds()[0].addDelegate({onAfterRendering:function(e){t._setVariantsFilterItems(1);}});this._aQuadrants[2].getLinkClouds()[0].addDelegate({onAfterRendering:function(e){t._setVariantsFilterItems(2);}});this._aQuadrants[3].getLinkClouds()[0].addDelegate({onAfterRendering:function(e){t._setVariantsFilterItems(3);}});this._oSearchBtn=new sap.m.Button(this.getId()+"-search",{icon:"sap-icon://initiative",press:function(){t.search();}}).addStyleClass("sapSuiteUiTFSearchBtn");this._oSettingsBtn=new sap.m.Button(this.getId()+"-master-settings-button",{icon:"sap-icon://action-settings"});this._oSelLstLbl=new sap.m.Label(this.getId()+"-selection-list-label",{text:this._oRb.getText("TARGETFILTER_YOUR_SELECTION_TEXT")+" (0)",labelFor:this.getId()+"-selection-list"}).addStyleClass("sapSuiteUiTFSelLstLbl");this._oSelLst=new sap.m.List(this.getId()+"-selection-list",{mode:"Delete","delete":function(e){this.attachEventOnce("updateFinished",this.focus,this);var I=e.getParameter("listItem");t._aQuadrants[I.getIndex()].removeFilter(I.getKey());},growing:true});this._oScrollCont=new sap.m.ScrollContainer(this.getId()+"-scrl-cntnr",{horizontal:false,vertical:true,height:"17rem",content:this._oSelLst}).addStyleClass("sapSuiteUiTFScroll");this._oShowSelLbl=new sap.m.Link(this.getId()+"-show-selected-label",{press:function(){t.search();}}).addStyleClass("sapSuiteUiTFShowSelLbl");this._oShowSelBox=new sap.m.HBox(this.getId()+"-selection-box",{items:[this._oSearchBtn,this._oShowSelLbl]}).addStyleClass("sapSuiteUiTFShowSelBox");this._oRightPanel=new sap.m.VBox(this.getId()+"-right-panel-box",{items:[this._oSelLstLbl,this._oScrollCont,this._oShowSelBox]}).addStyleClass("sapSuiteUiTFRightPanelBox");this._oCountDisplay=new sap.suite.ui.commons.TargetFilterCountDisplay();this.setAggregation("_countDisplay",this._oCountDisplay);this._oShowSelectedLink=new sap.m.Link(this.getId()+"-show-selected-link",{text:this._oRb.getText("TARGETFILTER_SHOW_ALL_TEXT"),press:function(){t.search();}});this._oSavedFiltersSet={};this._oVariants={};jQuery.sap.require("sap.ui.comp.variants.VariantManagement");this.oVariantManagement=new sap.ui.comp.variants.VariantManagement({enabled:true,showExecuteOnSelection:true,showShare:true,save:function(e){t._oVariants.sSelectedId=e.getParameters().key;t._oVariants[e.getParameters().key]={links:t._getFiltersSet(),aQuadrantsHistory:[],aQuadrantsCBSelected:[]};for(var i=0;i<4;i++){t._oVariants[e.getParameters().key].aQuadrantsCBSelected.push(t._aQuadrants[i]._oColumn.getPath());}if(t._aSelectionHistory.length!=0){for(var i in t._aSelectionHistory){t._oVariants[e.getParameters().key].aQuadrantsHistory[i]=t._aSelectionHistory[i];}}},select:function(e){t._oVariants.sSelectedId=e.getParameters().key;t._oVariants[t._oVariants.sSelectedId].iQHIndex=0;var Q=t._oVariants[t._oVariants.sSelectedId].aQuadrantsHistory;if(Q.length!=0){t._oVariants.steps=[];for(var i in Q){t._oVariants.steps[Q[i]]=2;}t._setVariantsFilterItems(Q[0]);}else{var c=t._oVariants[t._oVariants.sSelectedId].aQuadrantsCBSelected;for(var i=0;i<c.length;i++){t.setQuadCBoxItem(i,c[i]);}var a=t._aSelectionHistory[0];if(t._aSelectionHistory.length!=0){t._aQuadrants[a]._oFilters={};t._aQuadrants[a].getLinkClouds()[0].updateVisibleLinks();t._handleFiltersChange(a);}}}});sap.ui.Device.resize.attachHandler(this._calcWidthTargetWidthRPanel);this.addDelegate({onAfterRendering:function(e){t._calcWidthTargetWidthRPanel();}});this.data("sap-ui-fastnavgroup","true",true);};
sap.suite.ui.commons.TargetFilter.prototype._calcWidthTargetWidthRPanel=function(e){var s=1024;var o=16;var r=Math.min(3,Math.max(0,(parseInt(jQuery('.sapMFlexItem').css("width"))-s)/o));jQuery('.sapUiMedia-Std-Desktop .sapSuiteUiTFRightPanel').css("margin-left",r+"rem");};
sap.suite.ui.commons.TargetFilter.prototype._setVariantsFilterItems=function(q){if(this._oVariants.steps&&this._oVariants.steps[q]!=null){if(this._oVariants[this._oVariants.sSelectedId].iQHIndex>4||this._aQuadrants[q].getLinkClouds()[0].getLinks().length==0||this._oVariants[this._oVariants.sSelectedId].aQuadrantsHistory[this._oVariants[this._oVariants.sSelectedId].iQHIndex]!=q){return;}switch(this._oVariants.steps[q]){case 2:this._oVariants.steps[q]=1;if(!this.setQuadCBoxItem(q,this._oVariants[this._oVariants.sSelectedId].aQuadrantsCBSelected[q])){this._setVariantsFilterItems(q);}break;case 1:this._oVariants.steps[q]=null;this._oVariants[this._oVariants.sSelectedId].iQHIndex++;var l=this._oVariants[this._oVariants.sSelectedId].links[this._oVariants[this._oVariants.sSelectedId].aQuadrantsCBSelected[q]];if(!l){break;}this._aQuadrants[q]._oFilters={};var Q=this._aQuadrants[q].getLinkClouds()[0].getLinks();for(var L in l){for(var i in Q){if(Q[i].getKey()==L){this._aQuadrants[q]._oFilters[L]={filter:new sap.ui.model.Filter(this._aQuadrants[q]._oColumn.getPath(),sap.ui.model.FilterOperator.EQ,L),linkId:Q[i].getId(),text:Q[i].getText()};Q[i].setEmphasized(true).setSubtle(false);}}}this._aQuadrants[q].getLinkClouds()[0].updateVisibleLinks();this._handleFiltersChange(q);break;}}};
sap.suite.ui.commons.TargetFilter.prototype.setQuadCBoxItem=function(q,n){if(this._aQuadrants[q]._oColumn.getPath()==n){return false;}var N={};var I=this._aQuadrants[q]._oFilterCb.getItems();for(var i=0;i<I.length;i++){N[sap.ui.getCore().byId(I[i].getKey()).getPath()]=I[i].getKey();}if(N[n]){this._aQuadrants[q].setColumn(N[n]);return true;}return false;};
sap.suite.ui.commons.TargetFilter.prototype.search=function(){this.fireSearch();this._oSavedFiltersSet=this._getFiltersSet();return this;};
sap.suite.ui.commons.TargetFilter.prototype._getFiltersSet=function(){var f={};for(var i=0;i<this._aQuadrants.length;i++){var F=this._aQuadrants[i].getFiltersSet();var q={};for(var y=0;y<F.length;y++){q[F[y].key]={};}if(F.length){f[this._aQuadrants[i]._oColumn.getPath()]=q;}}return f;};
sap.suite.ui.commons.TargetFilter.prototype.getParameters=function(){return{};};
sap.suite.ui.commons.TargetFilter.prototype.getFilters=function(){var f=[];for(var i=0;i<this._aSelectionHistory.length;i++){var F=this._aQuadrants[this._aSelectionHistory[i]].getFilters();if(F){f.push(F);}}if(f.length){return[new sap.ui.model.Filter(f,true)];}else{return f;}};
sap.suite.ui.commons.TargetFilter.prototype._handleFiltersChange=function(q){this.iCountFilters=0;var Q=this._aSelectionHistory.indexOf(q);if(Q==-1){this._aSelectionHistory.push(q);}else{this._aSelectionHistory.splice(this._aQuadrants[q].hasFilters()?Q+1:Q);}this._oSelLst.removeAllItems();for(var i=0;i<this._aSelectionHistory.length;i++){var f=this._aQuadrants[this._aSelectionHistory[i]].getFiltersSet();if(f.length){var I=new sap.m.GroupHeaderListItem({title:this._aQuadrants[this._aSelectionHistory[i]]._oColumn.getTitle(),upperCase:false});this._oSelLst.addItem(I);for(var y=0;y<f.length;y++){var I=new sap.suite.ui.commons.TargetFilterListItem({title:f[y].text,key:f[y].key,index:this._aSelectionHistory[i]});this._oSelLst.addItem(I);this.iCountFilters++;}}}this._oSelLst.rerender();var f=this.getFilters();for(var i=0;i<this._aQuadrants.length;i++){Q=this._aSelectionHistory.indexOf(i);if(Q==-1&&q!=i){this._aQuadrants[i].filter(f);}}this._oCountDisplay.filter(f);this.fireFilterChange();var c=this._getFiltersSet();if(this.equalFiltersSet(c,this._oSavedFiltersSet)){this.fireCancel();}this._oSelLstLbl.setText(this._oRb.getText("TARGETFILTER_YOUR_SELECTION_TEXT")+" ("+this.iCountFilters+")");};
sap.suite.ui.commons.TargetFilter.prototype.equalFiltersSet=function(f,F){var a=Object.getOwnPropertyNames(f);var b=Object.getOwnPropertyNames(F);if(a.length!=b.length){return false;}for(var i=0;i<a.length;i++){var s=a[i];if(!F.hasOwnProperty(s)||!this.equalFiltersSet(f[s],F[s])){return false;}}return true;};
sap.suite.ui.commons.TargetFilter.prototype._bindModel=function(){if(this._bBindModel){this._bBindModel=false;for(var i=0;i<this._aQuadrants.length;i++){this._aQuadrants[i].rebindColumns();}var t=this;this._oCountDisplay.bindAggregation("counts",{path:"/"+this.getEntitySet(),parameters:{select:this.getMeasureColumn().getPath()},length:1,template:new sap.suite.ui.commons.TargetFilterCount({count:{path:this.getMeasureColumn().getPath(),type:this.getMeasureColumn().getType()},countUpdated:function(){t._oShowSelLbl.setText(t._oRb.getText((t.iCountFilters>0)?"TARGETFILTER_SHOW_SELECTED_TEXT":"TARGETFILTER_SHOW_ALL_TEXT")+" ("+this.getCount()+")");}})});}};
sap.suite.ui.commons.TargetFilter.prototype._callMethodInManagedObject=function(f,e){if(e==="columns"||e==="entitySet"||e==="measureColumnName"){this._bBindModel=true;}var a=Array.prototype.slice.call(arguments);return sap.ui.core.Control.prototype[f].apply(this,a.slice(1));};
sap.suite.ui.commons.TargetFilter.prototype.setProperty=function(p,v,s){this._callMethodInManagedObject("setProperty",p,v,s);return this;};
sap.suite.ui.commons.TargetFilter.prototype.insertAggregation=function(a,o,i,s){this._callMethodInManagedObject("insertAggregation",a,o,i,s);return this;};
sap.suite.ui.commons.TargetFilter.prototype.addAggregation=function(a,o,s){this._callMethodInManagedObject("addAggregation",a,o,s);return this;};
sap.suite.ui.commons.TargetFilter.prototype.removeAggregation=function(a,o,s){return this._callMethodInManagedObject("removeAggregation",a,o,s);};
sap.suite.ui.commons.TargetFilter.prototype.removeAllAggregation=function(a,s){return this._callMethodInManagedObject("removeAllAggregation",a,s);};
sap.suite.ui.commons.TargetFilter.prototype.destroyAggregation=function(a,s){this._callMethodInManagedObject("destroyAggregation",a,s);return this;};
sap.suite.ui.commons.TargetFilter.prototype.onBeforeRendering=function(){this._bindModel();};
sap.suite.ui.commons.TargetFilter.prototype.onAfterRendering=function(){var t=this;this._oShowSelBox.$().attr("tabindex","0");this._oShowSelBox.addDelegate({onkeypress:function(e){if(e.which==jQuery.sap.KeyCodes.ENTER||e.which==jQuery.sap.KeyCodes.SPACE){t._oSearchBtn.firePress();e.preventDefault();}}});this._oShowSelLbl.$().attr("tabindex","-1");this._oSearchBtn.$().attr("tabindex","-1");};
sap.suite.ui.commons.TargetFilter.prototype.exit=function(){sap.ui.Device.media.detachHandler(this.rerender,this,sap.ui.Device.media.RANGESETS.SAP_STANDARD);this._oSearchBtn.destroy();this._oSettingsBtn.destroy();this._oSelLstLbl.destroy();this._oSelLst.destroy();this._oScrollCont.destroy();this._oShowSelLbl.destroy();this._oShowSelBox.destroy();this._oRightPanel.destroy();this._oShowSelectedLink.destroy();};
