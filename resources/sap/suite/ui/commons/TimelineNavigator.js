/*!
 * 
 * 		SAP UI development toolkit for HTML5 (SAPUI5)
 * 		(c) Copyright 2009-2015 SAP SE. All rights reserved
 * 	
 */
sap.ui.define(["sap/ui/core/delegate/ItemNavigation"],function(I){"use strict";function s(S,p){var d=S.length-p.length;return d>=0&&S.lastIndexOf(p)===d;}var T=I.extend("sap.suite.ui.commons.TimelineNavigator",{constructor:function(d,i,n,r){I.apply(this,arguments);this.setCycling(false);this._aRows=r;}});T.prototype.updateReferences=function(d,i,r){this.setRootDomRef(d);this.setItemDomRefs(i);this._aRows=r;};T.prototype._callParent=function(f,a){if(typeof I.prototype[f]==="function"){I.prototype[f].apply(this,a);}};T.prototype._onF7=function(e){if(!jQuery.sap.containsOrEquals(this.oDomRef,e.target)){return;}var f=this.getFocusedIndex();if(f>=0){this.focusItem(f,e);e.preventDefault();e.stopPropagation();}};T.prototype.onsapspace=function(e){this.onsapenter(e);};T.prototype.onsapenter=function(e){var i,E;if(this._skipNavigation(e,false,true)){return;}E=jQuery(this.getFocusedDomRef());i=E.attr("id");if(s(i,"-outline")){if(E.hasClass("sapSuiteUiCommonsTimelineGroupHeaderMainWrapper")){i=i.substr(0,i.length-"outline".length)+"groupCollapseIcon";E.find("#"+i).mousedown().mouseup().click();}else{E.find("div[role='toolbar']").children().first().mousedown().mouseup().click();}e.preventDefault();e.stopPropagation();}else if(s(i,"-showMoreWrapper")){E.find("span").mousedown().mouseup().click();e.preventDefault();e.stopPropagation();}};T.prototype.onsaphome=function(e){if(this.aItemDomRefs.length===0){return;}this._callParent("onsaphome",arguments);};T.prototype.onkeyup=function(e){var i,c=false;this._callParent("onkeyup",arguments);if(!jQuery.sap.containsOrEquals(this.oDomRef,e.target)){return;}if(e.keyCode===jQuery.sap.KeyCodes.F7){this._onF7(e);}if(e.keyCode!==jQuery.sap.KeyCodes.TAB&&e.keyCode!==jQuery.sap.KeyCodes.F6){return;}if(!jQuery.sap.containsOrEquals(this.getFocusedDomRef(),e.target)){this.iFocusedIndex=-1;c=true;}if(this.iFocusedIndex<0){for(i=0;i<this.aItemDomRefs.length;i++){if(jQuery.sap.containsOrEquals(this.aItemDomRefs[i],e.target)){this.iFocusedIndex=i;c=true;break;}}}if(c){this.setItemsTabindex();}};T.prototype.onmousedown=function(e){var S=e.target;var c=function(d,o){var f=false;var C=jQuery(d);while(!C.is(":sapFocusable")&&C.get(0)!=o){C=C.parent();}if(C.get(0)!=o){f=true;}return f;};if(jQuery.sap.containsOrEquals(this.oDomRef,S)){for(var i=0;i<this.aItemDomRefs.length;i++){var o=this.aItemDomRefs[i];if(jQuery.sap.containsOrEquals(o,S)){if(o===S||!c(S,o)){this.focusItem(i,e);}return;}}this._bMouseDownHappened=true;var t=this;window.setTimeout(function(){t._bMouseDownHappened=false;},20);}};T.prototype.onsapnext=function(e){var i,f=true,c,n,o;if(!this._aRows){this._callParent("onsapnext",arguments);return;}if(this._skipNavigation(e,true,false)){return;}e.preventDefault();e.stopPropagation();if(this.getFocusedIndex()<0){return;}c=this._findPosition(this.iFocusedIndex);if(c===null){throw new Error("TimelineNavigation cannot obtain a position of focused item and hance it cannot senect next.");}n=jQuery.extend({},c);do{if(e.keyCode===jQuery.sap.KeyCodes.ARROW_DOWN){n.iY++;if(n.iY>=this._aRows.length){if(n.iX+1>=this._aRows[this._aRows.length-1].length){return;}n.iY=0;n.iX++;}}else{n.iX++;if(n.iX>=this._aRows[n.iY].length){if(n.iY>=this._aRows.length){return;}n.iX=0;n.iY++;}}if(n.iX===c.iX&&n.iY===c.iY){if(f){f=false;}else{return;}}o=this._aRows[n.iY][n.iX];}while(!o||!jQuery(o).is(":sapFocusable"));i=this._findIndex(n);this.focusItem(i,e);};T.prototype.onsapprevious=function(e){var i,f=true,c,n,o;if(!this._aRows){this._callParent("onsapprevious",arguments);return;}if(this._skipNavigation(e,true,false)){return;}e.preventDefault();e.stopPropagation();if(this.getFocusedIndex()<0){return;}c=this._findPosition(this.iFocusedIndex);if(c===null){throw new Error("TimelineNavigation cannot obtain a position of focused item and hance it cannot senect next.");}n=jQuery.extend({},c);do{if(e.keyCode===jQuery.sap.KeyCodes.ARROW_UP){n.iY--;if(n.iY<0){if(n.iX<=0){return;}n.iY=this._aRows.length-1;n.iX--;}}else{n.iX--;if(n.iX<0){if(n.iY<=0){return;}n.iX=this._aRows[n.iY].length-1;n.iY--;}}if(n.iX===c.iX&&n.iY===c.iY){if(f){f=false;}else{return;}}o=this._aRows[n.iY][n.iX];}while(!o||!jQuery(o).is(":sapFocusable"));i=this._findIndex(n);this.focusItem(i,e);};T.prototype._findPosition=function(i){var x,y,o=this.aItemDomRefs[i];for(y=0;y<this._aRows.length;y++){for(x=0;x<this._aRows[y].length;x++){if(o===this._aRows[y][x]){return{iX:x,iY:y};}}}return null;};T.prototype._findIndex=function(p){var o=this._aRows[p.iY][p.iX],i;for(i=0;i<this.aItemDomRefs.length;i++){if(o===this.aItemDomRefs[i]){return i;}}return null;};T.prototype._skipNavigation=function(e,c,C){return!jQuery.sap.containsOrEquals(this.oDomRef,e.target)||(this.getFocusedIndex()<0&&C)||jQuery.inArray(e.target,this.aItemDomRefs)===-1||(jQuery(this.oDomRef).data("sap.InNavArea")&&c);};return T;});
