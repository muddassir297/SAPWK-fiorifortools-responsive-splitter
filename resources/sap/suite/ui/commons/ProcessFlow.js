/*!
 * 
 * 		SAP UI development toolkit for HTML5 (SAPUI5)
 * 		(c) Copyright 2009-2015 SAP SE. All rights reserved
 * 	
 */
jQuery.sap.declare("sap.suite.ui.commons.ProcessFlow");jQuery.sap.require("sap.suite.ui.commons.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.suite.ui.commons.ProcessFlow",{metadata:{publicMethods:["getZoomLevel","setZoomLevel","zoomIn","zoomOut","updateModel","getFocusedNode","updateNodesOnly","setSelectedPath"],library:"sap.suite.ui.commons",properties:{"foldedCorners":{type:"boolean",group:"Misc",defaultValue:false},"scrollable":{type:"boolean",group:"Misc",defaultValue:true},"wheelZoomable":{type:"boolean",group:"Behavior",defaultValue:true},"showLabels":{type:"boolean",group:"Appearance",defaultValue:false}},defaultAggregation:"lanes",aggregations:{"_connections":{type:"sap.suite.ui.commons.ProcessFlowConnection",multiple:true,singularName:"_connection",visibility:"hidden"},"nodes":{type:"sap.suite.ui.commons.ProcessFlowNode",multiple:true,singularName:"node"},"lanes":{type:"sap.suite.ui.commons.ProcessFlowLaneHeader",multiple:true,singularName:"lane"}},events:{"nodeTitlePress":{deprecated:true,parameters:{"oEvent":{type:"object"}}},"nodePress":{parameters:{"oEvent":{type:"object"}}},"labelPress":{parameters:{"oEvent":{type:"object"}}},"headerPress":{parameters:{"oEvent":{type:"object"}}},"onError":{parameters:{"oEvent":{type:"object"}}}}}});sap.suite.ui.commons.ProcessFlow.M_EVENTS={'nodeTitlePress':'nodeTitlePress','nodePress':'nodePress','labelPress':'labelPress','headerPress':'headerPress','onError':'onError'};jQuery.sap.require("sap.m.Image");sap.suite.ui.commons.ProcessFlow.prototype._resBundle=null;sap.suite.ui.commons.ProcessFlow._cellEdgeConstants={'LU':'tl','LD':'lb','DU':'tb','LR':'rl','DR':'rt','UR':'rb'};sap.suite.ui.commons.ProcessFlow._constants={scrollContainer:"scrollContainer",counterLeft:"counterLeft",counterRight:"counterRight",arrowScrollRight:"arrowScrollRight",arrowScrollRightMinus:"-arrowScrollRight",arrowScrollLeft:"arrowScrollLeft",arrowScrollLeftMinus:"-arrowScrollLeft",top:"top",px:"px",parents:"parents",left:"left",right:"right"};sap.suite.ui.commons.ProcessFlow._mouseEvents={mouseMove:'mousemove',mouseDown:'mousedown',mouseUp:'mouseup',mouseLeave:'mouseleave',mouseEnter:'mouseenter',touchStart:'touchstart',sapTouchStart:'saptouchstart',touchEnd:'touchend',sapTouchCancel:'saptouchcancel'};sap.suite.ui.commons.ProcessFlow._enumMoveDirection={'LEFT':'left','RIGHT':'right','UP':'up','DOWN':'down'};sap.suite.ui.commons.ProcessFlow.prototype._zoomLevel=sap.suite.ui.commons.ProcessFlowZoomLevel.Two;sap.suite.ui.commons.ProcessFlow.prototype._wheelTimeout=null;sap.suite.ui.commons.ProcessFlow.prototype._isFocusChanged=false;sap.suite.ui.commons.ProcessFlow.prototype._wheelTimestamp=null;sap.suite.ui.commons.ProcessFlow.prototype._wheelCalled=false;sap.suite.ui.commons.ProcessFlow.prototype._internalCalcMatrix=false;sap.suite.ui.commons.ProcessFlow.prototype._internalConnectionMap=null;sap.suite.ui.commons.ProcessFlow.prototype._internalLanes=false;sap.suite.ui.commons.ProcessFlow.prototype._jumpOverElements=5;sap.suite.ui.commons.ProcessFlow.prototype._lastNavigationFocusElement=null;sap.suite.ui.commons.ProcessFlow.prototype._bHighlightedMode=false;sap.suite.ui.commons.ProcessFlow.prototype._isLayoutOptimized=false;sap.suite.ui.commons.ProcessFlow.prototype._defaultCursorClass="sapSuiteUiDefaultCursorPF";if(sap.ui.Device.browser.msie){sap.suite.ui.commons.ProcessFlow.prototype._grabCursorClass="sapSuiteUiGrabCursorIEPF";sap.suite.ui.commons.ProcessFlow.prototype._grabbingCursorClass="sapSuiteUiGrabbingCursorIEPF";}else{sap.suite.ui.commons.ProcessFlow.prototype._grabCursorClass="sapSuiteUiGrabCursorPF";sap.suite.ui.commons.ProcessFlow.prototype._grabbingCursorClass="sapSuiteUiGrabbingCursorPF";}sap.suite.ui.commons.ProcessFlow.prototype._mousePreventEvents='contextmenu dblclick';sap.suite.ui.commons.ProcessFlow.prototype._mouseEvents='contextmenu mousemove mouseleave mousedown mouseup mouseenter';sap.suite.ui.commons.ProcessFlow.prototype._mouseWheelEvent=(sap.ui.Device.browser.mozilla)?'DOMMouseScroll MozMousePixelScroll':'mousewheel wheel';sap.suite.ui.commons.ProcessFlow.prototype._headerHasFocus=false;sap.suite.ui.commons.ProcessFlow.prototype._isInitialZoomLevelNeeded=true;sap.suite.ui.commons.ProcessFlow.prototype._bDoScroll=!sap.ui.Device.system.desktop||(sap.ui.Device.os.windows&&sap.ui.Device.os.version===8);sap.suite.ui.commons.ProcessFlow.prototype._scrollStep=192;sap.suite.ui.commons.ProcessFlow.prototype._bPreviousScrollForward=false;sap.suite.ui.commons.ProcessFlow.prototype._bPreviousScrollBack=false;sap.suite.ui.commons.ProcessFlow.prototype._iInitialArrowTop=undefined;sap.suite.ui.commons.ProcessFlow.prototype._iInitialCounterTop=undefined;sap.suite.ui.commons.ProcessFlow.prototype._bRtl=false;sap.suite.ui.commons.ProcessFlow.prototype._arrowScrollable=null;sap.suite.ui.commons.ProcessFlow.prototype._iTouchStartScrollTop=undefined;sap.suite.ui.commons.ProcessFlow.prototype._iTouchStartScrollLeft=undefined;sap.suite.ui.commons.ProcessFlow.prototype._bSetFocusOnce=true;
sap.suite.ui.commons.ProcessFlow.prototype.init=function(){this._bRtl=sap.ui.getCore().getConfiguration().getRTL();if(!this._resBundle){this._resBundle=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");}this._internalLanes=[];if(this._getScrollContainer()){this._getScrollContainer().bind('keydown',jQuery.proxy(this.onkeydown,this));}};
sap.suite.ui.commons.ProcessFlow.prototype.exit=function(){var n=this.getNodes();if(n){for(var i=0;i<n.length;i++){if(n[i]){n[i].destroy();}}n=null;}if(this._internalLanes){for(var i=0;i<this._internalLanes.length;i++){this._internalLanes[i].destroy();}this._internalLanes=null;}var I=this.getAggregation("_connections");if(I){for(var i=0;i<I.length;i++){I[i].destroy();}I=null;}if(this._oArrowLeft){this._oArrowLeft.destroy();}if(this._oArrowRight){this._oArrowRight.destroy();}if(this._resizeRegId){sap.ui.core.ResizeHandler.deregister(this._resizeRegId);}if(this._internalCalcMatrix){delete this._internalCalcMatrix;this._internalCalcMatrix=null;}if(this._getScrollContainer()){this._getScrollContainer().unbind(this._mousePreventEvents,this._handlePrevent);this._getScrollContainer().unbind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));this._getScrollContainer().unbind(this._mouseWheelEvent,jQuery.proxy(this._registerMouseWheel,this));this._getScrollContainer().unbind('keydown',jQuery.proxy(this.onkeydown,this));this._getScrollContainer().unbind('scroll',jQuery.proxy(this._onScroll,this));}};
sap.suite.ui.commons.ProcessFlow.prototype.onBeforeRendering=function(){if(this._getScrollContainer()){this._getScrollContainer().unbind(this._mousePreventEvents,this._handlePrevent);this._getScrollContainer().unbind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));this._getScrollContainer().unbind(this._mouseWheelEvent,jQuery.proxy(this._registerMouseWheel,this));this._getScrollContainer().unbind('keydown',jQuery.proxy(this.onkeydown,this));this._getScrollContainer().unbind('scroll',jQuery.proxy(this._onScroll,this));}};
sap.suite.ui.commons.ProcessFlow.prototype.onAfterRendering=function(){var s=false,$=this.$("scroll-content"),h,w,S,i;this._checkOverflow(this._getScrollContainer().get(0),this.$());this.iCursorPositionX=0;this.iCursorPositionY=0;if($&&$.length){this._getScrollContainer().find('.sapSuiteUiCommonsProcessFlowNode .sapUiIcon').css("cursor","inherit");if(this.getScrollable()){h=parseInt(this._getScrollContainer().css("height").slice(0,-2),10);w=parseInt(this._getScrollContainer().css("width").slice(0,-2),10);i=$[0].scrollHeight;S=$[0].scrollWidth;if(i<=h&&S<=w){this._clearHandlers(this._getScrollContainer());this._switchCursors(this._getScrollContainer(),this._grabCursorClass,this._defaultCursorClass);}else{this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabCursorClass);s=true;}}else{this._clearHandlers(this._getScrollContainer());this._switchCursors(this._getScrollContainer(),this._grabCursorClass,this._defaultCursorClass);$.css("position","static");}if(s){if(!this._iInitialArrowTop||!this._iInitialCounterTop){this._iInitialArrowTop=parseInt(this.$(sap.suite.ui.commons.ProcessFlow._constants.arrowScrollRight).css(sap.suite.ui.commons.ProcessFlow._constants.top),10);this._iInitialCounterTop=parseInt(this.$(sap.suite.ui.commons.ProcessFlow._constants.counterRight).css(sap.suite.ui.commons.ProcessFlow._constants.top),10);}if(sap.ui.Device.os.windows&&sap.ui.Device.system.combi&&sap.ui.Device.browser.chrome){this._getScrollContainer().bind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));this._getScrollContainer().css("overflow","auto");}else if(sap.ui.Device.os.windows&&sap.ui.Device.system.combi&&sap.ui.Device.browser.msie&&(sap.ui.Device.browser.version>9)){this._getScrollContainer().bind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));this._getScrollContainer().css("overflow","auto");this._getScrollContainer().css("-ms-overflow-style","none");}else if(!sap.ui.Device.support.touch&&!jQuery.sap.simulateMobileOnDesktop){this._getScrollContainer().bind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));}else{this._clearHandlers(this._getScrollContainer());this._getScrollContainer().css("overflow","auto");}}else{if(this._bDoScroll){this._getScrollContainer().css("overflow","auto");}else{this._getScrollContainer().css("overflow","hidden");}}if(this.getWheelZoomable()&&sap.ui.Device.system.desktop&&!this._isHeaderMode()){this._getScrollContainer().bind(this._mouseWheelEvent,jQuery.proxy(this._registerMouseWheel,this));}if(this._bDoScroll){this._getScrollContainer().bind("scroll",jQuery.proxy(this._onScroll,this));}this._resizeRegId=sap.ui.core.ResizeHandler.register(this,jQuery.proxy(sap.suite.ui.commons.ProcessFlow.prototype._onResize,this));if(this._isInitialZoomLevelNeeded){this._initZoomLevel();}if(this._headerHasFocus){this._headerHasFocus=false;var a=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId(a[0].id);this._changeNavigationFocus(null,n);}}};
sap.suite.ui.commons.ProcessFlow.prototype.ontouchend=function(e){if(e.target&&e.target.id.indexOf("arrowScroll")!=-1){this._onArrowClick(e);}else{if(!sap.ui.Device.support.touch&&!jQuery.sap.simulateMobileOnDesktop){this.onAfterRendering();}else{this._adjustAndShowArrow();}if(e===null||e.oSource===undefined){return;}e.preventDefault();if(this&&this._isHeaderMode()){this._internalLanes=[];this.fireHeaderPress(this);}}};
sap.suite.ui.commons.ProcessFlow.prototype._handlePrevent=function(e){if(e&&!e.isDefaultPrevented()){e.preventDefault();}if(e&&!e.isPropagationStopped()){e.stopPropagation();}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation();}};
sap.suite.ui.commons.ProcessFlow.prototype._onResize=function(){var a=new Date().getTime();if(!this._iLastResizeEventTime||((a-this._iLastResizeEventTime)<50)){if(!this._iLastResizeHandlingTime||(a-this._iLastResizeHandlingTime>500)){this.onAfterRendering();this._iLastResizeHandlingTime=new Date().getTime();}}else{this._iLastResizeHandlingTime=null;}this._iLastResizeEventTime=new Date().getTime();};
sap.suite.ui.commons.ProcessFlow.prototype._registerMouseEvents=function(e){if(e&&!e.isDefaultPrevented()){e.preventDefault();}switch(e.type){case sap.suite.ui.commons.ProcessFlow._mouseEvents.mouseMove:if(this._getScrollContainer().hasClass(this._grabbingCursorClass)){if(sap.ui.getCore().getConfiguration().getRTL()){this._getScrollContainer().scrollLeftRTL(this.iCursorPositionX-e.pageX);}else{this._getScrollContainer().scrollLeft(this.iCursorPositionX-e.pageX);}this._getScrollContainer().scrollTop(this.iCursorPositionY-e.pageY);this._adjustAndShowArrow();}break;case sap.suite.ui.commons.ProcessFlow._mouseEvents.mouseDown:this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabbingCursorClass);if(sap.ui.getCore().getConfiguration().getRTL()){this.iCursorPositionX=this._getScrollContainer().scrollLeftRTL()+e.pageX;}else{this.iCursorPositionX=this._getScrollContainer().scrollLeft()+e.pageX;}this.iCursorPositionY=this._getScrollContainer().scrollTop()+e.pageY;if(sap.ui.Device.system.combi){this._iTouchStartScrollLeft=this._getScrollContainer().scrollLeft();if(this.getScrollable()){this._iTouchStartScrollTop=this._getScrollContainer().scrollTop();}}break;case sap.suite.ui.commons.ProcessFlow._mouseEvents.mouseUp:this._switchCursors(this._getScrollContainer(),this._grabbingCursorClass,this._grabCursorClass);break;case sap.suite.ui.commons.ProcessFlow._mouseEvents.mouseLeave:this._getScrollContainer().removeClass(this._grabbingCursorClass);this._getScrollContainer().removeClass(this._grabCursorClass);this._getScrollContainer().addClass(this._defaultCursorClass);break;case sap.suite.ui.commons.ProcessFlow._mouseEvents.mouseEnter:this._getScrollContainer().removeClass(this._defaultCursorClass);if(e.buttons===null){if(e.which===1){this._getScrollContainer().addClass(this._grabbingCursorClass);}else{this._getScrollContainer().addClass(this._grabCursorClass);}}else{if(e.buttons===0){this._getScrollContainer().addClass(this._grabCursorClass);}else if(e.buttons===1){this._getScrollContainer().addClass(this._grabbingCursorClass);}}break;}if(e.target&&e.target.parentElement&&e.target.parentElement.parentElement&&e.target.parentElement.parentElement instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel){if(e&&!e.isPropagationStopped()){e.stopPropagation();}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation();}}};
sap.suite.ui.commons.ProcessFlow.prototype.onfocusin=function(e){var t;if(e&&e.target&&e.target.id){t=sap.ui.getCore().byId(e.target.id);}if(this._isHeaderMode()){this._setFocusOnHeader(true);}else{if(this._bSetFocusOnce){this._bSetFocusOnce=false;if(t&&t instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel){this._changeNavigationFocus(null,t);}else{if(!this._lastNavigationFocusElement){var $=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId($[0].id);this._changeNavigationFocus(null,n);}else{this._changeNavigationFocus(null,this._lastNavigationFocusElement);}}}}};
sap.suite.ui.commons.ProcessFlow.prototype.onfocusout=function(e){this._bSetFocusOnce=true;if(this._lastNavigationFocusElement&&this._lastNavigationFocusElement._getNavigationFocus()){this._lastNavigationFocusElement._setNavigationFocus(false);if(this._lastNavigationFocusElement instanceof sap.suite.ui.commons.ProcessFlowNode){this._lastNavigationFocusElement.rerender();}}};
sap.suite.ui.commons.ProcessFlow.prototype.onsapplus=function(e){this._isFocusChanged=true;this.zoomIn();};
sap.suite.ui.commons.ProcessFlow.prototype.onsapminus=function(e){this._isFocusChanged=true;this.zoomOut();};
sap.suite.ui.commons.ProcessFlow.prototype.onsaptabnext=function(e){var n=true;var $=e.target;if(e.target&&e.target.childElementCount>0){$=e.target.childNodes[0];}var a=sap.ui.getCore().byId($.id);if(!(a instanceof sap.suite.ui.commons.ProcessFlowNode)&&!(a instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel)){if(!this._isHeaderMode()&&!this._lastNavigationFocusElement){var b=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var N=sap.ui.getCore().byId(b[0].id);this._changeNavigationFocus(null,N);n=false;}else if(this._lastNavigationFocusElement){this._changeNavigationFocus(null,this._lastNavigationFocusElement);n=false;}}if(this._isHeaderMode()&&n){if(!this._headerHasFocus){this._setFocusOnHeader(true);}else{this._setFocusOnHeader(false);}}else{if((this._lastNavigationFocusElement instanceof sap.suite.ui.commons.ProcessFlowNode)){this._lastNavigationFocusElement.rerender();}}if(n){var o=this.$().nextAll().find(":focusable").first();if(o.length===0){s.bind(this)();}o.focus();jQuery.sap.log.debug("saptabnext: Keyboard focus has been changed to element:  id='"+o.id+"' outerHTML='"+n.outerHTML+"'");o=null;}e.preventDefault();function s(){var c=this.$().parent();do{o=c.next(":focusable");if(o.length===0){o=c.nextAll().find(":focusable").first();}c=c.parent();}while((c.length!==0)&&(o.length===0));return;}};
sap.suite.ui.commons.ProcessFlow.prototype.onsaptabprevious=function(e){var p=null;var $=e.target;if((!this._lastNavigationFocusElement||!this._lastNavigationFocusElement._getNavigationFocus())&&e.target&&e.target.childElementCount>0){$=e.target.childNodes[0];}var a=sap.ui.getCore().byId($.id);if(a&&((a instanceof sap.suite.ui.commons.ProcessFlowNode)||(a instanceof sap.suite.ui.commons.ProcessFlowConnection))){if(!this._isHeaderMode()&&!this._lastNavigationFocusElement){var b=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId(b[0].id);this._changeNavigationFocus(null,n);}else if(this._lastNavigationFocusElement){this._changeNavigationFocus(null,this._lastNavigationFocusElement);e.preventDefault();return;}}if(this._isHeaderMode()){if(!this._headerHasFocus){this._setFocusOnHeader(true);}else{this._setFocusOnHeader(false);p=this.$().prevAll().find(":focusable").first();}}else{p=this.$().prev(":focusable");if(p.length===0){p=this.$().prevAll().find(":focusable").first();}if(this._lastNavigationFocusElement){this._lastNavigationFocusElement._setNavigationFocus(false);}if(this._lastNavigationFocusElement instanceof sap.suite.ui.commons.ProcessFlowNode){this._lastNavigationFocusElement.rerender();}}if(p){if(p.length===0){s.bind(this)();}else if(p.first().length!==0){p=jQuery(p.first());}p.focus();jQuery.sap.log.debug("saptabnext: Keyboard focus has been set on element:  id='"+p.id+"' outerHTML='"+p.outerHTML+"'");p=null;}e.preventDefault();function s(){var c=this.$();do{p=c.prev(":focusable");if(p.length===0){p=c.prevAll().find(":focusable").last();}c=c.parent();}while((c.length!==0)&&(p.length===0));return;}};
sap.suite.ui.commons.ProcessFlow.prototype.onsapselect=function(e){if(this._isHeaderMode()){this._internalLanes=[];this.fireHeaderPress(this);var $=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId($[0].id);this._changeNavigationFocus(null,n);}else{if(this._lastNavigationFocusElement instanceof sap.suite.ui.commons.ProcessFlowNode&&this._lastNavigationFocusElement._getNavigationFocus()){this.fireNodePress(this._lastNavigationFocusElement);}}};
sap.suite.ui.commons.ProcessFlow.prototype.onkeydown=function(e){var k=(e.keyCode?e.keyCode:e.which);jQuery.sap.log.debug("ProcessFlow::keyboard input has been catched and action going to start: keycode="+k);var E=false;var c=e.ctrlKey;var a=e.altKey;var p=this._lastNavigationFocusElement;switch(k){case jQuery.sap.KeyCodes.ARROW_RIGHT:E=this._moveToNextElement(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT);break;case jQuery.sap.KeyCodes.ARROW_LEFT:E=this._moveToNextElement(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT);break;case jQuery.sap.KeyCodes.ARROW_DOWN:E=this._moveToNextElement(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.DOWN);break;case jQuery.sap.KeyCodes.ARROW_UP:E=this._moveToNextElement(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.UP);break;case jQuery.sap.KeyCodes.PAGE_UP:E=this._moveOnePage(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.UP,a);break;case jQuery.sap.KeyCodes.PAGE_DOWN:E=this._moveOnePage(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.DOWN,a);break;case jQuery.sap.KeyCodes.HOME:E=this._moveHomeEnd(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT,c);break;case jQuery.sap.KeyCodes.END:E=this._moveHomeEnd(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT,c);break;case jQuery.sap.KeyCodes.NUMPAD_0:case jQuery.sap.KeyCodes.DIGIT_0:this._initZoomLevel();break;case jQuery.sap.KeyCodes.ENTER:case jQuery.sap.KeyCodes.SPACE:e.preventDefault();return;default:return;}e.preventDefault();if(E){this._changeNavigationFocus(p,this._lastNavigationFocusElement);}};
sap.suite.ui.commons.ProcessFlow.prototype._onArrowClick=function(e){var t=e.target.id;if(t){var i=this.getId();e.preventDefault();if(t==i+sap.suite.ui.commons.ProcessFlow._constants.arrowScrollLeftMinus&&sap.ui.Device.system.desktop){this._scroll(-this._scrollStep,500);}else if(t==i+sap.suite.ui.commons.ProcessFlow._constants.arrowScrollRightMinus&&sap.ui.Device.system.desktop){this._scroll(this._scrollStep,500);}}};
sap.suite.ui.commons.ProcessFlow.prototype._onScroll=function(e){var s=this._getScrollContainer().scrollLeft();var d=Math.abs(s-this._iTouchStartScrollLeft);if(d>(this._scrollStep/4)&&!this._isFocusChanged){this._adjustAndShowArrow();this._iTouchStartScrollLeft=s;}else{if(this.getScrollable()){var S=this._getScrollContainer().scrollTop();var D=Math.abs(S-this._iTouchStartScrollTop);if(D>10){this._moveArrowAndCounterVertical();this._iTouchStartScrollTop=S;}}}};
sap.suite.ui.commons.ProcessFlow.prototype.ontouchstart=function(e){this._iTouchStartScrollLeft=this._getScrollContainer().scrollLeft();if(this.getScrollable()){this._iTouchStartScrollTop=this._getScrollContainer().scrollTop();}};
sap.suite.ui.commons.ProcessFlow.prototype._handleLabelClick=function(e){if(e){var c=e.getSource();if(c instanceof sap.ui.core.Icon){c=c.getParent();}if(c instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel){var r=this._getConnectionMapEntries(c);var a=this._createLabelPressEventArgs(c,r);this.fireLabelPress(a);}}};
sap.suite.ui.commons.ProcessFlow.prototype._onFocusChanged=function(){var f=this._lastNavigationFocusElement,$=f?f.$():null,s,S,i,a,b,c,C,e,E,p,d,g,h,j,k,l,m=500;if(f&&this.getScrollable()){jQuery.sap.log.debug("The actually focused element is "+f.getId());if(f instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel){e=$.parent().parent().parent().outerWidth();E=$.parent().parent().parent().outerHeight();p=$.parent().parent().parent().position();}else{e=$.outerWidth();E=$.outerHeight();p=$.position();}jQuery.sap.log.debug("Element outer width x height ["+e+" x "+E+"]");jQuery.sap.log.debug("Position of element in the content is ["+p.left+", "+p.top+"]");b=this.$("scroll-content");s=this._getScrollContainer().innerWidth();S=this._getScrollContainer().innerHeight();jQuery.sap.log.debug("Scroll container inner width x height ["+s+" x "+S+"]");i=this._getScrollContainer().scrollLeft();a=this._getScrollContainer().scrollTop();jQuery.sap.log.debug("Current scroll offset is ["+i+", "+a+"]");c=b.innerWidth();C=b.innerHeight();jQuery.sap.log.debug("Scroll content inner width x height ["+c+" x "+C+"]");d=-i+p.left;h=d+e;g=-a+p.top;j=g+E;if((h>s)||(d<0)||(j>S)||(g<0)){k=Math.round((s-e)/2);k=Math.max(s-c+p.left,k);k=Math.min(p.left,k);l=Math.round((S-E)/2);l=Math.max(S-C+p.top,l);l=Math.min(p.top,l);jQuery.sap.log.debug("Element lies outside the scroll container, scrolling from ["+d+","+g+"] to ["+k+","+l+"]");this._isFocusChanged=true;this._getScrollContainer().animate({scrollTop:p.top-l,scrollLeft:p.left-k},m,"swing",jQuery.proxy(this._adjustAndShowArrow,this));}else{jQuery.sap.log.debug("Element lies inside the scroll container, no scrolling happens.");this._setFocusToNode(f);}}else{this._setFocusToNode(f);this._adjustAndShowArrow();}};
sap.suite.ui.commons.ProcessFlow.prototype._setScrollWidth=function(){switch(this.getZoomLevel()){case(sap.suite.ui.commons.ProcessFlowZoomLevel.One):this._scrollStep=240;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Two):this._scrollStep=192;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Three):this._scrollStep=168;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Four):this._scrollStep=128;break;}};
sap.suite.ui.commons.ProcessFlow.prototype._getLastNavigationFocusElement=function(){return this._lastNavigationFocusElement;};
sap.suite.ui.commons.ProcessFlow.prototype._getNode=function(n,a){for(var i=0;i<a.length;i++){if(a[i].getNodeId()===n.toString()){return a[i];}}};
sap.suite.ui.commons.ProcessFlow.prototype._getLane=function(l){for(var i=0;i<this._internalLanes.length;i++){if(this._internalLanes[i].getLaneId()===l){return this._internalLanes[i];}}};
sap.suite.ui.commons.ProcessFlow._getChildIdByElement=function(c){if(typeof c==='object'){return c.nodeId;}else{return c;}};
sap.suite.ui.commons.ProcessFlow.prototype._isHeaderMode=function(){var n=this.getNodes();return!n||(n.length===0);};
sap.suite.ui.commons.ProcessFlow.prototype._getScrollContainer=function(){return this.$(sap.suite.ui.commons.ProcessFlow._constants.scrollContainer);};
sap.suite.ui.commons.ProcessFlow.prototype._handleException=function(e){var t=this._resBundle.getText('PF_ERROR_INPUT_DATA');this.fireOnError({text:t});jQuery.sap.log.error("Error loading data for the process flow with id : "+this.getId());if(e instanceof Array){for(var i=0;i<e.length;i++){jQuery.sap.log.error("Detailed description ("+i+") :"+e[i]);}}else{jQuery.sap.log.error("Detailed description  :"+e);}};
sap.suite.ui.commons.ProcessFlow.prototype._getAriaText=function(){var a=this._resBundle.getText('PF_ARIA_PROCESS_FLOW');return a;};
sap.suite.ui.commons.ProcessFlow.prototype._updateLanesFromNodes=function(){sap.suite.ui.commons.ProcessFlow.NodeElement._createNodeElementsFromProcessFlowNodes(this.getNodes(),this.getLanes());var i=this._arrangeNodesByParentChildRelation(this.getNodes());this._internalLanes=sap.suite.ui.commons.ProcessFlow.NodeElement._updateLanesFromNodes(this.getLanes(),i).lanes;};
sap.suite.ui.commons.ProcessFlow.prototype._getOrCreateLaneMap=function(){if(!this._internalLanes||this._internalLanes.length<=0){this._updateLanesFromNodes();}var l=sap.suite.ui.commons.ProcessFlow.NodeElement._createMapFromLanes(this._internalLanes,jQuery.proxy(this.ontouchend,this),this._isHeaderMode()).positionMap;return l;};
sap.suite.ui.commons.ProcessFlow.prototype._arrangeNodesByParentChildRelation=function(a){var I=a?a.length:0;var c=[];var i,j;if(I>0){this._setParentForNodes(a);for(i=0;i<I;i++){c=a[i].getChildren();if(c){var C=c.length;for(j=0;j<C;j++){c[j]=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(c[j]).toString();}}for(j=0;j<i;j++){if(jQuery.inArray(a[j].getNodeId(),c)>-1&&a[j].getLaneId()===a[i].getLaneId()){a.splice(j,0,a[i]);a.splice(i+1,1);a=this._arrangeNodesByParentChildRelation(a);break;}}}}return a;};
sap.suite.ui.commons.ProcessFlow.prototype._getOrCreateProcessFlow=function(){if(!this._internalLanes||this._internalLanes.length<=0){this._updateLanesFromNodes();}this.applyNodeDisplayState();var I=this.getNodes();var r=sap.suite.ui.commons.ProcessFlow.NodeElement._createNodeElementsFromProcessFlowNodes(I,this._internalLanes);var e=r.elementById;var E=r.elementsByLane;sap.suite.ui.commons.ProcessFlow.NodeElement._calculateLaneStatePieChart(E,this._internalLanes,I,this);var c=this._calculateMatrix(e);c=this._addFirstAndLastColumn(c);for(var i=0;i<c.length;i++){for(var j=0;j<c[i].length;j++){if(c[i][j]instanceof sap.suite.ui.commons.ProcessFlow.NodeElement){c[i][j]=e[c[i][j].nodeId].oNode;}}}this._internalCalcMatrix=c;return c;};
sap.suite.ui.commons.ProcessFlow.prototype._addFirstAndLastColumn=function(c){if(!c||c.length<=0){return[];}var o=c.length;for(var i=0;i<o;i++){c[i].unshift(null);c[i].push(null);}return c;};
sap.suite.ui.commons.ProcessFlow.prototype._calculateMatrix=function(e){var I,E,l,r,c;if(!e||(e.length===0)){return[];}I=new sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation(this);I.checkInputNodeConsistency(e);E=I._retrieveInfoFromInputArray(e);I._resetPositions();l=E.highestLanePosition+1;r=Math.max(Object.keys(e).length,2);c=I._createMatrix(r,l);for(var i=0;i<E.rootElements.length;i++){I.iPositionY=E.rootElements[i].lane;c=I.processCurrentElement(E.rootElements[i],e,c);}if(this._isLayoutOptimized){I._optimizeMatrix(c,e);}c=I._doubleColumnsInMatrix(c);c=I._calculatePathInMatrix(c);c=I._removeEmptyLines(c);return c;};
sap.suite.ui.commons.ProcessFlow.NodeElement=function(i,l,n,a){this.nodeId=i;this.lane=l;this.state=n.getState();this.displayState=n._getDisplayState();this.isProcessed=false;if(jQuery.isArray(a)){this.aParent=a;}else{this.oParent=a;}this.oNode=n;};
sap.suite.ui.commons.ProcessFlow.NodeElement._initNodeElement=function(i,l,n,a){return new sap.suite.ui.commons.ProcessFlow.NodeElement(i,l,n,a);};
sap.suite.ui.commons.ProcessFlow.NodeElement.prototype={toString:function(){return this.nodeId;},containsChildren:function(t){if(!t){return false;}if(!(t instanceof sap.suite.ui.commons.ProcessFlow.NodeElement)){return false;}if(this.oNode.getChildren()&&t.oNode.getChildren()&&this.oNode.getChildren().length&&t.oNode.getChildren().length){for(var i=0;i<this.oNode.getChildren().length;i++){if(t.oNode.getChildren().indexOf(this.oNode.getChildren()[i])>=0){return true;}}}return false;}};
sap.suite.ui.commons.ProcessFlow.NodeElement._calculateLaneStatePieChart=function(l,a,b,p){if(!l||!a||!b){return;}for(var i=0;i<b.length;i++){p._bHighlightedMode=b[i].getHighlighted();if(p._bHighlightedMode){break;}}var P,n,N,c,C;for(var i=0;i<a.length;i++){var L=a[i];var o=l[L.getLaneId()];if(!o){continue;}P=0;n=0;N=0;c=0;C=0;for(var j=0;j<o.length;j++){if(!p._bHighlightedMode||(o[j].oNode._getDisplayState()==sap.suite.ui.commons.ProcessFlowDisplayState.Highlighted||o[j].oNode._getDisplayState()==sap.suite.ui.commons.ProcessFlowDisplayState.HighlightedFocused||o[j].oNode._getDisplayState()==sap.suite.ui.commons.ProcessFlowDisplayState.SelectedHighlighted||o[j].oNode._getDisplayState()==sap.suite.ui.commons.ProcessFlowDisplayState.SelectedHighlightedFocused)){switch(o[j].oNode.getState()){case sap.suite.ui.commons.ProcessFlowNodeState.Positive:P++;break;case sap.suite.ui.commons.ProcessFlowNodeState.Negative:n++;break;case sap.suite.ui.commons.ProcessFlowNodeState.Planned:c++;break;case sap.suite.ui.commons.ProcessFlowNodeState.Neutral:N++;break;case sap.suite.ui.commons.ProcessFlowNodeState.PlannedNegative:n++;break;case sap.suite.ui.commons.ProcessFlowNodeState.Critical:C++;break;}}}var s=[{state:sap.suite.ui.commons.ProcessFlowNodeState.Positive,value:P},{state:sap.suite.ui.commons.ProcessFlowNodeState.Negative,value:n},{state:sap.suite.ui.commons.ProcessFlowNodeState.Neutral,value:N},{state:sap.suite.ui.commons.ProcessFlowNodeState.Planned,value:c},{state:sap.suite.ui.commons.ProcessFlowNodeState.Critical,value:C}];L.setState(s);}};
sap.suite.ui.commons.ProcessFlow.NodeElement._updateLanesFromNodes=function(p,a){var r=sap.suite.ui.commons.ProcessFlow.NodeElement._createMapFromLanes(p,null,false);var l=r.positionMap;var L=r.idMap;var n={};var t=p.slice();var P;var T={};var b=0;for(var i=0;i<a.length;i++){n[a[i].getNodeId()]=a[i];}for(var i=0;i<a.length;i++){var c=a[i];var C=c.getChildren()||[];var d=1;var N=null;var o=null;for(var j=0;j<C.length;j++){var e=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(C[j]);var f=n[e];if(!f){jQuery.sap.log.error("Node "+e+" is not defined but used as child of node "+c.getNodeId());}if(f&&(c.getLaneId()==f.getLaneId())){N=f.getLaneId()+d;o=L[N];if(!o){var g=L[c.getLaneId()];o=sap.suite.ui.commons.ProcessFlow.NodeElement._createNewProcessFlowElement(g,N,g.getPosition()+d);L[o.getLaneId()]=o;t.splice(o.getPosition(),0,o);}f._setMergedLaneId(o.getLaneId());}sap.suite.ui.commons.ProcessFlow.NodeElement._changeLaneOfChildren(c.getLaneId(),f,n);}if(o){T={};P=false;for(var k in l){if(o.getLaneId()==l[k].getLaneId()){P=true;break;}if(parseInt(k)>=o.getPosition()){var h=l[k];T[h.getPosition()+d]=h;}}if(!P){for(var m in T){b=parseInt(m);T[b]._setMergedPosition(b);}T[o.getPosition()]=o;for(var v=0;v<o.getPosition();v++){T[v]=l[v];}l=T;}}}return{lanes:t,nodes:a};};
sap.suite.ui.commons.ProcessFlow.NodeElement._changeLaneOfChildren=function(l,c,n){var C=c.getChildren();if(C){for(var i=0;i<C.length;i++){var s=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(C[i]);var o=n[s];if(o.getLaneId()==l){o._setMergedLaneId(c.getLaneId());sap.suite.ui.commons.ProcessFlow.NodeElement._changeLaneOfChildren(l,o,n);}}}};
sap.suite.ui.commons.ProcessFlow.NodeElement._createNewProcessFlowElement=function(o,n,a){var c=new sap.suite.ui.commons.ProcessFlowLaneHeader({laneId:n,iconSrc:o.getIconSrc(),text:o.getText(),state:o.getState(),position:a,zoomLevel:o.getZoomLevel()});return c;};
sap.suite.ui.commons.ProcessFlow.NodeElement._createMapFromLanes=function(p,t,a){var l,L={},b={},c=p?p.length:0,i=0;if(!c){return{};}else{while(i<c){l=p[i];if(l instanceof sap.suite.ui.commons.ProcessFlowLaneHeader){L[l.getPosition()]=l;b[l.getLaneId()]=l;if(t){l.attachPress(t);}l._setHeaderMode(a);}i++;}return{positionMap:L,idMap:b};}};
sap.suite.ui.commons.ProcessFlow.NodeElement._createNodeElementsFromProcessFlowNodes=function(p,a){var l={},L={},P={},n,N=p?p.length:0,s,o,b=a?a.length:0,c,d=[],e,C,f,g,i,j,I={};if(N===0){return{elementById:{},elementsByLane:{}};}if(b===0){throw["No lane definition although there is a node definition."];}i=0;while(i<b){o=a[i];c=o.getLaneId();e=o.getPosition();if(l[c]){throw["The lane with id: "+c+" is defined at least twice. (Lane error)"];}l[c]=e;if(jQuery.inArray(e,d)>-1){throw["The position "+e+" is defined at least twice. (Lane error)."];}else{d.push(e);}L[c]=[];i++;}i=0;while(i<N){n=p[i];if(n instanceof sap.suite.ui.commons.ProcessFlowNode){s=n.getNodeId();c=n.getLaneId();C=n.getChildren()||[];g=C.length;j=0;while(j<g){f=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(C[j]);P[f]=P[f]||[];P[f].push(s);j++;}}i++;}i=0;while(i<N){n=p[i];if(n instanceof sap.suite.ui.commons.ProcessFlowNode){s=n.getNodeId();if(!s){throw["There is a node which has no node id defined. (Title="+n.getTitle()+") and array position: "+i];}c=n.getLaneId();e=l[c];if(typeof e!=='number'){throw["For the node "+s+" position (lane) is not defined."];}if(!I[s]){I[s]=sap.suite.ui.commons.ProcessFlow.NodeElement._initNodeElement(s,e,n,P[s]);L[c].push(I[s]);}else{throw["The node id "+s+" is used second time."];}}i++;}return{elementById:I,elementsByLane:L};};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation=function(p){this.parentControl=p;this.iPositionX=0;this.iPositionY=0;this.nodePositions={};this.mapChildToNode={};};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._optimizeMatrix=function(m,e){var l;do{l=false;for(var a=0;a<m[0].length;a++){for(var b=0;b<m.length-1;b++){if(!m[b][a]){var n=false;for(var i=b+1;i<m.length;i++){if(m[i][a]){n=true;break;}}if(!n){break;}if(this._optimizeLane(m,b,a,e)){l=true;}}}}}while(l);};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._optimizeLane=function(m,r,l,e){for(var i=r+1;i<m.length;i++){if(m[i][l]){var n=m[i][l];if(this._verifyOptimizeLane(m,r,i,l,e)){m[r][l]=n;this.nodePositions[n.nodeId].x=r;m[i][l]=null;return true;}else{return false;}}}return false;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._verifyOptimizeLane=function(m,r,e,l,a){var n=m[e][l].oNode;if(n&&n.getChildren()){var c=m[e][l].oNode.getChildren();for(var i=0;i<c.length;i++){var N=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(c[i]);var C=a[N].lane;for(var j=l+1;j<C;j++){if(m[r][j]){return false;}}}}var o=m[e][l].nodeId;var O=this.nodePositions[o];var p=m[e][l].aParent;if(p){for(var i=0;i<p.length;i++){var N=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(p[i]);if(l-1!==a[N].lane){return false;}var b=this.nodePositions[N];if(b.x>=O.x){return false;}}}for(var i=0;i<l;i++){for(var j=0;j<m.length;j++){if(m[j][i]&&m[j][i].oNode){var N=m[j][i].nodeId;var P=this.nodePositions[N];var c=m[j][i].oNode.getChildren();if(c){for(var k=0;k<c.length;k++){var s=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(c[k]);var d=this.nodePositions[s];if(a[s].lane>l&&!((P.x<r&&d.x<r)||((P.x>r&&d.x>r)))){return false;}}}}}}if(n._hasChildren()){for(var i=0;i<r;i++){if(m[i][l]){var c=m[i][l].oNode.getChildren();if(c){for(var j=0;j<c.length;j++){var N=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(c[j]);var E=a[N];var f=this.nodePositions[N];if(E.lane>l&&f.x>=r&&!n._hasChildrenWithNodeId(N)){return false;}}}}}}return true;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.checkInputNodeConsistency=function(e){var r=[],j,c,n,C,E;Object.keys(e).forEach(function(s){E=e[s];C=E.oNode.getChildren();n=C?C.length:0;j=0;while(j<n){c=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(C[j]);if(!e[c]){r.push("Node identificator "+c+" used in children definition is not presented as the node itself. Element : "+E.nodeId);}j++;}});if(r.length>0){throw r;}};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._resetPositions=function(){this.iPositionX=0;this.iPositionY=0;delete this.nodePositions;delete this.mapChildToNode;this.nodePositions={};this.mapChildToNode={};};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._createMatrix=function(l){l=parseInt(l,10);var c=new Array(l||0);var i=l;if(arguments.length>1){var a=Array.prototype.slice.call(arguments,1);while(i--){c[l-1-i]=this._createMatrix.apply(this,a);}}return c;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._retrieveInfoFromInputArray=function(e){var l=0,r=[],E;Object.keys(e).forEach(function(s){E=e[s];if(!E.oParent&&!E.aParent){r.push(E);}if(l<E.lane){l=E.lane;}});return{'highestLanePosition':l,'rootElements':r};};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._doubleColumnsInMatrix=function(c){var m=0;for(var i=0;i<c.length;i++){m=m>c[i].length?m:c[i].length;}var t=new Array(c.length||0);for(var i=0;i<t.length;i++){t[i]=new Array(m*2-1);for(var j=0;j<m;j++){if(c[i][j]){t[i][2*j]=c[i][j];}}}return t;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._removeEmptyLines=function(o){var l=0;for(var i=0;i<o.length;i++){for(var j=0;j<o[i].length;j++){if(o[i][j]){l++;break;}}}var r=this._createMatrix(l,o[0].length);for(var i=0;i<l;i++){for(var j=0;j<o[i].length;j++){r[i][j]=null;if(o[i][j]){r[i][j]=o[i][j];}}}return r;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._sortBasedOnChildren=function(n,e){var E={},a,l=null,L,c,C,s=[],S,b,p;if(n){n.forEach(function(o){var d=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(o);a=E[e[d].lane];if(!a){E[e[d].lane]=a=[];}a.push(e[d]);});}else{return[];}L=[];for(l in E){L.push(l);E[l].sort(function(d,f){c=(d.oNode.getChildren()||[]).length;C=(f.oNode.getChildren()||[]).length;return C-c;});}L=L.sort(function(d,f){return f-d;});L.forEach(function(d){S=E[d];if(S.length>1){b=[];p=S.shift();while(p){if(b.indexOf(p)<0){b.push(p);}S.forEach(function(o){if(p.containsChildren(o)){b.push(o);}});p=S.shift();}s=s.concat(b);}else{s=s.concat(S);}});return s;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._calculatePathInMatrix=function(o){var c=null;for(var k in this.nodePositions){if(this.nodePositions.hasOwnProperty(k)){c=this.nodePositions[k];var C=c.c.oNode.getChildren();for(var i=0;C&&i<C.length;i++){var s=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(C[i]);var p=this.nodePositions[s];o=this._calculateSingleNodeConnection(c,p,c.x,c.y,p.x,p.y,o);}}}return o;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._calculateSingleNodeConnection=function(n,a,p,b,c,d,o){var h=d-b;var v=c-p;if(h<0){var e=["Problem with negative horizontal movement","Parent node is "+n.c.toString(),"Children node is "+a.c.toString(),"Coordinates : '"+p+"','"+b+"','"+c+"','"+d+"'"];throw e;}else if(v<=-1){var N=this._checkIfHorizontalLinePossible(o,c,b+2,d);var P=d-1;if(N){P=b+1;}var i=p;if(N){i=c;}o[p][P]=this._createConnectionElement(o[p][P],sap.suite.ui.commons.ProcessFlow._cellEdgeConstants.LU,n,a,false);o=this._writeVerticalLine(o,p,c,P,n,a);o[c][P]=this._createConnectionElement(o[c][P],sap.suite.ui.commons.ProcessFlow._cellEdgeConstants.UR,n,a,(P==d-1));var s=b+2;var E=d;if(!N){s=b+1;E=P+1;}o=this._writeHorizontalLine(o,i,s,E,n,a);}else if(v===0){o=this._writeHorizontalLine(o,p,b+1,d,n,a);}else if(v===1){o[p][b+1]=this._createConnectionElement(o[p][b+1],sap.suite.ui.commons.ProcessFlow._cellEdgeConstants.LD,n,a,false);o[c][b+1]=this._createConnectionElement(o[c][b+1],sap.suite.ui.commons.ProcessFlow._cellEdgeConstants.DR,n,a,(b+1)===(d-1));o=this._writeHorizontalLine(o,c,b+2,d,n,a);}else{o[p][b+1]=this._createConnectionElement(o[p][b+1],sap.suite.ui.commons.ProcessFlow._cellEdgeConstants.LD,n,a,false);o=this._writeVerticalLine(o,c,p,b+1,n,a);o[c][b+1]=this._createConnectionElement(o[c][b+1],sap.suite.ui.commons.ProcessFlow._cellEdgeConstants.DR,n,a,(b+1)===(d-1));o=this._writeHorizontalLine(o,c,b+2,d,n,a);}return o;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._writeVerticalLine=function(o,f,l,c,n,a){for(var j=f-1;j>l;j--){o[j][c]=this._createConnectionElement(o[j][c],sap.suite.ui.commons.ProcessFlow._cellEdgeConstants.DU,n,a,false);}return o;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._checkIfHorizontalLinePossible=function(o,r,f,l){var L=true;for(var i=f;i<l;i++){if(o[r][i]instanceof sap.suite.ui.commons.ProcessFlow.NodeElement){L=false;break;}}return L;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._writeHorizontalLine=function(o,r,f,l,n,a){var p=(r==a.x);if(!p){l--;}for(var i=f;i<l;i++){o[r][i]=this._createConnectionElement(o[r][i],sap.suite.ui.commons.ProcessFlow._cellEdgeConstants.LR,n,a,(i==(l-1))&&p);}return o;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._createConnectionElement=function(o,a,i,t,b){var n=o;if(!n){n=new sap.suite.ui.commons.ProcessFlowConnection();}if(n instanceof sap.suite.ui.commons.ProcessFlowConnection){var d=this._calculateConnectionDisplayStateBySourceAndTargetNode(i.c.oNode,t.c.oNode);var c={flowLine:a,targetNodeState:t.c.state,displayState:d,hasArrow:b};n.addConnectionData(c);}return n;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._calculateConnectionDisplayStateBySourceAndTargetNode=function(s,t){var S=s.getHighlighted();var b=s.getSelected();var a=s._getDimmed();var T=t.getHighlighted();var c=t.getSelected();var d=t._getDimmed();var D=sap.suite.ui.commons.ProcessFlowDisplayState.Regular;if(b&&c){D=sap.suite.ui.commons.ProcessFlowDisplayState.Selected;}else if(S&&T){D=sap.suite.ui.commons.ProcessFlowDisplayState.Highlighted;}else if((a||d)||S&&c||b&&T){D=sap.suite.ui.commons.ProcessFlowDisplayState.Dimmed;}return D;};
sap.suite.ui.commons.ProcessFlow.prototype.addNode=function(n){return this.addAggregation("nodes",n,false);};
sap.suite.ui.commons.ProcessFlow.prototype._switchCursors=function($,c,a){if($.hasClass(c)){$.removeClass(c);}if(!$.hasClass(a)){$.addClass(a);}};
sap.suite.ui.commons.ProcessFlow.prototype._clearHandlers=function($){$.bind(this._mousePreventEvents,jQuery.proxy(this._handlePrevent,this));};
sap.suite.ui.commons.ProcessFlow.prototype._initZoomLevel=function(){if(this.$()){var w=this.$().width();if(w){if(w<sap.m.ScreenSizes.tablet){this.setZoomLevel(sap.suite.ui.commons.ProcessFlowZoomLevel.Four);}else if(w<sap.m.ScreenSizes.desktop){this.setZoomLevel(sap.suite.ui.commons.ProcessFlowZoomLevel.Three);}else{this.setZoomLevel(sap.suite.ui.commons.ProcessFlowZoomLevel.Two);}}}};
sap.suite.ui.commons.ProcessFlow.prototype._registerMouseWheel=function(e){var d=e.originalEvent.wheelDelta||-e.originalEvent.detail;if(d===0){d=-e.originalEvent.deltaY;}var t=this;if(e&&!e.isDefaultPrevented()){e.preventDefault();e.originalEvent.returnValue=false;}var w=300;var D=function(){var i=new Date()-t._wheelTimestamp;if(i<w){t._wheelTimeout=jQuery.sap.delayedCall(w-i,t,D);}else{t._wheelTimeout=null;t._wheelCalled=false;}};if(!t._wheelCalled){t._wheelCalled=true;if(d<0){this._isFocusChanged=true;t.zoomOut();}else{this._isFocusChanged=true;t.zoomIn();}}if(!t._wheelTimeout){t._wheelTimestamp=new Date();t._wheelTimeout=jQuery.sap.delayedCall(w,t,D);}if(e&&!e.isPropagationStopped()){e.stopPropagation();}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation();}};
sap.suite.ui.commons.ProcessFlow.prototype._setFocusToNode=function(n){if(n){if(n instanceof sap.suite.ui.commons.ProcessFlowNode){jQuery("#"+n.sId).parent().focus();n._setNavigationFocus(true);n.rerender();}else if(n instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel){n.$().focus();n._setNavigationFocus(true);}}else if(this._lastNavigationFocusElement){if(this._lastNavigationFocusElement instanceof sap.suite.ui.commons.ProcessFlowNode){jQuery("#"+this._lastNavigationFocusElement.sId).parent().focus();this._lastNavigationFocusElement._setNavigationFocus(true);this._lastNavigationFocusElement.rerender();}else if(this._lastNavigationFocusElement instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel){this._lastNavigationFocusElement.$().focus();this._lastNavigationFocusElement._setNavigationFocus(true);}}};
sap.suite.ui.commons.ProcessFlow.prototype._changeNavigationFocus=function(n,a){if(n&&a&&(n.getId()!==a.getId())){jQuery.sap.log.debug("Rerendering PREVIOUS node with id '"+n.getId()+"' navigation focus : "+n._getNavigationFocus());n._setNavigationFocus(false);if(n instanceof sap.suite.ui.commons.ProcessFlowNode){n.rerender();}}if(a){jQuery.sap.log.debug("Rerendering CURRENT node with id '"+a.getId()+"' navigation focus : "+a._getNavigationFocus());a._setNavigationFocus(true);if(a instanceof sap.suite.ui.commons.ProcessFlowNode){a.rerender();}this._lastNavigationFocusElement=a;this._onFocusChanged();}};
sap.suite.ui.commons.ProcessFlow.prototype._moveOnePage=function(d,a){d=d||sap.suite.ui.commons.ProcessFlow._enumMoveDirection.UP;a=a||false;var p=0,P=0;var b=0,c=0;var n=0;var N=false;for(var i=0;i<this._internalCalcMatrix.length;i++){for(var j=0;j<this._internalCalcMatrix[i].length;j++){if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&this._internalCalcMatrix[i][j]._getNavigationFocus()){p=i;P=j;break;}else if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][j]._getVisibleLabel();if(l&&l._getNavigationFocus()){p=i;P=j;break;}}}}if(a){if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.UP){for(var j=P-1;j>=0&&n<this._jumpOverElements;j--){if(this._internalCalcMatrix[p][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[p][j].getHighlighted())){n++;b=p;c=j;N=true;}else if(this._internalCalcMatrix[p][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[p][j]._getVisibleLabel();if(l&&l.getEnabled()){n++;b=p;c=j;N=true;}}}}else if(d===sap.suite.ui.commons.ProcessFlow._enumMoveDirection.DOWN){for(var j=P+1;j<this._internalCalcMatrix[p].length&&n<this._jumpOverElements;j++){if(this._internalCalcMatrix[p][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[p][j].getHighlighted())){n++;b=p;c=j;N=true;}else if(this._internalCalcMatrix[p][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[p][j]._getVisibleLabel();if(l&&l.getEnabled()){n++;b=p;c=j;N=true;}}}}}else{if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.UP){for(var i=p-1;i>=0&&n<this._jumpOverElements;i--){if(this._internalCalcMatrix[i][P]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[i][P].getHighlighted())){n++;b=i;c=P;N=true;}else if(this._internalCalcMatrix[i][P]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][P]._getVisibleLabel();if(l&&l.getEnabled()){n++;b=i;c=P;N=true;}}}}else if(d===sap.suite.ui.commons.ProcessFlow._enumMoveDirection.DOWN){for(var i=p+1;i<this._internalCalcMatrix.length&&n<this._jumpOverElements;i++){if(this._internalCalcMatrix[i][P]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[i][P].getHighlighted())){n++;b=i;c=P;N=true;}else if(this._internalCalcMatrix[i][P]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][P]._getVisibleLabel();if(l&&l.getEnabled()){n++;b=i;c=P;N=true;}}}}}if(N){if(this._internalCalcMatrix[p][P]instanceof sap.suite.ui.commons.ProcessFlowConnection){this._internalCalcMatrix[p][P]._getVisibleLabel()._setNavigationFocus(false);}else{this._internalCalcMatrix[p][P]._setNavigationFocus(false);}if(this._internalCalcMatrix[b][c]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[b][c]._getVisibleLabel();l._setNavigationFocus(true);this._lastNavigationFocusElement=l;}else{this._internalCalcMatrix[b][c]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[b][c];}}return N;};
sap.suite.ui.commons.ProcessFlow.prototype._moveHomeEnd=function(d,c){d=d||sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT;c=c||false;var p=0,P=0;var a=0,b=0;var n=false;for(var i=0;i<this._internalCalcMatrix.length;i++){for(var j=0;j<this._internalCalcMatrix[i].length;j++){if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&this._internalCalcMatrix[i][j]._getNavigationFocus()){p=i;P=j;break;}else if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][j]._getVisibleLabel();if(l&&l._getNavigationFocus()){p=i;P=j;break;}}}}if(c){if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT){for(var i=0;i<p;i++){if(this._internalCalcMatrix[i][P]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[i][P].getHighlighted())){a=i;b=P;n=true;break;}else if(this._internalCalcMatrix[i][P]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][P]._getVisibleLabel();if(l&&l.getEnabled()){a=i;b=P;n=true;break;}}}}else if(d===sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT){for(var i=this._internalCalcMatrix.length-1;i>p;i--){if(this._internalCalcMatrix[i][P]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[i][P].getHighlighted())){a=i;b=P;n=true;break;}else if(this._internalCalcMatrix[i][P]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][P]._getVisibleLabel();if(l&&l.getEnabled()){a=i;b=P;n=true;break;}}}}}else{if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT){for(var j=0;j<P;j++){if(this._internalCalcMatrix[p][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[p][j].getHighlighted())){a=p;b=j;n=true;break;}else if(this._internalCalcMatrix[p][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[p][j]._getVisibleLabel();if(l&&l.getEnabled()){a=p;b=j;n=true;break;}}}}else if(d===sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT){for(var j=this._internalCalcMatrix[p].length-1;j>P;j--){if(this._internalCalcMatrix[p][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[p][j].getHighlighted())){a=p;b=j;n=true;break;}else if(this._internalCalcMatrix[p][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[p][j]._getVisibleLabel();if(l&&l.getEnabled()){a=p;b=j;n=true;break;}}}}}if(n){if(this._internalCalcMatrix[p][P]instanceof sap.suite.ui.commons.ProcessFlowConnection){this._internalCalcMatrix[p][P]._getVisibleLabel()._setNavigationFocus(false);}else{this._internalCalcMatrix[p][P]._setNavigationFocus(false);}if(this._internalCalcMatrix[a][b]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[a][b]._getVisibleLabel();l._setNavigationFocus(true);this._lastNavigationFocusElement=l;}else{this._internalCalcMatrix[a][b]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[a][b];}}return n;};
sap.suite.ui.commons.ProcessFlow.prototype._moveToNextElement=function(d,s){d=d||sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT;if(sap.ui.getCore().getConfiguration().getRTL()){if(d===sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT){d=sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT;}else if(d===sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT){d=sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT;}}s=s||1;var f=false;var n=false;var p=0,P=1;if(!this._internalCalcMatrix){return;}var a=0,b=0;for(var i=0;i<this._internalCalcMatrix.length;i++){for(var j=0;j<this._internalCalcMatrix[i].length;j++){if(this._internalCalcMatrix[i][j]){if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&this._internalCalcMatrix[i][j]._getNavigationFocus()){p=a=i;P=b=j;f=true;break;}else if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][j]._getVisibleLabel();if(l&&l._getNavigationFocus()&&l.getEnabled()){p=a=i;P=b=j;f=true;break;}}}}if(f){break;}}if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT){for(var i=a;i<this._internalCalcMatrix.length;i++){for(var j=b+1;j<this._internalCalcMatrix[i].length;j++){if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowNode){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][j].getHighlighted())){this._internalCalcMatrix[i][j]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[i][j];n=true;break;}}else if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][j]._getVisibleLabel();if(l&&f&&l.getEnabled()){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;n=true;break;}}}b=0;if(n){break;}}}if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT){for(var i=a;i>=0;i--){for(var j=b-1;j>=0;j--){if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowNode){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][j].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[i][j]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[i][j];n=true;break;}}else if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][j]._getVisibleLabel();if(l&&f&&l.getEnabled()){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;n=true;break;}}}if(i>0){b=this._internalCalcMatrix[i-1].length;}if(n){break;}}}var D,c,e;if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.UP){for(var i=a-1;i>=0;i--){D=0;while(!n){c=b-D;e=b+D;if(c>=0&&this._internalCalcMatrix[i][c]instanceof sap.suite.ui.commons.ProcessFlowNode){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][c].getHighlighted())){this._internalCalcMatrix[i][c]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[i][c];n=true;break;}}else if(c>=0&&this._internalCalcMatrix[i][c]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][c]._getVisibleLabel();if(l&&f&&l.getEnabled()){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;n=true;break;}}if(e<this._internalCalcMatrix[i].length&&this._internalCalcMatrix[i][e]instanceof sap.suite.ui.commons.ProcessFlowNode){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][e].getHighlighted())){this._internalCalcMatrix[i][e]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[i][e];n=true;break;}}else if(e>=0&&this._internalCalcMatrix[i][e]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][e]._getVisibleLabel();if(l&&f&&l.getEnabled()){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;n=true;break;}}if(c<0&&e>this._internalCalcMatrix[i].length){break;}D++;}}}if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.DOWN){for(var i=a+1;i<this._internalCalcMatrix.length;i++){D=0;while(!n){c=b-D;e=b+D;if(c>=0&&this._internalCalcMatrix[i][c]instanceof sap.suite.ui.commons.ProcessFlowNode){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][c].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[i][c]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[i][c];n=true;break;}}else if(c>=0&&this._internalCalcMatrix[i][c]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][c]._getVisibleLabel();if(l&&f&&l.getEnabled()){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;n=true;break;}}if(e<this._internalCalcMatrix[i].length&&this._internalCalcMatrix[i][e]instanceof sap.suite.ui.commons.ProcessFlowNode){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][e].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[i][e]._setNavigationFocus(true);this._lastNavigationFocusElement=this._internalCalcMatrix[i][e];n=true;break;}}else if(e>=0&&this._internalCalcMatrix[i][e]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][e]._getVisibleLabel();if(l&&f&&l.getEnabled()){l._setNavigationFocus(true);this._lastNavigationFocusElement=l;n=true;break;}}if(c<0&&e>this._internalCalcMatrix[i].length){break;}D++;}}}if(n){if(this._internalCalcMatrix[p][P]instanceof sap.suite.ui.commons.ProcessFlowNode){this._internalCalcMatrix[p][P]._setNavigationFocus(false);}else{this._internalCalcMatrix[p][P]._getVisibleLabel()._setNavigationFocus(false);}}return n;};
sap.suite.ui.commons.ProcessFlow.prototype._getScrollContainerOnZoomChanged=function(s,$){s.scrollLeft=Math.round($.context.scrollWidth/s.scrollWidth*s.scrollLeft);s.scrollTop=Math.round($.context.scrollHeight/s.scrollHeight*s.scrollTop);s.scrollWidth=$.context.scrollWidth;s.scrollHeight=$.context.scrollHeight;return s;};
sap.suite.ui.commons.ProcessFlow.prototype._mergeLaneIdNodeStates=function(l){var p=0;var n=0;var N=0;var P=0;var c=0;for(var s=0;s<5;s++){for(var i=0;i<l.length;i++){switch(l[i][s].state){case sap.suite.ui.commons.ProcessFlowNodeState.Positive:p=p+l[i][s].value;break;case sap.suite.ui.commons.ProcessFlowNodeState.Negative:n=n+l[i][s].value;break;case sap.suite.ui.commons.ProcessFlowNodeState.Neutral:N=N+l[i][s].value;break;case sap.suite.ui.commons.ProcessFlowNodeState.Planned:P=P+l[i][s].value;break;case sap.suite.ui.commons.ProcessFlowNodeState.PlannedNegative:n=n+l[i][s].value;break;case sap.suite.ui.commons.ProcessFlowNodeState.Critical:c=c+l[i][s].value;break;}}}var r=[{state:sap.suite.ui.commons.ProcessFlowNodeState.Positive,value:p},{state:sap.suite.ui.commons.ProcessFlowNodeState.Negative,value:n},{state:sap.suite.ui.commons.ProcessFlowNodeState.Neutral,value:N},{state:sap.suite.ui.commons.ProcessFlowNodeState.Planned,value:P},{state:sap.suite.ui.commons.ProcessFlowNodeState.Critical,value:c}];return r;};
sap.suite.ui.commons.ProcessFlow.prototype._setFocusOnHeader=function(n){var t=jQuery.sap.byId(this.getId()+"-thead");if(n){t.focus();t.addClass("sapSuiteUiCommonsPFHeaderFocused");this._headerHasFocus=true;}else{t.removeClass("sapSuiteUiCommonsPFHeaderFocused");this._headerHasFocus=false;}};
sap.suite.ui.commons.ProcessFlow.prototype._scroll=function(d,a){var D=this._getScrollContainer().get(0);var s=D.scrollLeft;if(!!!sap.ui.Device.browser.internet_explorer&&this._bRtl){d=-d;}var S=s+d;jQuery(D).stop(true,true).animate({scrollLeft:S},a,jQuery.proxy(this._adjustAndShowArrow,this));};
sap.suite.ui.commons.ProcessFlow.prototype._adjustAndShowArrow=function(){this._checkOverflow(this._getScrollContainer().get(0),this.$());if(this.getScrollable()){this._moveArrowAndCounterVertical();}if(this._isFocusChanged){this._setFocusToNode(this._lastNavigationFocusElement);this._isFocusChanged=false;}};
sap.suite.ui.commons.ProcessFlow.prototype._getScrollingArrow=function(d){var s;if(sap.ui.Device.system.desktop){s="sap-icon://navigation-"+d+"-arrow";}else{s="sap-icon://slim-arrow-"+d;}var p={src:s};var l="sapPFHArrowScrollLeft";var r="sapPFHArrowScrollRight";var c=["sapPFHArrowScroll",l];var C=["sapPFHArrowScroll",r];if(d===sap.suite.ui.commons.ProcessFlow._constants.left){if(!this._oArrowLeft){this._oArrowLeft=sap.m.ImageHelper.getImageControl(this.getId()+sap.suite.ui.commons.ProcessFlow._constants.arrowScrollLeftMinus,null,this,p,c);}return this._oArrowLeft;}if(d===sap.suite.ui.commons.ProcessFlow._constants.right){if(!this._oArrowRight){this._oArrowRight=sap.m.ImageHelper.getImageControl(this.getId()+sap.suite.ui.commons.ProcessFlow._constants.arrowScrollRightMinus,null,this,p,C);}return this._oArrowRight;}};
sap.suite.ui.commons.ProcessFlow.prototype._checkScrolling=function(s,$){var S=false;if(s){if(s.scrollWidth>s.clientWidth){S=true;}}if(this._arrowScrollable!==S){$.toggleClass("sapPFHScrollable",S);$.toggleClass("sapPFHNotScrollable",!S);this._arrowScrollable=S;}return S;};
sap.suite.ui.commons.ProcessFlow.prototype._updateLeftCounter=function(){var s;if(!this._bRtl){s=this._getScrollContainer().scrollLeft();}else{s=this._getScrollContainer().scrollRightRTL();}var c=Math.round(s/this._scrollStep);this.$(sap.suite.ui.commons.ProcessFlow._constants.counterLeft).text(c.toString());return c;};
sap.suite.ui.commons.ProcessFlow.prototype._updateRightCounter=function(s,a){var S;var c;if(!this._bRtl){S=this._getScrollContainer().scrollLeft();c=Math.round((a-S-s)/this._scrollStep);}else{S=this._getScrollContainer().scrollLeftRTL();c=Math.round(S/this._scrollStep);}this.$(sap.suite.ui.commons.ProcessFlow._constants.counterRight).text(c.toString());return c;};
sap.suite.ui.commons.ProcessFlow.prototype._moveArrowAndCounterVertical=function(){var s=this._getScrollContainer().scrollTop();if(s>0){var a=this._iInitialArrowTop-s;var c=this._iInitialCounterTop-s;var d=this._iInitialCounterTop-this._iInitialArrowTop;if(a>0){this.$(sap.suite.ui.commons.ProcessFlow._constants.arrowScrollRight).css(sap.suite.ui.commons.ProcessFlow._constants.top,a+sap.suite.ui.commons.ProcessFlow._constants.px);this.$(sap.suite.ui.commons.ProcessFlow._constants.arrowScrollLeft).css(sap.suite.ui.commons.ProcessFlow._constants.top,a+sap.suite.ui.commons.ProcessFlow._constants.px);}else{this.$(sap.suite.ui.commons.ProcessFlow._constants.arrowScrollRight).css(sap.suite.ui.commons.ProcessFlow._constants.top,"0px");this.$(sap.suite.ui.commons.ProcessFlow._constants.arrowScrollLeft).css(sap.suite.ui.commons.ProcessFlow._constants.top,"0px");}if(c>d){this.$(sap.suite.ui.commons.ProcessFlow._constants.counterRight).css(sap.suite.ui.commons.ProcessFlow._constants.top,c+sap.suite.ui.commons.ProcessFlow._constants.px);this.$(sap.suite.ui.commons.ProcessFlow._constants.counterLeft).css(sap.suite.ui.commons.ProcessFlow._constants.top,c+sap.suite.ui.commons.ProcessFlow._constants.px);}else{this.$(sap.suite.ui.commons.ProcessFlow._constants.counterRight).css(sap.suite.ui.commons.ProcessFlow._constants.top,d+sap.suite.ui.commons.ProcessFlow._constants.px);this.$(sap.suite.ui.commons.ProcessFlow._constants.counterLeft).css(sap.suite.ui.commons.ProcessFlow._constants.top,d+sap.suite.ui.commons.ProcessFlow._constants.px);}}else{this.$(sap.suite.ui.commons.ProcessFlow._constants.arrowScrollRight).css(sap.suite.ui.commons.ProcessFlow._constants.top,this._iInitialArrowTop+sap.suite.ui.commons.ProcessFlow._constants.px);this.$(sap.suite.ui.commons.ProcessFlow._constants.arrowScrollLeft).css(sap.suite.ui.commons.ProcessFlow._constants.top,this._iInitialArrowTop+sap.suite.ui.commons.ProcessFlow._constants.px);this.$(sap.suite.ui.commons.ProcessFlow._constants.counterRight).css(sap.suite.ui.commons.ProcessFlow._constants.top,this._iInitialCounterTop+sap.suite.ui.commons.ProcessFlow._constants.px);this.$(sap.suite.ui.commons.ProcessFlow._constants.counterLeft).css(sap.suite.ui.commons.ProcessFlow._constants.top,this._iInitialCounterTop+sap.suite.ui.commons.ProcessFlow._constants.px);}};
sap.suite.ui.commons.ProcessFlow.prototype._checkOverflow=function(s,$){if(this._checkScrolling(s,$)&&s){this._setScrollWidth();var S=false;var b=false;var o=20;var i=this._getScrollContainer().scrollLeft();var a=s.scrollWidth;var c=s.clientWidth;if(Math.abs(a-c)==1){a=c;}if(!this._bRtl){if(i>o){S=true;}if((a>c)&&(i+c+o<a)){b=true;}}else{var d=jQuery(s);if(d.scrollLeftRTL()>o){b=true;}if(d.scrollRightRTL()>o){S=true;}}this._updateLeftCounter();this._updateRightCounter(c,a);if((b!==this._bPreviousScrollForward)||(S!==this._bPreviousScrollBack)){this._bPreviousScrollForward=b;this._bPreviousScrollBack=S;$.toggleClass("sapPFHScrollBack",S);$.toggleClass("sapPFHNoScrollBack",!S);$.toggleClass("sapPFHScrollForward",b);$.toggleClass("sapPFHNoScrollForward",!b);}}else{this._bPreviousScrollForward=false;this._bPreviousScrollBack=false;}};
sap.suite.ui.commons.ProcessFlow.prototype._setParentForNodes=function(a){var I=a?a.length:0;var c;var i,j;for(var C in a){a[C].removeAllAssociation(sap.suite.ui.commons.ProcessFlow._constants.parents,true);}for(i=0;i<I;i++){c=a[i].getChildren();if(c){for(j=0;j<c.length;j++){var o=this._getNode(sap.suite.ui.commons.ProcessFlow._getChildIdByElement(c[j]),a);if(o){o.addAssociation(sap.suite.ui.commons.ProcessFlow._constants.parents,a[i],true);}}}}};
sap.suite.ui.commons.ProcessFlow.prototype._getConnectionsMap=function(){var c=[];var n=this.getNodes();for(var i=0;i<n.length;i++){var p=this._getPositionOfNodeInMatrix(this._internalCalcMatrix,n[i]);var C=n[i].getChildren();if(C){for(var j=0;j<C.length;j++){var o={};o.sourceNode=n[i];var a=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(C[j]);var b=this._getNode(a,n);if(b){if(typeof C[j]==='object'){o.label=C[j].connectionLabel;}o.targetNode=b;var P=this._getPositionOfNodeInMatrix(this._internalCalcMatrix,o.targetNode);o.connectionParts=this._calculateConnectionParts(p,P);c.push(o);}}}}this._internalConnectionMap=c;return c;};
sap.suite.ui.commons.ProcessFlow.prototype._getPositionOfNodeInMatrix=function(m,n){var p={};for(var i=0;i<m.length;i++){var c=m[i];for(var j=0;j<c.length;j++){var a=c[j];if(a&&a instanceof sap.suite.ui.commons.ProcessFlowNode&&a.getNodeId()===n.getNodeId()){p.y=i;p.x=j;return p;}}}return p;};
sap.suite.ui.commons.ProcessFlow.prototype._calculateConnectionParts=function(p,a){var c=[];var s=p.y;var S=p.x;S++;c.push({x:S,y:s});if(a.y>=p.y){while(s<a.y){s++;c.push({x:S,y:s});}}else{while(s>a.y){s--;c.push({x:S,y:s});}}while(S<a.x-1){S++;c.push({x:S,y:s});}return c;};
sap.suite.ui.commons.ProcessFlow.prototype._getConnectionMapEntries=function(c){var f=[];var C=null;var e=null;if(this._internalConnectionMap){for(var i=0;i<this._internalConnectionMap.length;i++){e=this._internalConnectionMap[i];if(e.label&&e.label.getId()===c.getId()){C=e;break;}}e=null;for(var j=0;j<this._internalConnectionMap.length;j++){e=this._internalConnectionMap[j];if(e.targetNode&&e.targetNode.getNodeId()===C.targetNode.getNodeId()){f.push(e);}}}return f;};
sap.suite.ui.commons.ProcessFlow.prototype._createLabelPressEventArgs=function(c,a){var e={};var E=[];if(a){for(var i=0;i<a.length;i++){var o={sourceNode:a[i].sourceNode,targetNode:a[i].targetNode,label:a[i].label};E.push(o);}}e.selectedLabel=c;e.connections=E;return e;};
sap.suite.ui.commons.ProcessFlow.prototype.applyNodeDisplayState=function(){var I=this.getNodes(),n=I?I.length:0,i=0;if(n===0){return;}else{while(i<n){I[i]._setRegularState();i++;}i=0;while((i<n)&&!I[i].getHighlighted()&&!I[i].getSelected()){i++;}if(i<n){i=0;while(i<n){if(!I[i].getHighlighted()&&!I[i].getSelected()){I[i]._setDimmedState();}i++;}}}};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.checkInputNodeConsistency=function(e){var E=[],j,c,C,a,o,f=0;Object.keys(e).forEach(function(s){o=e[s];a=o.oNode.getChildren();C=a?a.length:0;if(o.oNode.getFocused()){f++;}j=0;while(j<C){c=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(a[j]);if(!e[c]){E.push("Node identificator "+c+" used in children definition is not presented as the node itself. Element : "+o.nodeId);}j++;}});if(E.length>0){throw E;}return f>1;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.processCurrentElement=function(c,e,m){var E,a,t=this,n=true,M=true;if(c.isProcessed){return m;}this.nodePositions[c.nodeId]={'c':c,'x':this.iPositionX,'y':this.iPositionY*2};m[this.iPositionX][this.iPositionY++]=c;E=c.oNode.getChildren();c.isProcessed=true;a=this._sortBasedOnChildren(E,e);if(a){a.forEach(function(C){if(!C.isProcessed){M=false;while(t.iPositionY<C.lane){m[t.iPositionX][t.iPositionY++]=null;}m=t.processCurrentElement(C,e,m);}else{if(n&&M){t.iPositionX++;n=false;}}});}if(!E||M){if(n){this.iPositionX++;}this.iPositionY=0;}return m;};
sap.suite.ui.commons.ProcessFlow.prototype.getZoomLevel=function(){return this._zoomLevel;};
sap.suite.ui.commons.ProcessFlow.prototype.setZoomLevel=function(z){if(!this._getScrollContainer()){return;}var $=this._getScrollContainer();var s=null;var S;if($.context){s={scrollWidth:$.context.scrollWidth,scrollHeight:$.context.scrollHeight,scrollLeft:$.context.scrollLeft,scrollTop:$.context.scrollTop};S=s;if(this._zoomLevel===z){this._isInitialZoomLevelNeeded=false;return;}}if(!(z in sap.suite.ui.commons.ProcessFlowZoomLevel)){this._handleException("\""+z+"\" is not a valid entry of the enumeration for property zoom level of ProcessFlow");return;}this._zoomLevel=z;if(this._isInitialZoomLevelNeeded){this._isInitialZoomLevelNeeded=false;this.invalidate();}else{this.rerender();}if(s){if(sap.ui.Device.support.touch||jQuery.sap.simulateMobileOnDesktop){var h=parseInt(this._getScrollContainer().css("height").slice(0,-2),10);var w=parseInt(this._getScrollContainer().css("width").slice(0,-2),10);var i=this._getScrollContainer()[0].scrollHeight;var a=this._getScrollContainer()[0].scrollWidth;if(this.getScrollable()&&(i>h||a>w)){this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabCursorClass);this._getScrollContainer().css("overflow","auto");}}$=this._getScrollContainer();S=this._getScrollContainerOnZoomChanged(s,$);$.scrollLeft(S.scrollLeft);$.scrollTop(S.scrollTop);this._adjustAndShowArrow();if(this._isFocusChanged){this._setFocusToNode();this._isFocusChanged=false;}}};
sap.suite.ui.commons.ProcessFlow.prototype.zoomOut=function(){var c=this.getZoomLevel();var n=c;switch(c){case(sap.suite.ui.commons.ProcessFlowZoomLevel.One):n=sap.suite.ui.commons.ProcessFlowZoomLevel.Two;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Two):n=sap.suite.ui.commons.ProcessFlowZoomLevel.Three;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Three):n=sap.suite.ui.commons.ProcessFlowZoomLevel.Four;break;}this.setZoomLevel(n);return this.getZoomLevel();};
sap.suite.ui.commons.ProcessFlow.prototype.zoomIn=function(){var c=this.getZoomLevel();var n=c;switch(c){case(sap.suite.ui.commons.ProcessFlowZoomLevel.Four):n=sap.suite.ui.commons.ProcessFlowZoomLevel.Three;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Three):n=sap.suite.ui.commons.ProcessFlowZoomLevel.Two;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Two):n=sap.suite.ui.commons.ProcessFlowZoomLevel.One;break;}this.setZoomLevel(n);return this.getZoomLevel();};
sap.suite.ui.commons.ProcessFlow.prototype.updateModel=function(){var n=this.getNodes();n.forEach(function(o){o._mergedLaneId=false;});var l=this.getLanes();l.forEach(function(o){o._mergedLanePosition=false;});this._internalLanes=[];if(this._isHeaderMode()){var L=this.getBindingInfo("lanes");this.getModel(L.model).refresh();}else{var N=this.getBindingInfo("nodes");this.getModel(N.model).refresh();}this.rerender();};
sap.suite.ui.commons.ProcessFlow.prototype.optimizeLayout=function(i){if(i===undefined){i=true;}if(this._isLayoutOptimized!==i){this._isLayoutOptimized=i;this.updateModel();}return this;};
sap.suite.ui.commons.ProcessFlow.prototype.getFocusedNode=function(){if(this._lastNavigationFocusElement){return this._lastNavigationFocusElement.sId;}};
sap.suite.ui.commons.ProcessFlow.prototype.updateNodesOnly=function(){var n=this.getBindingInfo("nodes");this.getModel(n.model).refresh();this.rerender();};
sap.suite.ui.commons.ProcessFlow.prototype.setSelectedPath=function(s,t){var n=this.getNodes();if(n){if(s&&t){var c=0;for(var i=0;i<n.length;i++){if(n[i].getNodeId()===s||n[i].getNodeId()===t){n[i].setSelected(true);c++;}else{n[i].setSelected(false);}}if(c==2){this.rerender();}}else if(!s&&!t){for(var i=0;i<n.length;i++){n[i].setSelected(false);}this.rerender();}}};
sap.suite.ui.commons.ProcessFlow.prototype.setShowLabels=function(v){var o=this.getShowLabels();if(o&&!v){this.setProperty("showLabels",v,true);if(!this.getShowLabels()){this.setSelectedPath(null,null);}}else{this.setProperty("showLabels",v);}};
sap.suite.ui.commons.ProcessFlow.prototype.setFocusToLabel=function(l){this._changeNavigationFocus(this._lastNavigationFocusElement,l);};
sap.suite.ui.commons.ProcessFlow.prototype.getNode=function(n){var N=this.getNodes();for(var i=0;i<N.length;i++){if(N[i].getProperty("nodeId")===n){return N[i];}}};
sap.suite.ui.commons.ProcessFlow.prototype.getLane=function(l){var L=this.getLanes();for(var i=0;i<L.length;i++){if(L[i].getProperty("laneId")===l){return L[i];}}};
